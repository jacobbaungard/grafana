"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5890],{19051:(U,$,t)=>{t.r($),t.d($,{EditNotificationChannelPage:()=>S,default:()=>L});var s=t(96540),e=t(32264),p=t(51253),O=t(62930),C=t(36830),N=t(4146),c=t.n(N),I=t(69733),o=t(80348),E=t(97007);const P=(T,h,g)=>A=>{const M=(0,I.connect)(T,h)(A),i=n=>{const a=(0,o.useDispatch)();return(0,s.useEffect)(()=>function(){a((0,E.N)({cleanupAction:g}))},[a]),s.createElement(M,{...n})};return i.displayName=`ConnectWithCleanUp(${M.displayName})`,c()(i,A),i};var R=t(95645),u=t(52659),m=t(52806),r=t(21161);class S extends s.PureComponent{constructor(){super(...arguments),this.onSubmit=h=>{const{notificationChannel:g}=this.props;this.props.updateNotificationChannel({...(0,r.TY)({...g,...h,settings:{...g.settings,...h.settings}}),id:g.id})},this.onTestChannel=h=>{const{notificationChannel:g}=this.props;this.props.testNotificationChannel((0,r.bw)({...g,...h,settings:{...g.settings,...h.settings}}))}}componentDidMount(){this.props.loadNotificationChannel(parseInt(this.props.match.params.id,10))}render(){const{notificationChannel:h,notificationChannelTypes:g}=this.props;return s.createElement(C.Y,{navId:"channels"},s.createElement(C.Y.Contents,null,s.createElement("h2",{className:"page-sub-heading"},"Edit notification channel"),h&&h.id>0?s.createElement(p.l,{maxWidth:600,onSubmit:this.onSubmit,defaultValues:{...h,type:g.find(A=>A.value===h.type)}},({control:A,errors:M,getValues:i,register:n,watch:a})=>{const d=g.find(f=>f.value===i().type.value);return s.createElement(R.x,{selectableChannels:(0,r.Bm)(g,!0),selectedChannel:d,imageRendererAvailable:e.$.rendererAvailable,onTestChannel:this.onTestChannel,register:n,watch:a,errors:M,getValues:i,control:A,resetSecureField:this.props.resetSecureField,secureFields:h.secureFields})}):s.createElement("div",null,"Loading notification channel",s.createElement(O.y,null))))}}const W=T=>({notificationChannel:T.notificationChannel.notificationChannel,notificationChannelTypes:T.notificationChannel.notificationChannelTypes}),F={loadNotificationChannel:u.$h,testNotificationChannel:u.d,updateNotificationChannel:u.ut,resetSecureField:m.NR},L=P(W,F,T=>T.notificationChannel=m.lB)(S)},95645:(U,$,t)=>{t.d($,{x:()=>A});var s=t(32196),e=t(96540),p=t(40845),O=t(62930),C=t(66864),N=t(55852),c=t(2913),I=t(49785),o=t(88575),E=t(10354),P=t(88323),R=t(10880),u=t(21744);const m=({control:i,option:n,register:a,invalid:d})=>{const f=n.secure?`secureSettings.${n.propertyName}`:`settings.${n.propertyName}`;switch(n.element){case"input":return e.createElement(E.p,{...a(`${f}`,{required:n.required?"Required":!1,validate:v=>n.validationRule!==""?r(v,n.validationRule):!0}),invalid:d,type:n.inputType,placeholder:n.placeholder});case"select":return e.createElement(I.xI,{control:i,name:`${f}`,render:({field:{ref:v,...y}})=>e.createElement(P.l6,{...y,options:n.selectOptions??void 0,invalid:d})});case"textarea":return e.createElement(u.f,{invalid:d,...a(`${f}`,{required:n.required?"Required":!1,validate:v=>n.validationRule!==""?r(v,n.validationRule):!0})});default:return console.error("Element not supported",n.element),null}},r=(i,n)=>RegExp(n).test(i)?!0:"Invalid format",S=({control:i,currentFormValues:n,errors:a,selectedChannelOptions:d,register:f,onResetSecureField:v,secureFields:y})=>e.createElement(e.Fragment,null,d.map((l,x)=>{const D=`${l.label}-${x}`,B=n[`settings.${l.showWhen.field}`]&&n[`settings.${l.showWhen.field}`].value;return l.showWhen.field&&B!==l.showWhen.is?null:l.element==="checkbox"?e.createElement(o.D,{key:D},e.createElement(R.S,{...f(l.secure?`secureSettings.${l.propertyName}`:`settings.${l.propertyName}`),label:l.label,description:l.description})):e.createElement(o.D,{key:D,label:l.label,description:l.description,invalid:a.settings&&!!a.settings[l.propertyName],error:a.settings&&String(a.settings[l.propertyName]?.message||"")},y&&y[l.propertyName]?e.createElement(E.p,{readOnly:!0,value:"Configured",suffix:e.createElement(N.$n,{onClick:()=>v(l.propertyName),fill:"text",type:"button",size:"sm"},"Clear")}):e.createElement(m,{option:l,register:f,control:i}))})),W=({control:i,currentFormValues:n,errors:a,secureFields:d,selectedChannel:f,channels:v,register:y,resetSecureField:l})=>e.createElement(e.Fragment,null,e.createElement(o.D,{label:"Name",invalid:!!a.name,error:a.name&&a.name.message},e.createElement(E.p,{...y("name",{required:"Name is required"})})),e.createElement(o.D,{label:"Type"},e.createElement(I.xI,{name:"type",render:({field:{ref:x,...D}})=>e.createElement(P.l6,{...D,options:v}),control:i,rules:{required:!0}})),e.createElement(S,{selectedChannelOptions:f.options.filter(x=>x.required),currentFormValues:n,secureFields:d,onResetSecureField:l,register:y,errors:a,control:i}));var F=t(57418),L=t(42418);const T=({control:i,currentFormValues:n,errors:a,selectedChannel:d,secureFields:f,register:v,resetSecureField:y})=>e.createElement(F.M,{label:`Optional ${d.heading}`,isOpen:!1},d.info!==""&&e.createElement(L.F,{severity:"info",title:d.info??""}),e.createElement(S,{selectedChannelOptions:d.options.filter(l=>!l.required),currentFormValues:n,register:v,errors:a,control:i,onResetSecureField:y,secureFields:f}));var h=t(37166);const g=({currentFormValues:i,imageRendererAvailable:n,register:a})=>e.createElement(F.M,{label:"Notification settings",isOpen:!1},e.createElement(o.D,null,e.createElement(R.S,{...a("isDefault"),label:"Default",description:"Use this notification for all alerts"})),e.createElement(o.D,null,e.createElement(R.S,{...a("settings.uploadImage"),label:"Include image",description:"Captures an image and include it in the notification"})),i.uploadImage&&!n&&e.createElement(h.w,{title:"No image renderer available/installed"},"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."),e.createElement(o.D,null,e.createElement(R.S,{...a("disableResolveMessage"),label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"})),e.createElement(o.D,null,e.createElement(R.S,{...a("sendReminder"),label:"Send reminders",description:"Send additional notifications for triggered alerts"})),i.sendReminder&&e.createElement(e.Fragment,null,e.createElement(o.D,{label:"Send reminder every",description:`Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m', or 1h etc.
            Alert reminders are sent after rules are evaluated. A reminder can never be sent more frequently
            than a configured alert rule evaluation interval.`},e.createElement(E.p,{...a("frequency"),width:8})))),A=({control:i,errors:n,selectedChannel:a,selectableChannels:d,register:f,watch:v,getValues:y,imageRendererAvailable:l,onTestChannel:x,resetSecureField:D,secureFields:B})=>{const b=(0,p.of)(M);(0,e.useEffect)(()=>{const j=new Set(a?.options.filter(G=>G.showWhen.field).map(G=>`settings.${G.showWhen.field}`))||[];v(["type","sendReminder","uploadImage",...j])},[a?.options,v]);const K=y();return a?e.createElement("div",{className:b.formContainer},e.createElement("div",{className:b.formItem},e.createElement(W,{selectedChannel:a,channels:d,secureFields:B,resetSecureField:D,currentFormValues:K,register:f,errors:n,control:i})),a.options.filter(j=>!j.required).length>0&&e.createElement("div",{className:b.formItem},e.createElement(T,{selectedChannel:a,secureFields:B,resetSecureField:D,currentFormValues:K,register:f,errors:n,control:i})),e.createElement("div",{className:b.formItem},e.createElement(g,{imageRendererAvailable:l,currentFormValues:K,register:f,errors:n,control:i})),e.createElement("div",{className:b.formButtons},e.createElement(C.Gy,null,e.createElement(N.$n,{type:"submit"},"Save"),e.createElement(N.$n,{type:"button",variant:"secondary",onClick:()=>x(y())},"Test"),e.createElement("a",{href:`${c.Ay.appSubUrl}/alerting-legacy/notifications`},e.createElement(N.$n,{type:"button",variant:"secondary"},"Back"))))):e.createElement(O.y,null)},M=i=>({formContainer:(0,s.css)``,formItem:(0,s.css)`
      flex-grow: 1;
      padding-top: ${i.spacing(2)};
    `,formButtons:(0,s.css)`
      padding-top: ${i.spacing(4)};
    `})},52659:(U,$,t)=>{t.d($,{$h:()=>R,L5:()=>I,d:()=>E,fo:()=>P,l3:()=>c,ut:()=>o,yF:()=>N});var s=t(17172),e=t(12131),p=t(82467),O=t(3169),C=t(52806);function N(u){return async m=>{m((0,C.EF)());const r=await(0,s.AI)().get("/api/alerts",u);m((0,C.L9)(r))}}function c(u,m){return async r=>{await(0,s.AI)().post(`/api/alerts/${u}/pause`,m);const S=e.Ny.getSearchObject().state||"all";r(N({state:S.toString()}))}}function I(u){return async m=>{try{await(0,s.AI)().post("/api/alert-notifications",u),m((0,p.dx)((0,O.tZ)("Notification created"))),e.Ny.push("/alerting-legacy/notifications")}catch(r){(0,s.NF)(r)&&m((0,p.dx)((0,O.gi)(r.data.error)))}}}function o(u){return async m=>{try{await(0,s.AI)().put(`/api/alert-notifications/${u.id}`,u),m((0,p.dx)((0,O.tZ)("Notification updated")))}catch(r){(0,s.NF)(r)&&m((0,p.dx)((0,O.gi)(r.data.error)))}}}function E(u){return async(m,r)=>{const S=r().notificationChannel.notificationChannel;await(0,s.AI)().post("/api/alert-notifications/test",{id:S.id,...u})}}function P(){return async u=>{const r=(await(0,s.AI)().get("/api/alert-notifiers-legacy")).sort((S,W)=>S.name>W.name?1:-1);u((0,C.of)(r))}}function R(u){return async m=>{await m(P());const r=await(0,s.AI)().get(`/api/alert-notifications/${u}`);m((0,C.cN)(r))}}},21161:(U,$,t)=>{t.d($,{Bm:()=>O,TY:()=>C,bw:()=>N,gH:()=>p});var s=t(41811),e=t(32264);const p={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:e.$.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},O=(0,s.A)((c,I)=>c.map(o=>I?{value:o.value,label:o.label,description:o.description}:{value:o.value,label:o.label})),C=c=>{const I=Object.fromEntries(Object.entries(c.settings).map(([o,E])=>[o,E&&E.hasOwnProperty("value")?E.value:E]));return{...p,...c,frequency:c.frequency===""?p.frequency:c.frequency,type:c.type.value,settings:{...p.settings,...I},secureSettings:{...c.secureSettings}}},N=c=>({name:c.name,type:c.type.value,frequency:c.frequency??p.frequency,settings:{...Object.assign(p.settings,c.settings)},secureSettings:{...c.secureSettings}})}}]);

//# sourceMappingURL=EditNotificationChannelLegacy.75122e6dbfb215d89d81.js.map