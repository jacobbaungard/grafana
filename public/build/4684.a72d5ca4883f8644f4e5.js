(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4684],{35931:(ot,Ue,l)=>{"use strict";l.d(Ue,{H:()=>A});var T=l(32196),Re=l(96540),D=l(40845);function A(de){const{description:b,suffix:Oe,feature:W}=de,fe=`Learn more about ${W}`,w=(0,D.of)(r);return Re.createElement("span",{className:w.container},b,Re.createElement("a",{"aria-label":fe,href:`https://grafana.com/docs/grafana/next/datasources/${Oe}`,rel:"noreferrer",target:"_blank"},fe))}const r=de=>({container:(0,T.css)({color:de.colors.text.secondary,a:(0,T.css)({color:de.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},6191:(ot,Ue,l)=>{"use strict";l.d(Ue,{X:()=>A});var T=l(32196),Re=l(96540),D=l(40845);const A=({children:de})=>{const b=(0,D.of)(r);return Re.createElement("div",{className:b.root},de)},r=de=>({root:(0,T.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:de.spacing(3),minHeight:de.spacing(4)})})},31347:(ot,Ue,l)=>{"use strict";l.d(Ue,{Z:()=>Re});var T=l(96540);const Re=({grow:D,shrink:A})=>T.createElement("div",{style:{display:"block",flexGrow:D,flexShrink:A}})},92762:(ot,Ue,l)=>{"use strict";l.d(Ue,{Z:()=>b});var T=l(32196),Re=l(28848),D=l.n(Re),A=l(96540),r=l(40672),de=l(40845);function b({query:W,language:fe,className:w}){const q=(0,de.$j)(),Le=Oe(q),S=D().highlight(W,fe.grammar,fe.name);return A.createElement("div",{className:(0,T.cx)(Le.editorField,"prism-syntax-highlight",w),"aria-label":"selector",dangerouslySetInnerHTML:{__html:r.sQ.sanitize(S)}})}const Oe=W=>({editorField:(0,T.css)({fontFamily:W.typography.fontFamilyMonospace,fontSize:W.typography.bodySmall.fontSize})})},42952:(ot,Ue,l)=>{"use strict";l.d(Ue,{T:()=>Re,f:()=>T});var T=(D=>(D.Code="code",D.Builder="builder",D))(T||{});const Re="Binary operations"},60016:(ot,Ue,l)=>{"use strict";l.d(Ue,{TO:()=>Le,iB:()=>ke,kl:()=>$e,wU:()=>We});var T=l(2543),Re=l.n(T),D=l(96540),A=l(32264),r=l(67061),de=l(38894),b=l(94354),Oe=l(14186),W=l(10354),fe=l(21594),w=l(56587),q=l(65650);const Le=[{value:q.U3.Range,label:"Range",description:"Run query over a range of time."},{value:q.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}];A.$.featureToggles.lokiExperimentalStreaming&&Le.push({value:q.U3.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const ke=[{value:1,label:"1/1"}].concat((0,T.map)([2,3,4,5,10],$=>({value:$,label:"1/"+$})));function $e($){const{lineLimitValue:te,resolution:be,onRunQuery:Fe,runOnBlur:me,onChange:Ae}=$,B=$.query??{},Te=(0,w.Io)(B);function Qe(ee){const ue={...B,maxLines:We(ee)};Ae(ue)}function Je(ee){const{instant:ue,range:R,...C}=B;Ae({...C,queryType:ee})}function He(ee){B.maxLines!==We(ee.currentTarget.value)&&Qe(ee.currentTarget.value)}function N(ee){ee.key==="Enter"&&Fe()}function k(ee){const ue={...B,resolution:ee.value};Ae(ue)}return D.createElement(r.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field"},D.createElement(r.B,{wrap:"nowrap",gap:0,"data-testid":"queryTypeField","aria-label":"Query type field"},D.createElement(de.I,{width:"auto"},"Query type"),D.createElement(b.z,{options:Le,value:Te,onChange:ee=>{Je(ee),me&&Fe()}})),D.createElement(r.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field"},D.createElement(Oe.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},D.createElement(W.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:He,onKeyDown:N,value:te,onBlur:()=>{me&&Fe()}})),D.createElement(Oe.I,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels."},D.createElement(fe.l6,{isSearchable:!1,onChange:k,options:ke,value:be,"aria-label":"Select resolution"}))))}var ye=(0,D.memo)($e);function We($){const te=parseInt($,10);if(!(isNaN(te)||te<0))return te}},95881:(ot,Ue,l)=>{"use strict";l.d(Ue,{W:()=>de});var T=l(96540),Re=l(97535);const D=T.lazy(()=>l.e(1952).then(l.bind(l,51639))),A=b=>T.createElement(T.Suspense,{fallback:null},T.createElement(D,{...b})),r=b=>{const Oe=(0,T.useRef)(null),{onRunQuery:W,onChange:fe,...w}=b,q=S=>{Oe.current=S,fe(S),W()},Le=S=>{fe(S)};return T.createElement(A,{onRunQuery:q,onBlur:Le,onChange:fe,...w})};class de extends T.PureComponent{constructor(Oe){super(Oe),this._isMounted=!1,this.onChangeQuery=(W,fe)=>{const{query:w,onChange:q,onRunQuery:Le}=this.props;if(q){const S={...w,expr:W};q(S),fe&&Le&&Le()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(Oe){const{range:W,datasource:{languageProvider:fe}}=this.props;(0,Re.WV)(W,Oe.range)&&fe.fetchLabels({timeRange:W})}render(){const{ExtraFieldElement:Oe,query:W,datasource:fe,history:w,onRunQuery:q,range:Le}=this.props,S=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return T.createElement(T.Fragment,null,T.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},T.createElement("div",{className:"gf-form--grow flex-shrink-1 min-width-15"},T.createElement(r,{datasource:fe,history:w??[],onChange:this.onChangeQuery,onRunQuery:q,initialValue:W.expr??"",placeholder:S,timeRange:Le}))),Oe)}}},20065:(ot,Ue,l)=>{"use strict";l.d(Ue,{B:()=>Re,a:()=>de});var T=l(56245);function Re(b,Oe,W,fe){if(!b)return!1;const w=D(Oe,fe);if(!w.length)return!1;let q=w;if(b!==Oe){const Le=D(b,fe);q=w.flatMap(S=>Le.filter(ke=>S.text===ke.text)||S)}return q.map(Le=>A(b,W,Le)).filter(r)}function D(b,Oe){const W=[];return Oe.parse(b).iterate({enter:w=>{if(w.type.id===T.Ql){const q=w.node;W.push({node:q,text:b.substring(q.from,q.to)})}}}),W}function A(b,Oe,W){if(Oe.length===1){const q=W.node.from===W.node.to,Le=q&&W.node.parent?W.node.parent:W.node,S=q?b.substring(Le.from,Le.to):W.text;return{startLineNumber:1,startColumn:Le.from+1,endLineNumber:1,endColumn:Le.to+1,error:S}}let fe=0,w=0;for(let q=0;q<Oe.length;q++){if(w=fe+Oe[q].length,W.node.from>w){fe+=Oe[q].length+1;continue}return{startLineNumber:q+1,startColumn:W.node.from-fe+1,endLineNumber:q+1,endColumn:W.node.to-fe+1,error:W.text}}return null}function r(b){return b!==null}const de={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},27724:(ot,Ue,l)=>{"use strict";l.d(Ue,{we:()=>Lt,VQ:()=>ua,lb:()=>Er,Gf:()=>oa,M1:()=>la,ow:()=>Ia,mL:()=>Na,In:()=>Pr});var T=l(2543),Re=l(13288),D=l(44240),A=l(62467),r=l(75505),de=l(81160),b=l(66847),Oe=l(59099),W=l(63720),fe=l(65879),w=l(39070),q=l(9557),Le=l(76885),S=l(41987),ke=l(78368),$e=l(43659),ye=l(36195),We=l(26657),$=l(72574),te=l(32264);const be=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Fe=new Set,me=typeof process=="object"&&process?process:{},Ae=(m,n,a,i)=>{typeof me.emitWarning=="function"?me.emitWarning(m,n,a,i):console.error(`[${a}] ${n}: ${m}`)};let B=globalThis.AbortController,Te=globalThis.AbortSignal;if(typeof B>"u"){Te=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,o){this._onabort.push(o)}},B=class{constructor(){n()}signal=new Te;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const o of this.signal._onabort)o(i);this.signal.onabort?.(i)}}};let m=me.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const n=()=>{m&&(m=!1,Ae("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",n))}}const Qe=m=>!Fe.has(m),Je=Symbol("type"),He=m=>m&&m===Math.floor(m)&&m>0&&isFinite(m),N=m=>He(m)?m<=Math.pow(2,8)?Uint8Array:m<=Math.pow(2,16)?Uint16Array:m<=Math.pow(2,32)?Uint32Array:m<=Number.MAX_SAFE_INTEGER?k:null:null;class k extends Array{constructor(n){super(n),this.fill(0)}}class ee{heap;length;static#l=!1;static create(n){const a=N(n);if(!a)return[];ee.#l=!0;const i=new ee(n,a);return ee.#l=!1,i}constructor(n,a){if(!ee.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new a(n),this.length=0}push(n){this.heap[this.length++]=n}pop(){return this.heap[--this.length]}}class ue{#l;#d;#g;#h;#R;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#v;#a;#r;#e;#c;#f;#o;#s;#O;#i;#y;#b;#p;#E;#S;#u;static unsafeExposeInternals(n){return{starts:n.#b,ttls:n.#p,sizes:n.#y,keyMap:n.#a,keyList:n.#r,valList:n.#e,next:n.#c,prev:n.#f,get head(){return n.#o},get tail(){return n.#s},free:n.#O,isBackgroundFetch:a=>n.#t(a),backgroundFetch:(a,i,o,u)=>n.#C(a,i,o,u),moveToTail:a=>n.#Q(a),indexes:a=>n.#P(a),rindexes:a=>n.#x(a),isStale:a=>n.#m(a)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#v}get size(){return this.#n}get fetchMethod(){return this.#R}get dispose(){return this.#g}get disposeAfter(){return this.#h}constructor(n){const{max:a=0,ttl:i,ttlResolution:o=1,ttlAutopurge:u,updateAgeOnGet:p,updateAgeOnHas:y,allowStale:P,dispose:X,disposeAfter:Y,noDisposeOnSet:Z,noUpdateTTL:ae,maxSize:se=0,maxEntrySize:Xe=0,sizeCalculation:Ce,fetchMethod:ze,noDeleteOnFetchRejection:we,noDeleteOnStaleGet:Ze,allowStaleOnFetchRejection:et,allowStaleOnFetchAbort:Ye,ignoreFetchAbort:ct}=n;if(a!==0&&!He(a))throw new TypeError("max option must be a nonnegative integer");const At=a?N(a):Array;if(!At)throw new Error("invalid max value: "+a);if(this.#l=a,this.#d=se,this.maxEntrySize=Xe||this.#d,this.sizeCalculation=Ce,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(ze!==void 0&&typeof ze!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#R=ze,this.#S=!!ze,this.#a=new Map,this.#r=new Array(a).fill(void 0),this.#e=new Array(a).fill(void 0),this.#c=new At(a),this.#f=new At(a),this.#o=0,this.#s=0,this.#O=ee.create(a),this.#n=0,this.#v=0,typeof X=="function"&&(this.#g=X),typeof Y=="function"?(this.#h=Y,this.#i=[]):(this.#h=void 0,this.#i=void 0),this.#E=!!this.#g,this.#u=!!this.#h,this.noDisposeOnSet=!!Z,this.noUpdateTTL=!!ae,this.noDeleteOnFetchRejection=!!we,this.allowStaleOnFetchRejection=!!et,this.allowStaleOnFetchAbort=!!Ye,this.ignoreFetchAbort=!!ct,this.maxEntrySize!==0){if(this.#d!==0&&!He(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!He(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#X()}if(this.allowStale=!!P,this.noDeleteOnStaleGet=!!Ze,this.updateAgeOnGet=!!p,this.updateAgeOnHas=!!y,this.ttlResolution=He(o)||o===0?o:1,this.ttlAutopurge=!!u,this.ttl=i||0,this.ttl){if(!He(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#A()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const Dt="LRU_CACHE_UNBOUNDED";Qe(Dt)&&(Fe.add(Dt),Ae("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Dt,ue))}}getRemainingTTL(n){return this.#a.has(n)?1/0:0}#A(){const n=new k(this.#l),a=new k(this.#l);this.#p=n,this.#b=a,this.#D=(u,p,y=be.now())=>{if(a[u]=p!==0?y:0,n[u]=p,p!==0&&this.ttlAutopurge){const P=setTimeout(()=>{this.#m(u)&&this.delete(this.#r[u])},p+1);P.unref&&P.unref()}},this.#$=u=>{a[u]=n[u]!==0?be.now():0},this.#L=(u,p)=>{if(n[p]){const y=n[p],P=a[p];if(!y||!P)return;u.ttl=y,u.start=P,u.now=i||o();const X=u.now-P;u.remainingTTL=y-X}};let i=0;const o=()=>{const u=be.now();if(this.ttlResolution>0){i=u;const p=setTimeout(()=>i=0,this.ttlResolution);p.unref&&p.unref()}return u};this.getRemainingTTL=u=>{const p=this.#a.get(u);if(p===void 0)return 0;const y=n[p],P=a[p];if(!y||!P)return 1/0;const X=(i||o())-P;return y-X},this.#m=u=>{const p=a[u],y=n[u];return!!y&&!!p&&(i||o())-p>y}}#$=()=>{};#L=()=>{};#D=()=>{};#m=()=>!1;#X(){const n=new k(this.#l);this.#v=0,this.#y=n,this.#T=a=>{this.#v-=n[a],n[a]=0},this.#M=(a,i,o,u)=>{if(this.#t(i))return 0;if(!He(o))if(u){if(typeof u!="function")throw new TypeError("sizeCalculation must be a function");if(o=u(i,a),!He(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#w=(a,i,o)=>{if(n[a]=i,this.#d){const u=this.#d-n[a];for(;this.#v>u;)this.#F(!0)}this.#v+=n[a],o&&(o.entrySize=i,o.totalCalculatedSize=this.#v)}}#T=n=>{};#w=(n,a,i)=>{};#M=(n,a,i,o)=>{if(i||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#P({allowStale:n=this.allowStale}={}){if(this.#n)for(let a=this.#s;!(!this.#N(a)||((n||!this.#m(a))&&(yield a),a===this.#o));)a=this.#f[a]}*#x({allowStale:n=this.allowStale}={}){if(this.#n)for(let a=this.#o;!(!this.#N(a)||((n||!this.#m(a))&&(yield a),a===this.#s));)a=this.#c[a]}#N(n){return n!==void 0&&this.#a.get(this.#r[n])===n}*entries(){for(const n of this.#P())this.#e[n]!==void 0&&this.#r[n]!==void 0&&!this.#t(this.#e[n])&&(yield[this.#r[n],this.#e[n]])}*rentries(){for(const n of this.#x())this.#e[n]!==void 0&&this.#r[n]!==void 0&&!this.#t(this.#e[n])&&(yield[this.#r[n],this.#e[n]])}*keys(){for(const n of this.#P()){const a=this.#r[n];a!==void 0&&!this.#t(this.#e[n])&&(yield a)}}*rkeys(){for(const n of this.#x()){const a=this.#r[n];a!==void 0&&!this.#t(this.#e[n])&&(yield a)}}*values(){for(const n of this.#P())this.#e[n]!==void 0&&!this.#t(this.#e[n])&&(yield this.#e[n])}*rvalues(){for(const n of this.#x())this.#e[n]!==void 0&&!this.#t(this.#e[n])&&(yield this.#e[n])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(n,a={}){for(const i of this.#P()){const o=this.#e[i],u=this.#t(o)?o.__staleWhileFetching:o;if(u!==void 0&&n(u,this.#r[i],this))return this.get(this.#r[i],a)}}forEach(n,a=this){for(const i of this.#P()){const o=this.#e[i],u=this.#t(o)?o.__staleWhileFetching:o;u!==void 0&&n.call(a,u,this.#r[i],this)}}rforEach(n,a=this){for(const i of this.#x()){const o=this.#e[i],u=this.#t(o)?o.__staleWhileFetching:o;u!==void 0&&n.call(a,u,this.#r[i],this)}}purgeStale(){let n=!1;for(const a of this.#x({allowStale:!0}))this.#m(a)&&(this.delete(this.#r[a]),n=!0);return n}info(n){const a=this.#a.get(n);if(a===void 0)return;const i=this.#e[a],o=this.#t(i)?i.__staleWhileFetching:i;if(o===void 0)return;const u={value:o};if(this.#p&&this.#b){const p=this.#p[a],y=this.#b[a];if(p&&y){const P=p-(be.now()-y);u.ttl=P,u.start=Date.now()}}return this.#y&&(u.size=this.#y[a]),u}dump(){const n=[];for(const a of this.#P({allowStale:!0})){const i=this.#r[a],o=this.#e[a],u=this.#t(o)?o.__staleWhileFetching:o;if(u===void 0||i===void 0)continue;const p={value:u};if(this.#p&&this.#b){p.ttl=this.#p[a];const y=be.now()-this.#b[a];p.start=Math.floor(Date.now()-y)}this.#y&&(p.size=this.#y[a]),n.unshift([i,p])}return n}load(n){this.clear();for(const[a,i]of n){if(i.start){const o=Date.now()-i.start;i.start=be.now()-o}this.set(a,i.value,i)}}set(n,a,i={}){if(a===void 0)return this.delete(n),this;const{ttl:o=this.ttl,start:u,noDisposeOnSet:p=this.noDisposeOnSet,sizeCalculation:y=this.sizeCalculation,status:P}=i;let{noUpdateTTL:X=this.noUpdateTTL}=i;const Y=this.#M(n,a,i.size||0,y);if(this.maxEntrySize&&Y>this.maxEntrySize)return P&&(P.set="miss",P.maxEntrySizeExceeded=!0),this.delete(n),this;let Z=this.#n===0?void 0:this.#a.get(n);if(Z===void 0)Z=this.#n===0?this.#s:this.#O.length!==0?this.#O.pop():this.#n===this.#l?this.#F(!1):this.#n,this.#r[Z]=n,this.#e[Z]=a,this.#a.set(n,Z),this.#c[this.#s]=Z,this.#f[Z]=this.#s,this.#s=Z,this.#n++,this.#w(Z,Y,P),P&&(P.set="add"),X=!1;else{this.#Q(Z);const ae=this.#e[Z];if(a!==ae){if(this.#S&&this.#t(ae)){ae.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:se}=ae;se!==void 0&&!p&&(this.#E&&this.#g?.(se,n,"set"),this.#u&&this.#i?.push([se,n,"set"]))}else p||(this.#E&&this.#g?.(ae,n,"set"),this.#u&&this.#i?.push([ae,n,"set"]));if(this.#T(Z),this.#w(Z,Y,P),this.#e[Z]=a,P){P.set="replace";const se=ae&&this.#t(ae)?ae.__staleWhileFetching:ae;se!==void 0&&(P.oldValue=se)}}else P&&(P.set="update")}if(o!==0&&!this.#p&&this.#A(),this.#p&&(X||this.#D(Z,o,u),P&&this.#L(P,Z)),!p&&this.#u&&this.#i){const ae=this.#i;let se;for(;se=ae?.shift();)this.#h?.(...se)}return this}pop(){try{for(;this.#n;){const n=this.#e[this.#o];if(this.#F(!0),this.#t(n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(this.#u&&this.#i){const n=this.#i;let a;for(;a=n?.shift();)this.#h?.(...a)}}}#F(n){const a=this.#o,i=this.#r[a],o=this.#e[a];return this.#S&&this.#t(o)?o.__abortController.abort(new Error("evicted")):(this.#E||this.#u)&&(this.#E&&this.#g?.(o,i,"evict"),this.#u&&this.#i?.push([o,i,"evict"])),this.#T(a),n&&(this.#r[a]=void 0,this.#e[a]=void 0,this.#O.push(a)),this.#n===1?(this.#o=this.#s=0,this.#O.length=0):this.#o=this.#c[a],this.#a.delete(i),this.#n--,a}has(n,a={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:o}=a,u=this.#a.get(n);if(u!==void 0){const p=this.#e[u];if(this.#t(p)&&p.__staleWhileFetching===void 0)return!1;if(this.#m(u))o&&(o.has="stale",this.#L(o,u));else return i&&this.#$(u),o&&(o.has="hit",this.#L(o,u)),!0}else o&&(o.has="miss");return!1}peek(n,a={}){const{allowStale:i=this.allowStale}=a,o=this.#a.get(n);if(o===void 0||!i&&this.#m(o))return;const u=this.#e[o];return this.#t(u)?u.__staleWhileFetching:u}#C(n,a,i,o){const u=a===void 0?void 0:this.#e[a];if(this.#t(u))return u;const p=new B,{signal:y}=i;y?.addEventListener("abort",()=>p.abort(y.reason),{signal:p.signal});const P={signal:p.signal,options:i,context:o},X=(Ce,ze=!1)=>{const{aborted:we}=p.signal,Ze=i.ignoreFetchAbort&&Ce!==void 0;if(i.status&&(we&&!ze?(i.status.fetchAborted=!0,i.status.fetchError=p.signal.reason,Ze&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),we&&!Ze&&!ze)return Z(p.signal.reason);const et=se;return this.#e[a]===se&&(Ce===void 0?et.__staleWhileFetching?this.#e[a]=et.__staleWhileFetching:this.delete(n):(i.status&&(i.status.fetchUpdated=!0),this.set(n,Ce,P.options))),Ce},Y=Ce=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=Ce),Z(Ce)),Z=Ce=>{const{aborted:ze}=p.signal,we=ze&&i.allowStaleOnFetchAbort,Ze=we||i.allowStaleOnFetchRejection,et=Ze||i.noDeleteOnFetchRejection,Ye=se;if(this.#e[a]===se&&(!et||Ye.__staleWhileFetching===void 0?this.delete(n):we||(this.#e[a]=Ye.__staleWhileFetching)),Ze)return i.status&&Ye.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),Ye.__staleWhileFetching;if(Ye.__returned===Ye)throw Ce},ae=(Ce,ze)=>{const we=this.#R?.(n,u,P);we&&we instanceof Promise&&we.then(Ze=>Ce(Ze===void 0?void 0:Ze),ze),p.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(Ce(void 0),i.allowStaleOnFetchAbort&&(Ce=Ze=>X(Ze,!0)))})};i.status&&(i.status.fetchDispatched=!0);const se=new Promise(ae).then(X,Y),Xe=Object.assign(se,{__abortController:p,__staleWhileFetching:u,__returned:void 0});return a===void 0?(this.set(n,Xe,{...P.options,status:void 0}),a=this.#a.get(n)):this.#e[a]=Xe,Xe}#t(n){if(!this.#S)return!1;const a=n;return!!a&&a instanceof Promise&&a.hasOwnProperty("__staleWhileFetching")&&a.__abortController instanceof B}async fetch(n,a={}){const{allowStale:i=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:u=this.noDeleteOnStaleGet,ttl:p=this.ttl,noDisposeOnSet:y=this.noDisposeOnSet,size:P=0,sizeCalculation:X=this.sizeCalculation,noUpdateTTL:Y=this.noUpdateTTL,noDeleteOnFetchRejection:Z=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:ae=this.allowStaleOnFetchRejection,ignoreFetchAbort:se=this.ignoreFetchAbort,allowStaleOnFetchAbort:Xe=this.allowStaleOnFetchAbort,context:Ce,forceRefresh:ze=!1,status:we,signal:Ze}=a;if(!this.#S)return we&&(we.fetch="get"),this.get(n,{allowStale:i,updateAgeOnGet:o,noDeleteOnStaleGet:u,status:we});const et={allowStale:i,updateAgeOnGet:o,noDeleteOnStaleGet:u,ttl:p,noDisposeOnSet:y,size:P,sizeCalculation:X,noUpdateTTL:Y,noDeleteOnFetchRejection:Z,allowStaleOnFetchRejection:ae,allowStaleOnFetchAbort:Xe,ignoreFetchAbort:se,status:we,signal:Ze};let Ye=this.#a.get(n);if(Ye===void 0){we&&(we.fetch="miss");const ct=this.#C(n,Ye,et,Ce);return ct.__returned=ct}else{const ct=this.#e[Ye];if(this.#t(ct)){const xr=i&&ct.__staleWhileFetching!==void 0;return we&&(we.fetch="inflight",xr&&(we.returnedStale=!0)),xr?ct.__staleWhileFetching:ct.__returned=ct}const At=this.#m(Ye);if(!ze&&!At)return we&&(we.fetch="hit"),this.#Q(Ye),o&&this.#$(Ye),we&&this.#L(we,Ye),ct;const Dt=this.#C(n,Ye,et,Ce),kt=Dt.__staleWhileFetching!==void 0&&i;return we&&(we.fetch=At?"stale":"refresh",kt&&At&&(we.returnedStale=!0)),kt?Dt.__staleWhileFetching:Dt.__returned=Dt}}get(n,a={}){const{allowStale:i=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:u=this.noDeleteOnStaleGet,status:p}=a,y=this.#a.get(n);if(y!==void 0){const P=this.#e[y],X=this.#t(P);return p&&this.#L(p,y),this.#m(y)?(p&&(p.get="stale"),X?(p&&i&&P.__staleWhileFetching!==void 0&&(p.returnedStale=!0),i?P.__staleWhileFetching:void 0):(u||this.delete(n),p&&i&&(p.returnedStale=!0),i?P:void 0)):(p&&(p.get="hit"),X?P.__staleWhileFetching:(this.#Q(y),o&&this.#$(y),P))}else p&&(p.get="miss")}#I(n,a){this.#f[a]=n,this.#c[n]=a}#Q(n){n!==this.#s&&(n===this.#o?this.#o=this.#c[n]:this.#I(this.#f[n],this.#c[n]),this.#I(this.#s,n),this.#s=n)}delete(n){let a=!1;if(this.#n!==0){const i=this.#a.get(n);if(i!==void 0)if(a=!0,this.#n===1)this.clear();else{this.#T(i);const o=this.#e[i];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#E||this.#u)&&(this.#E&&this.#g?.(o,n,"delete"),this.#u&&this.#i?.push([o,n,"delete"])),this.#a.delete(n),this.#r[i]=void 0,this.#e[i]=void 0,i===this.#s)this.#s=this.#f[i];else if(i===this.#o)this.#o=this.#c[i];else{const u=this.#f[i];this.#c[u]=this.#c[i];const p=this.#c[i];this.#f[p]=this.#f[i]}this.#n--,this.#O.push(i)}}if(this.#u&&this.#i?.length){const i=this.#i;let o;for(;o=i?.shift();)this.#h?.(...o)}return a}clear(){for(const n of this.#x({allowStale:!0})){const a=this.#e[n];if(this.#t(a))a.__abortController.abort(new Error("deleted"));else{const i=this.#r[n];this.#E&&this.#g?.(a,i,"delete"),this.#u&&this.#i?.push([a,i,"delete"])}}if(this.#a.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#p&&this.#b&&(this.#p.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#o=0,this.#s=0,this.#O.length=0,this.#v=0,this.#n=0,this.#u&&this.#i){const n=this.#i;let a;for(;a=n?.shift();)this.#h?.(...a)}}}var R=l(40187),C=l(43127),K=l(97535),z=l(56587),Q=l(60706),O=l(75723),v=l(65650);const L=1e6,I="{}";class U extends R.Is{constructor(n,a){super(),this.started=!1,this.seriesCache=new ue({max:10}),this.labelsCache=new ue({max:10}),this.request=async(i,o)=>{try{return await this.datasource.metadataRequest(i,o)}catch(u){console.error(u)}},this.start=i=>{const o=i??this.getDefaultTimeRange();return(!this.startTask||this.startedTimeRange?.from.isSame(o.from)===!1||this.startedTimeRange?.to.isSame(o.to)===!1)&&(this.startedTimeRange=o,this.startTask=this.fetchLabels({timeRange:o}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(i,o)=>{const u=this.datasource.interpolateString(i),p="series",y=o?.timeRange??this.getDefaultTimeRange(),{start:P,end:X}=this.datasource.getTimeRangeParams(y),Y=this.generateCacheKey(p,P,X,u);let Z=this.seriesCache.get(Y);if(!Z){const ae={"match[]":u,start:P,end:X},se=await this.request(p,ae);if(!Array.isArray(se))return{};const{values:Xe}=(0,K.P7)(se);Z=Xe,this.seriesCache.set(Y,Z)}return Z},this.fetchSeries=async(i,o)=>{const u="series",p=o?.timeRange??this.getDefaultTimeRange(),{start:y,end:P}=this.datasource.getTimeRangeParams(p),X={"match[]":i,start:y,end:P};return await this.request(u,X)},this.datasource=n,this.labelKeys=[],Object.assign(this,a)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(n){return{refId:n.refId,expr:(0,K.tt)(n),queryType:v.U3.Range}}exportToAbstractQuery(n){if(!n.expr||n.expr.length===0)return{refId:n.refId,labelMatchers:[]};const i=(0,z.pk)(n.expr).map(o=>(0,Q.u_)(o).query.labels.map(y=>({name:y.label,value:y.value,operator:K.sM[y.op]})));return{refId:n.refId,labelMatchers:(0,T.flatten)(i)}}async fetchLabels(n){if(!n||!n.streamSelector)return this.fetchLabelsByLabelsEndpoint(n);{const a=await this.fetchSeriesLabels(n.streamSelector,{timeRange:n.timeRange});return Object.keys(a??{})}}async fetchLabelsByLabelsEndpoint(n){const a="labels",i=n?.timeRange??this.getDefaultTimeRange(),o=this.datasource.getTimeRangeParams(i),u=await this.request(a,o);if(Array.isArray(u)){const p=u.slice().sort().filter(y=>y!=="__name__");return this.labelKeys=p,this.labelKeys}return[]}generateCacheKey(n,a,i,o){return[n,this.roundTime(a),this.roundTime(i),o].join()}roundTime(n){return n?Math.floor(n/L/1e3/60/5):0}async fetchLabelValues(n,a){const i=encodeURIComponent(this.datasource.interpolateString(n)),o=a?.streamSelector&&a.streamSelector!==I?this.datasource.interpolateString(a.streamSelector):void 0,u=`label/${i}/values`,p=a?.timeRange??this.getDefaultTimeRange(),y=this.datasource.getTimeRangeParams(p),{start:P,end:X}=y,Y={start:P,end:X};let Z=i;o&&(Y.query=o,Z+=o);const ae=this.generateCacheKey(u,P,X,Z);let se=this.labelsCache.get(ae);if(!se){this.labelsCache.set(ae,[]);const Xe=await this.request(u,Y);Array.isArray(Xe)&&(se=Xe.slice().sort(),this.labelsCache.set(ae,se))}return se??[]}async getParserAndLabelKeys(n,a){const i={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};if(!te.$.featureToggles.lokiQueryHints)return i;const o=await this.datasource.getDataSamples({expr:n,refId:"data-samples",maxLines:a?.maxLines||Lt},a?.timeRange??this.getDefaultTimeRange());if(!o.length)return i;const{hasLogfmt:u,hasJSON:p,hasPack:y}=(0,O.YB)(o[0]);return{extractedLabelKeys:[...(0,O.fV)(o[0],v.HD.Indexed),...(0,O.fV)(o[0],v.HD.Parsed)],structuredMetadataKeys:(0,O.fV)(o[0],v.HD.StructuredMetadata),unwrapLabelKeys:(0,O.aN)(o[0]),hasJSON:p,hasPack:y,hasLogfmt:u}}getDefaultTimeRange(){return(0,C.E2)()}}var pe=l(39697),Pe=l(37748),Ie=l(69862),je=l(69850),it=l(31635),dt=l(13752),Mt=l(75508),$t=l(88483),Vt=l(64423),Jt=l(39741),ur={url:"",deserializer:function(m){return JSON.parse(m.data)},serializer:function(m){return JSON.stringify(m)}},Ur="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Br=function(m){(0,it.__extends)(n,m);function n(a,i){var o=m.call(this)||this;if(o._socket=null,a instanceof $t.c)o.destination=i,o.source=a;else{var u=o._config=(0,it.__assign)({},ur);if(o._output=new dt.B,typeof a=="string")u.url=a;else for(var p in a)a.hasOwnProperty(p)&&(u[p]=a[p]);if(!u.WebSocketCtor&&WebSocket)u.WebSocketCtor=WebSocket;else if(!u.WebSocketCtor)throw new Error("no WebSocket constructor can be found");o.destination=new Jt.m}return o}return n.prototype.lift=function(a){var i=new n(this._config,this.destination);return i.operator=a,i.source=this,i},n.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Jt.m),this._output=new dt.B},n.prototype.multiplex=function(a,i,o){var u=this;return new $t.c(function(p){try{u.next(a())}catch(P){p.error(P)}var y=u.subscribe({next:function(P){try{o(P)&&p.next(P)}catch(X){p.error(X)}},error:function(P){return p.error(P)},complete:function(){return p.complete()}});return function(){try{u.next(i())}catch(P){p.error(P)}y.unsubscribe()}})},n.prototype._connectSocket=function(){var a=this,i=this._config,o=i.WebSocketCtor,u=i.protocol,p=i.url,y=i.binaryType,P=this._output,X=null;try{X=u?new o(p,u):new o(p),this._socket=X,y&&(this._socket.binaryType=y)}catch(Z){P.error(Z);return}var Y=new Vt.yU(function(){a._socket=null,X&&X.readyState===1&&X.close()});X.onopen=function(Z){var ae=a._socket;if(!ae){X.close(),a._resetState();return}var se=a._config.openObserver;se&&se.next(Z);var Xe=a.destination;a.destination=Mt.vU.create(function(Ce){if(X.readyState===1)try{var ze=a._config.serializer;X.send(ze(Ce))}catch(we){a.destination.error(we)}},function(Ce){var ze=a._config.closingObserver;ze&&ze.next(void 0),Ce&&Ce.code?X.close(Ce.code,Ce.reason):P.error(new TypeError(Ur)),a._resetState()},function(){var Ce=a._config.closingObserver;Ce&&Ce.next(void 0),X.close(),a._resetState()}),Xe&&Xe instanceof Jt.m&&Y.add(Xe.subscribe(a.destination))},X.onerror=function(Z){a._resetState(),P.error(Z)},X.onclose=function(Z){X===a._socket&&a._resetState();var ae=a._config.closeObserver;ae&&ae.next(Z),Z.wasClean?P.complete():P.error(Z)},X.onmessage=function(Z){try{var ae=a._config.deserializer;P.next(ae(Z))}catch(se){P.error(se)}}},n.prototype._subscribe=function(a){var i=this,o=this.source;return o?o.subscribe(a):(this._socket||this._connectSocket(),this._output.subscribe(a),a.add(function(){var u=i._socket;i._output.observers.length===0&&(u&&(u.readyState===1||u.readyState===0)&&u.close(),i._resetState())}),a)},n.prototype.unsubscribe=function(){var a=this._socket;a&&(a.readyState===1||a.readyState===0)&&a.close(),this._resetState(),m.prototype.unsubscribe.call(this)},n}(dt.k);function Ba(m){return new Br(m)}var Zr=l(33526),lt=l(11261),ha=l(38823),_a=l(8227);function Wa(m){if(!(0,_a.A)(m))throw TypeError("Invalid UUID");let n;const a=new Uint8Array(16);return a[0]=(n=parseInt(m.slice(0,8),16))>>>24,a[1]=n>>>16&255,a[2]=n>>>8&255,a[3]=n&255,a[4]=(n=parseInt(m.slice(9,13),16))>>>8,a[5]=n&255,a[6]=(n=parseInt(m.slice(14,18),16))>>>8,a[7]=n&255,a[8]=(n=parseInt(m.slice(19,23),16))>>>8,a[9]=n&255,a[10]=(n=parseInt(m.slice(24,36),16))/1099511627776&255,a[11]=n/4294967296&255,a[12]=n>>>24&255,a[13]=n>>>16&255,a[14]=n>>>8&255,a[15]=n&255,a}const _r=Wa;function Wr(m){m=unescape(encodeURIComponent(m));const n=[];for(let a=0;a<m.length;++a)n.push(m.charCodeAt(a));return n}const va="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Oa="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ot(m,n,a){function i(o,u,p,y){var P;if(typeof o=="string"&&(o=Wr(o)),typeof u=="string"&&(u=_r(u)),((P=u)===null||P===void 0?void 0:P.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let X=new Uint8Array(16+o.length);if(X.set(u),X.set(o,u.length),X=a(X),X[6]=X[6]&15|n,X[8]=X[8]&63|128,p){y=y||0;for(let Y=0;Y<16;++Y)p[y+Y]=X[Y];return p}return(0,ha.k)(X)}try{i.name=m}catch{}return i.DNS=va,i.URL=Oa,i}function Zt(m,n,a,i){switch(m){case 0:return n&a^~n&i;case 1:return n^a^i;case 2:return n&a^n&i^a&i;case 3:return n^a^i}}function qr(m,n){return m<<n|m>>>32-n}function ea(m){const n=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof m=="string"){const p=unescape(encodeURIComponent(m));m=[];for(let y=0;y<p.length;++y)m.push(p.charCodeAt(y))}else Array.isArray(m)||(m=Array.prototype.slice.call(m));m.push(128);const i=m.length/4+2,o=Math.ceil(i/16),u=new Array(o);for(let p=0;p<o;++p){const y=new Uint32Array(16);for(let P=0;P<16;++P)y[P]=m[p*64+P*4]<<24|m[p*64+P*4+1]<<16|m[p*64+P*4+2]<<8|m[p*64+P*4+3];u[p]=y}u[o-1][14]=(m.length-1)*8/Math.pow(2,32),u[o-1][14]=Math.floor(u[o-1][14]),u[o-1][15]=(m.length-1)*8&4294967295;for(let p=0;p<o;++p){const y=new Uint32Array(80);for(let se=0;se<16;++se)y[se]=u[p][se];for(let se=16;se<80;++se)y[se]=qr(y[se-3]^y[se-8]^y[se-14]^y[se-16],1);let P=a[0],X=a[1],Y=a[2],Z=a[3],ae=a[4];for(let se=0;se<80;++se){const Xe=Math.floor(se/20),Ce=qr(P,5)+Zt(Xe,X,Y,Z)+ae+n[Xe]+y[se]>>>0;ae=Z,Z=Y,Y=qr(X,30)>>>0,X=P,P=Ce}a[0]=a[0]+P>>>0,a[1]=a[1]+X>>>0,a[2]=a[2]+Y>>>0,a[3]=a[3]+Z>>>0,a[4]=a[4]+ae>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,a[0]&255,a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,a[1]&255,a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,a[2]&255,a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,a[3]&255,a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,a[4]&255]}const Va=Ot("v5",80,ea),ya="6ec946da-0f49-47a8-983a-1d76d17e7c92";function qt(m,n){const a=m.streams;if(!a||!a.length)return;const i=n.fields[0],o=n.fields[1],u=n.fields[2],p={};for(const y of a){const P=Object.entries(y.stream).map(([X,Y])=>`${X}="${Y}"`).sort().join("");for(const[X,Y]of y.values)i.values.push(new Date(parseInt(X.slice(0,-6),10)).toISOString()),o.values.push(Y),u.values.push(er(X,P,Y,p,n.refId))}}function er(m,n,a,i,o){let u=Va(`${m}_${n}_${a}`,ya);if(u in i){const p=i[u]+1;i[u]=p,u=`${u}_${p}`}else i[u]=0;return o?`${o}_${u}`:u}class Bt{constructor(){this.streams={}}getStream(n,a=5e3){let i=this.streams[n.url];if(i)return i;const o=new Zr.x({capacity:n.size});return o.addField({name:"Time",type:lt.PU.time,config:{}}),o.addField({name:"Line",type:lt.PU.string}),o.addField({name:"id",type:lt.PU.string}),o.meta={...o.meta,preferredVisualisationType:"logs"},o.refId=n.refId,i=Ba(n.url).pipe((0,de.T)(u=>(qt(u,o),[o])),(0,Pe.l)(u=>u.pipe((0,Ie.Z)((p,y)=>{const P=y+1;return p.code===1006&&P<30?(P>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${p.reason}`),(0,pe.O)(a)):(0,Re.$)(p)}))),(0,je.j)(()=>{delete this.streams[n.url]})),this.streams[n.url]=i,i}}var yt=l(47232),ba=l(85404),bt=l(32196),Ee=l(96540),$r=l(16817),tr=l(36663),Ea=l(92762),Tt=l(14110),gt=l(40845),Tr=l(42418),ft=l(56034),ja=l(55852),za=l(82762),Pa=l(14578),rr=l(62930),ta=l(60029),Qr=l(21594),_t=l(39268),jt=l(14186),xa=l(44522),fr=l(15292),ra=l(71713);function kr(m){return{labels:(0,bt.css)`
      display: flex;
      gap: ${m.spacing(.5)};
    `,wrapper:(0,bt.css)`
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: ${m.spacing(.5)};
      position: relative;
    `,textWrapper:(0,bt.css)`
      display: flex;
      align-items: center;
    `,hidden:(0,bt.css)`
      visibility: hidden;
    `,label:(0,bt.css)`
      max-width: 100%;
      &:first-of-type {
        margin-bottom: ${m.spacing(2)};
      }
      &:not(:first-of-type) {
        margin: ${m.spacing(2)} 0;
      }
    `,rawQueryContainer:(0,bt.css)`
      text-align: start;
      line-break: anywhere;
      margin-top: -${m.spacing(.25)};
      margin-right: ${m.spacing(6)};
      min-height: ${m.spacing(4)};
    `,ui:(0,bt.css)`
      background-color: ${m.colors.background.secondary};
      padding: ${m.spacing(2)};
    `,notification:(0,bt.css)({position:"absolute",zIndex:m.zIndex.portal,top:0,right:0}),rawQuery:(0,bt.css)`
      display: inline;
    `,queryDescription:(0,bt.css)`
      margin-left: ${m.spacing(.5)};
    `,iconButton:(0,bt.css)`
      position: absolute;
      top: ${m.spacing(1)};
      right: ${m.spacing(1)};
      z-index: ${m.zIndex.navbarFixed};
    `,operationsToggle:(0,bt.css)`
      margin: ${m.spacing(1)} 0 ${m.spacing(-1)} 0;
      & > div {
        margin: 0;
        & > label {
          padding: 0;
        }
      }
    `}}const aa="isLogContextQueryUiOpen";function Ka(m){const{row:n,logContextProvider:a,updateFilter:i,onClose:o,origQuery:u,runContextQuery:p}=m,y=(0,gt.of)(kr),[P,X]=(0,Ee.useState)([]),[Y,Z]=(0,Ee.useState)(!1),[ae,se]=(0,Ee.useState)(!1),[Xe,Ce]=(0,Ee.useState)(!1),[ze,we]=(0,Ee.useState)(window.localStorage.getItem(aa)==="true"),[Ze,et]=(0,Ee.useState)(window.localStorage.getItem(Rt)==="true"),Ye=Ee.useRef(),ct=Ee.useRef(!1),At=Ee.useRef([]),Dt=(0,Ee.useMemo)(()=>!(ae&&P.some(_=>_.nonIndexed===_.enabled)||Ze&&a.queryContainsValidPipelineStages(u)),[P,Ze,ae,a,u]);(0,Ee.useEffect)(()=>{if(ae){if(!ct.current){ct.current=ae;return}if(P.filter(({enabled:_,nonIndexed:Se})=>_&&!Se).length===0){X(At.current);return}return At.current=structuredClone(P),Ye.current&&clearTimeout(Ye.current),Ce(!0),Ye.current=window.setTimeout(()=>{i(P.filter(({enabled:Se})=>Se));const _={removedLabels:[],selectedExtractedLabels:[]};P.forEach(({enabled:Se,nonIndexed:Me,label:Be})=>{!Se&&!Me&&_.removedLabels.push(Be),Se&&Me&&_.selectedExtractedLabels.push(Be)}),window.localStorage.setItem(pt,JSON.stringify(_)),Ce(!1)},1500),()=>{clearTimeout(Ye.current)}}},[P,ae]),(0,Ee.useEffect)(()=>()=>{clearTimeout(Ye.current),o()},[o]),(0,$r.A)(async()=>{Ce(!0);const _=await a.getInitContextFilters(n,u,{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs),raw:{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs)}});X(_.contextFilters),Z(_.preservedFiltersApplied),se(!0),Ce(!1)}),(0,Ee.useEffect)(()=>{Y&&setTimeout(()=>{Z(!1)},2e3)},[Y]),(0,Ee.useEffect)(()=>((0,Tt.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:n.uid,type:"load"}),()=>{(0,Tt.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:n.uid,type:"unload"})}),[n.uid]);const Nr=P.filter(({nonIndexed:_})=>!_),kt=Nr.filter(({enabled:_})=>_),xr=P.filter(({nonIndexed:_})=>_),V=xr.filter(({enabled:_})=>_),H=(0,Ee.useCallback)(_=>({label:`${_.label}="${(0,K.Bb)(_.value)}"`,value:_.label}),[]),ne=xr.length>0;let re=a.prepareExpression(P.filter(({enabled:_})=>_),u);return Ee.createElement("div",{className:y.wrapper},Y&&Ee.createElement(Tr.F,{className:y.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),Ee.createElement(ft.m,{content:"Revert to initial log context query."},Ee.createElement("div",{className:y.iconButton},Ee.createElement(ja.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:Dt,onClick:_=>{(0,Tt.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:n.uid}),X(Se=>Se.map(Me=>({...Me,enabled:!Me.nonIndexed}))),window.localStorage.removeItem(pt),window.localStorage.removeItem(Rt),et(!1)}}))),Ee.createElement(za.S,{collapsible:!0,isOpen:ze,onToggle:()=>{window.localStorage.setItem(aa,(!ze).toString()),we(_=>!_),(0,Tt.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:n.uid,action:ze?"close":"open"})},label:Ee.createElement("div",{className:y.rawQueryContainer},ae?Ee.createElement(Ee.Fragment,null,Ee.createElement(Ea.Z,{language:{grammar:ra.vB,name:"loki"},query:re,className:y.rawQuery}),Ee.createElement(ft.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query."},Ee.createElement(Pa.I,{name:"info-circle",size:"sm",className:y.queryDescription}))):Ee.createElement(rr.y,null))},Ee.createElement("div",{className:y.ui},Ee.createElement(ta.J,{className:y.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters."},"Widen the search"),Ee.createElement(Qr.KF,{isLoading:Xe,options:Nr.map(H),value:kt.map(H),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(_,Se)=>(Se.action==="select-option"&&(0,Tt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"label",action:"select"}),Se.action==="remove-value"&&(0,Tt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"label",action:"remove"}),X(P.map(Me=>(Me.nonIndexed||(Me.enabled=_.some(Be=>Be.value===Me.label)),Me))))}),ne&&Ee.createElement(Ee.Fragment,null,Ee.createElement(ta.J,{className:y.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line."},"Refine the search"),Ee.createElement(Qr.KF,{isLoading:Xe,options:xr.map(H),value:V.map(H),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(_,Se)=>{Se.action==="select-option"&&(0,Tt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"parsed_label",action:"select"}),Se.action==="remove-value"&&(0,Tt.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:n.uid,type:"parsed_label",action:"remove"}),X(P.map(Me=>(Me.nonIndexed&&(Me.enabled=_.some(Be=>Be.value===Me.label)),Me)))}})),a.queryContainsValidPipelineStages(u)&&Ee.createElement(_t.C,{className:y.operationsToggle},Ee.createElement(jt.I,{label:"Include LogQL pipeline operations",tooltip:Ee.createElement(xa.I,{content:(0,tr.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")})},Ee.createElement(fr.K,{value:Ze,showLabel:!0,transparent:!0,onChange:_=>{(0,Tt.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:n.uid,action:_.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem(Rt,_.currentTarget.checked.toString()),et(_.currentTarget.checked),p&&p()}}))))))}var Ge=l(12798),Vr=(m=>(m[m.Ascending=0]="Ascending",m[m.Descending=1]="Descending",m))(Vr||{});function La(m,n){const a=m.values,{nanos:i}=m,o=Array(a.length);for(let p=0;p<o.length;p++)o[p]=p;const u=n===0;return o.sort((p,y)=>{const P=a[p],X=a[y];if(P<X)return u?-1:1;if(P>X)return u?1:-1;if(i===void 0)return 0;const Y=i[p],Z=i[y];return Y<Z?u?-1:1:Y>Z?u?1:-1:0}),o}function Qt(m,n){const{fields:a,...i}=m,o=a.find(p=>p.type===lt.PU.time);if(o===void 0)throw new Error("missing timestamp field. should never happen");const u=La(o,n);return{...i,fields:a.map(p=>({...p,values:ar(p.values,u),nanos:p.nanos===void 0?void 0:ar(p.nanos,u)}))}}function ar(m,n){return m.map((a,i)=>m[n[i]])}const pt="lokiLogContextPreservedLabels",Rt="lokiLogContextShouldIncludePipelineOperations";class Et{constructor(n){this.getLogRowContextQuery=async(a,i,o,u=!0)=>{const{query:p}=await this.getQueryAndRange(a,i,o,u);return u||(this.cachedContextFilters=[]),p},this.getLogRowContext=async(a,i,o)=>{const u=i&&i.direction||q.ZF.Backward,{query:p,range:y}=await this.getQueryAndRange(a,i,o),P=Y=>{const ae=Y.data.map(se=>Qt(se,Vr.Descending));return{...Y,data:ae}},X=S.Jk.Explore;return(0,r.s)(this.datasource.query(Pr(p,y,X,`${la}${u}`)).pipe((0,b.W)(Y=>{throw{message:"Error during context query. Please check JS console logs.",status:Y.status,statusText:Y.statusText}}),(0,W.n)(Y=>(0,A.of)(P(Y)))))},this.processContextFiltersToExpr=(a,i)=>{let u=`{${a.map(p=>!p.nonIndexed&&p.enabled?`${p.label}="${(0,K.Qn)(p.value)}"`:"").filter(p=>!!p).join(",")}}`;if(i){let p=!1;if((0,z.MX)(i.expr).parserCount===1){p=!0;const P=(0,z.aw)(i.expr);P&&(u=(0,Ge.aH)(u,P))}const y=a.filter(P=>P.nonIndexed&&P.enabled);for(const P of y)P.enabled&&(u=(0,Ge.tE)(u,P.label,"=",P.value,p?v.HD.Parsed:v.HD.StructuredMetadata))}return u},this.processPipelineStagesToExpr=(a,i)=>{let o=a;const u=i?.expr??"";if((0,z.MX)(u).parserCount>1)return o;const p=(0,z.TQ)(u,[ye.t3,ye.iT,ye.c$,ye.LM,ye.CX,ye.bY]),y=p.filter(X=>X.type?.id===ye.t3),P=p.filter(X=>X.type?.id!==ye.t3);for(const X of y)P.some(Y=>X.contains(Y))||(o+=` ${X.getExpression(u)}`);return o},this.queryContainsValidPipelineStages=a=>{const i=a?.expr??"",o=(0,z.TQ)(i,[ye.t3,ye.iT,ye.CX,ye.bY]),u=o.filter(y=>y.type?.id===ye.t3),p=o.filter(y=>y.type?.id!==ye.t3);return u.some(y=>p.every(P=>y.contains(P)===!1))},this.getInitContextFilters=async(a,i,o)=>{let u=!1;if(!i||(0,T.isEmpty)(a.labels))return{contextFilters:[],preservedFiltersApplied:u};const p=a.labels;let y=[];if(!(0,z.MX)(i.expr).queryWithParser)await this.datasource.languageProvider.start(o),y=this.datasource.languageProvider.getLabelKeys();else{const Z=(0,z.pk)(i.expr);y=await this.datasource.languageProvider.fetchLabels({streamSelector:Z[0],timeRange:o})}const P=[];Object.entries(p).forEach(([Z,ae])=>{const se=(0,K.Ed)(Z,a.dataFrame,a.rowIndex),Xe={label:Z,value:ae,enabled:y.includes(Z),nonIndexed:se!==null&&se!==v.HD.Indexed};P.push(Xe)});let X;const Y=window.localStorage.getItem(pt);if(Y)try{X=JSON.parse(Y)}catch{}if(X){let Z=!1;const ae=P.map(Xe=>X.removedLabels.includes(Xe.label)?(Z=!0,{...Xe,enabled:!1}):X.selectedExtractedLabels.includes(Xe.label)?(Z=!0,{...Xe,enabled:!0}):{...Xe});return ae.some(({enabled:Xe,nonIndexed:Ce})=>Xe&&!Ce)?(Z&&(u=!0),{contextFilters:ae,preservedFiltersApplied:u}):{contextFilters:P,preservedFiltersApplied:u}}else return{contextFilters:P,preservedFiltersApplied:u}},this.datasource=n,this.cachedContextFilters=[]}async getQueryAndRange(n,a,i,o=!0){const u=a&&a.direction||q.ZF.Backward,p=a&&a.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!o){const y=(await this.getInitContextFilters(n,i,{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs),raw:{from:(0,yt.KQ)(n.timeEpochMs),to:(0,yt.KQ)(n.timeEpochMs)}})).contextFilters.filter(P=>P.enabled);this.cachedContextFilters=y}return await this.prepareLogRowContextQueryTarget(n,p,u,i)}async prepareLogRowContextQueryTarget(n,a,i,o){const u=this.prepareExpression(this.cachedContextFilters,o),p=2*60*60*1e3,y=i===q.ZF.Forward?v.ti.Forward:v.ti.Backward,P={expr:u,queryType:v.U3.Range,refId:`${la}_${Math.random().toString()}`,maxLines:a,direction:y,datasource:{uid:this.datasource.uid,type:this.datasource.type}},Y=new ba.L(n.dataFrame).getFirstFieldOfType(lt.PU.time);if(Y===void 0)throw new Error("loki: data frame missing time-field, should never happen");const Z=Y.values[n.rowIndex],ae=(0,yt.yT)(Z),se=y===v.ti.Forward?{from:ae,to:(0,yt.yT)(n.timeEpochMs+p)}:{from:(0,yt.yT)(n.timeEpochMs-p),to:ae};return{query:P,range:{from:se.from,to:se.to,raw:se}}}getLogRowContextUi(n,a,i){const o=u=>{this.cachedContextFilters=u,a&&a()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),Ka({row:n,origQuery:i,updateFilter:o,onClose:this.onContextClose,logContextProvider:this,runContextQuery:a})}prepareExpression(n,a){let i=this.processContextFiltersToExpr(n,a);return window.localStorage.getItem(Rt)==="true"&&(i=this.processPipelineStagesToExpr(i,a)),i}}var Nt=l(65474),It=l(29505),nr=l(84596),Ft=l(10354);const jr=/^label_names\(\)\s*$/,pr=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function mr(m){if(typeof m!="string")return m;const n={refId:"LokiVariableQueryEditor-VariableQuery",type:v.ie.LabelNames};if(m.match(jr))return{...n,type:v.ie.LabelNames};const i=m.match(pr);return i?{...n,type:v.ie.LabelValues,label:i[2]?i[2]:i[1],stream:i[2]?i[1]:void 0}:n}const na=[{label:"Label names",value:v.ie.LabelNames},{label:"Label values",value:v.ie.LabelValues}],Ha="LokiVariableQueryEditor-VariableQuery",Ga=({onChange:m,query:n,datasource:a,range:i})=>{const[o,u]=(0,Ee.useState)(void 0),[p,y]=(0,Ee.useState)(""),[P,X]=(0,Ee.useState)([]),[Y,Z]=(0,Ee.useState)(""),ae=(0,nr.A)(o);(0,Ee.useEffect)(()=>{if(!n)return;const we=typeof n=="string"?mr(n):n;u(we.type),y(we.label||""),Z(we.stream||"")},[n]),(0,Ee.useEffect)(()=>{o!==v.ie.LabelValues||ae===o||a.languageProvider.fetchLabels({timeRange:i}).then(we=>{X(we.map(Ze=>({label:Ze,value:Ze})))})},[a,o,i,ae]);const se=we=>{u(we.value),we.value!==void 0&&m({type:we.value,label:p,stream:Y,refId:Ha})},Xe=we=>{y(we.value||"")},Ce=we=>{Z(we.currentTarget.value)},ze=()=>{o!==void 0&&m({type:o,label:p,stream:Y,refId:"LokiVariableQueryEditor-VariableQuery"})};return Ee.createElement(Ee.Fragment,null,Ee.createElement(_t.C,null,Ee.createElement(jt.I,{label:"Query type",labelWidth:20},Ee.createElement(Qr.l6,{"aria-label":"Query type",onChange:se,onBlur:ze,value:o,options:na,width:16})),o===v.ie.LabelValues&&Ee.createElement(Ee.Fragment,null,Ee.createElement(jt.I,{label:"Label",labelWidth:20},Ee.createElement(Qr.l6,{"aria-label":"Label",onChange:Xe,onBlur:ze,value:{label:p,value:p},options:P,width:16,allowCustomValue:!0})))),o===v.ie.LabelValues&&Ee.createElement(_t.C,null,Ee.createElement(jt.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:Ee.createElement("div",null,'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}')},Ee.createElement(Ft.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:Y,onChange:Ce,onBlur:ze}))))};class wt extends It.f5{constructor(n){super(),this.datasource=n,this.editor=Ga}async execute(n,a,i){return this.datasource.metricFindQuery(n,{scopedVars:a,range:i})}query(n){const a=this.execute(n.targets[0],n.scopedVars,n.range);return(0,Nt.H)(a).pipe((0,de.T)(i=>({data:i})))}}var Wt=l(14236),Rr=l(19347);function Pt(m,n){if(!n.length)return[];const a=(0,T.groupBy)(n,"name"),i=Object.values(a).map(Ct),o=m.fields.find(p=>p.type===lt.PU.string);if(o===void 0)throw new Error("invalid logs-dataframe, string-field missing");const u=m.fields.find(p=>p.type===lt.PU.other&&p.name==="labels");for(let p=0;p<o.values.length;p++)for(const y of i)if(a[y.name][0].matcherType==="label"&&u){const P=u.values[p];if(P){const X=Object.keys(P).find(Y=>a[y.name][0].matcherRegex===Y);if(X){y.values.push(P[X]);continue}}y.values.push(null)}else if(a[y.name][0].matcherType==="regex"||a[y.name][0].matcherType===void 0){const X=o.values[p].match(a[y.name][0].matcherRegex);if(X&&X[1]){y.values.push(X[1]);continue}y.values.push(null)}else y.values.push(null);return i}function Ct(m){const n=(0,Rr.l)(),a=m.reduce((i,o)=>{if(o.datasourceUid){const u=n.getInstanceSettings(o.datasourceUid),p=y=>{switch(y){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};i.push({title:o.urlDisplayLabel||"",url:"",internal:{query:{query:o.url,queryType:p(u?.type)},datasourceUid:o.datasourceUid,datasourceName:u?.name??"Data source not found"}})}else o.url&&i.push({title:o.urlDisplayLabel||"",url:o.url});return i},[]);return{name:m[0].name,type:lt.PU.string,config:{links:a},values:[]}}function Sa(m){const n=m.filter(i=>i.refId!==void 0),a=(0,T.groupBy)(n,i=>i.refId);return Object.entries(a).map(([i,o])=>$a(o,i))}function $a(m,n){const a={name:"Time",config:{},values:[],type:lt.PU.time},i={name:`Value #${n}`,config:{},values:[],type:lt.PU.number},o=new Set(m.map(y=>y.fields.map(P=>Object.keys(P.labels??{})).flat()).flat()),p=Array.from(o).sort().map(y=>({name:y,config:{filterable:!0},values:[],type:lt.PU.string}));return m.forEach(y=>{const P=y.fields.find(se=>se.type===lt.PU.time),X=y.fields.find(se=>se.type===lt.PU.number);if(P==null||X==null)return;const Y=P.values,Z=X.values;for(let se of Y)a.values.push(se);for(let se of Z)i.values.push(se);const ae=X.labels??{};for(let se of p){const Xe=ae[se.name]??"";for(let Ce=0;Ce<Z.length;Ce++)se.values.push(Xe)}}),{fields:[a,...p,i],refId:n,meta:{preferredVisualisationType:"table"},length:a.values.length}}function zt(m){return m.fields.every(n=>n.type===lt.PU.time||n.type===lt.PU.number)}function Xt(m,n){const{meta:a,...i}=m,o={...a,...n};return{...i,meta:o}}function Ta(m,n,a){const i={...m.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,O.nE)(m)&&(i.error="Error when parsing some of the logs");const o={preferredVisualisationType:"logs",limit:n?.maxLines,searchWords:n!==void 0?(0,z.H0)(n.expr):void 0,custom:i},u=Xt(m,o),p=Pt(u,a);return{...u,fields:[...u.fields,...p]}}function sr(m,n,a){return m.map(i=>{const o=i.refId!==void 0?n.get(i.refId):void 0;return Ta(i,o,a)})}function wr(m){return m.length>0?Sa(m):[]}function sa(m){const n={preferredVisualisationType:"graph"};return m.map(a=>Xt(a,n))}function Qa(m,n){const a=[],i=[],o=[];return m.forEach(u=>{zt(u)?u.refId!=null&&n.get(u.refId)?.queryType===v.U3.Instant?i.push(u):o.push(u):a.push(u)}),{streamsFrames:a,metricInstantFrames:i,metricRangeFrames:o}}function gr(m,n){if(m===void 0)return m;const{refId:a,message:i}=m;if(a===void 0||i===void 0)return m;const o=n.get(a);return o===void 0?m:i.includes("escape")&&o.expr.includes("\\")?{...m,message:`${i}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:m}function ht(m,n,a){const{data:i,error:o,...u}=m,p=i.map(Z=>{if(!(0,Wt.ci)(Z))throw new Error("transformation only supports dataframe responses");return Z}),y=new Map(n.map(Z=>[Z.refId,Z])),{streamsFrames:P,metricInstantFrames:X,metricRangeFrames:Y}=Qa(p,y);return{...u,error:gr(o,y),data:[...sa(Y),...wr(X),...sr(P,y,a)]}}var xt=l(9e4),vt=l(81580),nt=l(67061),hr=l(60016),Kt=l(95881);const vr=(0,Ee.memo)(function(n){const{annotation:a,onAnnotationChange:i,history:o}=n;if(a===void 0||i===void 0)return null;const u=y=>{const P=(0,z.vV)(y).queryType===v.U3.Instant;i({...a,expr:y.expr,maxLines:y.maxLines,instant:P})},p={refId:"",expr:a.expr,maxLines:a.maxLines,instant:a.instant,queryType:a.queryType};return Ee.createElement(nt.B,{gap:5,direction:"column"},Ee.createElement(nt.B,{gap:0,direction:"column"},Ee.createElement(Kt.W,{datasource:n.datasource,query:p,onChange:u,onRunQuery:()=>{},history:o,ExtraFieldElement:Ee.createElement(hr.kl,{lineLimitValue:p?.maxLines?.toString()||"",resolution:p.resolution||1,query:p,onRunQuery:()=>{},onChange:u})})),Ee.createElement(xt.U,null,Ee.createElement(vt.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},Ee.createElement(Ft.p,{type:"text",placeholder:"alertname",value:a.titleFormat,onChange:y=>{i({...a,titleFormat:y.currentTarget.value})}})),Ee.createElement(vt.c,{label:"Tags"},Ee.createElement(Ft.p,{type:"text",placeholder:"label1,label2",value:a.tagKeys,onChange:y=>{i({...a,tagKeys:y.currentTarget.value})}})),Ee.createElement(vt.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},Ee.createElement(Ft.p,{type:"text",placeholder:"instance",value:a.textFormat,onChange:y=>{i({...a,textFormat:y.currentTarget.value})}}))))});var ir=l(20065);function Ya(m,n){if(n.length===0)return[];const a=[],{queryWithParser:i,parserCount:o}=(0,z.MX)(m);if(!i){const{hasLogfmt:y,hasJSON:P,hasPack:X}=(0,O.YB)(n[0]);P&&(X?a.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:m}}}):a.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:m}}})),y&&a.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:m}}})}if(i){if(o===1){const P=(0,z.d_)(m);(0,O.db)(n[0])&&!P&&a.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:m}}})}(0,z.pS)(m)||a.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:m}}})}if(!(0,z._i)(m)){const y=(0,O.Ac)(n[0]),P=(0,O.sz)(n[0]);!y&&P&&a.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${P}" label.`,fix:{title:"add label level format",label:`If ${P} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:m,options:{renameTo:"level",originalLabel:P}}}})}return(0,z.Rn)(m)||a.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:m}}}),a}var ia=l(62938),Fr=l(33948),Ja=l(52622),Cr=l(70416),Ra=l(80822);function Za(m,n,a){if(n-m<=a)return[[m,n]];const i=[];for(let o=n;o>m;o-=a){const u=Math.max(o-a,m);i.push([u,o])}return i.reverse(),i}function qa(m,n,a,i){if(i<a)return[[m,n]];const o=Math.trunc(i/a)*a,u=m-m%a,p=[];for(let y=u;y<n;y+=o){const P=Math.min(y+o-a,n);p.push([y,P])}return p}var wa=l(79007);function Fa(m,n,a,i){const o=n.from.toDate().getTime(),u=n.to.toDate().getTime();return(m?Za(o,u,i):qa(o,u,a,i)).map(([y,P])=>{const X=(0,yt.KQ)(y),Y=(0,yt.KQ)(P);return{from:X,to:Y,raw:{from:X,to:Y}}})}function en(m,n){return n?m.map(a=>{if(!a.maxLines||!(0,z.sI)(a.expr))return a;const i=n.data.find(u=>u.refId===a.refId);if(!i)return a;const o=a.maxLines-i.length;return{...a,maxLines:o<0?0:o}}).filter(a=>a.maxLines===void 0||a.maxLines>0):m}function tn(m,n){const a=n.length?n[0].request.queryGroupId:(0,ia.A)();let i={data:[],state:w.Gu.Streaming,key:a};const o=Math.max(...n.map(({partition:Y})=>Y.length)),u=n.filter(({partition:Y})=>Y.length===o)[0].partition;let p=!1,y=null;const P=(Y,Z,ae)=>{if(p){Y.complete();return}const se=()=>{i.state=w.Gu.Done,Y.next(i),Y.complete()},Xe=()=>{const{nextRequestN:et,nextRequestGroup:Ye}=Or(n,ae,Z);if(et>0&&Ye>=0){P(Y,et,Ye);return}se()},Ce=n[ae],ze=Ce.partition[Z-1],we=en(Ce.request.targets,i);if(!we.length){Xe();return}const Ze={...n[ae].request,range:ze,targets:we};Ce.request.requestId&&(Ze.requestId=`${Ce.request.requestId}_${Z}`),y=m.runQuery(Ze).subscribe({next:et=>{i=(0,Ra.Wn)(i,et),i=Ar(i,Ze,u,Z),((i.errors??[]).length>0||i.error!=null)&&(p=!0)},complete:()=>{Y.next(i),Xe()},error:et=>{Y.error(et)}})};return new $t.c(Y=>(P(Y,o,0),()=>{p=!0,y?.unsubscribe()}))}const Ca="loki-splitting-progress";function Ar(m,n,a,i){if((0,z.sI)(n.targets[0].expr)||(m.data=m.data.filter(u=>u.name!==Ca),i<=1))return m;const o=(0,Fr.I)([{time:a[0].from.valueOf(),timeEnd:a[i-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return o.name=Ca,o.meta={dataTopic:Ja.QR.Annotations},m.data.push(o),m}function Or(m,n,a){for(let i=n+1;i<m.length;i++)if(m[i].partition[a-1])return{nextRequestGroup:i,nextRequestN:a};return{nextRequestGroup:m.findIndex(i=>i?.partition[a-1]!==void 0),nextRequestN:a-1}}function Dr(m){return m.queryType!==v.U3.Instant&&!(0,z.Cg)(m.expr)}function yr(m,n){const a=n.targets.filter(ae=>!ae.hide).filter(ae=>ae.expr),[i,o]=(0,T.partition)(a,ae=>!Dr(ae)),[u,p]=(0,T.partition)(o,ae=>(0,z.sI)(ae.expr));n.queryGroupId=(0,ia.A)();const y=24*60*60*1e3,P=(0,T.groupBy)(u,ae=>ae.splitDuration?(0,Cr.WT)((0,Cr.E9)(ae.splitDuration)):y),X=(0,T.groupBy)(p,ae=>ae.splitDuration?(0,Cr.WT)((0,Cr.E9)(ae.splitDuration)):y),Y=[];for(const[ae,se]of Object.entries(P)){const Xe=(0,T.groupBy)(se,Ce=>Ce.resolution||1);for(const Ce in Xe)Y.push({request:{...n,targets:Xe[Ce]},partition:Fa(!0,n.range,n.intervalMs,Number(ae))})}for(const[ae,se]of Object.entries(X)){const Xe=(0,T.groupBy)(se,Ce=>Mr(n.intervalMs,n.range,Ce.resolution||1,Ce.step));for(const Ce in Xe){const ze=Xe[Ce].map(we=>{const{maxLines:Ze,...et}=we;return et});Y.push({request:{...n,targets:ze},partition:Fa(!1,n.range,Number(Ce),Number(ae))})}}i.length&&Y.push({request:{...n,targets:i},partition:[n.range]});const Z=new Date;return tn(m,Y).pipe((0,Oe.M)(ae=>{ae.state===w.Gu.Done&&(0,wa.uJ)(ae,Y,n,Z,{predefinedOperations:m.predefinedOperations})}))}function Mr(m,n,a,i){const o=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(i?.match(o))return fe.intervalToMs(i)*a;const u=m*a,p=Math.round((n.to.valueOf()-n.from.valueOf())/11e3);return Math.max(u,p)}var Aa=l(56245),rn=l(72316),Da=l(9631),Ht=l(55004),an=l(78731);async function zr(m){const n=JSON.stringify({expr:m.expr}),a=new TextEncoder().encode(n),i=await crypto.subtle.digest("SHA-1",a);return Array.from(new Uint8Array(i.slice(0,8))).map(u=>u.toString(16).padStart(2,"0")).join("")}function or(m,n,a){const i=a.range,o=i.to.valueOf()-i.from.valueOf()+1e3;let u=a.maxDataPoints??1e3;u>100&&(u*=2);let p;const y=P=>{if(P?.message){const X=P.message;p?p.push(X):p=Da.k9.fromDataFrameJSON(X,{maxLength:u,maxDelta:o,displayNameFormat:m.legendFormat})}return p};return(0,rn.v)(()=>zr(m)).pipe((0,Ie.Z)(P=>(0,an.oF)().getStream({scope:Ht.qD.DataSource,namespace:n.uid,path:`tail/${P}`,data:{...m,timeRange:{from:i.from.valueOf().toString(),to:i.to.valueOf().toString()}}}).pipe((0,de.T)(X=>{const Y=y(X);return{data:Y?[Y]:[],state:w.Gu.Streaming}}))))}const Kr=m=>{let a=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${te.$.appSubUrl}`;return a.endsWith("/")&&(a=a.slice(0,-1)),`${a}${m}`},Ma=1e3,Lt=10,br="/loki/api/v1",Er="loki-data-samples",oa="annotation-",la="log-row-context-query-",Na="log-volume-",Ia="log-sample-",nn="log-stats-",ca=1e6;function Pr(m,n,a,i,o){const u=fe.calculateInterval(n,1);return{targets:[m],requestId:i,interval:u.interval,intervalMs:u.intervalMs,range:n,scopedVars:{},timezone:"UTC",app:a,startTime:Date.now(),hideFromInspector:o}}class ua extends We.iy{constructor(n,a=(0,$.w)()){super(n),this.instanceSettings=n,this.templateSrv=a,this.streams=new Bt,this.runLiveQuery=(o,u)=>{const p=this.createLiveTarget(o,u);return this.streams.getStream(p).pipe((0,de.T)(y=>({data:y||[],key:`loki-${p.refId}`,state:w.Gu.Streaming})),(0,b.W)(y=>(0,Re.$)(()=>`Live tailing was stopped due to following error: ${y.reason}`)))},this.getLogRowContext=async(o,u,p)=>await this.logContextProvider.getLogRowContext(o,u,(0,z.sc)(p)),this.getLogRowContextQuery=async(o,u,p,y)=>await this.logContextProvider.getLogRowContextQuery(o,u,(0,z.sc)(p),y),this.languageProvider=new U(this);const i=n.jsonData||{};this.maxLines=parseInt(i.maxLines??"0",10)||Ma,this.predefinedOperations=i.predefinedOperations??"",this.annotations={QueryEditor:vr},this.variables=new wt(this),this.logContextProvider=new Et(this)}getSupplementaryRequest(n,a,i){switch(n){case q.cF.LogsVolume:const o=i?.type===q.cF.LogsVolume?i:{type:n};return this.getLogsVolumeDataProvider(a,o);case q.cF.LogsSample:const u=i?.type===q.cF.LogsSample?i:{type:n};return this.getLogsSampleDataProvider(a,u);default:return}}getSupportedSupplementaryQueryTypes(){return[q.cF.LogsVolume,q.cF.LogsSample]}getSupplementaryQuery(n,a){const i=(0,z.vV)(a);let o=(0,Ge.Lv)(i.expr),u=!1;switch(n.type){case q.cF.LogsVolume:if(u=!!(o&&(0,z.sI)(o)&&i.queryType===v.U3.Range),!u)return;const p=`${o} | drop __error__`,y=n.field||"level";return(0,z.FV)(this.interpolateString(p,ir.a))===!1&&(o=p),{...i,refId:`${Na}${i.refId}`,queryType:v.U3.Range,supportingQueryType:v.Q$.LogsVolume,expr:`sum by (${y}) (count_over_time(${o}[$__auto]))`,legendFormat:`{{ ${y} }}`};case q.cF.LogsSample:return u=!!(o&&!(0,z.sI)(o)),u?{...i,queryType:v.U3.Range,refId:`${Ia}${i.refId}`,expr:(0,z.OT)(o),maxLines:Number.isNaN(Number(n.limit))?this.maxLines:Number(n.limit)}:void 0;default:return}}getLogsVolumeDataProvider(n,a){const i=(0,T.cloneDeep)(n),o=i.targets.map(u=>this.getSupplementaryQuery(a,u)).filter(u=>!!u);if(o.length)return{...i,targets:o}}getLogsSampleDataProvider(n,a){const i=(0,T.cloneDeep)(n),o=i.targets.map(u=>this.getSupplementaryQuery({type:q.cF.LogsSample,limit:100},u)).filter(u=>!!u);if(o.length)return{...i,targets:o}}query(n){const a=n.targets.map(z.vV).map(p=>({...p,maxLines:p.maxLines??this.maxLines})),i={...n,targets:a},o=i.targets.filter(p=>p.queryType===v.U3.Stream);if(te.$.featureToggles.lokiExperimentalStreaming&&o.length>0&&i.rangeRaw?.to==="now"){const p={...i,targets:o};return(0,D.h)(...o.map(y=>or(this.applyTemplateVariables(y,n.scopedVars,n.filters),this,p)))}if(i.liveStreaming)return this.runLiveQueryThroughBackend(i);if(te.$.featureToggles.lokiQuerySplitting&&(0,z.gy)(i.targets))return yr(this,i);const u=new Date;return this.runQuery(i).pipe((0,Oe.M)(p=>(0,wa.Ex)(p,i,u,{predefinedOperations:this.predefinedOperations})))}runQuery(n){return super.query(n).pipe((0,de.T)(a=>ht(a,n.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(n){const a=n.targets.filter(o=>o.expr!==""&&(0,z.sI)(o.expr));if(a.length===0)return(0,A.of)({data:[],state:w.Gu.Done});const i=a.map(o=>{const u=this.applyTemplateVariables(o,n.scopedVars,n.filters),p=u.maxLines||this.maxLines;return this.runLiveQuery(u,p)});return(0,D.h)(...i)}createLiveTarget(n,a){const i=n.expr,o=this.instanceSettings.url,u=Le.kM.serializeParams({query:i});return{query:i,url:Kr(`${o}/loki/api/v1/tail?${u}`),refId:n.refId,size:a}}interpolateVariablesInQueries(n,a,i){let o=n;return n&&n.length&&(o=n.map(u=>({...u,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(u.expr,a,this.interpolateQueryExpr),i)}))),o}getQueryDisplayText(n){return n.expr}getTimeRangeParams(n){return{start:n.from.valueOf()*ca,end:n.to.valueOf()*ca}}async importFromAbstractQueries(n){await this.languageProvider.start();const a=this.languageProvider.labelKeys;return a&&a.length&&(n=n.map(i=>(i.labelMatchers=i.labelMatchers.filter(o=>a.includes(o.name)),i))),n.map(i=>this.languageProvider.importFromAbstractQuery(i))}async exportToAbstractQueries(n){return n.map(a=>this.languageProvider.exportToAbstractQuery(a))}async metadataRequest(n,a,i){if(n.startsWith("/"))throw new Error(`invalid metadata request url: ${n}`);return(await this.getResource(n,a,i)).data||[]}async statsMetadataRequest(n,a,i){if(n.startsWith("/"))throw new Error(`invalid metadata request url: ${n}`);return await this.getResource(n,a,i)}async getQueryStats(n,a){if((0,z.FV)(this.interpolateString(n.expr,ir.a)))return;const i=(0,z.pk)(n.expr);let o={streams:0,chunks:0,bytes:0,entries:0};for(const u in i){const{start:p,end:y}=this.getStatsTimeRange(n,Number(u),a);if(p===void 0||y===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const P=await this.statsMetadataRequest("index/stats",{query:i[u],start:p,end:y},{showErrorAlert:!1,requestId:`${nn}${n.refId}`});o={streams:o.streams+P.streams,chunks:o.chunks+P.chunks,bytes:o.bytes+P.bytes,entries:o.entries+P.entries}}catch{break}}return o}getStatsTimeRange(n,a,i){let o,u;const P=(0,z.QH)(n.expr,[ye.dw]).map(X=>n.expr.substring(X.from,X.to));return(0,z.sI)(n.expr)?n.queryType===v.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(i):n.queryType===v.U3.Instant?P[a]?(u=this.getTimeRangeParams(i).end,o=u-fe.intervalToMs(P[a])*1e6,{start:o,end:u}):/(\$__auto|\$__range)/.test(n.expr)?this.getTimeRangeParams(i):{start:void 0,end:void 0}:this.getTimeRangeParams(i)}async getStats(n,a){if(!n.expr)return null;const i=await this.getQueryStats(n,a);return i?Object.values(i).every(o=>o===0)?null:i:null}async metricFindQuery(n,a){if(!n)return Promise.resolve([]);let i;return typeof n=="string"?i=this.parseStringToVariableQuery(this.interpolateString(n,a?.scopedVars)):i={...n,label:this.interpolateString(n.label||"",a?.scopedVars),stream:this.interpolateString(n.stream||"",a?.scopedVars)},i?await this.processMetricFindQuery(i,a?.range):Promise.resolve([])}async processMetricFindQuery(n,a){return n.type===v.ie.LabelNames?(await this.languageProvider.fetchLabels({timeRange:a})).map(u=>({text:u})):n.label?(await this.languageProvider.fetchLabelValues(n.label,{streamSelector:n.stream,timeRange:a})).map(o=>({text:o})):[]}parseStringToVariableQuery(n){const a="LokiVariableQueryEditor-VariableQuery";if(n.match(jr))return{type:v.ie.LabelNames,refId:a};const o=n.match(pr);if(o)return{type:v.ie.LabelValues,label:o[2],stream:o[1],refId:a}}async getDataSamples(n,a){if(!(0,z.sI)(n.expr)||(0,z.FV)(this.interpolateString(n.expr,ir.a)))return[];const i={expr:n.expr,queryType:v.U3.Range,refId:Er,maxLines:n.maxLines||Lt,supportingQueryType:v.Q$.DataSample},o=Pr(i,a,S.Jk.Unknown,Er,!0);return await(0,r.s)(this.query(o).pipe((0,W.n)(u=>(0,A.of)(u.data))))}async getTagKeys(n){return(await this.languageProvider.fetchLabels({timeRange:n?.timeRange})).map(i=>({text:i}))}async getTagValues(n){return(await this.languageProvider.fetchLabelValues(n.key,{timeRange:n.timeRange})).map(i=>({text:i}))}interpolateQueryExpr(n,a){return!a.multi&&!a.includeAll?Gt(n):typeof n=="string"?da(n):(0,T.map)(n,da).join("|")}toggleQueryFilter(n,a){let i=n.expr??"";const o=(0,K.Ed)(a.options.key,a.frame,0);switch(a.type){case"FILTER_FOR":{if(a.options?.key&&a.options?.value){const u=(0,K.Bb)(a.options.value);i=(0,Ge.je)(i,a.options.key,"=",u)?(0,Ge.FN)(i,a.options.key,"=",u):(0,Ge.tE)(i,a.options.key,"=",u,o)}break}case"FILTER_OUT":{if(a.options?.key&&a.options?.value){const u=(0,K.Bb)(a.options.value);(0,Ge.je)(i,a.options.key,"=",u)&&(i=(0,Ge.FN)(i,a.options.key,"=",u)),i=(0,Ge.tE)(i,a.options.key,"!=",u,o)}break}default:break}return{...n,expr:i}}queryHasFilter(n,a){let i=n.expr??"";return(0,Ge.je)(i,a.key,"=",a.value)}modifyQuery(n,a){let i=n.expr??"";switch(a.type){case"ADD_FILTER":{if(a.options?.key&&a.options?.value){const o=(0,K.Ed)(a.options.key,a.frame,0),u=(0,K.Bb)(a.options.value);i=(0,Ge.tE)(i,a.options.key,"=",u,o)}break}case"ADD_FILTER_OUT":{if(a.options?.key&&a.options?.value){const o=(0,K.Ed)(a.options.key,a.frame,0),u=(0,K.Bb)(a.options.value);i=(0,Ge.tE)(i,a.options.key,"!=",u,o)}break}case"ADD_LOGFMT_PARSER":{i=(0,Ge.aH)(i,"logfmt");break}case"ADD_JSON_PARSER":{i=(0,Ge.aH)(i,"json");break}case"ADD_UNPACK_PARSER":{i=(0,Ge.aH)(i,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{i=(0,Ge.yI)(i);break}case"ADD_LEVEL_LABEL_FORMAT":{a.options?.originalLabel&&a.options?.renameTo&&(i=(0,Ge.o9)(i,{renameTo:a.options.renameTo,originalLabel:a.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const o=(0,Ge.cH)(n.expr),u=(0,Ge.lN)(n.expr),p=(0,Ge.lq)([...o,...u]),y=(0,Ge.i6)("","","=");i=(0,Ge.cQ)(i,[p],y);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{i=(0,Ge.OS)(i,a.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{i=(0,Ge.OS)(i,a.options?.value,"!=");break}default:break}return{...n,expr:i}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(n,a,i){return this.logContextProvider.getLogRowContextUi(n,a,(0,z.sc)(i))}async annotationQuery(n){const{expr:a,maxLines:i,instant:o,tagKeys:u="",titleFormat:p="",textFormat:y=""}=n.annotation;if(!a)return[];const P=`${oa}${n.annotation.name}`,X={refId:P,expr:a,maxLines:i,instant:o,queryType:o?v.U3.Instant:v.U3.Range},Y=Pr(X,n.range,S.Jk.Dashboard,P),{data:Z}=await(0,r.s)(this.query(Y)),ae=[],se=u.split(",").filter(Xe=>Xe!=="");for(const Xe of Z)new ke.R(Xe).forEach(ze=>{const{labels:we}=ze,Ze=Object.entries(we).map(([Ye,ct])=>[Ye,ct.trim()]).filter(([Ye,ct])=>!(ct===""||se.length&&!se.includes(Ye))).map(([Ye,ct])=>ct),et=Array.from(new Set(Ze));ae.push({time:new Date(ze.Time).valueOf(),title:(0,$e.j)(p,we),text:(0,$e.j)(y,we)||ze.Line,tags:et})});return ae}addAdHocFilters(n,a){if(!a?.length)return n;let i=(0,Aa.qk)(n);return i=a.reduce((o,u)=>{const{key:p,operator:y}=u;let{value:P}=u;return(0,K.N4)(y)?P=Gt(P):P=(0,K.Bb)(P,y),(0,Ge.tE)(o,p,y,P)},i),(0,Aa.If)(i)}filterQuery(n){return!(n.hide||n.expr==="")}applyTemplateVariables(n,a,i){const{__auto:o,__interval:u,__interval_ms:p,__range:y,__range_s:P,__range_ms:X,...Y}=a||{},Z={...Y,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}},ae=this.addAdHocFilters(this.templateSrv.replace(n.expr,Z,this.interpolateQueryExpr),i);return{...n,legendFormat:this.templateSrv.replace(n.legendFormat,Y),expr:ae}}interpolateString(n,a){return this.templateSrv.replace(n,a,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(n=>`$${n.name}`)}getQueryHints(n,a){return Ya(n.expr,a)}getDefaultQuery(n){const a={refId:"A",expr:""};return n===S.Jk.UnifiedAlerting?{...a,queryType:v.U3.Instant}:{...a,queryType:v.U3.Range}}}function Gt(m){return typeof m=="string"?m.replace(/'/g,"\\\\'"):m}function da(m){return typeof m=="string"?Gt(m.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):m}},97535:(ot,Ue,l)=>{"use strict";l.d(Ue,{Bb:()=>Le,Cs:()=>q,Ed:()=>$e,N4:()=>S,P7:()=>te,Qn:()=>fe,WV:()=>b,qv:()=>w,sM:()=>We,tY:()=>ke,tt:()=>$});var T=l(2543),Re=l.n(T),D=l(73372),A=l(65650);function r(me){return de(me/1e3)}function de(me){return Math.floor(me/60)}function b(me,Ae){if(me&&Ae){const B=r(me.from.valueOf())===r(Ae.from.valueOf()),Te=r(me.to.valueOf())===r(Ae.to.valueOf());return!(B&&Te)}return!1}const Oe=/[*+?()|\\.\[\]{}^$]/g;function W(me){return me.replace(Oe,"\\$&")}function fe(me){return me.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function w(me){return me.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function q(me){return fe(W(me))}function Le(me,Ae){return S(Ae)?q(me):fe(me)}function S(me){return!!(me&&(me.includes("=~")||me.includes("!~")))}function ke(me){const Ae=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],B=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${Ae.join("|")})$`);return!!me.match(B)}function $e(me,Ae,B){if(!Ae||B===void 0)return null;const Te=Ae.fields.find(Qe=>Qe.name==="labelTypes")?.values[B];if(!Te)return null;switch(Te[me]){case"I":return A.HD.Indexed;case"S":return A.HD.StructuredMetadata;case"P":return A.HD.Parsed;default:return null}}const ye={[D.D_.Equal]:"=",[D.D_.NotEqual]:"!=",[D.D_.EqualRegEx]:"=~",[D.D_.NotEqualRegEx]:"!~"},We=(0,T.invert)(ye);function $(me){const Ae=me.labelMatchers.map(B=>{const Te=ye[B.operator];return Te?`${B.name}${Te}"${B.value}"`:""}).filter(B=>B!=="").join(", ");return Ae?`{${Ae}}`:""}function te(me){const Ae={};me.forEach(Te=>{Object.keys(Te).forEach(Qe=>{Ae[Qe]||(Ae[Qe]=new Set),Ae[Qe].has(Te[Qe])||Ae[Qe].add(Te[Qe])})});const B={};return Fe(Object.keys(Ae)).forEach(Te=>{B[Te]=Fe(Array.from(Ae[Te]))}),{values:B,keys:Object.keys(B)}}const be=1e4;function Fe(me){return me.slice(0,be)}},12798:(ot,Ue,l)=>{"use strict";l.d(Ue,{Ch:()=>W,FN:()=>w,Lv:()=>te,OS:()=>k,aH:()=>ye,cH:()=>Fe,cQ:()=>Je,i6:()=>Te,je:()=>fe,lN:()=>me,lq:()=>R,o9:()=>$,tE:()=>ke,yB:()=>be,yI:()=>We});var T=l(2543),Re=l.n(T),D=l(36195),A=l(97535),r=l(56587),de=l(43548),b=l(60706),Oe=l(65650);class W{constructor(v,L,I){this.from=v,this.to=L,this.type=I}static fromNode(v){return new W(v.from,v.to,v.type)}contains(v){return this.from<=v.from&&this.to>=v.to}getExpression(v){return v.substring(this.from,this.to)}}function fe(O,v,L,I){return S(O,v,L,I).length>0}function w(O,v,L,I){const U=S(O,v,L,I);for(const pe of U)O=pe.parent?.type.id===D.bY?q(O,pe):Le(O,pe);return O}function q(O,v){const L=v.parent?.parent;return!L||L.type.id!==D.t3?O:(O.substring(0,L.from)+O.substring(L.to)).trim()}function Le(O,v){let L=v;do L=L.parent;while(L&&L.type.id!==D.MD);const I=v.getChild(D.gw);if(!L||!I)return O;const U=O.substring(I.from,I.to),pe=O.substring(0,L.from),Pe=O.substring(L.to),Ie=(0,b.u_)(O.substring(L.from,L.to));return Ie.query.labels=Ie.query.labels.filter(je=>je.label!==U),pe+de.y.renderQuery(Ie.query)+Pe}function S(O,v,L,I){const U=D.K3.parse(O),pe=[];return U.iterate({enter:({type:Pe,node:Ie})=>{Pe.id===D.g$&&pe.push(Ie)}}),pe.filter(Pe=>{const Ie=Pe.getChild(D.gw),je=Ie?.nextSibling,it=Pe.getChild(D.Qf);if(!Ie||!je||!it||O.substring(Ie.from,Ie.to)!==v)return!1;const Mt=O.substring(it.from,it.to);return!((0,b.w4)(Mt)!==(0,A.qv)(I)||O.substring(je.from,je.to)!==L)})}function ke(O,v,L,I,U){if(!v||!I)throw new Error("Need label to add to query.");const pe=be(O);if(!pe.length)return O;const Pe=Fe(O),Ie=me(O),je=z(O),it=(0,r.TQ)(O,[D.J_]);U||Q(O).map(Jt=>Jt.getExpression(O)).includes(v)&&(U=Oe.HD.Indexed);const dt=pe.every($t=>je.some(Vt=>Vt.from>=$t.from&&Vt.to<=$t.to)),Mt=Te(v,I,L);if(U===Oe.HD.Parsed||U===Oe.HD.StructuredMetadata){const $t=$e(O,[...pe,...Ie,...Pe,...it]);return Je(O,$t,Mt)}else{if(U===Oe.HD.Indexed)return Qe(O,pe,Mt);if(Pe.length===0||dt===!1)return Qe(O,pe,Mt);{const $t=$e(O,[...Pe,...Ie,...it]);return Je(O,$t,Mt)}}}function $e(O,v){const L=C((0,r.TQ)(O,[D.GN])),I=[...v];return L.map(pe=>R(I.filter(Pe=>pe.contains(Pe))))}function ye(O,v){const L=Ae(O);if(L.length)return He(O,L,v);{const I=be(O);return I.length?He(O,I,v):O}}function We(O){const v=Fe(O);if(!v.length)return O;const L=Te("__error__","","=");return Je(O,v,L)}function $(O,v){const L=B(O);return N(O,L,v)}function te(O){const v=ee(O);if(!v.length)return O;let L="",I=0;for(let U of v)L=L+O.substring(I,U.from),I=U.to;return L=L+O.substring(I),L}function be(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({type:I,node:U})=>{if(I.id===D.MD)return L.push(W.fromNode(U)),!1}}),L}function Fe(O){const v=D.K3.parse(O),L=[],I=[D.iT,D.eF,D.Zj,D.Tz];return v.iterate({enter:({type:U,node:pe})=>{if(I.includes(U.id))return L.push(W.fromNode(pe)),!1}}),L}function me(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({type:I,node:U})=>{if(I.id===D.bY)return L.push(W.fromNode(U)),!1}}),L}function Ae(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({type:I,node:U})=>{if(I.id===D.CX)return L.push(W.fromNode(U)),!1}}),L}function B(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({type:I,node:U})=>{if(I.id===D.UK)return L.push(W.fromNode(U)),!1;if(I.id===D.xo){const pe=[],Pe=U.getChild(D.MD);Pe&&pe.push(W.fromNode(Pe));const Ie=U.getChild(D.AL);Ie&&pe.push(W.fromNode(Ie));const je=U.getChild(D.HV);je&&pe.push(W.fromNode(je));const it=(0,T.sortBy)(pe,dt=>dt.to);return L.push(new W(it[0].from,it[it.length-1].to)),!1}}}),L}function Te(O,v,L){return{label:O,op:L,value:v}}function Qe(O,v,L){let I="",U=0;for(let pe=0;pe<v.length;pe++){const Pe=v[pe],Ie=pe===v.length-1,je=O.substring(U,Pe.from),it=Ie?O.substring(Pe.to):"",dt=(0,b.u_)(O.substring(Pe.from,Pe.to));ue(dt.query.labels,L)||dt.query.labels.push(L);const Mt=de.y.renderQuery(dt.query);I+=je+Mt+it,U=Pe.to}return I}function Je(O,v,L){let I="",U=0;for(let pe=0;pe<v.length;pe++){const Pe=v[pe],Ie=pe===v.length-1,je=O.substring(U,Pe.to),it=Ie?O.substring(Pe.to):"";let dt="";!Number.isNaN(Number(L.value))&&(L.op==="<"||L.op===">")?dt=` | ${L.label}${L.op}${Number(L.value)}`:dt=` | ${L.label}${L.op}\`${(0,A.qv)(L.value)}\``,I+=je+dt+it,U=Pe.to}return I}function He(O,v,L){let I="",U=0;for(let pe=0;pe<v.length;pe++){const Pe=v[pe],Ie=pe===v.length-1,je=O.substring(U,Pe.to),it=Ie?O.substring(Pe.to):"";I+=je+` | ${L}`+it,U=Pe.to}return I}function N(O,v,L){let I="",U=0;for(let pe=0;pe<v.length;pe++){const Pe=v[pe],Ie=pe===v.length-1,je=O.substring(U,Pe.to),it=Ie?O.substring(Pe.to):"",dt=` | label_format ${L.renameTo}=${L.originalLabel}`;I+=je+dt+it,U=Pe.to}return I}function k(O,v="",L="|="){const I=be(O);if(!I.length)return O;const U=I[0].to;return O.slice(0,U)+` ${L} \`${v}\``+O.slice(U)}function ee(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({type:I,from:U,to:pe})=>{if(I.id===D.uk)return L.push(new W(U,pe,I)),!1}}),L}function ue(O,v){return O.find(L=>L.label===v.label&&L.value===v.value)}function R(O){return O.length?O.reduce((v,L)=>v.to>L.to?v:L):new W(0,0)}function C(O){return O.filter(v=>O.every(L=>v.contains(L)===!1||v===L))}function K(O,v){if(O.type.id===v)return[W.fromNode(O)];const L=[];let I=0,U=O.childAfter(I);for(;U;)L.push(...K(U,v)),I=U.to,U=O.childAfter(I);return L}function z(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({node:I})=>{I.type.id===D.MD&&L.push(...K(I,D.g$))}}),L}function Q(O){const v=D.K3.parse(O),L=[];return v.iterate({enter:({node:I})=>{I.type.id===D.MD&&L.push(...K(I,D.gw))}}),L}},24684:(ot,Ue,l)=>{"use strict";l.r(Ue),l.d(Ue,{plugin:()=>wo});var T=l(40187),Re=l(69129),D=l(3591),A=l(2543),r=l(96540),de=l(14110),b=l(97535);const Oe=['{job="default/prometheus"}'],W=["job","app","k8s_app"],fe=5,w=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class q extends r.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],c=W.find(d=>s.includes(d));if(c){const d=await t.fetchLabelValues(c),f=(0,A.shuffle)(d).slice(0,fe).map(E=>`{${c}="${(0,b.Qn)(E)}"}`);this.setState({userExamples:f})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,de.rR)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,c=d=>{s(d),(0,de.rR)("grafana_loki_cheatsheet_example_clicked",{})};return r.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:()=>c({refId:"A",expr:t})},r.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return r.createElement("div",null,r.createElement("h2",null,"Loki Cheat Sheet"),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),r.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?r.createElement("div",null,r.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(c=>this.renderExpression(c))):r.createElement("div",null,r.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(Oe[0]))),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),r.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),r.createElement("div",{className:"cheat-sheet-item"},r.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),r.createElement("div",{className:"cheat-sheet-item__label"},r.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),w.map(c=>r.createElement("div",{className:"cheat-sheet-item",key:c.expression},r.createElement("div",{className:"cheat-sheet-item__title"},c.title),this.renderExpression(c.expression),r.createElement("div",{className:"cheat-sheet-item__label"},c.label))))}}var Le=l(41987),S=l(84596),ke=l(39070),$e=l(13544),ye=l(42952),We=l(6191),$=l(32196),te=l(40845),be=l(15292),Fe=l(46819),me=Object.defineProperty,Ae=Object.defineProperties,B=Object.getOwnPropertyDescriptors,Te=Object.getOwnPropertySymbols,Qe=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable,He=(e,t,s)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,N=(e,t)=>{for(var s in t||(t={}))Qe.call(t,s)&&He(e,s,t[s]);if(Te)for(var s of Te(t))Je.call(t,s)&&He(e,s,t[s]);return e},k=(e,t)=>Ae(e,B(t)),ee=(e,t)=>{var s={};for(var c in e)Qe.call(e,c)&&t.indexOf(c)<0&&(s[c]=e[c]);if(e!=null&&Te)for(var c of Te(e))t.indexOf(c)<0&&Je.call(e,c)&&(s[c]=e[c]);return s};function ue(e){var t=e,{label:s}=t,c=ee(t,["label"]);const d=s.replace(" ","-"),f=(0,r.useRef)((0,A.uniqueId)(`switch-${d}`)),E=(0,te.of)(R);return r.createElement(Fe.B,{gap:1},r.createElement("label",{htmlFor:f.current,className:E.switchLabel},s),r.createElement(be.d,k(N({},c),{id:f.current})))}const R=e=>({switchLabel:(0,$.css)({color:e.colors.text.secondary,cursor:"pointer",fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.primary}})});var C=l(31347),K=l(94354);const z=[{label:"Builder",value:ye.f.Builder},{label:"Code",value:ye.f.Code}];function Q({mode:e,onChange:t}){return r.createElement("div",{"data-testid":"QueryEditorModeToggle"},r.createElement(K.z,{options:z,size:"sm",value:e,onChange:t}))}var O=l(71087),v=l(32264),L=l(96374),I=l(67061),U=l(55852),pe=l(68402);class Pe{get(t){return window.localStorage[t]}set(t,s){window.localStorage[t]=s}getBool(t,s){return s!==void 0&&!this.exists(t)?s:window.localStorage[t]==="true"}getObject(t,s){let c=s;if(this.exists(t)){const d=window.localStorage[t];try{c=JSON.parse(d)}catch(f){console.error(`Error parsing store object: ${t}. Returning default: ${s}. [${f}]`)}}return c}setObject(t,s){let c;try{c=JSON.stringify(s)}catch(d){throw new Error(`Could not stringify object: ${t}. [${d}]`)}try{this.set(t,c)}catch(d){const f=new Error(`Could not save item in localStorage: ${t}. [${d}]`);throw d instanceof Error&&(f.name=d.name),f}return!0}exists(t){return window.localStorage[t]!==void 0}delete(t){window.localStorage.removeItem(t)}}const Ie=new Pe,je=e=>{const{children:t,storageKey:s,defaultValue:c}=e,[d,f]=(0,r.useState)({value:Ie.getObject(e.storageKey,e.defaultValue)});(0,r.useEffect)(()=>{const g=x=>{x.key===s&&f({value:Ie.getObject(e.storageKey,e.defaultValue)})};return window.addEventListener("storage",g),()=>{window.removeEventListener("storage",g)}});const E=g=>{try{Ie.setObject(s,g)}catch(x){console.error(x)}f({value:g})},h=()=>{try{Ie.delete(s)}catch(g){console.log(g)}f({value:c})};return r.createElement(r.Fragment,null,t(d.value,E,h))};var it=l(37390),dt=l(39558),Mt=l(91793),$t=l(9830),Vt=l(60029),Jt=l(54438),ur=l(10354);const Ur=1e3,Br=1e4,Ba=4,Zr="{}";function lt(e){const t=[];for(const s of e)if(s.selected&&s.values&&s.values.length>0){const c=s.values.filter(d=>d.selected).map(d=>d.name);c.length>1?t.push(`${s.name}=~"${c.map(b.Cs).join("|")}"`):c.length===1&&t.push(`${s.name}="${(0,b.Qn)(c[0])}"`)}return["{",t.join(","),"}"].join("")}function ha(e,t,s){return e.map(c=>{const d=t[c.name];if(d){let f;if(c.name===s&&c.values)f=c.values;else{const E=new Set(c.values?.filter(h=>h.selected).map(h=>h.name)||[]);f=d.map(h=>({name:h,selected:E.has(h)}))}return{...c,loading:!1,values:f,facets:f.length}}return{...c,loading:!1,hidden:!d,values:void 0,facets:0}})}const _a=e=>({wrapper:(0,$.css)`
    background-color: ${e.colors.background.secondary};
    width: 100%;
  `,wrapperPadding:(0,$.css)`
    padding: ${e.spacing(2)};
  `,list:(0,$.css)`
    margin-top: ${e.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:(0,$.css)`
    & + & {
      margin: ${e.spacing(2,0)};
    }

    position: relative;
  `,footerSectionStyles:(0,$.css)`
    padding: ${e.spacing(1)};
    background-color: ${e.colors.background.primary};
    position: sticky;
    bottom: -${e.spacing(3)}; /* offset the padding on modal */
    left: 0;
  `,selector:(0,$.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    margin-bottom: ${e.spacing(1)};
    width: 100%;
  `,status:(0,$.css)`
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
    font-size: ${e.typography.bodySmall.fontSize};
    height: calc(${e.typography.bodySmall.fontSize} + 10px);
  `,statusShowing:(0,$.css)`
    opacity: 1;
  `,error:(0,$.css)`
    color: ${e.colors.error.main};
  `,valueList:(0,$.css)`
    margin-right: ${e.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:(0,$.css)`
    border-left: 1px solid ${e.colors.border.medium};
    margin: ${e.spacing(1,0)};
    padding: ${e.spacing(1,0,1,1)};
  `,valueListArea:(0,$.css)`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${e.spacing(1)};
  `,valueTitle:(0,$.css)`
    margin-left: -${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
  `,validationStatus:(0,$.css)`
    padding: ${e.spacing(.5)};
    margin-bottom: ${e.spacing(1)};
    color: ${e.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class Wa extends r.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,de.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=lt(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,de.rR)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${lt(this.state.labels)}[$__auto])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(c=>({...c,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,c)=>{const d=this.state.labels.find(h=>h.name===t);if(!d)return;const f=!d.selected;let E={selected:f};if(d.values&&!f){const h=d.values.map(g=>({...g,selected:!1}));E={...E,facets:0,values:h}}this.setState({searchTerm:""}),this.updateLabelState(t,E,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,c)=>{const d=this.state.labels.find(E=>E.name===t);if(!d||!d.values)return;this.setState({searchTerm:""});const f=d.values.map(E=>({...E,selected:E.name===s?!E.selected:E.selected}));this.updateLabelState(t,{values:f},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=lt(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=lt(this.state.labels);if(s===Zr){const c=this.state.labels.map(d=>({...d,facets:0,values:void 0,hidden:!1}));this.setState({labels:c},()=>{this.state.labels.forEach(d=>d.selected&&this.fetchValues(d.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,c="",d){this.setState(f=>{const E=f.labels.map(g=>g.name===t?{...g,...s}:g),h=c?"":f.error;return{labels:E,status:c,error:h,validationStatus:""}},d)}componentDidMount(){const{languageProvider:t,autoSelect:s=Ba,lastUsedLabels:c,timeRange:d}=this.props;if(t){const f=c;t.start(d).then(()=>{let E=t.getLabelKeys();if(E.length>Ur){const g=`Too many labels found (showing only ${Ur} of ${E.length})`;E=E.slice(0,Ur),this.setState({error:g})}const h=E.map((g,x,M)=>({name:g,selected:M.length<=s&&f.length===0||f.includes(g),loading:!1}));this.setState({labels:h},()=>{this.state.labels.forEach(g=>{g.selected&&this.fetchValues(g.name,Zr)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(d=>d.name===t);if(!s)return;const c=this.state.labels.filter(d=>d.selected).map(d=>d.name);this.props.storeLastUsedLabels(c),s.selected?s.values||this.fetchValues(t,lt(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:c,timeRange:d}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let f=await c.fetchLabelValues(t,{timeRange:d});if(s!==lt(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(f.length>Br){const h=`Too many values for ${t} (showing only ${Br} of ${f.length})`;f=f.slice(0,Br),this.setState({error:h})}const E=f.map(h=>({name:h}));this.updateLabelState(t,{values:E,loading:!1})}catch(f){console.error(f)}}async fetchSeries(t,s){const{languageProvider:c,timeRange:d}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const f=await c.fetchSeriesLabels(t,{timeRange:d});if(t!==lt(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(f).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const E=ha(this.state.labels,f,s);this.setState({labels:E,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(f){console.error(f)}}async validateSelector(t){const{languageProvider:s,timeRange:c}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const d=await s.fetchSeries(t,{timeRange:c});this.setState({validationStatus:`Selector is valid (${d.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:c,status:d,error:f,validationStatus:E}=this.state;if(s.length===0)return r.createElement(dt._,{text:"Loading labels..."});const h=_a(t),g=lt(this.state.labels),x=g===Zr;let M=s.filter(F=>F.selected&&F.values);return c?M=M.map(F=>{const G=F.values.filter(j=>{if(j.selected)return j.highlightParts=void 0,!0;const xe=(0,$t.I)(j.name.toLowerCase(),c.toLowerCase());return xe.found?(j.highlightParts=xe.ranges,j.order=xe.distance,!0):!1});return{...F,values:(0,A.sortBy)(G,j=>j.selected?-1/0:j.order)}}):M=this.state.labels.filter(F=>F.selected&&F.values).map(F=>({...F,values:F?.values?F.values.map(G=>({...G,highlightParts:void 0})):[]})),r.createElement(r.Fragment,null,r.createElement("div",{className:h.wrapper},r.createElement("div",{className:(0,$.cx)(h.section,h.wrapperPadding)},r.createElement(Vt.J,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),r.createElement("div",{className:h.list},s.map(F=>r.createElement(Jt.J,{key:F.name,name:F.name,loading:F.loading,active:F.selected,hidden:F.hidden,facets:F.facets,onClick:this.onClickLabel})))),r.createElement("div",{className:(0,$.cx)(h.section,h.wrapperPadding)},r.createElement(Vt.J,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),r.createElement("div",null,r.createElement(ur.p,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:c,placeholder:"Enter a label value"})),r.createElement("div",{className:h.valueListArea},M.map(F=>r.createElement("div",{role:"list",key:F.name,className:h.valueListWrapper},r.createElement("div",{className:h.valueTitle,"aria-label":`Values for ${F.name}`},r.createElement(Jt.J,{name:F.name,loading:F.loading,active:F.selected,hidden:F.hidden,facets:F.facets||F.values?.length,onClick:this.onClickLabel})),r.createElement(Mt.Y1,{height:200,itemCount:F.values?.length||0,itemSize:28,itemKey:G=>F.values?.[G].name??G,width:200,className:h.valueList},({index:G,style:j})=>{const xe=F.values?.[G];return xe?r.createElement("div",{style:j},r.createElement(Jt.J,{name:F.name,value:xe?.name,active:xe?.selected,highlightParts:xe?.highlightParts,onClick:this.onClickValue,searchTerm:c})):null})))))),r.createElement("div",{className:h.footerSectionStyles},r.createElement(Vt.J,null,"3. Resulting selector"),r.createElement("pre",{"aria-label":"selector",className:h.selector},g),E&&r.createElement("div",{className:h.validationStatus},E),r.createElement("div",{className:(0,$.cx)(h.status,(d||f)&&h.statusShowing)},r.createElement("span",{className:f?h.error:""},f||d)),r.createElement(I.B,{gap:1},r.createElement(U.$n,{"aria-label":"Use selector as logs button",disabled:x,onClick:this.onClickRunLogsQuery},"Show logs"),r.createElement(U.$n,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:x,onClick:this.onClickRunMetricsQuery},"Show logs rate"),r.createElement(U.$n,{"aria-label":"Validate submit button",variant:"secondary",disabled:x,onClick:this.onClickValidate},"Validate selector"),r.createElement(U.$n,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const _r=(0,te.cV)(Wa),Wr=e=>{const{isOpen:t,onClose:s,datasource:c,app:d,timeRange:f}=e,[E,h]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!1),M="grafana.datasources.loki.browser.labels",F=(0,te.of)(va);(0,r.useEffect)(()=>{t&&c.languageProvider.fetchLabels({timeRange:f}).then(J=>{h(!0),x(J.length>0)})},[c,t,f]);const G=J=>{const{query:le,onChange:he,onRunQuery:ie}=e,ve={...le,expr:J};he(ve),ie()},j=J=>{G(J),s()},xe=()=>{(0,de.rR)("grafana_loki_label_browser_closed",{app:d,closeType:"modalClose"}),s()};return r.createElement(it.a,{isOpen:t,title:"Label browser",onDismiss:xe,className:F.modal},!E&&r.createElement(dt._,{text:"Loading labels..."}),E&&!g&&r.createElement("p",null,"No labels found."),E&&g&&r.createElement(je,{storageKey:M,defaultValue:[]},(J,le,he)=>r.createElement(_r,{languageProvider:c.languageProvider,onChange:j,lastUsedLabels:J,storeLastUsedLabels:le,deleteLastUsedLabels:he,app:d,timeRange:f})))},va=e=>({modal:(0,$.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Oa=l(65307),Ot=l(43548),Zt=l(60706),qr=l(43127),ea=l(9e4),dr=l(81580),ka=l(97801),Va=l(85269),ya=l(44600),qt=l(50877),er=l(14186),Bt=l(21594),yt=l(81392),ba=l(3721),bt=Object.defineProperty,Ee=Object.defineProperties,$r=Object.getOwnPropertyDescriptors,tr=Object.getOwnPropertySymbols,Ea=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,gt=(e,t,s)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Tr=(e,t)=>{for(var s in t||(t={}))Ea.call(t,s)&&gt(e,s,t[s]);if(tr)for(var s of tr(t))Tt.call(t,s)&&gt(e,s,t[s]);return e},ft=(e,t)=>Ee(e,$r(t));const ja="You have conflicting label filters";function za({item:e,items:t,defaultOp:s,onChange:c,onDelete:d,onGetLabelNames:f,onGetLabelValues:E,invalidLabel:h,invalidValue:g,multiValueSeparator:x="|"}){var M;const[F,G]=(0,r.useState)({}),[j,xe]=(0,r.useState)(!1),[J,le]=(0,r.useState)(!1),he=(oe=e.op)=>{var Ne;return(Ne=Pa.find(ge=>ge.label===oe))==null?void 0:Ne.isMultiValue},ie=oe=>oe?oe.indexOf(x)>0?oe.split(x):[oe]:[],ve=()=>{const oe=F.labelValues?[...F.labelValues]:[],Ne=ie(e?.value).map(qt.z);return(0,A.uniqBy)([...Ne,...oe],"value")},ce=rr(e,t),{current:De}=(0,r.useRef)((0,ya.A)());return r.createElement("div",{"data-testid":"visual-query-builder-dimensions-filter-item"},r.createElement(er.I,{error:ja,invalid:ce?!0:void 0},r.createElement(yt.M,null,r.createElement(Bt.l6,{placeholder:"Select label","data-testid":$e.Tp.components.QueryBuilder.labelSelect,inputId:`visual-query-builder-dimensions-filter-item-key-${De}`,width:"auto",value:e.label?(0,qt.z)(e.label):null,allowCustomValue:!0,onOpenMenu:async()=>{G({isLoadingLabelNames:!0});const oe=await f(e);xe(!0),G({labelNames:oe,isLoadingLabelNames:void 0})},onCloseMenu:()=>{xe(!1)},isOpen:j,isLoading:F.isLoadingLabelNames,options:F.labelNames,onChange:oe=>{var Ne;oe.value&&c(ft(Tr({},e),{op:(Ne=e.op)!=null?Ne:s,label:oe.value}))},invalid:ce||h}),r.createElement(Bt.l6,{"data-testid":$e.Tp.components.QueryBuilder.matchOperatorSelect,value:(0,qt.z)((M=e.op)!=null?M:s),options:Pa,width:"auto",onChange:oe=>{oe.value&&c(ft(Tr({},e),{op:oe.value,value:he(oe.value)?e.value:ie(e?.value)[0]}))},invalid:ce}),r.createElement(Bt.l6,{placeholder:"Select value","data-testid":$e.Tp.components.QueryBuilder.valueSelect,inputId:`visual-query-builder-dimensions-filter-item-value-${De}`,width:"auto",value:he()?ie(e?.value).map(qt.z):ie(e?.value).map(qt.z)[0],allowCustomValue:!0,onOpenMenu:async()=>{G({isLoadingLabelValues:!0});const oe=await E(e);G(ft(Tr({},F),{labelValues:oe,isLoadingLabelValues:void 0})),le(!0)},onCloseMenu:()=>{le(!1)},isOpen:J,isMulti:he(),isLoading:F.isLoadingLabelValues,options:ve(),onChange:oe=>{var Ne,ge;if(oe.value)c(ft(Tr({},e),{value:oe.value,op:(Ne=e.op)!=null?Ne:s}));else{const Ve=oe.map(Ke=>{if(Ke.value)return Ke.value}).filter(Ke=>Ke!==void 0).join(x);c(ft(Tr({},e),{value:Ve,op:(ge=e.op)!=null?ge:s}))}},invalid:ce||g}),r.createElement(ba.Z,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:d}))))}const Pa=[{label:"=",value:"=",description:"Equals",isMultiValue:!1},{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0}];function rr(e,t){if(!e.label||!e.op||!e.value||t.length<2)return!1;const s=e.op.toString().startsWith("!");return t.filter(f=>f.label===e.label&&f.value===e.value&&f.op!==e.op).some(f=>{var E,h;return!!(s&&((E=f?.op)==null?void 0:E.toString().startsWith("!"))===!1||s===!1&&((h=f?.op)!=null&&h.toString().startsWith("!")))})}const ta="Select at least 1 label filter (label and value)";function Qr({labelsFilters:e,onChange:t,onGetLabelNames:s,onGetLabelValues:c,labelFilterRequired:d,multiValueSeparator:f}){const E="=",[h,g]=(0,r.useState)([{op:E}]);(0,r.useEffect)(()=>{e.length>0?g(e):g([{op:E}])},[e]);const x=F=>{g(F);const G=F.filter(j=>j.label!==void 0&&j.value!==void 0);(0,A.isEqual)(G,e)||t(G)},M=h.some(F=>F.label&&F.value);return r.createElement(ka.B,null,r.createElement(dr.c,{label:"Label filters",error:ta,invalid:d&&!M},r.createElement(Va.o,{items:h,onChange:x,renderItem:(F,G,j)=>r.createElement(za,{item:F,items:h,defaultOp:E,onChange:G,onDelete:j,onGetLabelNames:s,onGetLabelValues:c,invalidLabel:d&&!F.label,invalidValue:d&&!F.value,multiValueSeparator:f})})))}var _t=l(36663);function jt({title:e,stepNumber:t,markdown:s,children:c}){const d=(0,te.of)(xa);return r.createElement("div",{className:d.box},t!==void 0&&r.createElement("div",{className:d.stepNumber},t),r.createElement("div",{className:d.boxInner},e&&r.createElement("div",{className:d.header},r.createElement("span",null,e)),r.createElement("div",{className:d.body},s&&r.createElement("div",{dangerouslySetInnerHTML:{__html:(0,_t.G)(s)}}),c)))}const xa=e=>({box:(0,$.css)({background:e.colors.background.secondary,padding:e.spacing(1),borderRadius:e.shape.radius.default,position:"relative"}),boxInner:(0,$.css)({marginLeft:e.spacing(4)}),stepNumber:(0,$.css)({fontWeight:e.typography.fontWeightMedium,background:e.colors.secondary.main,width:"20px",height:"20px",borderRadius:e.shape.radius.circle,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:e.typography.bodySmall.fontSize}),header:(0,$.css)({paddingBottom:e.spacing(.5),display:"flex",alignItems:"center",fontFamily:e.typography.fontFamilyMonospace}),body:(0,$.css)({color:e.colors.text.secondary,"p:last-child":{margin:0},a:{color:e.colors.text.link,textDecoration:"underline"}})});var fr=l(92762),ra=l(21103),kr=l(75494),aa=l(1604),Ka=l(3988),Ge=l(56034),Vr=l(14578),La=l(98587),Qt=l(58168),ar=l(40961);function pt(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Rt(e){var t=pt(e).Element;return e instanceof t||e instanceof Element}function Et(e){var t=pt(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function Nt(e){if(typeof ShadowRoot>"u")return!1;var t=pt(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var It=Math.max,nr=Math.min,Ft=Math.round;function jr(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function pr(){return!/^((?!chrome|android).)*safari/i.test(jr())}function mr(e,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var c=e.getBoundingClientRect(),d=1,f=1;t&&Et(e)&&(d=e.offsetWidth>0&&Ft(c.width)/e.offsetWidth||1,f=e.offsetHeight>0&&Ft(c.height)/e.offsetHeight||1);var E=Rt(e)?pt(e):window,h=E.visualViewport,g=!pr()&&s,x=(c.left+(g&&h?h.offsetLeft:0))/d,M=(c.top+(g&&h?h.offsetTop:0))/f,F=c.width/d,G=c.height/f;return{width:F,height:G,top:M,right:x+F,bottom:M+G,left:x,x,y:M}}function na(e){var t=pt(e),s=t.pageXOffset,c=t.pageYOffset;return{scrollLeft:s,scrollTop:c}}function Ha(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Ga(e){return e===pt(e)||!Et(e)?na(e):Ha(e)}function wt(e){return e?(e.nodeName||"").toLowerCase():null}function Wt(e){return((Rt(e)?e.ownerDocument:e.document)||window.document).documentElement}function Rr(e){return mr(Wt(e)).left+na(e).scrollLeft}function Pt(e){return pt(e).getComputedStyle(e)}function Ct(e){var t=Pt(e),s=t.overflow,c=t.overflowX,d=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+d+c)}function Sa(e){var t=e.getBoundingClientRect(),s=Ft(t.width)/e.offsetWidth||1,c=Ft(t.height)/e.offsetHeight||1;return s!==1||c!==1}function $a(e,t,s){s===void 0&&(s=!1);var c=Et(t),d=Et(t)&&Sa(t),f=Wt(t),E=mr(e,d,s),h={scrollLeft:0,scrollTop:0},g={x:0,y:0};return(c||!c&&!s)&&((wt(t)!=="body"||Ct(f))&&(h=Ga(t)),Et(t)?(g=mr(t,!0),g.x+=t.clientLeft,g.y+=t.clientTop):f&&(g.x=Rr(f))),{x:E.left+h.scrollLeft-g.x,y:E.top+h.scrollTop-g.y,width:E.width,height:E.height}}function zt(e){var t=mr(e),s=e.offsetWidth,c=e.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-c)<=1&&(c=t.height),{x:e.offsetLeft,y:e.offsetTop,width:s,height:c}}function Xt(e){return wt(e)==="html"?e:e.assignedSlot||e.parentNode||(Nt(e)?e.host:null)||Wt(e)}function Ta(e){return["html","body","#document"].indexOf(wt(e))>=0?e.ownerDocument.body:Et(e)&&Ct(e)?e:Ta(Xt(e))}function sr(e,t){var s;t===void 0&&(t=[]);var c=Ta(e),d=c===((s=e.ownerDocument)==null?void 0:s.body),f=pt(c),E=d?[f].concat(f.visualViewport||[],Ct(c)?c:[]):c,h=t.concat(E);return d?h:h.concat(sr(Xt(E)))}function wr(e){return["table","td","th"].indexOf(wt(e))>=0}function sa(e){return!Et(e)||Pt(e).position==="fixed"?null:e.offsetParent}function Qa(e){var t=/firefox/i.test(jr()),s=/Trident/i.test(jr());if(s&&Et(e)){var c=Pt(e);if(c.position==="fixed")return null}var d=Xt(e);for(Nt(d)&&(d=d.host);Et(d)&&["html","body"].indexOf(wt(d))<0;){var f=Pt(d);if(f.transform!=="none"||f.perspective!=="none"||f.contain==="paint"||["transform","perspective"].indexOf(f.willChange)!==-1||t&&f.willChange==="filter"||t&&f.filter&&f.filter!=="none")return d;d=d.parentNode}return null}function gr(e){for(var t=pt(e),s=sa(e);s&&wr(s)&&Pt(s).position==="static";)s=sa(s);return s&&(wt(s)==="html"||wt(s)==="body"&&Pt(s).position==="static")?t:s||Qa(e)||t}var ht="top",xt="bottom",vt="right",nt="left",hr="auto",Kt=[ht,xt,vt,nt],vr="start",ir="end",Ya="clippingParents",ia="viewport",Fr="popper",Ja="reference",Cr=Kt.reduce(function(e,t){return e.concat([t+"-"+vr,t+"-"+ir])},[]),Ra=[].concat(Kt,[hr]).reduce(function(e,t){return e.concat([t,t+"-"+vr,t+"-"+ir])},[]),Za="beforeRead",qa="read",wa="afterRead",Fa="beforeMain",en="main",tn="afterMain",Ca="beforeWrite",Ar="write",Or="afterWrite",Dr=[Za,qa,wa,Fa,en,tn,Ca,Ar,Or];function yr(e){var t=new Map,s=new Set,c=[];e.forEach(function(f){t.set(f.name,f)});function d(f){s.add(f.name);var E=[].concat(f.requires||[],f.requiresIfExists||[]);E.forEach(function(h){if(!s.has(h)){var g=t.get(h);g&&d(g)}}),c.push(f)}return e.forEach(function(f){s.has(f.name)||d(f)}),c}function Mr(e){var t=yr(e);return Dr.reduce(function(s,c){return s.concat(t.filter(function(d){return d.phase===c}))},[])}function Aa(e){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(e())})})),t}}function rn(e){var t=e.reduce(function(s,c){var d=s[c.name];return s[c.name]=d?Object.assign({},d,c,{options:Object.assign({},d.options,c.options),data:Object.assign({},d.data,c.data)}):c,s},{});return Object.keys(t).map(function(s){return t[s]})}var Da={placement:"bottom",modifiers:[],strategy:"absolute"};function Ht(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!t.some(function(c){return!(c&&typeof c.getBoundingClientRect=="function")})}function an(e){e===void 0&&(e={});var t=e,s=t.defaultModifiers,c=s===void 0?[]:s,d=t.defaultOptions,f=d===void 0?Da:d;return function(h,g,x){x===void 0&&(x=f);var M={placement:"bottom",orderedModifiers:[],options:Object.assign({},Da,f),modifiersData:{},elements:{reference:h,popper:g},attributes:{},styles:{}},F=[],G=!1,j={state:M,setOptions:function(he){var ie=typeof he=="function"?he(M.options):he;J(),M.options=Object.assign({},f,M.options,ie),M.scrollParents={reference:Rt(h)?sr(h):h.contextElement?sr(h.contextElement):[],popper:sr(g)};var ve=Mr(rn([].concat(c,M.options.modifiers)));return M.orderedModifiers=ve.filter(function(ce){return ce.enabled}),xe(),j.update()},forceUpdate:function(){if(!G){var he=M.elements,ie=he.reference,ve=he.popper;if(Ht(ie,ve)){M.rects={reference:$a(ie,gr(ve),M.options.strategy==="fixed"),popper:zt(ve)},M.reset=!1,M.placement=M.options.placement,M.orderedModifiers.forEach(function(Ke){return M.modifiersData[Ke.name]=Object.assign({},Ke.data)});for(var ce=0;ce<M.orderedModifiers.length;ce++){if(M.reset===!0){M.reset=!1,ce=-1;continue}var De=M.orderedModifiers[ce],oe=De.fn,Ne=De.options,ge=Ne===void 0?{}:Ne,Ve=De.name;typeof oe=="function"&&(M=oe({state:M,options:ge,name:Ve,instance:j})||M)}}}},update:Aa(function(){return new Promise(function(le){j.forceUpdate(),le(M)})}),destroy:function(){J(),G=!0}};if(!Ht(h,g))return j;j.setOptions(x).then(function(le){!G&&x.onFirstUpdate&&x.onFirstUpdate(le)});function xe(){M.orderedModifiers.forEach(function(le){var he=le.name,ie=le.options,ve=ie===void 0?{}:ie,ce=le.effect;if(typeof ce=="function"){var De=ce({state:M,name:he,instance:j,options:ve}),oe=function(){};F.push(De||oe)}})}function J(){F.forEach(function(le){return le()}),F=[]}return j}}var zr=null,or={passive:!0};function Kr(e){var t=e.state,s=e.instance,c=e.options,d=c.scroll,f=d===void 0?!0:d,E=c.resize,h=E===void 0?!0:E,g=pt(t.elements.popper),x=[].concat(t.scrollParents.reference,t.scrollParents.popper);return f&&x.forEach(function(M){M.addEventListener("scroll",s.update,or)}),h&&g.addEventListener("resize",s.update,or),function(){f&&x.forEach(function(M){M.removeEventListener("scroll",s.update,or)}),h&&g.removeEventListener("resize",s.update,or)}}const Ma={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Kr,data:{}};function Lt(e){return e.split("-")[0]}function br(e){return e.split("-")[1]}function Er(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function oa(e){var t=e.reference,s=e.element,c=e.placement,d=c?Lt(c):null,f=c?br(c):null,E=t.x+t.width/2-s.width/2,h=t.y+t.height/2-s.height/2,g;switch(d){case ht:g={x:E,y:t.y-s.height};break;case xt:g={x:E,y:t.y+t.height};break;case vt:g={x:t.x+t.width,y:h};break;case nt:g={x:t.x-s.width,y:h};break;default:g={x:t.x,y:t.y}}var x=d?Er(d):null;if(x!=null){var M=x==="y"?"height":"width";switch(f){case vr:g[x]=g[x]-(t[M]/2-s[M]/2);break;case ir:g[x]=g[x]+(t[M]/2-s[M]/2);break;default:}}return g}function la(e){var t=e.state,s=e.name;t.modifiersData[s]=oa({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Na={name:"popperOffsets",enabled:!0,phase:"read",fn:la,data:{}};var Ia={top:"auto",right:"auto",bottom:"auto",left:"auto"};function nn(e,t){var s=e.x,c=e.y,d=t.devicePixelRatio||1;return{x:Ft(s*d)/d||0,y:Ft(c*d)/d||0}}function ca(e){var t,s=e.popper,c=e.popperRect,d=e.placement,f=e.variation,E=e.offsets,h=e.position,g=e.gpuAcceleration,x=e.adaptive,M=e.roundOffsets,F=e.isFixed,G=E.x,j=G===void 0?0:G,xe=E.y,J=xe===void 0?0:xe,le=typeof M=="function"?M({x:j,y:J}):{x:j,y:J};j=le.x,J=le.y;var he=E.hasOwnProperty("x"),ie=E.hasOwnProperty("y"),ve=nt,ce=ht,De=window;if(x){var oe=gr(s),Ne="clientHeight",ge="clientWidth";if(oe===pt(s)&&(oe=Wt(s),Pt(oe).position!=="static"&&h==="absolute"&&(Ne="scrollHeight",ge="scrollWidth")),oe=oe,d===ht||(d===nt||d===vt)&&f===ir){ce=xt;var Ve=F&&oe===De&&De.visualViewport?De.visualViewport.height:oe[Ne];J-=Ve-c.height,J*=g?1:-1}if(d===nt||(d===ht||d===xt)&&f===ir){ve=vt;var Ke=F&&oe===De&&De.visualViewport?De.visualViewport.width:oe[ge];j-=Ke-c.width,j*=g?1:-1}}var at=Object.assign({position:h},x&&Ia),St=M===!0?nn({x:j,y:J},pt(s)):{x:j,y:J};if(j=St.x,J=St.y,g){var mt;return Object.assign({},at,(mt={},mt[ce]=ie?"0":"",mt[ve]=he?"0":"",mt.transform=(De.devicePixelRatio||1)<=1?"translate("+j+"px, "+J+"px)":"translate3d("+j+"px, "+J+"px, 0)",mt))}return Object.assign({},at,(t={},t[ce]=ie?J+"px":"",t[ve]=he?j+"px":"",t.transform="",t))}function Pr(e){var t=e.state,s=e.options,c=s.gpuAcceleration,d=c===void 0?!0:c,f=s.adaptive,E=f===void 0?!0:f,h=s.roundOffsets,g=h===void 0?!0:h,x={placement:Lt(t.placement),variation:br(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:d,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,ca(Object.assign({},x,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:E,roundOffsets:g})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,ca(Object.assign({},x,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const ua={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Pr,data:{}};function Gt(e){var t=e.state;Object.keys(t.elements).forEach(function(s){var c=t.styles[s]||{},d=t.attributes[s]||{},f=t.elements[s];!Et(f)||!wt(f)||(Object.assign(f.style,c),Object.keys(d).forEach(function(E){var h=d[E];h===!1?f.removeAttribute(E):f.setAttribute(E,h===!0?"":h)}))})}function da(e){var t=e.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(c){var d=t.elements[c],f=t.attributes[c]||{},E=Object.keys(t.styles.hasOwnProperty(c)?t.styles[c]:s[c]),h=E.reduce(function(g,x){return g[x]="",g},{});!Et(d)||!wt(d)||(Object.assign(d.style,h),Object.keys(f).forEach(function(g){d.removeAttribute(g)}))})}}const m={name:"applyStyles",enabled:!0,phase:"write",fn:Gt,effect:da,requires:["computeStyles"]};function n(e,t,s){var c=Lt(e),d=[nt,ht].indexOf(c)>=0?-1:1,f=typeof s=="function"?s(Object.assign({},t,{placement:e})):s,E=f[0],h=f[1];return E=E||0,h=(h||0)*d,[nt,vt].indexOf(c)>=0?{x:h,y:E}:{x:E,y:h}}function a(e){var t=e.state,s=e.options,c=e.name,d=s.offset,f=d===void 0?[0,0]:d,E=Ra.reduce(function(M,F){return M[F]=n(F,t.rects,f),M},{}),h=E[t.placement],g=h.x,x=h.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=g,t.modifiersData.popperOffsets.y+=x),t.modifiersData[c]=E}const i={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:a};var o={left:"right",right:"left",bottom:"top",top:"bottom"};function u(e){return e.replace(/left|right|bottom|top/g,function(t){return o[t]})}var p={start:"end",end:"start"};function y(e){return e.replace(/start|end/g,function(t){return p[t]})}function P(e,t){var s=pt(e),c=Wt(e),d=s.visualViewport,f=c.clientWidth,E=c.clientHeight,h=0,g=0;if(d){f=d.width,E=d.height;var x=pr();(x||!x&&t==="fixed")&&(h=d.offsetLeft,g=d.offsetTop)}return{width:f,height:E,x:h+Rr(e),y:g}}function X(e){var t,s=Wt(e),c=na(e),d=(t=e.ownerDocument)==null?void 0:t.body,f=It(s.scrollWidth,s.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),E=It(s.scrollHeight,s.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),h=-c.scrollLeft+Rr(e),g=-c.scrollTop;return Pt(d||s).direction==="rtl"&&(h+=It(s.clientWidth,d?d.clientWidth:0)-f),{width:f,height:E,x:h,y:g}}function Y(e,t){var s=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(s&&Nt(s)){var c=t;do{if(c&&e.isSameNode(c))return!0;c=c.parentNode||c.host}while(c)}return!1}function Z(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function ae(e,t){var s=mr(e,!1,t==="fixed");return s.top=s.top+e.clientTop,s.left=s.left+e.clientLeft,s.bottom=s.top+e.clientHeight,s.right=s.left+e.clientWidth,s.width=e.clientWidth,s.height=e.clientHeight,s.x=s.left,s.y=s.top,s}function se(e,t,s){return t===ia?Z(P(e,s)):Rt(t)?ae(t,s):Z(X(Wt(e)))}function Xe(e){var t=sr(Xt(e)),s=["absolute","fixed"].indexOf(Pt(e).position)>=0,c=s&&Et(e)?gr(e):e;return Rt(c)?t.filter(function(d){return Rt(d)&&Y(d,c)&&wt(d)!=="body"}):[]}function Ce(e,t,s,c){var d=t==="clippingParents"?Xe(e):[].concat(t),f=[].concat(d,[s]),E=f[0],h=f.reduce(function(g,x){var M=se(e,x,c);return g.top=It(M.top,g.top),g.right=nr(M.right,g.right),g.bottom=nr(M.bottom,g.bottom),g.left=It(M.left,g.left),g},se(e,E,c));return h.width=h.right-h.left,h.height=h.bottom-h.top,h.x=h.left,h.y=h.top,h}function ze(){return{top:0,right:0,bottom:0,left:0}}function we(e){return Object.assign({},ze(),e)}function Ze(e,t){return t.reduce(function(s,c){return s[c]=e,s},{})}function et(e,t){t===void 0&&(t={});var s=t,c=s.placement,d=c===void 0?e.placement:c,f=s.strategy,E=f===void 0?e.strategy:f,h=s.boundary,g=h===void 0?Ya:h,x=s.rootBoundary,M=x===void 0?ia:x,F=s.elementContext,G=F===void 0?Fr:F,j=s.altBoundary,xe=j===void 0?!1:j,J=s.padding,le=J===void 0?0:J,he=we(typeof le!="number"?le:Ze(le,Kt)),ie=G===Fr?Ja:Fr,ve=e.rects.popper,ce=e.elements[xe?ie:G],De=Ce(Rt(ce)?ce:ce.contextElement||Wt(e.elements.popper),g,M,E),oe=mr(e.elements.reference),Ne=oa({reference:oe,element:ve,strategy:"absolute",placement:d}),ge=Z(Object.assign({},ve,Ne)),Ve=G===Fr?ge:oe,Ke={top:De.top-Ve.top+he.top,bottom:Ve.bottom-De.bottom+he.bottom,left:De.left-Ve.left+he.left,right:Ve.right-De.right+he.right},at=e.modifiersData.offset;if(G===Fr&&at){var St=at[d];Object.keys(Ke).forEach(function(mt){var Ut=[vt,xt].indexOf(mt)>=0?1:-1,rt=[ht,xt].indexOf(mt)>=0?"y":"x";Ke[mt]+=St[rt]*Ut})}return Ke}function Ye(e,t){t===void 0&&(t={});var s=t,c=s.placement,d=s.boundary,f=s.rootBoundary,E=s.padding,h=s.flipVariations,g=s.allowedAutoPlacements,x=g===void 0?Ra:g,M=br(c),F=M?h?Cr:Cr.filter(function(xe){return br(xe)===M}):Kt,G=F.filter(function(xe){return x.indexOf(xe)>=0});G.length===0&&(G=F);var j=G.reduce(function(xe,J){return xe[J]=et(e,{placement:J,boundary:d,rootBoundary:f,padding:E})[Lt(J)],xe},{});return Object.keys(j).sort(function(xe,J){return j[xe]-j[J]})}function ct(e){if(Lt(e)===hr)return[];var t=u(e);return[y(e),t,y(t)]}function At(e){var t=e.state,s=e.options,c=e.name;if(!t.modifiersData[c]._skip){for(var d=s.mainAxis,f=d===void 0?!0:d,E=s.altAxis,h=E===void 0?!0:E,g=s.fallbackPlacements,x=s.padding,M=s.boundary,F=s.rootBoundary,G=s.altBoundary,j=s.flipVariations,xe=j===void 0?!0:j,J=s.allowedAutoPlacements,le=t.options.placement,he=Lt(le),ie=he===le,ve=g||(ie||!xe?[u(le)]:ct(le)),ce=[le].concat(ve).reduce(function(ga,Xr){return ga.concat(Lt(Xr)===hr?Ye(t,{placement:Xr,boundary:M,rootBoundary:F,padding:x,flipVariations:xe,allowedAutoPlacements:J}):Xr)},[]),De=t.rects.reference,oe=t.rects.popper,Ne=new Map,ge=!0,Ve=ce[0],Ke=0;Ke<ce.length;Ke++){var at=ce[Ke],St=Lt(at),mt=br(at)===vr,Ut=[ht,xt].indexOf(St)>=0,rt=Ut?"width":"height",_e=et(t,{placement:at,boundary:M,rootBoundary:F,altBoundary:G,padding:x}),st=Ut?mt?vt:nt:mt?xt:ht;De[rt]>oe[rt]&&(st=u(st));var Yt=u(st),cr=[];if(f&&cr.push(_e[St]<=0),h&&cr.push(_e[st]<=0,_e[Yt]<=0),cr.every(function(ga){return ga})){Ve=at,ge=!1;break}Ne.set(at,cr)}if(ge)for(var Gr=xe?3:1,ma=function(Xr){var Ua=ce.find(function(mn){var Yr=Ne.get(mn);if(Yr)return Yr.slice(0,Xr).every(function(Tn){return Tn})});if(Ua)return Ve=Ua,"break"},Sr=Gr;Sr>0;Sr--){var pn=ma(Sr);if(pn==="break")break}t.placement!==Ve&&(t.modifiersData[c]._skip=!0,t.placement=Ve,t.reset=!0)}}const Dt={name:"flip",enabled:!0,phase:"main",fn:At,requiresIfExists:["offset"],data:{_skip:!1}};function Nr(e){return e==="x"?"y":"x"}function kt(e,t,s){return It(e,nr(t,s))}function xr(e,t,s){var c=kt(e,t,s);return c>s?s:c}function V(e){var t=e.state,s=e.options,c=e.name,d=s.mainAxis,f=d===void 0?!0:d,E=s.altAxis,h=E===void 0?!1:E,g=s.boundary,x=s.rootBoundary,M=s.altBoundary,F=s.padding,G=s.tether,j=G===void 0?!0:G,xe=s.tetherOffset,J=xe===void 0?0:xe,le=et(t,{boundary:g,rootBoundary:x,padding:F,altBoundary:M}),he=Lt(t.placement),ie=br(t.placement),ve=!ie,ce=Er(he),De=Nr(ce),oe=t.modifiersData.popperOffsets,Ne=t.rects.reference,ge=t.rects.popper,Ve=typeof J=="function"?J(Object.assign({},t.rects,{placement:t.placement})):J,Ke=typeof Ve=="number"?{mainAxis:Ve,altAxis:Ve}:Object.assign({mainAxis:0,altAxis:0},Ve),at=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,St={x:0,y:0};if(oe){if(f){var mt,Ut=ce==="y"?ht:nt,rt=ce==="y"?xt:vt,_e=ce==="y"?"height":"width",st=oe[ce],Yt=st+le[Ut],cr=st-le[rt],Gr=j?-ge[_e]/2:0,ma=ie===vr?Ne[_e]:ge[_e],Sr=ie===vr?-ge[_e]:-Ne[_e],pn=t.elements.arrow,ga=j&&pn?zt(pn):{width:0,height:0},Xr=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:ze(),Ua=Xr[Ut],mn=Xr[rt],Yr=kt(0,Ne[_e],ga[_e]),Tn=ve?Ne[_e]/2-Gr-Yr-Ua-Ke.mainAxis:ma-Yr-Ua-Ke.mainAxis,Fo=ve?-Ne[_e]/2+Gr+Yr+mn+Ke.mainAxis:Sr+Yr+mn+Ke.mainAxis,Qn=t.elements.arrow&&gr(t.elements.arrow),Co=Qn?ce==="y"?Qn.clientTop||0:Qn.clientLeft||0:0,cs=(mt=at?.[ce])!=null?mt:0,Ao=st+Tn-cs-Co,Do=st+Fo-cs,us=kt(j?nr(Yt,Ao):Yt,st,j?It(cr,Do):cr);oe[ce]=us,St[ce]=us-st}if(h){var ds,Mo=ce==="x"?ht:nt,No=ce==="x"?xt:vt,Jr=oe[De],gn=De==="y"?"height":"width",fs=Jr+le[Mo],ps=Jr-le[No],Rn=[ht,nt].indexOf(he)!==-1,ms=(ds=at?.[De])!=null?ds:0,gs=Rn?fs:Jr-Ne[gn]-ge[gn]-ms+Ke.altAxis,hs=Rn?Jr+Ne[gn]+ge[gn]-ms-Ke.altAxis:ps,vs=j&&Rn?xr(gs,Jr,hs):kt(j?gs:fs,Jr,j?hs:ps);oe[De]=vs,St[De]=vs-Jr}t.modifiersData[c]=St}}const H={name:"preventOverflow",enabled:!0,phase:"main",fn:V,requiresIfExists:["offset"]};var ne=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,we(typeof t!="number"?t:Ze(t,Kt))};function re(e){var t,s=e.state,c=e.name,d=e.options,f=s.elements.arrow,E=s.modifiersData.popperOffsets,h=Lt(s.placement),g=Er(h),x=[nt,vt].indexOf(h)>=0,M=x?"height":"width";if(!(!f||!E)){var F=ne(d.padding,s),G=zt(f),j=g==="y"?ht:nt,xe=g==="y"?xt:vt,J=s.rects.reference[M]+s.rects.reference[g]-E[g]-s.rects.popper[M],le=E[g]-s.rects.reference[g],he=gr(f),ie=he?g==="y"?he.clientHeight||0:he.clientWidth||0:0,ve=J/2-le/2,ce=F[j],De=ie-G[M]-F[xe],oe=ie/2-G[M]/2+ve,Ne=kt(ce,oe,De),ge=g;s.modifiersData[c]=(t={},t[ge]=Ne,t.centerOffset=Ne-oe,t)}}function _(e){var t=e.state,s=e.options,c=s.element,d=c===void 0?"[data-popper-arrow]":c;d!=null&&(typeof d=="string"&&(d=t.elements.popper.querySelector(d),!d)||Y(t.elements.popper,d)&&(t.elements.arrow=d))}const Se={name:"arrow",enabled:!0,phase:"main",fn:re,effect:_,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Me(e,t,s){return s===void 0&&(s={x:0,y:0}),{top:e.top-t.height-s.y,right:e.right-t.width+s.x,bottom:e.bottom-t.height+s.y,left:e.left-t.width-s.x}}function Be(e){return[ht,vt,xt,nt].some(function(t){return e[t]>=0})}function tt(e){var t=e.state,s=e.name,c=t.rects.reference,d=t.rects.popper,f=t.modifiersData.preventOverflow,E=et(t,{elementContext:"reference"}),h=et(t,{altBoundary:!0}),g=Me(E,c),x=Me(h,d,f),M=Be(g),F=Be(x);t.modifiersData[s]={referenceClippingOffsets:g,popperEscapeOffsets:x,isReferenceHidden:M,hasPopperEscaped:F},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":M,"data-popper-escaped":F})}var ut=[Ma,Na,ua,m,i,Dt,H,Se,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:tt}],lr=an({defaultModifiers:ut}),Lr=l(30115),fa=l.n(Lr),sn=function(t){return Array.isArray(t)?t[0]:t},hn=function(t){if(typeof t=="function"){for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];return t.apply(void 0,c)}},Io=function(t,s){if(typeof t=="function")return hn(t,s);t!=null&&(t.current=s)},wn=function(t){return t.reduce(function(s,c){var d=c[0],f=c[1];return s[d]=f,s},{})},Fn=typeof window<"u"&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,Os=[],ys=function(t,s,c){c===void 0&&(c={});var d=r.useRef(null),f={onFirstUpdate:c.onFirstUpdate,placement:c.placement||"bottom",strategy:c.strategy||"absolute",modifiers:c.modifiers||Os},E=r.useState({styles:{popper:{position:f.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),h=E[0],g=E[1],x=r.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(j){var xe=j.state,J=Object.keys(xe.elements);ar.flushSync(function(){g({styles:wn(J.map(function(le){return[le,xe.styles[le]||{}]})),attributes:wn(J.map(function(le){return[le,xe.attributes[le]]}))})})},requires:["computeStyles"]}},[]),M=r.useMemo(function(){var G={onFirstUpdate:f.onFirstUpdate,placement:f.placement,strategy:f.strategy,modifiers:[].concat(f.modifiers,[x,{name:"applyStyles",enabled:!1}])};return fa()(d.current,G)?d.current||G:(d.current=G,G)},[f.onFirstUpdate,f.placement,f.strategy,f.modifiers,x]),F=r.useRef();return Fn(function(){F.current&&F.current.setOptions(M)},[M]),Fn(function(){if(!(t==null||s==null)){var G=c.createPopper||lr,j=G(t,s,M);return F.current=j,function(){j.destroy(),F.current=null}}},[t,s,c.createPopper]),{state:F.current?F.current.state:null,styles:h.styles,attributes:h.attributes,update:F.current?F.current.update:null,forceUpdate:F.current?F.current.forceUpdate:null}};function Cn(e){var t=r.useRef(e);return t.current=e,r.useCallback(function(){return t.current},[])}var bs=function(){};function Es(e){var t=e.initial,s=e.value,c=e.onChange,d=c===void 0?bs:c;if(t===void 0&&s===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var f=r.useState(t),E=f[0],h=f[1],g=Cn(E),x=r.useCallback(function(F){var G=g(),j=typeof F=="function"?F(G):F;typeof j.persist=="function"&&j.persist(),h(j),typeof d=="function"&&d(j)},[g,d]),M=s!==void 0;return[M?s:E,M?d:x]}function An(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),function(){return{width:0,height:0,top:t,right:e,bottom:t,left:e,x:0,y:0,toJSON:function(){return null}}}}var Ps=["styles","attributes"],Dn={getBoundingClientRect:An()},Mn={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function xs(e,t){var s,c,d;e===void 0&&(e={}),t===void 0&&(t={});var f=Object.keys(Mn).reduce(function(rt,_e){var st;return(0,Qt.A)({},rt,(st={},st[_e]=rt[_e]!==void 0?rt[_e]:Mn[_e],st))},e),E=r.useMemo(function(){return[{name:"offset",options:{offset:f.offset}}]},Array.isArray(f.offset)?f.offset:[]),h=(0,Qt.A)({},t,{placement:t.placement||f.placement,modifiers:t.modifiers||E}),g=r.useState(null),x=g[0],M=g[1],F=r.useState(null),G=F[0],j=F[1],xe=Es({initial:f.defaultVisible,value:f.visible,onChange:f.onVisibleChange}),J=xe[0],le=xe[1],he=r.useRef();r.useEffect(function(){return function(){return clearTimeout(he.current)}},[]);var ie=ys(f.followCursor?Dn:x,G,h),ve=ie.styles,ce=ie.attributes,De=(0,La.A)(ie,Ps),oe=De.update,Ne=Cn({visible:J,triggerRef:x,tooltipRef:G,finalConfig:f}),ge=r.useCallback(function(rt){return Array.isArray(f.trigger)?f.trigger.includes(rt):f.trigger===rt},Array.isArray(f.trigger)?f.trigger:[f.trigger]),Ve=r.useCallback(function(){clearTimeout(he.current),he.current=window.setTimeout(function(){return le(!1)},f.delayHide)},[f.delayHide,le]),Ke=r.useCallback(function(){clearTimeout(he.current),he.current=window.setTimeout(function(){return le(!0)},f.delayShow)},[f.delayShow,le]),at=r.useCallback(function(){Ne().visible?Ve():Ke()},[Ne,Ve,Ke]);r.useEffect(function(){if(Ne().finalConfig.closeOnOutsideClick){var rt=function(st){var Yt,cr=Ne(),Gr=cr.tooltipRef,ma=cr.triggerRef,Sr=(st.composedPath==null||(Yt=st.composedPath())==null?void 0:Yt[0])||st.target;Sr instanceof Node&&Gr!=null&&ma!=null&&!Gr.contains(Sr)&&!ma.contains(Sr)&&Ve()};return document.addEventListener("mousedown",rt),function(){return document.removeEventListener("mousedown",rt)}}},[Ne,Ve]),r.useEffect(function(){if(!(x==null||!ge("click")))return x.addEventListener("click",at),function(){return x.removeEventListener("click",at)}},[x,ge,at]),r.useEffect(function(){if(!(x==null||!ge("double-click")))return x.addEventListener("dblclick",at),function(){return x.removeEventListener("dblclick",at)}},[x,ge,at]),r.useEffect(function(){if(!(x==null||!ge("right-click"))){var rt=function(st){st.preventDefault(),at()};return x.addEventListener("contextmenu",rt),function(){return x.removeEventListener("contextmenu",rt)}}},[x,ge,at]),r.useEffect(function(){if(!(x==null||!ge("focus")))return x.addEventListener("focus",Ke),x.addEventListener("blur",Ve),function(){x.removeEventListener("focus",Ke),x.removeEventListener("blur",Ve)}},[x,ge,Ke,Ve]),r.useEffect(function(){if(!(x==null||!ge("hover")))return x.addEventListener("mouseenter",Ke),x.addEventListener("mouseleave",Ve),function(){x.removeEventListener("mouseenter",Ke),x.removeEventListener("mouseleave",Ve)}},[x,ge,Ke,Ve]),r.useEffect(function(){if(!(G==null||!ge("hover")||!Ne().finalConfig.interactive))return G.addEventListener("mouseenter",Ke),G.addEventListener("mouseleave",Ve),function(){G.removeEventListener("mouseenter",Ke),G.removeEventListener("mouseleave",Ve)}},[G,ge,Ke,Ve,Ne]);var St=De==null||(s=De.state)==null||(c=s.modifiersData)==null||(d=c.hide)==null?void 0:d.isReferenceHidden;r.useEffect(function(){f.closeOnTriggerHidden&&St&&Ve()},[f.closeOnTriggerHidden,Ve,St]),r.useEffect(function(){if(!f.followCursor||x==null)return;function rt(_e){var st=_e.clientX,Yt=_e.clientY;Dn.getBoundingClientRect=An(st,Yt),oe?.()}return x.addEventListener("mousemove",rt),function(){return x.removeEventListener("mousemove",rt)}},[f.followCursor,x,oe]),r.useEffect(function(){if(!(G==null||oe==null||f.mutationObserverOptions==null)){var rt=new MutationObserver(oe);return rt.observe(G,f.mutationObserverOptions),function(){return rt.disconnect()}}},[f.mutationObserverOptions,G,oe]);var mt=function(_e){return _e===void 0&&(_e={}),(0,Qt.A)({},_e,{style:(0,Qt.A)({},_e.style,ve.popper)},ce.popper,{"data-popper-interactive":f.interactive})},Ut=function(_e){return _e===void 0&&(_e={}),(0,Qt.A)({},_e,ce.arrow,{style:(0,Qt.A)({},_e.style,ve.arrow),"data-popper-arrow":!0})};return(0,Qt.A)({getArrowProps:Ut,getTooltipProps:mt,setTooltipRef:j,setTriggerRef:M,tooltipRef:G,triggerRef:x,visible:J},De)}var Ls=l(17464),Ss=Object.defineProperty,$s=Object.defineProperties,Ts=Object.getOwnPropertyDescriptors,Nn=Object.getOwnPropertySymbols,Qs=Object.prototype.hasOwnProperty,Rs=Object.prototype.propertyIsEnumerable,In=(e,t,s)=>t in e?Ss(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ws=(e,t)=>{for(var s in t||(t={}))Qs.call(t,s)&&In(e,s,t[s]);if(Nn)for(var s of Nn(t))Rs.call(t,s)&&In(e,s,t[s]);return e},Fs=(e,t)=>$s(e,Ts(t));const Xn=r.memo(({definition:e,operation:t,innerQueryPlaceholder:s})=>{const c=(0,te.of)(Cs),[d,f]=(0,r.useState)(!1),{getTooltipProps:E,setTooltipRef:h,setTriggerRef:g,visible:x}=xs({placement:"top",visible:d,offset:[0,16],onVisibleChange:f,interactive:!0,trigger:["click"]});return r.createElement(r.Fragment,null,r.createElement(U.$n,{title:"Click to show description",ref:g,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),x&&r.createElement(Ls.ZL,null,r.createElement("div",Fs(ws({ref:h},E()),{className:c.docBox}),r.createElement("div",{className:c.docBoxHeader},r.createElement("span",null,e.renderer(t,e,s)),r.createElement(C.Z,{grow:1}),r.createElement(U.$n,{icon:"times",onClick:()=>f(!1),fill:"text",variant:"secondary",title:"Remove operation"})),r.createElement("div",{className:c.docBoxBody,dangerouslySetInnerHTML:{__html:As(e,t)}}))))});Xn.displayName="OperationDocs";const Cs=e=>({docBox:(0,$.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,$.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,$.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,$.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,$.css)({opacity:0,color:e.colors.text.secondary})});function As(e,t){var s;return(0,_t.G)(e.explainHandler?e.explainHandler(t,e):(s=e.documentation)!=null?s:"no docs")}var Ds=Object.defineProperty,Ms=Object.defineProperties,Ns=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertySymbols,Is=Object.prototype.hasOwnProperty,Xs=Object.prototype.propertyIsEnumerable,Bn=(e,t,s)=>t in e?Ds(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,vn=(e,t)=>{for(var s in t||(t={}))Is.call(t,s)&&Bn(e,s,t[s]);if(Un)for(var s of Un(t))Xs.call(t,s)&&Bn(e,s,t[s]);return e},_n=(e,t)=>Ms(e,Ns(t));const Wn=r.memo(({operation:e,definition:t,index:s,onChange:c,onRemove:d,queryModeller:f,dragHandleProps:E})=>{var h;const g=(0,te.of)(Us),[x,M]=(0,r.useState)({}),F=()=>{if(x.isOpen)M(_n(vn({},x),{isOpen:!1}));else{const G=f.getAlternativeOperations(t.alternativesKey).map(j=>({label:j.name,value:j}));M({isOpen:!0,alternatives:G})}};return r.createElement("div",{className:g.header},!x.isOpen&&r.createElement(r.Fragment,null,r.createElement("div",vn({},E),(h=t.name)!=null?h:t.id),r.createElement(C.Z,{grow:1}),r.createElement("div",{className:`${g.operationHeaderButtons} operation-header-show-on-hover`},r.createElement(U.$n,{icon:"angle-down",size:"sm",onClick:F,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),r.createElement(Xn,{definition:t,operation:e,innerQueryPlaceholder:f.innerQueryPlaceholder}),r.createElement(U.$n,{icon:"times",size:"sm",onClick:()=>d(s),fill:"text",variant:"secondary",title:"Remove operation"}))),x.isOpen&&r.createElement("div",{className:g.selectWrapper},r.createElement(Bt.l6,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:x.alternatives,isOpen:!0,onCloseMenu:F,onChange:G=>{if(G.value){const j=f.getOperationDefinition(G.value.id),xe=[...j.defaultParams];for(let le=0;le<Math.min(e.params.length,xe.length);le++)j.params[le].type===t.params[le].type&&(xe[le]=e.params[le]);const J=_n(vn({},e),{params:xe,id:G.value.id});c(s,t.changeTypeHandler?t.changeTypeHandler(J,j):J)}}})))});Wn.displayName="OperationHeader";const Us=e=>({header:(0,$.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,$.css)({opacity:1}),selectWrapper:(0,$.css)({paddingRight:e.spacing(2)})});var pa=l(51440),Bs=l(10880);function _s(e){if(e.editor)return e.editor;if(e.options)return Vs;switch(e.type){case"boolean":return ks;case"number":case"string":default:return Ws}}function Ws(e){var t;return r.createElement(pa.D,{id:on(e.operationId,e.index),defaultValue:(t=e.value)==null?void 0:t.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:s=>{e.onChange(e.index,s.currentTarget.value),e.paramDef.runQueryOnEnter&&s.type==="keydown"&&e.onRunQuery()}})}function ks(e){return r.createElement(Bs.S,{id:on(e.operationId,e.index),value:!!e.value,onChange:t=>e.onChange(e.index,t.currentTarget.checked)})}function Vs({paramDef:e,value:t,index:s,operationId:c,onChange:d}){var f,E;const h=(0,te.of)(js);let g=e.options;(f=g[0])!=null&&f.label||(g=e.options.map(M=>({label:M.toString(),value:M})));let x=(E=g.find(M=>M.value===t))!=null?E:(0,qt.z)(t);return!t&&e.optional?r.createElement("div",{className:h.optionalParam},r.createElement(U.$n,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>d(s,g[0].value)},e.name)):r.createElement(Fe.B,{gap:.5,direction:"row",alignItems:"center"},r.createElement(Bt.l6,{id:on(c,s),value:x,options:g,placeholder:e.placeholder,allowCustomValue:!0,onChange:M=>d(s,M.value),width:e.minWidth||"auto"}),e.optional&&r.createElement(U.$n,{"data-testid":`operations.${s}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>d(s,"")}))}const js=e=>({optionalParam:(0,$.css)({marginTop:e.spacing(1)})});function on(e,t){return`operations.${e}.param.${t}`}var zs=Object.defineProperty,Ks=Object.defineProperties,Hs=Object.getOwnPropertyDescriptors,kn=Object.getOwnPropertySymbols,Gs=Object.prototype.hasOwnProperty,Ys=Object.prototype.propertyIsEnumerable,Vn=(e,t,s)=>t in e?zs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ln=(e,t)=>{for(var s in t||(t={}))Gs.call(t,s)&&Vn(e,s,t[s]);if(kn)for(var s of kn(t))Ys.call(t,s)&&Vn(e,s,t[s]);return e},cn=(e,t)=>Ks(e,Hs(t));function Js({provided:e,flash:t,isConflicting:s,highlight:c,index:d,queryModeller:f,onChange:E,onRemove:h,operation:g,definition:x,query:M,timeRange:F,onRunQuery:G,datasource:j}){const xe=(0,te.$j)(),J=Zs(xe,s),le=qs(t),{current:he}=(0,r.useRef)((0,ya.A)()),ie=(oe,Ne)=>{const ge=cn(ln({},g),{params:[...g.params]});ge.params[oe]=Ne,On(x,ge,d,oe,E)},ve=()=>{const oe=cn(ln({},g),{params:[...g.params,""]});On(x,oe,d,g.params.length,E)},ce=oe=>{const Ne=cn(ln({},g),{params:[...g.params.slice(0,oe),...g.params.slice(oe+1)]});On(x,Ne,d,oe,E)};let De;if(x.params.length>0){const oe=x.params[x.params.length-1];oe.restParam&&(De=ei(oe,ve,d,g.params.length,J))}return r.createElement("div",cn(ln({className:(0,$.cx)(J.card,(le||c)&&J.cardHighlight,s&&J.cardError),ref:e.innerRef},e.draggableProps),{"data-testid":`operations.${d}.wrapper`}),r.createElement(Wn,{operation:g,dragHandleProps:e.dragHandleProps,definition:x,index:d,onChange:E,onRemove:h,queryModeller:f}),r.createElement("div",{className:J.body},g.params.map((oe,Ne)=>{const ge=x.params[Math.min(x.params.length-1,Ne)],Ve=_s(ge);return r.createElement("div",{className:J.paramRow,key:`${Ne}-1`},!ge.hideName&&r.createElement("div",{className:J.paramName},r.createElement("label",{htmlFor:on(he,Ne)},ge.name),ge.description&&r.createElement(Ge.m,{placement:"top",content:ge.description,theme:"info"},r.createElement(Vr.I,{name:"info-circle",size:"sm",className:J.infoIcon}))),r.createElement("div",{className:J.paramValue},r.createElement(Fe.B,{gap:.5,direction:"row",alignItems:"center",wrap:!1},r.createElement(Ve,{index:Ne,paramDef:ge,value:g.params[Ne],operation:g,operationId:he,onChange:ie,onRunQuery:G,query:M,datasource:j,timeRange:F,queryModeller:f}),ge.restParam&&(g.params.length>x.params.length||ge.optional)&&r.createElement(U.$n,{"data-testid":`operations.${d}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${ge.name}`,onClick:()=>ce(Ne)}))))})),De,d<M.operations.length-1&&r.createElement("div",{className:J.arrow},r.createElement("div",{className:J.arrowLine}),r.createElement("div",{className:J.arrowArrow})))}const Zs=(e,t)=>({cardWrapper:(0,$.css)({alignItems:"stretch"}),error:(0,$.css)({marginBottom:e.spacing(1)}),card:(0,$.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:t?"auto":"100%"}),cardError:(0,$.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,$.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,$.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,$.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,$.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,$.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,$.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,$.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,$.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,$.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,$.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function qs(e){const[t,s]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let c;return e?c=setTimeout(()=>{s(!1)},1e3):s(!0),()=>clearTimeout(c)},[e]),t&&e}function On(e,t,s,c,d){e.paramChangedHandler?d(s,e.paramChangedHandler(c,t,e)):d(s,t)}function ei(e,t,s,c,d){return r.createElement("div",{className:d.restParam,key:`${c}-2`},r.createElement(U.$n,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:t,"data-testid":`operations.${s}.add-rest-param`},e.name))}function ti({operation:e,index:t,onRemove:s,onChange:c,onRunQuery:d,queryModeller:f,query:E,datasource:h,flash:g,highlight:x,timeRange:M,isConflictingOperation:F}){const G=f.getOperationDefinition(e.id),j=(0,te.$j)(),xe=F?F(e,E.operations):!1,J=ri(j);if(!G)return r.createElement("span",null,"Operation ",e.id," not found");const le=he=>{if(!he)return xe?!0:void 0};return r.createElement(kr.sx,{draggableId:`operation-${t}`,index:t},(he,ie)=>r.createElement(er.I,{error:"You have conflicting label filters",invalid:le(ie.isDragging),className:(0,$.cx)(J.error,J.cardWrapper)},r.createElement(Js,{provided:he,flash:g,highlight:x,isConflicting:xe,index:t,operation:e,definition:G,onChange:c,onRemove:s,queryModeller:f,query:E,timeRange:M,onRunQuery:d,datasource:h})))}const ri=(e,t)=>({cardWrapper:(0,$.css)({alignItems:"stretch"}),error:(0,$.css)({marginBottom:e.spacing(1)})});var ai=Object.defineProperty,ni=Object.defineProperties,si=Object.getOwnPropertyDescriptors,jn=Object.getOwnPropertySymbols,ii=Object.prototype.hasOwnProperty,oi=Object.prototype.propertyIsEnumerable,zn=(e,t,s)=>t in e?ai(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,un=(e,t)=>{for(var s in t||(t={}))ii.call(t,s)&&zn(e,s,t[s]);if(jn)for(var s of jn(t))oi.call(t,s)&&zn(e,s,t[s]);return e},yn=(e,t)=>ni(e,si(t));function li({query:e,datasource:t,queryModeller:s,onChange:c,onRunQuery:d,highlightedOp:f,timeRange:E,isConflictingOperation:h}){const g=(0,te.of)(di),{operations:x}=e,M=ci(x),[F,G]=(0,r.useState)(!1),j=(ve,ce)=>{const De=[...x];De.splice(ve,1,ce),c(yn(un({},e),{operations:De}))},xe=ve=>{const ce=[...x.slice(0,ve),...x.slice(ve+1)];c(yn(un({},e),{operations:ce}))},J=s.getCategories().map(ve=>({value:ve,label:ve,items:s.getOperationsForCategory(ve).map(ce=>({value:ce.id,label:ce.name,isLeaf:!0}))})),le=ve=>{const ce=s.getOperationDefinition(ve);ce&&(c(ce.addOperationHandler(ce,e,s)),G(!1))},he=ve=>{if(!ve.destination)return;const ce=[...x],De=ce[ve.source.index];ce.splice(ve.source.index,1),ce.splice(ve.destination.index,0,De),c(yn(un({},e),{operations:ce}))},ie=()=>{G(!1)};return r.createElement(Fe.B,{gap:1,direction:"column"},r.createElement(Fe.B,{gap:1},x.length>0&&r.createElement(kr.JY,{onDragEnd:he},r.createElement(kr.gL,{droppableId:"sortable-field-mappings",direction:"horizontal"},ve=>r.createElement("div",un({className:g.operationList,ref:ve.innerRef},ve.droppableProps),x.map((ce,De)=>r.createElement(ti,{key:ce.id+JSON.stringify(ce.params)+De,queryModeller:s,index:De,operation:ce,query:e,datasource:t,onChange:j,onRemove:xe,onRunQuery:d,flash:M[De],highlight:f===ce,timeRange:E,isConflictingOperation:h})),ve.placeholder))),r.createElement("div",{className:g.addButton},F?r.createElement(Ka.v,{options:J,onSelect:le,onBlur:ie,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):r.createElement(U.$n,{icon:"plus",variant:"secondary",onClick:()=>G(!0),title:"Add operation"},"Operations"))))}function ci(e){const t=(0,aa.A)(),s=(0,S.A)(e);if(!t())return e.map(()=>!1);if(!s)return e.map(()=>!0);let c=[];if(s.length-1===e.length&&e.every(d=>s.includes(d)))return e.map(()=>!1);if(s.length+1===e.length&&s.every(d=>e.includes(d))){const d=e.find(f=>!s.includes(f));c=e.map(f=>f===d)}else c=e.map((d,f)=>{var E;return!ui(d.id,(E=s[f])==null?void 0:E.id)});return c}function ui(e,t){return e===t||`__${e}_by`===t||e===`__${t}_by`}const di=e=>({heading:(0,$.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,$.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,$.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})}),Kn=({datasource:e,query:t,onChange:s,data:c,queryModeller:d,buildVisualQueryFromString:f,buildDataQueryFromQueryString:E,buildQueryStringFromDataQuery:h})=>{const[g,x]=(0,r.useState)([]),M=(0,te.of)(fi);return(0,r.useEffect)(()=>{var F;const G=E(d.renderQuery(t)),j=(F=e.getQueryHints)==null?void 0:F.call(e,G,c?.series||[]).filter(xe=>{var J;return(J=xe.fix)==null?void 0:J.action});x(j??[])},[e,t,c,d,E]),r.createElement(r.Fragment,null,g.length>0&&r.createElement("div",{className:M.container},g.map(F=>{var G,j,xe,J;return r.createElement(Ge.m,{content:`${F.label} ${(G=F.fix)==null?void 0:G.label}`,key:F.type},r.createElement(U.$n,{onClick:()=>{var le,he,ie;if((0,de.rR)("grafana_query_builder_hints_clicked",{hint:F.type,datasourceType:e.type}),(le=F?.fix)!=null&&le.action){const ve=E(d.renderQuery(t)),ce=(he=e.modifyQuery)==null?void 0:he.call(e,ve,F.fix.action);if(ce){const De=f((ie=h(ce))!=null?ie:"");return s(De.query)}}},fill:"outline",size:"sm",className:M.hint},"hint: ",((j=F.fix)==null?void 0:j.title)||((J=(xe=F.fix)==null?void 0:xe.action)==null?void 0:J.type.toLowerCase().replace("_"," "))))})))};Kn.displayName="QueryBuilderHints";const fi=e=>({container:(0,$.css)`
      display: flex;
      align-items: start;
    `,hint:(0,$.css)`
      margin-right: ${e.spacing(1)};
    `});function Hn({query:e,queryModeller:t,stepNumber:s,language:c,onMouseEnter:d,onMouseLeave:f}){return r.createElement(r.Fragment,null,e.operations.map((E,h)=>{var g;const x=t.getOperationDefinition(E.id);if(!x)return`Operation ${E.id} not found`;const M=x.renderer(E,x,t.innerQueryPlaceholder),F=x.explainHandler?x.explainHandler(E,x):(g=x.documentation)!=null?g:"no docs";return r.createElement("div",{key:h,onMouseEnter:()=>d?.(E,h),onMouseLeave:()=>f?.(E,h)},r.createElement(jt,{stepNumber:h+s,title:r.createElement(fr.Z,{query:M,language:c}),markdown:F}))}))}var dn=l(71713),pi=l(11216),Hr=l(54623);const Gn="Fetch all log lines matching label filters.",Yn=r.memo(({query:e})=>{const t=(0,Zt.u_)(e||"").query,s={grammar:dn.vB,name:"lokiql"};return r.createElement(I.B,{gap:0,direction:"column"},r.createElement(jt,{stepNumber:1,title:r.createElement(fr.Z,{query:`${Ot.y.renderLabels(t.labels)}`,language:s})},Gn),r.createElement(Hn,{stepNumber:2,queryModeller:Ot.y,query:t,language:s}))});Yn.displayName="LokiQueryBuilderExplained";var mi=l(29158),gi=l(58592);const Jn=r.memo(({nestedQuery:e,index:t,datasource:s,onChange:c,onRemove:d,onRunQuery:f,showExplain:E})=>{const h=(0,te.of)(vi);return r.createElement("div",{className:h.card},r.createElement("div",{className:h.header},r.createElement("div",{className:h.name},"Operator"),r.createElement(Bt.l6,{"aria-label":"Select operator",width:"auto",options:hi,value:(0,qt.z)(e.operator),onChange:g=>{c(t,{...e,operator:g.value})}}),r.createElement("div",{className:h.name},"Vector matches"),r.createElement("div",{className:h.vectorMatchWrapper},r.createElement(Bt.l6,{width:"auto",value:e.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:g=>{c(t,{...e,vectorMatchesType:g.value})}}),r.createElement(pa.D,{className:h.vectorMatchInput,minWidth:20,defaultValue:e.vectorMatches,onCommitChange:g=>{c(t,{...e,vectorMatches:g.currentTarget.value,vectorMatchesType:e.vectorMatchesType||"on"})}})),r.createElement(C.Z,{grow:1}),r.createElement(mi.K,{name:"times",size:"sm",onClick:()=>d(t),tooltip:"Remove nested query"})),r.createElement("div",{className:h.body},r.createElement(O.D,null,r.createElement(bn,{showExplain:E,query:e.query,datasource:s,onRunQuery:f,onChange:g=>{c(t,{...e,query:g})}}))))}),hi=gi.C.map(e=>({label:e.sign,value:e.sign}));Jn.displayName="NestedQuery";const vi=e=>({card:(0,$.css)({label:"card",display:"flex",flexDirection:"column",gap:e.spacing(.5)}),header:(0,$.css)({label:"header",padding:e.spacing(.5,.5,.5,1),gap:e.spacing(1),display:"flex",alignItems:"center"}),name:(0,$.css)({label:"name",whiteSpace:"nowrap"}),body:(0,$.css)({label:"body",paddingLeft:e.spacing(2)}),vectorMatchInput:(0,$.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,$.css)({label:"vectorMatchWrapper",display:"flex"})});function Oi({query:e,datasource:t,onChange:s,onRunQuery:c,showExplain:d}){const f=e.binaryQueries??[],E=(g,x)=>{const M=[...f];M.splice(g,1,x),s({...e,binaryQueries:M})},h=g=>{const x=[...f.slice(0,g),...f.slice(g+1)];s({...e,binaryQueries:x})};return r.createElement(I.B,{direction:"column",gap:1},f.map((g,x)=>r.createElement(Jn,{key:x.toString(),nestedQuery:g,index:x,onChange:E,datasource:t,onRemove:h,onRunQuery:c,showExplain:d})))}const Zn=5*60*1e3,bn=r.memo(({datasource:e,query:t,onChange:s,onRunQuery:c,showExplain:d,timeRange:f})=>{const[E,h]=(0,r.useState)(),[g,x]=(0,r.useState)(void 0),M=(0,S.A)(t),F=(0,S.A)(f),G=ie=>{s({...t,labels:ie})},j=async ie=>{const ve=await ie;return[...e.getVariables(),...ve].map(ce=>({label:ce,value:ce}))},xe=async ie=>{const ve=t.labels.filter(ge=>ge!==ie),ce=ve.find(ge=>ge.op==="="||ge.op==="=~"&&new RegExp(ge.value).test("")===!1);if(ve.length===0||!ce)return await e.languageProvider.fetchLabels({timeRange:f});const De=Ot.y.renderLabels(ve),oe=await e.languageProvider.fetchLabels({streamSelector:De,timeRange:f}),Ne=ve.map(ge=>ge.label);return oe.filter(ge=>!Ne.includes(ge)).sort()},J=async ie=>{if(!ie.label)return[];let ve;const ce=t.labels.filter(oe=>oe!==ie),De=ce.find(oe=>oe.op==="="||oe.op==="=~"&&new RegExp(oe.value).test("")===!1);if(ce.length===0||!De)ve=await e.languageProvider.fetchLabelValues(ie.label,{timeRange:f});else{const oe=Ot.y.renderLabels(ce);ve=await e.languageProvider.fetchLabelValues(ie.label,{streamSelector:oe,timeRange:f})}return ve?ve.map(oe=>(0,b.Bb)(oe,ie.op)):[]},le=(0,r.useMemo)(()=>{const{labels:ie,operations:ve}=t;return!ie.length&&ve.length?!(ve.length===1&&ve[0].id===Hr.EF.LineContains&&ve[0].params[0]===""):!1},[t]);(0,r.useEffect)(()=>{const ie=async()=>{const De={expr:Ot.y.renderQuery(t),refId:"data-samples"},oe=f??(0,qr.E2)(),ge={series:await e.getDataSamples(De,oe),state:ke.Gu.Done,timeRange:oe};h(ge)},ve=F&&f&&(Math.abs(f.to.valueOf()-F.to.valueOf())>Zn||Math.abs(f.from.valueOf()-F.from.valueOf())>Zn),ce=!(0,A.isEqual)(M,t);v.$.featureToggles.lokiQueryHints&&(ve||ce)&&ie().catch(console.error)},[e,t,f,M,F]);const he={grammar:dn.Ay,name:"logql"};return r.createElement("div",{"data-testid":Pn.editor},r.createElement(ea.U,null,r.createElement(Qr,{onGetLabelNames:ie=>j(xe(ie)),onGetLabelValues:ie=>j(J(ie)),labelsFilters:t.labels,onChange:G,labelFilterRequired:le})),d&&r.createElement(jt,{stepNumber:1,title:r.createElement(fr.Z,{query:`${Ot.y.renderLabels(t.labels)}`,language:he})},Gn),r.createElement(ra.i,null,r.createElement(li,{queryModeller:Ot.y,query:t,onChange:s,onRunQuery:c,datasource:e,highlightedOp:g,isConflictingOperation:(ie,ve)=>ie.id===Hr.EF.LabelFilter&&(0,pi.hh)(ie,ve)}),r.createElement(Kn,{datasource:e,query:t,onChange:s,data:E,queryModeller:Ot.y,buildVisualQueryFromString:Zt.u_,buildDataQueryFromQueryString:ie=>({expr:ie,refId:"hints"}),buildQueryStringFromDataQuery:ie=>ie.expr})),d&&r.createElement(Hn,{stepNumber:2,queryModeller:Ot.y,query:t,language:he,onMouseEnter:ie=>{x(ie)},onMouseLeave:()=>{x(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&r.createElement(Oi,{query:t,datasource:e,onChange:s,onRunQuery:c,showExplain:d}))});bn.displayName="LokiQueryBuilder";function yi({query:e}){return r.createElement(ea.U,null,r.createElement(ka.B,null,r.createElement(fr.Z,{query:e,language:{grammar:dn.vB,name:"lokiql"}})))}function bi(e){const{query:t,onChange:s,onRunQuery:c,datasource:d,showExplain:f,timeRange:E}=e,[h,g]=(0,r.useReducer)(qn.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,r.useEffect)(()=>{g(xi(t.expr))},[t.expr]);const x=M=>{const F=Ot.y.renderQuery(M);g(Pi({visQuery:M,expr:F})),s({...e.query,expr:F})};return h.visQuery?r.createElement(r.Fragment,null,r.createElement(bn,{query:h.visQuery,datasource:d,onChange:x,onRunQuery:c,showExplain:f,"data-testid":Pn.editor,timeRange:E}),t.expr!==""&&r.createElement(yi,{query:t.expr})):null}const Ei={expr:""},qn=(0,Oa.Z0)({name:"loki-builder-container",initialState:Ei,reducers:{visualQueryChange:(e,t)=>{e.expr=t.payload.expr,e.visQuery=t.payload.visQuery},exprChanged:(e,t)=>{if(!e.visQuery||e.expr!==t.payload){e.expr=t.payload;const s=(0,Zt.u_)(t.payload);e.visQuery=s.query}}}}),{visualQueryChange:Pi,exprChanged:xi}=qn.actions;var es=l(70416),Li=l(42941),Si=l(83195),ts=l(82762);function $i({title:e,children:t,collapsedInfo:s,queryStats:c}){const[d,f]=(0,Li.A)(!1),E=(0,te.of)(Ti);return r.createElement("div",{className:E.wrapper},r.createElement(ts.S,{className:E.collapse,collapsible:!0,isOpen:d,onToggle:f,label:r.createElement(Fe.B,{gap:0},r.createElement("h6",{className:E.title},e),!d&&r.createElement("div",{className:E.description},s.map((h,g)=>r.createElement("span",{key:g},h))))},r.createElement("div",{className:E.body},t)),c&&v.$.featureToggles.lokiQuerySplitting&&r.createElement(Ge.m,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},r.createElement(Vr.I,{tabIndex:0,name:"info-circle",className:E.tooltip,size:"sm"})),c&&r.createElement("p",{className:E.stats},Qi(c)))}const Ti=e=>({collapse:(0,$.css)({backgroundColor:"unset",border:"unset",marginBottom:0,"> button":{padding:e.spacing(0,1)}}),wrapper:(0,$.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,$.css)({flexGrow:1,overflow:"hidden",fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,margin:0}),description:(0,$.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.bodySmall.fontWeight,paddingLeft:e.spacing(2),gap:e.spacing(2),display:"flex"}),body:(0,$.css)({display:"flex",gap:e.spacing(2),flexWrap:"wrap"}),stats:(0,$.css)({margin:"0px",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize}),tooltip:(0,$.css)({marginRight:e.spacing(.25)})}),Qi=e=>e.message?e.message:`This query will process approximately ${Ri(e)}.`,Ri=e=>{const{text:t,suffix:s}=(0,Si.j_)("bytes")(e.bytes,1);return t+s};var wi=l(42418),Xa=l(60016),rs=l(56587);const as=r.memo(({app:e,query:t,onChange:s,onRunQuery:c,maxLines:d,queryStats:f})=>{const[E,h]=(0,r.useState)(!0),g=he=>{s({...t,queryType:he}),c()},x=he=>{(0,de.rR)("grafana_loki_resolution_clicked",{app:e,resolution:he.value}),s({...t,resolution:he.value}),c()},M=he=>{const ie=he.currentTarget.value;if(!(0,es.di)(ie)){h(!1);return}h(!0),s({...t,splitDuration:ie}),c()},F=he=>{s({...t,legendFormat:he.currentTarget.value}),c()};function G(he){const ie=(0,Xa.wU)(he.currentTarget.value);t.maxLines!==ie&&(s({...t,maxLines:ie}),c())}function j(he){s({...t,step:(0,A.trim)(he.currentTarget.value)}),c()}const xe=(0,rs.Io)(t),J=(0,rs.sI)(t.expr),le=(0,r.useMemo)(()=>!!(!t.step||(0,es.V3)(t.step)||!isNaN(Number(t.step))),[t.step]);return r.createElement(ea.U,null,r.createElement($i,{title:"Options",collapsedInfo:Fi(t,xe,d,J,le),queryStats:f},r.createElement(dr.c,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},r.createElement(pa.D,{placeholder:"{{label}}",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:F})),r.createElement(dr.c,{label:"Type"},r.createElement(K.z,{options:Xa.TO,value:xe,onChange:g})),J&&r.createElement(dr.c,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},r.createElement(pa.D,{className:"width-4",placeholder:d.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:G})),!J&&r.createElement(r.Fragment,null,r.createElement(dr.c,{label:"Step",tooltip:"Use the step parameter when making metric queries to Loki. If not filled, Grafana's calculated interval will be used. Example valid values: 1s, 5m, 10h, 1d.",invalid:!le,error:"Invalid step. Example valid values: 1s, 5m, 10h, 1d."},r.createElement(pa.D,{className:"width-6",placeholder:"auto",type:"string",defaultValue:t.step??"",onCommitChange:j})),t.resolution!==void 0&&t.resolution>1&&r.createElement(r.Fragment,null,r.createElement(dr.c,{label:"Resolution",tooltip:"Changes the step parameter of Loki metrics range queries. With a resolution of 1/1, each pixel corresponds to one data point. 1/10 retrieves one data point per 10 pixels. Lower resolutions perform better."},r.createElement(Bt.l6,{isSearchable:!1,onChange:x,options:Xa.iB,value:t.resolution||1,"aria-label":"Select resolution"})),r.createElement(wi.F,{severity:"warning",title:"The 'Resolution' is deprecated. Use 'Step' editor instead to change step parameter."}))),v.$.featureToggles.lokiQuerySplittingConfig&&v.$.featureToggles.lokiQuerySplitting&&r.createElement(dr.c,{label:"Split Duration",tooltip:"Defines the duration of a single query when query splitting is enabled."},r.createElement(pa.D,{minWidth:14,type:"string",min:0,defaultValue:t.splitDuration??"1d",onCommitChange:M,invalid:!E}))))});function Fi(e,t,s,c,d){const f=Xa.TO.find(g=>g.value===t),E=Xa.iB.find(g=>g.value===(e.resolution??1)),h=[];return e.legendFormat&&h.push(`Legend: ${e.legendFormat}`),h.push(`Type: ${f?.label}`),c&&h.push(`Line limit: ${e.maxLines??s}`),c||(e.step&&h.push(`Step: ${d?e.step:"Invalid value"}`),e.resolution&&h.push(`Resolution: ${E?.label}`)),h}as.displayName="LokiQueryBuilderOptions";var ns=l(95881);function Ci({query:e,datasource:t,range:s,onRunQuery:c,onChange:d,data:f,app:E,showExplain:h,history:g}){const x=(0,te.of)(Ai);return r.createElement("div",{className:x.wrapper},r.createElement(ns.W,{datasource:t,query:e,range:s,onRunQuery:c,onChange:d,history:g,data:f,app:E,"data-testid":Pn.editor}),h&&r.createElement(Yn,{query:e.expr}))}const Ai=e=>({wrapper:(0,$.css)`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `,buttonGroup:(0,$.css)`
      border: 1px solid ${e.colors.border.medium};
      border-top: none;
      padding: ${e.spacing(.5,.5,.5,.5)};
      margin-bottom: ${e.spacing(.5)};
      display: flex;
      flex-grow: 1;
      justify-content: end;
      font-size: ${e.typography.bodySmall.fontSize};
    `,hint:(0,$.css)`
      color: ${e.colors.text.disabled};
      white-space: nowrap;
      cursor: help;
    `});var Di=l(77789),Mi=l(83657),En=l(10860);const Ni=e=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:c,hasPreviousQuery:d,selectedPatternName:f,setSelectedPatternName:E}=e,h=(0,te.of)(Ii),g={grammar:dn.Ay,name:"logql"};return r.createElement(En.Z,{className:h.card},r.createElement(En.Z.Heading,null,t.name),r.createElement("div",{className:h.rawQueryContainer},r.createElement(fr.Z,{query:Ot.y.renderQuery({labels:[],operations:t.operations}),language:g,className:h.rawQuery})),r.createElement(En.Z.Actions,null,f!==t.name?r.createElement(U.$n,{size:"sm",onClick:()=>{d?E(t.name):s(t)}},"Use this query"):r.createElement(r.Fragment,null,r.createElement("div",{className:h.spacing},`If you would like to use this query, ${c?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),r.createElement(U.$n,{size:"sm",fill:"outline",onClick:()=>E(null)},"Back"),r.createElement(U.$n,{size:"sm",onClick:()=>{s(t)}},"Apply to query"),c&&r.createElement(U.$n,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},Ii=e=>({card:(0,$.css)`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:(0,$.css)`
      flex-grow: 1;
    `,rawQuery:(0,$.css)`
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1)};
      margin-top: ${e.spacing(1)};
    `,spacing:(0,$.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Xi=[Hr.Ln.Formats,Hr.Ln.LineFilters,Hr.Ln.LabelFilters],Ui=[Hr.EF.Unwrap],Bi=Mi.sp.filter(e=>e.category&&Xi.includes(e.category)&&!Ui.includes(e.id)).map(e=>e.id),_i=e=>{const{isOpen:t,onClose:s,onChange:c,onAddQuery:d,query:f,queries:E,app:h}=e,[g,x]=(0,r.useState)([]),[M,F]=(0,r.useState)(null),G=(0,te.of)(Wi),j=!!d,xe=(0,r.useMemo)(()=>(0,Zt.u_)(f.expr).query.operations.length>0,[f.expr]),J=(le,he=!1)=>{const ie=(0,Zt.u_)(he?"":f.expr);(0,de.rR)("grafana_loki_query_patterns_selected",{version:"v2",app:h??"",editorMode:f.editorMode,selectedPattern:le.name,preSelectedOperationsCount:ie.query.operations.length,preSelectedLabelsCount:ie.query.labels.length,createNewQuery:j&&he}),ie.query.operations=ie.query.operations.filter(ce=>Bi.includes(ce.id));const ve=le.operations.filter(ce=>ie.query.operations.findIndex(De=>De.id===ce.id)<0);ie.query.operations=[...ie.query.operations,...ve],j&&he?d({...f,refId:(0,Di.M)(E??[f]),expr:Ot.y.renderQuery(ie.query)}):c({...f,expr:Ot.y.renderQuery(ie.query)}),F(null),s()};return r.createElement(it.a,{isOpen:t,title:"Kick start your query",onDismiss:s,className:G.modal},r.createElement("div",{className:G.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(Hr.IQ).map(le=>r.createElement(ts.S,{key:le,label:`${(0,A.capitalize)(le)} query starters`,isOpen:g.includes(le),collapsible:!0,onToggle:()=>x(he=>he.includes(le)?he.filter(ie=>ie!==le):[...he,le])},r.createElement("div",{className:G.cardsContainer},Ot.y.getQueryPatterns().filter(he=>he.type===le).map(he=>r.createElement(Ni,{key:he.name,pattern:he,hasNewQueryOption:j,hasPreviousQuery:xe,onPatternSelect:J,selectedPatternName:M,setSelectedPatternName:F}))))),r.createElement(U.$n,{variant:"secondary",onClick:s},"Close"))},Wi=e=>({cardsContainer:(0,$.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:(0,$.css)`
      margin-bottom: ${e.spacing(1)};
    `,modal:(0,$.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
    `});var ki=l(65650);const ss="LokiQueryEditorModeDefault";function Vi(e,t,s){e.expr===""&&window.localStorage.setItem(ss,t),s({...e,editorMode:t})}function ji(e){if(e!=null&&e!=="")return ye.f.Code;switch(window.localStorage.getItem(ss)){case"code":return ye.f.Code;case"builder":default:return ye.f.Builder}}function zi(e){let t=e;return e.editorMode||(t={...e,editorMode:ji(e.expr)}),e.expr==null&&(t={...t,expr:""}),e.queryType==null&&(t={...t,queryType:ki.U3.Range}),t}var Ki=l(47232);function is(e,t){return!e||!t?!1:(0,Ki.Ar)(e)?e.isSame(t):e===t}function Hi(e,t,s,c,d,f){return t===void 0||e.trim()!==t.trim()||d!==f?!0:!(is(s?.raw.from,c?.raw.from)&&is(s?.raw.to,c?.raw.to))}const Pn={editor:"loki-editor"},os="LokiQueryEditorExplainDefault",ls=r.memo(e=>{const t=(0,r.useId)(),{onChange:s,onRunQuery:c,onAddQuery:d,data:f,app:E,queries:h,datasource:g,range:x}=e,[M,F]=(0,r.useState)(!1),[G,j]=(0,r.useState)(!1),[xe,J]=(0,r.useState)(!1),[le,he]=(0,r.useState)(!1),[ie,ve]=(0,r.useState)(null),[ce,De]=(0,r.useState)(window.localStorage.getItem(os)==="true"),oe=g.predefinedOperations,Ne=(0,S.A)(x),ge=zi(e.query);v.$.featureToggles.lokiPredefinedOperations&&!ge.expr&&oe&&(ge.expr=`{} ${oe}`);const Ve=(0,S.A)(ge.expr),Ke=(0,S.A)(ge.queryType),at=ge.editorMode,St=_e=>{window.localStorage.setItem(os,_e.currentTarget.checked?"true":"false"),De(_e.currentTarget.checked)},mt=(0,r.useCallback)(_e=>{if((0,de.rR)("grafana_loki_editor_mode_clicked",{newEditor:_e,previousEditor:ge.editorMode??"",newQuery:!ge.expr,app:E??""}),_e===ye.f.Builder&&(0,Zt.u_)(ge.expr||"").errors.length){F(!0);return}Vi(ge,_e,s)},[s,ge,E]);(0,r.useEffect)(()=>{J(!1)},[f]);const Ut=_e=>{(0,A.isEqual)(_e,e.query)||J(!0),s(_e)},rt=()=>{(0,de.rR)("grafana_loki_label_browser_opened",{app:E}),he(_e=>!_e)};return(0,r.useEffect)(()=>{Hi(ge.expr,Ve,x,Ne,ge.queryType,Ke)&&x&&(async()=>{const Yt=await g.getStats({...ge,refId:`${t}_${ge.refId}`},x);ve(Yt)})()},[g,x,Ne,ge,Ve,Ke,ve,t]),r.createElement(r.Fragment,null,r.createElement(L.u,{isOpen:M,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{s({...ge,editorMode:ye.f.Builder}),F(!1)},onDismiss:()=>F(!1)}),r.createElement(_i,{isOpen:G,onClose:()=>j(!1),query:ge,queries:h,app:E,onChange:s,onAddQuery:d}),r.createElement(Wr,{isOpen:le,datasource:g,query:ge,app:E,onClose:()=>he(!1),onChange:Ut,onRunQuery:c,timeRange:x}),r.createElement(We.X,null,r.createElement(I.B,{gap:1},r.createElement(U.$n,{"data-testid":$e.Tp.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{j(st=>!st);const _e=(0,Zt.u_)(ge.expr||"");(0,de.rR)("grafana_loki_query_patterns_opened",{version:"v2",app:E??"",editorMode:ge.editorMode,preSelectedOperationsCount:_e.query.operations.length,preSelectedLabelsCount:_e.query.labels.length})}},"Kick start your query"),r.createElement(U.$n,{variant:"secondary",size:"sm",onClick:rt,"data-testid":"label-browser-button"},"Label browser")),r.createElement(ue,{label:"Explain query",value:ce,onChange:St}),r.createElement(C.Z,{grow:1}),E!==Le.Jk.Explore&&E!==Le.Jk.Correlations&&r.createElement(U.$n,{variant:xe?"primary":"secondary",size:"sm",onClick:c,icon:f?.state===ke.Gu.Loading?"spinner":void 0,disabled:f?.state===ke.Gu.Loading},h&&h.length>1?"Run queries":"Run query"),r.createElement(Q,{mode:at,onChange:mt})),r.createElement(pe.$,{v:.5}),r.createElement(O.D,null,at===ye.f.Code&&r.createElement(Ci,{...e,query:ge,onChange:Ut,showExplain:ce}),at===ye.f.Builder&&r.createElement(bi,{datasource:e.datasource,query:ge,onChange:Ut,onRunQuery:e.onRunQuery,showExplain:ce,timeRange:x}),r.createElement(as,{query:ge,onChange:s,onRunQuery:c,app:E,maxLines:g.maxLines,queryStats:ie})))});ls.displayName="LokiQueryEditor";function Gi(e){const{query:t,data:s,datasource:c,onChange:d,onRunQuery:f,history:E}=e;return r.createElement(ns.W,{datasource:c,query:t,onChange:d,onRunQuery:f,history:E,data:s,placeholder:"Enter a Loki query","data-testid":Yi.editor})}const Yi={editor:"loki-editor-cloud-alerting"};function Ji(e){const{app:t}=e;switch(t){case Le.Jk.CloudAlerting:return r.createElement(Gi,{...e});default:return r.createElement(ls,{...e})}}const Zi=(0,r.memo)(Ji),Xo={editor:"loki-editor"};var qi=l(68704),eo=l(77657),to=l(39748),ro=l(66025),ao=l(91062),no=l(32346),xn=l(25994),so=l(17081),Ln=l(29020),Sn=l(35931);function io({options:e,onOptionsChange:t}){return r.createElement(Ln.I,{title:"Alerting",description:r.createElement(Sn.H,{description:"Manage alert rules for the Loki data source.",suffix:"loki/configure-loki-data-source/#alerting",feature:"alerting"})},r.createElement(er.I,{labelWidth:29,label:"Manage alert rules in Alerting UI",disabled:e.readOnly,tooltip:"Manage alert rules for this data source. To manage other alerting resources, add an Alertmanager data source."},r.createElement(be.K,{value:e.jsonData.manageAlerts!==!1,onChange:s=>t({...e,jsonData:{...e.jsonData,manageAlerts:s.currentTarget.checked}})})))}var oo=l(6709),lo=l(91890),co=l(72574),uo=l(21744);const fo=e=>{const{derivedFields:t,className:s}=e,[c,d]=(0,r.useState)("");let f=[];return c&&t&&(f=mo(t,c)),r.createElement("div",{className:s},r.createElement(er.I,{label:"Debug log message",labelWidth:24,grow:!0},r.createElement(uo.f,{type:"text","aria-label":"Loki query",placeholder:"Paste an example log line here to test the regular expressions of your derived fields",value:c,onChange:E=>d(E.currentTarget.value)})),!!f.length&&r.createElement(po,{fields:f}))},po=({fields:e})=>r.createElement("table",{className:"filter-table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,"Name"),r.createElement("th",null,"Value"),r.createElement("th",null,"Url"))),r.createElement("tbody",null,e.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=r.createElement("a",{href:t.href},s)),r.createElement("tr",{key:`${t.name}=${t.value}`},r.createElement("td",null,t.name),r.createElement("td",null,s),r.createElement("td",null,t.href?r.createElement("a",{href:t.href},t.href):""))})));function mo(e,t){return e.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const c=t.match(s.matcherRegex);let d;const f=c&&c[1];return f&&(d=(0,co.w)().replace(s.url,{__value:{value:{raw:f},text:"Raw value"}})),{name:s.name,value:f||"<no match>",href:d}}catch(c){return{name:s.name,error:c}}})}var go=l(55882),Ir=l(88575),ho=l(64078);const vo=e=>({row:(0,$.css)`
    display: flex;
    align-items: baseline;
  `,nameField:(0,$.css)`
    flex: 2;
    margin-right: ${e.spacing(.5)};
  `,regexField:(0,$.css)`
    flex: 3;
    margin-right: ${e.spacing(.5)};
  `,urlField:(0,$.css)`
    flex: 1;
    margin-right: ${e.spacing(.5)};
  `,urlDisplayLabelField:(0,$.css)`
    flex: 1;
  `,internalLink:(0,$.css)`
    margin-right: ${e.spacing(1)};
  `,dataSource:(0,$.css)``,nameMatcherField:(0,$.css)({width:e.spacing(20),marginRight:e.spacing(.5)})}),Oo=e=>{const{value:t,onChange:s,onDelete:c,suggestions:d,className:f,validateName:E}=e,h=(0,te.of)(vo),[g,x]=(0,r.useState)(!!t.datasourceUid),M=(0,S.A)(t.datasourceUid),[F,G]=(0,r.useState)(t.matcherType??"regex");(0,r.useEffect)(()=>{!M&&t.datasourceUid&&!g&&x(!0),M&&!t.datasourceUid&&g&&x(!1)},[M,t.datasourceUid,g]);const j=J=>le=>{s({...t,[J]:le.currentTarget.value})},xe=!E(t.name);return r.createElement("div",{className:f,"data-testid":"derived-field"},r.createElement("div",{className:"gf-form"},r.createElement(Ir.D,{className:h.nameField,label:"Name",invalid:xe,error:"The name is already in use"},r.createElement(ur.p,{value:t.name,onChange:j("name"),placeholder:"Field name",invalid:xe})),r.createElement(Ir.D,{className:h.nameMatcherField,label:r.createElement(fn,{label:"Type",content:"Derived fields can be created from labels or by applying a regular expression to the log message."})},r.createElement(Bt.l6,{options:[{label:"Regex in log line",value:"regex"},{label:"Label",value:"label"}],value:F,onChange:J=>{(J.value==="label"||J.value==="regex")&&(G(J.value),s({...t,matcherType:J.value}))}})),r.createElement(Ir.D,{className:h.regexField,label:r.createElement(r.Fragment,null,F==="regex"&&r.createElement(fn,{label:"Regex",content:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),F==="label"&&r.createElement(fn,{label:"Label",content:"Use to derive the field from a label."}))},r.createElement(ur.p,{value:t.matcherRegex,onChange:j("matcherRegex")})),r.createElement(Ir.D,{label:""},r.createElement(U.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:J=>{J.preventDefault(),c()}}))),r.createElement("div",{className:"gf-form"},r.createElement(Ir.D,{label:g?"Query":"URL",className:h.urlField},r.createElement(ho.l,{placeholder:g?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:J=>s({...t,url:J}),suggestions:d})),r.createElement(Ir.D,{className:h.urlDisplayLabelField,label:r.createElement(fn,{label:"URL Label",content:"Use to override the button label when this derived field is found in a log."})},r.createElement(ur.p,{value:t.urlDisplayLabel,onChange:j("urlDisplayLabel")}))),r.createElement("div",{className:"gf-form"},r.createElement(Ir.D,{label:"Internal link",className:h.internalLink},r.createElement(be.d,{value:g,onChange:J=>{const{checked:le}=J.currentTarget;le||s({...t,datasourceUid:void 0}),x(le)}})),g&&r.createElement(Ir.D,{label:"",className:h.dataSource},r.createElement(go.s,{tracing:!0,onChange:J=>s({...t,datasourceUid:J.uid}),current:t.datasourceUid,noDefault:!0}))))},fn=({content:e,label:t})=>r.createElement(Vt.J,null,t,r.createElement(Ge.m,{placement:"top",content:e,theme:"info"},r.createElement(Vr.I,{tabIndex:0,name:"info-circle",size:"sm",style:{marginLeft:"10px"}}))),yo=e=>({addButton:(0,$.css)`
    margin-right: 10px;
  `,derivedField:(0,$.css)`
    margin-bottom: ${e.spacing(1)};
  `,container:(0,$.css)`
    margin-bottom: ${e.spacing(4)};
  `,debugSection:(0,$.css)`
    margin-top: ${e.spacing(4)};
  `}),bo=({fields:e=[],onChange:t})=>{const s=(0,te.$j)(),c=yo(s),[d,f]=(0,r.useState)(!1),E=(0,r.useCallback)(h=>e.filter(g=>g.name&&g.name===h).length<=1,[e]);return r.createElement(Ln.I,{title:"Derived fields",description:r.createElement(Sn.H,{description:"Derived fields can be used to extract new fields from a log message and create a link from its value.",suffix:"loki/configure-loki-data-source/#derived-fields",feature:"derived fields"})},r.createElement("div",{className:c.container},e.map((h,g)=>r.createElement(Oo,{className:c.derivedField,key:g,value:h,onChange:x=>{const M=[...e];M.splice(g,1,x),t(M)},onDelete:()=>{const x=[...e];x.splice(g,1),t(x)},validateName:E,suggestions:[{value:oo.c.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:lo.$0.Value}]})),r.createElement("div",null,r.createElement(U.$n,{variant:"secondary",className:c.addButton,icon:"plus",onClick:h=>{h.preventDefault();const g={name:"",matcherRegex:"",urlDisplayLabel:"",url:"",matcherType:"regex"},x=[...e,g];t(x)}},"Add"),e.length>0&&r.createElement(U.$n,{variant:"secondary",type:"button",onClick:()=>f(!d)},d?"Hide example log message":"Show example log message")),d&&r.createElement("div",{className:c.debugSection},r.createElement(fo,{className:(0,$.css)`
                margin-bottom: 10px;
              `,derivedFields:e}))))};var Eo=l(39268),Po=l(39938);const xo=e=>{const{maxLines:t,onMaxLinedChange:s,predefinedOperations:c,onPredefinedOperationsChange:d}=e;return r.createElement(Ln.I,{title:"Queries",description:r.createElement(Sn.H,{description:"Additional options to customize your querying experience.",suffix:"loki/configure-loki-data-source/#queries",feature:"query settings"})},r.createElement(er.I,{label:"Maximum lines",htmlFor:"loki_config_maxLines",labelWidth:22,tooltip:r.createElement(r.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")},r.createElement(ur.p,{type:"number",id:"loki_config_maxLines",value:t,onChange:f=>s(f.currentTarget.value),width:16,placeholder:"1000",spellCheck:!1})),v.$.featureToggles.lokiPredefinedOperations&&r.createElement(Eo.C,null,r.createElement(er.I,{label:"Predefined operations",htmlFor:"loki_config_predefinedOperations",labelWidth:22,tooltip:r.createElement(r.Fragment,null,'Predefined operations are used as an initial state for your queries. They are useful, if you want to unpack, parse or format all log lines. Currently we support only log operations starting with |. For example: | unpack | line_format "{{.message}}".')},r.createElement(ur.p,{type:"string",id:"loki_config_predefinedOperations",value:c,onChange:f=>d(f.currentTarget.value),width:40,placeholder:"| unpack | line_format",spellCheck:!1})),r.createElement(er.I,null,r.createElement(Po.E,{text:"Experimental",color:"orange",icon:"exclamation-triangle",tooltip:"Predefined operations is an experimental feature that may change in the future."}))))},$n=e=>(t,s)=>({...t,jsonData:{...t.jsonData,[e]:s}}),Lo=$n("maxLines"),So=$n("predefinedOperations"),$o=$n("derivedFields"),To=e=>{const{options:t,onOptionsChange:s}=e,c=(0,r.useCallback)(d=>{(0,de.rR)("grafana_loki_predefined_operations_changed",{value:d}),s(So(t,d))},[t,s]);return r.createElement(r.Fragment,null,r.createElement(qi.I,{dataSourceName:"Loki",docsLink:"https://grafana.com/docs/grafana/latest/datasources/loki/configure-loki-data-source/",hasRequiredFields:!1}),r.createElement(xn.c,{spacing:4}),r.createElement(eo.u,{config:t,onChange:s,urlPlaceholder:"http://localhost:3100"}),r.createElement(xn.c,{spacing:4}),r.createElement(to.N,{...(0,ro.pe)({config:t,onChange:s})}),r.createElement(xn.c,{spacing:4}),r.createElement(ao.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0},r.createElement(I.B,{gap:5,direction:"column"},r.createElement(no.g,{config:t,onChange:s}),v.$.secureSocksDSProxyEnabled&&r.createElement(so.Y,{options:t,onOptionsChange:s}),r.createElement(io,{options:t,onOptionsChange:s}),r.createElement(xo,{maxLines:t.jsonData.maxLines||"",onMaxLinedChange:d=>s(Lo(t,d)),predefinedOperations:t.jsonData.predefinedOperations||"",onPredefinedOperationsChange:c}),r.createElement(bo,{fields:t.jsonData.derivedFields,onChange:d=>s($o(t,d))}))))};var Qo=l(27724),Ro=l(79007);const wo=new T.tD(Qo.VQ).setQueryEditor(Zi).setConfigEditor(To).setQueryEditorHelp(q);(0,D.J7)().subscribe(Re.gc,Ro.jg)},56587:(ot,Ue,l)=>{"use strict";l.d(Ue,{$F:()=>Le,Cg:()=>He,FV:()=>$,H0:()=>b,Io:()=>fe,MX:()=>be,OT:()=>B,QH:()=>$e,Rn:()=>Je,TQ:()=>ye,_i:()=>Ae,aw:()=>Fe,d_:()=>me,g5:()=>Te,gy:()=>k,pS:()=>Qe,pk:()=>N,sI:()=>te,sc:()=>ue,vV:()=>W});var T=l(2543),Re=l.n(T),D=l(36195),A=l(12798),r=l(56245),de=l(65650);function b(R=""){const C=[],K=$e(R,[D.PN]);for(const z of K){const Q=z.getChild(D.dJ)?.getChild(D.Sg),O=z.getChild(D.dJ)?.getChild(D.q5),v=Oe(z);if(!(!Q&&!O||!v.length))for(const L of v){const I=R.substring(L.from,L.to).trim(),U=I[0]==="`",pe=I.substring(1,I.length-1);if(!pe)continue;let Pe="";O?Pe=U?pe:pe.replace(/\\\\/g,"\\"):Pe=(0,T.escapeRegExp)(pe),Pe&&C.push(Pe)}}return C}function Oe(R){const C=[];let K=R;do{const z=K.getChild(D.Qf);z&&!K.getChild(D.w7)&&C.push(z),K=K.getChild(D.ih)}while(K!=null);return C}function W(R){const C=fe(R),{instant:K,range:z,...Q}=R;return{...Q,queryType:C}}function fe(R){const{queryType:C}=R;return C===de.U3.Range||C===de.U3.Instant||C===de.U3.Stream?C:R.instant===!0?de.U3.Instant:de.U3.Range}const w=["String","Identifier","LineComment","Number"],q=["__error__","__interval","__interval_ms","__auto"];function Le(R){let C=R;return D.K3.parse(R).iterate({enter:({name:z,from:Q,to:O})=>{const v=R.substring(Q,O);w.includes(z)&&!q.includes(v)&&(C=C.replace(v,z))}}),C}function S(R){const C=[];return parser.parse(R).iterate({enter:({name:z})=>{C.push(z)}}),C}function ke(R,C){let K=!1;return D.K3.parse(R).iterate({enter:({type:Q})=>{if(Q.id===C)return K=!0,!1}}),K}function $e(R,C){const K=[];return D.K3.parse(R).iterate({enter:Q=>{(C===void 0||C.includes(Q.type.id))&&K.push(Q.node)}}),K}function ye(R,C){const K=[];return D.K3.parse(R).iterate({enter:Q=>{(C===void 0||C.includes(Q.type.id))&&K.push(A.Ch.fromNode(Q.node))}}),K}function We(R,C){const K=$e(R,[C]);return K.length>0?K[0]:void 0}function $(R){return ke(R,r.Ql)}function te(R){return!ke(R,D.Yw)}function be(R){const K=$e(R,[D.iT,D.eF,D.c$]).length;return{queryWithParser:K>0,parserCount:K}}function Fe(R){const C=$e(R,[D.iT,D.LM,D.c$]);return C.length>0?R.substring(C[0].from,C[0].to).trim():void 0}function me(R){const C=$e(R,[D.bY]);for(const K of C){const z=K.getChild(D.g$)?.getChild(D.gw);if(z&&R.substring(z.from,z.to)==="__error__")return!0}return!1}function Ae(R){return ke(R,D.J_)}function B(R){if(te(R))return R;const C=We(R,D.MD);if(!C)return"";const K=R.substring(C.from,C.to),z=We(R,D.AL),Q=z?R.substring(z.from,z.to):"";return`${K} ${Q}`.trim()}function Te(R,C){if(te(R))return R;const K=$e(R,[D.Yw]).reverse().find(z=>z.from<=C&&z.to>=C);return K?B(R.substring(K.from,K.to)):""}function Qe(R){return ke(R,D.bY)}function Je(R){return ke(R,D.PN)}function He(R){const C=$e(R,[D.Q6]);for(const K of C)if(R.substring(K.from,K.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function N(R){return(0,A.yB)(R).map(z=>R.slice(z.from,z.to))}function k(R){return R.filter(K=>!K.hide).filter(K=>!K.refId.includes("do-not-chunk")).filter(K=>K.expr).length>0}const ee=R=>R?"expr"in R&&R.expr!==void 0:!1,ue=R=>{if(!(!R||!ee(R)))return R}},43548:(ot,Ue,l)=>{"use strict";l.d(Ue,{y:()=>b});var T=l(83077),Re=l(42952);class D{constructor(W,fe){this.categories=[],this.operationsRegistry=new T.O(()=>W),this.innerQueryPlaceholder=fe||"<query>"}setOperationCategories(W){this.categories=W}getOperationsForCategory(W){return this.operationsRegistry.list().filter(fe=>fe.category===W&&!fe.hideFromList)}getAlternativeOperations(W){return this.operationsRegistry.list().filter(fe=>fe.alternativesKey&&fe.alternativesKey===W)}getCategories(){return this.categories}getOperationDefinition(W){return this.operationsRegistry.getIfExists(W)}hasBinaryOp(W){return W.operations.find(fe=>{const w=this.getOperationDefinition(fe.id);return w?.category===Re.T})!==void 0}}var A=l(83657),r=l(54623);class de extends D{constructor(){super(A.sp,"<expr>"),this.setOperationCategories([r.Ln.Aggregations,r.Ln.RangeFunctions,r.Ln.Formats,r.Ln.BinaryOps,r.Ln.LabelFilters,r.Ln.LineFilters])}renderOperations(W,fe){for(const w of fe){const q=this.operationsRegistry.getIfExists(w.id);if(!q){console.error(`Could not find operation ${w.id} in the registry`);continue}W=q.renderer(w,q,W)}return W}renderBinaryQueries(W,fe){if(fe)for(const w of fe)W=`${this.renderBinaryQuery(W,w)}`;return W}renderBinaryQuery(W,fe){let w=W+` ${fe.operator} `;return fe.vectorMatches&&(w+=`${fe.vectorMatchesType}(${fe.vectorMatches}) `),w+this.renderQuery(fe.query,!0)}renderLabels(W){if(W.length===0)return"{}";let fe="{";for(const w of W)fe!=="{"&&(fe+=", "),fe+=`${w.label}${w.op}"${w.value}"`;return fe+"}"}renderQuery(W,fe){let w=this.renderLabels(W.labels);return w=this.renderOperations(w,W.operations),!fe&&this.hasBinaryOp(W)&&W.binaryQueries?.length&&(w=`(${w})`),w=this.renderBinaryQueries(w,W.binaryQueries),w}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:r.IQ.Log,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:r.IQ.Log,operations:[{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LineFormat,params:["{{.message}}"]},{id:r.EF.Json,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:r.IQ.Log,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.Unwrap,params:[""]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.SumOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:r.IQ.Metric,operations:[{id:r.EF.LineContains,params:[""]},{id:r.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:r.IQ.Metric,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.CountOverTime,params:["$__auto"]},{id:r.EF.Sum,params:[]},{id:r.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:r.IQ.Metric,operations:[{id:r.EF.Logfmt,params:[]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.Unwrap,params:["latency"]},{id:r.EF.LabelFilterNoErrors,params:[]},{id:r.EF.QuantileOverTime,params:["$__auto",.5]},{id:r.EF.Sum,params:[]}]}]}}const b=new de},58592:(ot,Ue,l)=>{"use strict";l.d(Ue,{C:()=>D,I:()=>A});var T=l(11216),Re=l(54623);const D=[{id:Re.EF.Addition,name:"Add scalar",sign:"+"},{id:Re.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:Re.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:Re.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:Re.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:Re.EF.Exponent,name:"Exponent",sign:"^"},{id:Re.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:Re.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:Re.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:Re.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:Re.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:Re.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],A=D.map(de=>{const b=[{name:"Value",type:"number"}];let Oe=[2];return de.comparison&&(b.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),Oe=[2,!1]),{id:de.id,name:de.name,params:b,defaultParams:Oe,alternativesKey:"binary scalar operations",category:Re.Ln.BinaryOps,renderer:r(de.sign),addOperationHandler:T.iZ}});function r(de){return function(Oe,W,fe){let w=Oe.params[0],q="";return Oe.params.length===2&&(q=Oe.params[1]?" bool":""),`${fe} ${de}${q} ${w}`}}},11216:(ot,Ue,l)=>{"use strict";l.d(Ue,{af:()=>be,VR:()=>Fe,G3:()=>k,jC:()=>K,fu:()=>q,yD:()=>Le,iZ:()=>N,UF:()=>me,OS:()=>B,hh:()=>ye,sn:()=>$e,EP:()=>We});var T=l(2543),Re=l(55127),D=l.n(Re),A=l(97535),r=l(71713),de=l(96540),b=l(21594);const Oe=({onChange:Q,index:O,operationId:v,value:L,query:I,datasource:U,queryModeller:pe})=>{const[Pe,Ie]=(0,de.useState)({});return de.createElement(b.l6,{inputId:B(v,O),autoFocus:L==="",openMenuOnFocus:!0,onOpenMenu:async()=>{Ie({isLoading:!0});const je=await W(I,U,pe);Ie({options:je,isLoading:void 0})},isLoading:Pe.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:Pe.options,value:fe(L),onChange:je=>Q(O,je.value)})};async function W(Q,O,v){let L=Q.labels;const I=v.renderLabels(L);return(await O.languageProvider.fetchLabels({streamSelector:I})).map(pe=>({label:pe,value:pe}))}const fe=Q=>({label:Q?.toString(),value:Q});var w=l(54623);function q(Q,O){const v=[Ae()],L=["$__auto"];let I;return Q===w.EF.QuantileOverTime&&(L.push("0.95"),v.push({name:"Quantile",type:"number"})),O&&(v.push({name:"By label",type:"string",restParam:!0,optional:!0}),I=Te(`__${Q}_by`)),{id:Q,name:He(Q),params:v,defaultParams:L,alternativesKey:"range function",category:w.Ln.RangeFunctions,orderRank:w.h5.RangeVectorFunction,renderer:ke,addOperationHandler:be,paramChangedHandler:I,explainHandler:(U,pe)=>{let Pe=r.AW.find(Ie=>Ie.insertText===U.id)?.documentation??"";return U.params[0]==="$__auto"?`${Pe} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${Pe} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${U.params[0]}\`.`}}}function Le(Q){const O=q(Q,!0),v=O.params.slice(0,-1);return[O,{id:`__${Q}_by`,name:`${He(Q)} by`,params:[...v,{name:"Label",type:"string",restParam:!0,optional:!0,editor:Oe}],defaultParams:[...O.defaultParams,""],alternativesKey:"range function with grouping",category:w.Ln.RangeFunctions,renderer:S(Q,"by"),paramChangedHandler:Je(Q),explainHandler:Qe(Q,"by"),addOperationHandler:be,hideFromList:!0},{id:`__${Q}_without`,name:`${He(Q)} without`,params:[...v,{name:"Label",type:"string",restParam:!0,optional:!0,editor:Oe}],defaultParams:[...O.defaultParams,""],alternativesKey:"range function with grouping",category:w.Ln.RangeFunctions,renderer:S(Q,"without"),paramChangedHandler:Je(Q),explainHandler:Qe(Q,"without"),addOperationHandler:be,hideFromList:!0}]}function S(Q,O){return function(L,I,U){const pe=I.params.findIndex(je=>je.restParam),Pe=L.params.slice(0,pe),Ie=L.params.slice(pe);return Pe.length===2&&Q===w.EF.QuantileOverTime?`${Q}(${Pe[1]}, ${U} [${Pe[0]}]) ${O} (${Ie.join(", ")})`:`${Q}(${U} [${Pe[0]}]) ${O} (${Ie.join(", ")})`}}function ke(Q,O,v){const L=Q.params??[],I=L[0]??"$__auto";if(L.length===2&&Q.id===w.EF.QuantileOverTime){const U=L[1];return`${Q.id}(${U}, ${v} [${I}])`}return`${Q.id}(${v} [${L[0]??"$__auto"}])`}function $e(Q,O,v){return["<","<=",">",">="].includes(String(Q.params[1]))?`${v} | ${Q.params[0]} ${Q.params[1]} ${Q.params[2]}`:`${v} | ${Q.params[0]} ${Q.params[1]} \`${Q.params[2]}\``}function ye(Q,O){if(!Q)return!1;const v=Q.params[1].toString().startsWith("!");return O.filter(U=>U.id===w.EF.LabelFilter&&U.params[0]===Q.params[0]&&U.params[2]===Q.params[2]).some(U=>!!(v&&U.params[1].toString().startsWith("!")===!1||v===!1&&U.params[1].toString().startsWith("!")))}function We(Q,O,v){switch(Q.id){case w.EF.Logfmt:const[L=!1,I=!1,...U]=Q.params;return`${v} | logfmt${L?" --strict":""}${I?" --keep-empty":""} ${U.filter(pe=>pe).join(", ")}`.trim();case w.EF.Json:return`${v} | json ${Q.params.filter(pe=>pe).join(", ")}`.trim();case w.EF.Drop:return`${v} | drop ${Q.params.filter(pe=>pe).join(", ")}`.trim();case w.EF.Keep:return`${v} | keep ${Q.params.filter(pe=>pe).join(", ")}`.trim();default:return`${v} | ${Q.id}`}}function $(Q){return Q.category===w.Ln.RangeFunctions}function te(Q,O,v){const L=Q.findIndex(I=>{const U=O.getOperationDefinition(I.id);return U?v(U):!1});return L===-1?Q.length:L}function be(Q,O,v){const L={id:Q.id,params:Q.defaultParams},I=[...O.operations],U=I.find(pe=>{const Pe=v.getOperationDefinition(pe.id);return Pe?$(Pe):!1});switch(Q.category){case w.Ln.Aggregations:case w.Ln.Functions:if(!U){const Pe=te(I,v,Ie=>Ie.category===w.Ln.Functions);I.splice(Pe,0,{id:w.EF.Rate,params:["$__auto"]})}I.push(L);break;case w.Ln.RangeFunctions:if(U){const Pe=I.indexOf(U);I[Pe]=L;break}default:const pe=te(I,v,Pe=>(Q.orderRank??100)<(Pe.orderRank??100));I.splice(pe,0,L);break}return{...O,operations:I}}function Fe(Q,O){return{...O,binaryQueries:[...O.binaryQueries??[],{operator:"/",query:O}]}}function me(Q,O){return function(L,I,U){const pe=L.params.some(je=>typeof je=="string"&&je.includes("`")),Pe=pe?'"':"`";let Ie;return pe?Ie=L.params.map(je=>typeof je=="string"?(0,A.Qn)(je):je):Ie=L.params,O?`${U} ${Q} ${Pe}(?i)${Ie.join(`${Pe} or ${Pe}(?i)`)}${Pe}`:`${U} ${Q} ${Pe}${Ie.join(`${Pe} or ${Pe}`)}${Pe}`}}function Ae(){return{name:"Range",type:"string",options:["$__auto","1m","5m","10m","1h","24h"]}}function B(Q,O){return`operations.${Q}.param.${O}`}function Te(Q){return function(v,L,I){return L.params.length===I.params.length?{...L,id:Q}:L}}function Qe(Q,O){return function(L){const I=L.params.map(pe=>`\`${pe}\``).join(" and "),U=D()("label",L.params.length);switch(O){case"by":return`Calculates ${Q} over dimensions while preserving ${U} ${I}.`;case"without":return`Calculates ${Q} over the dimensions ${I}. All other labels are preserved.`;default:return`Calculates ${Q} over the dimensions.`}}}function Je(Q){return function(v,L,I){return L.params.length<I.params.length?{...L,id:Q}:L}}function He(Q){return(0,T.capitalize)(Q.replace(/_/g," "))}function N(Q,O){const v={id:Q.id,params:Q.defaultParams};return{...O,operations:[...O.operations,v]}}function k(Q,O={}){return[{id:Q,name:He(Q),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],alternativesKey:"plain aggregations",category:w.Ln.Aggregations,renderer:ue,paramChangedHandler:Te(`__${Q}_by`),explainHandler:Qe(Q,""),addOperationHandler:N,...O},{id:`__${Q}_by`,name:`${He(Q)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:Oe}],defaultParams:[""],alternativesKey:"aggregations by",category:w.Ln.Aggregations,renderer:C(Q),paramChangedHandler:Je(Q),explainHandler:Qe(Q,"by"),addOperationHandler:N,hideFromList:!0,...O},{id:`__${Q}_without`,name:`${He(Q)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:Oe}],defaultParams:[""],alternativesKey:"aggregations by",category:w.Ln.Aggregations,renderer:ee(Q),paramChangedHandler:Je(Q),explainHandler:Qe(Q,"without"),addOperationHandler:N,hideFromList:!0,...O}]}function ee(Q){return function(v,L,I){return`${Q} without(${v.params.join(", ")}) (${I})`}}function ue(Q,O,v){const L=R(Q,O,v),I=Q.id+"(";return v&&L.push(v),I+L.join(", ")+")"}function R(Q,O,v){return(Q.params??[]).map((L,I)=>O.params[I].type==="string"?'"'+L+'"':L)}function C(Q){return function(v,L,I){return`${Q} by(${v.params.join(", ")}) (${I})`}}function K(Q,O,v={}){const L=k(Q,v);return L[0].params.unshift(...O.params),L[1].params.unshift(...O.params),L[2].params.unshift(...O.params),L[0].defaultParams=O.defaultParams,L[1].defaultParams=[...O.defaultParams,""],L[2].defaultParams=[...O.defaultParams,""],L[1].renderer=z(Q),L[2].renderer=z(Q),L}function z(Q){return function(v,L,I){const U=L.params.findIndex(Ie=>Ie.restParam),pe=v.params.slice(0,U),Pe=v.params.slice(U);return`${Q} by(${Pe.join(", ")}) (${pe.map((Ie,je)=>L.params[je].type==="string"?`"${Ie}"`:Ie).join(", ")}, ${I})`}}},83657:(ot,Ue,l)=>{"use strict";l.d(Ue,{VI:()=>$,y6:()=>ye,mD:()=>We,sp:()=>$e});var T=l(58592),Re=l(96540),D=l(50877),A=l(43127),r=l(32264),de=l(21594),b=l(20065),Oe=l(27724),W=l(56587),fe=l(75723),w=l(11216);function q({onChange:te,index:be,operationId:Fe,value:me,query:Ae,datasource:B,timeRange:Te,queryModeller:Qe}){const[Je,He]=(0,Re.useState)({});return Re.createElement(de.l6,{inputId:(0,w.OS)(Fe,be),onOpenMenu:async()=>{if(B instanceof Oe.VQ&&r.$.featureToggles.lokiQueryHints){He({isLoading:!0});const N=await Le(Ae,B,Qe,Te);He({options:N,isLoading:void 0})}},isLoading:Je.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:Je.options,value:me?(0,D.z)(me.toString()):null,onChange:N=>{N.value&&te(be,N.value)}})}async function Le(te,be,Fe,me=(0,A.E2)()){const Ae=Fe.renderQuery(te),B=(0,W.OT)(Ae);if((0,W.FV)(be.interpolateString(B,b.a)))return[];const Te=await be.getDataSamples({expr:B,refId:"unwrap_samples"},me);return(0,fe.aN)(Te[0]).map(He=>({label:He,value:He}))}var S=l(54623);function ke(){const te=[S.EF.Sum,S.EF.Min,S.EF.Max,S.EF.Avg,S.EF.Stddev,S.EF.Stdvar,S.EF.Count].flatMap(B=>(0,w.G3)(B,{addOperationHandler:w.af,orderRank:S.h5.Last})),be=[S.EF.TopK,S.EF.BottomK].flatMap(B=>(0,w.jC)(B,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:w.af,orderRank:S.h5.Last})),Fe=[(0,w.fu)(S.EF.Rate),(0,w.fu)(S.EF.RateCounter),(0,w.fu)(S.EF.CountOverTime),(0,w.fu)(S.EF.SumOverTime),(0,w.fu)(S.EF.BytesRate),(0,w.fu)(S.EF.BytesOverTime),(0,w.fu)(S.EF.AbsentOverTime)],me=[...(0,w.yD)(S.EF.AvgOverTime),...(0,w.yD)(S.EF.MaxOverTime),...(0,w.yD)(S.EF.MinOverTime),...(0,w.yD)(S.EF.FirstOverTime),...(0,w.yD)(S.EF.LastOverTime),...(0,w.yD)(S.EF.StdvarOverTime),...(0,w.yD)(S.EF.StddevOverTime),...(0,w.yD)(S.EF.QuantileOverTime)];return[...te,...be,...Fe,...me,{id:S.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:(B,Te,Qe)=>`${Qe} | regexp \`${B.params[0]}\``,addOperationHandler:w.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:S.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:(B,Te,Qe)=>`${Qe} | pattern \`${B.params[0]}\``,addOperationHandler:w.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Parsers,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:S.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(B,Te,Qe)=>`${Qe} | line_format \`${B.params[0]}\``,addOperationHandler:w.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:S.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(B,Te,Qe)=>`${Qe} | label_format ${B.params[1]}=${B.params[0]}`,addOperationHandler:w.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:S.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("|="),addOperationHandler:w.af,explainHandler:B=>`Return log lines that contain string \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("!="),addOperationHandler:w.af,explainHandler:B=>`Return log lines that does not contain string \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("|~",!0),addOperationHandler:w.af,explainHandler:B=>`Return log lines that match regex \`(?i)${B.params?.join("`, or `(?i)")}\`.`},{id:S.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("!~",!0),addOperationHandler:w.af,explainHandler:B=>`Return log lines that does not match regex \`(?i)${B.params?.join("`, or `(?i)")}\`.`},{id:S.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("|~"),addOperationHandler:w.af,explainHandler:B=>`Return log lines that match a \`RE2\` regex pattern. \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(0,w.UF)("!~"),addOperationHandler:w.af,explainHandler:B=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${B.params?.join("`, or `")}\`.`},{id:S.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[S.NS.contains,S.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:S.Ln.LineFilters,orderRank:S.h5.LineFilters,renderer:(B,Te,Qe)=>`${Qe} ${B.params[0]} ip(\`${B.params[1]}\`)`,addOperationHandler:w.af,explainHandler:B=>`Return log lines using IP matching of \`${B.params[1]}\``},{id:S.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[S.NS.equals,S.NS.doesNotEqual,S.NS.matchesRegex,S.NS.doesNotMatchRegex,S.NS.greaterThan,S.NS.lessThan,S.NS.greaterThanOrEqual,S.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.PipeOperations,renderer:w.sn,addOperationHandler:w.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:S.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[S.NS.equals,S.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.PipeOperations,renderer:(B,Te,Qe)=>`${Qe} | ${B.params[0]} ${B.params[1]} ip(\`${B.params[2]}\`)`,addOperationHandler:w.af,explainHandler:B=>`Return log lines using IP matching of \`${B.params[2]}\` for \`${B.params[0]}\` label`},{id:S.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:S.Ln.LabelFilters,orderRank:S.h5.NoErrors,renderer:(B,Te,Qe)=>`${Qe} | __error__=\`\``,addOperationHandler:w.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:S.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:q},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.Unwrap,renderer:(B,Te,Qe)=>`${Qe} | unwrap ${B.params[1]?`${B.params[1]}(${B.params[0]})`:B.params[0]}`,addOperationHandler:w.af,explainHandler:B=>{let Te=String(B.params[0]).length>0?B.params[0]:"<label>";return`Use the extracted label \`${Te}\` as sample values instead of log lines for the subsequent range aggregation.${B.params[1]?` Conversion function \`${B.params[1]}\` wrapping \`${Te}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:S.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:(B,Te,Qe)=>`${Qe} | decolorize`,addOperationHandler:w.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:S.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:S.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],alternativesKey:"format",category:S.Ln.Formats,orderRank:S.h5.PipeOperations,renderer:w.EP,addOperationHandler:w.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...T.I,{id:S.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:S.Ln.BinaryOps,renderer:(B,Te,Qe)=>Qe,addOperationHandler:w.VR}]}const $e=ke();function ye(te){return($e.find(me=>me.id===te)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function We(te){return $e.find(be=>be.id===te)}function $(te,be){return!(be.length<te.params.filter(Fe=>!Fe.optional).length)}},60706:(ot,Ue,l)=>{"use strict";l.d(Ue,{u_:()=>de,w4:()=>Ae});var T=l(36195),Re=l(58592),D=l(83657),A=l(56245),r=l(54623);function de(N){const k=(0,A.qk)(N),ue=T.K3.parse(k).topNode,C={query:{labels:[],operations:[]},errors:[]};try{b(k,ue,C)}catch(K){console.error(K),K instanceof Error&&C.errors.push({text:K.message})}return Qe(C.query)&&(C.errors=[]),C}function b(N,k,ee){const ue=ee.query;switch(k.type.id){case T.g$:{ue.labels.push(Oe(N,k));const R=k.getChild(A.Ql);R&&ee.errors.push((0,A.xz)(N,R));break}case T.PN:{const{operation:R,error:C}=W(N,k);R&&ue.operations.push(R),C&&ee.errors.push(Te(N,k,C));break}case T.iT:{ue.operations.push(fe(N,k));break}case T.bY:{const{operation:R,error:C}=Le(N,k);R&&ue.operations.push(R),C&&ee.errors.push(Te(N,k,C));break}case T.eF:{ue.operations.push(w(N,k));break}case T.Zj:case T.Tz:{const{operation:R,error:C}=q(N,k);R&&ue.operations.push(R),C&&ee.errors.push(Te(N,k,C));break}case T.pH:{ue.operations.push(S(N,k));break}case T.e_:{ue.operations.push(ke(N,k));break}case T.HV:{const{operation:R,error:C}=ye(N,k,ee);R&&ue.operations.push(R),C&&ee.errors.push(Te(N,k,C));break}case T.Zg:{ue.operations.push($e());break}case T.h1:{ue.operations.push(We(N,k,ee));break}case T.Rh:{ue.operations.push($(N,k,ee));break}case T.MK:{be(N,k,ee);break}case A.Ql:{if(me(k))break;ee.errors.push((0,A.xz)(N,k));break}case T.i8:{ue.operations.push(Je(N,k,ee));break}case T.UP:{ue.operations.push(He(N,k,ee));break}default:{let R=k.firstChild;for(;R;)b(N,R,ee),R=R.nextSibling}}}function Oe(N,k){const ee=k.getChild(T.gw),ue=(0,A.AA)(N,ee),R=(0,A.AA)(N,ee?.nextSibling);let C=(0,A.AA)(N,k.getChild(T.Qf));return C=C.substring(1,C.length-1),{label:ue,op:R,value:C}}function W(N,k){const ee=(0,A.AA)(N,k.getChild(T.dJ)),ue=Ae((0,A.AA)(N,k.getChild(T.Qf)));if(k.getChild(T.w7)?.getChild(T.Ip))return{operation:{id:r.EF.LineFilterIpMatches,params:[ee,ue]}};const C=[ue];let K=k.getChild(T.ih);for(;K;)C.push(Ae((0,A.AA)(N,K.getChild(T.Qf)))),K=K.getChild(T.ih);return{operation:{id:{"|=":r.EF.LineContains,"!=":r.EF.LineContainsNot,"|~":r.EF.LineMatchesRegex,"!~":r.EF.LineMatchesRegexNot}[ee],params:C}}}function fe(N,k){const ee=k.firstChild,ue=(0,A.AA)(N,ee),R=Ae((0,A.AA)(N,k.getChild(T.Qf)));let C=R?[R]:[];const K=(0,D.mD)(ue);return K&&!(0,D.VI)(K,C)&&(C=K?.defaultParams||[]),{id:ue,params:C}}function w(N,k){const ee=k.getChild(T.LM),ue=(0,A.AA)(N,ee),R=[...(0,A.R1)(N,k,T.Gn)];return{id:ue,params:R}}function q(N,k){const ee=[],ue=[];let R;const C=k.from;return k.toTree().iterate({enter:z=>{z.type.id===T.ov?ee.push(N.substring(z.from+C,z.to+C)):z.type.id===T.Gn?ue.push(N.substring(z.from+C,z.to+C)):z.type.id===A.Ql&&(R=`Unexpected string "${N.substring(z.from+C,z.to+C)}"`)}}),{operation:{id:r.EF.Logfmt,params:[ee.includes("--strict"),ee.includes("--keep-empty"),...ue]},error:R}}function Le(N,k){if(k.getChild(T.Or)||k.getChild(T.KD)||k.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(k.firstChild.type.id===T.GA){const Q=k.firstChild,O=Q?.getChild(T.gw),v=O?.nextSibling,L=Q?.getChild(T.Qf),I=Ae((0,A.AA)(N,L));return{operation:{id:r.EF.LabelFilterIpMatches,params:[(0,A.AA)(N,O),(0,A.AA)(N,v),I]}}}const ee=r.EF.LabelFilter;if(k.firstChild.type.id===T.Jq){const O=k.firstChild.firstChild.firstChild,v=O.nextSibling,L=v.nextSibling,I=Ae((0,A.AA)(N,L));return{operation:{id:ee,params:[(0,A.AA)(N,O),(0,A.AA)(N,v),I]}}}const R=k.firstChild.firstChild,C=R.nextSibling,K=C.nextSibling,z=[(0,A.AA)(N,R),(0,A.AA)(N,C),Ae((0,A.AA)(N,K))];return z.join("")==="__error__="?{operation:{id:r.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:ee,params:z}}}function S(N,k){const ee=r.EF.LineFormat,ue=Ae((0,A.AA)(N,k.getChild(T.Qf)));return{id:ee,params:[ue]}}function ke(N,k){const ee=r.EF.LabelFormat,ue=k.getChild(T.gw),C=ue.nextSibling.nextSibling;return{id:ee,params:[(0,A.AA)(N,C),Ae((0,A.AA)(N,ue))]}}function $e(){return{id:r.EF.Decolorize,params:[]}}function ye(N,k,ee){const ue=k.getChild(T.HV),R=k.getChild(T.bY),C=k.getChild(T.sK);if(ue&&b(N,ue,ee),R&&b(N,R,ee),C){if(C.nextSibling?.type.id===T.yW){const K=C.nextSibling,z=K.nextSibling;return{operation:{id:r.EF.Unwrap,params:[(0,A.AA)(N,z),(0,A.AA)(N,K)]}}}return{operation:{id:r.EF.Unwrap,params:[(0,A.AA)(N,C?.nextSibling),""]}}}return{}}function We(N,k,ee){const ue=k.getChild(T.lo),R=(0,A.AA)(N,ue),C=k.getChild(T.wN),K=k.getChild(T.xo),z=C!=null?[(0,A.AA)(N,C)]:[],Q=K?.getChild(T.Q6),O=Q?(0,A.AA)(N,Q):null,v=k.getChild(T.aU);O&&z.unshift(O.substring(1,O.length-1)),v&&z.push(...(0,A.R1)(N,v,T.gw));const L={id:R,params:z};return K&&b(N,K,ee),L}function $(N,k,ee){const ue=k.getChild(T.ZQ);let R=(0,A.AA)(N,ue);const C=k.getChild(T.aU),K=[],z=k.getChild(T.wN);z&&K.push(Number((0,A.AA)(N,z))),C&&(C.getChild(T.By)&&R&&(R=`__${R}_by`),C.getChild(T.xB)&&(R=`__${R}_without`),K.push(...(0,A.R1)(N,C,T.gw)));const Q=k.getChild(T.Yw),O={id:R,params:K};return Q&&(Q.firstChild?.type.id===T.MK&&ee.errors.push({text:"Query parsing is ambiguous.",from:Q.firstChild.from,to:Q.firstChild?.to}),b(N,Q,ee)),O}const te=Re.C.reduce((N,k)=>(N[k.sign]={id:k.id,comparison:k.comparison},N),{});function be(N,k,ee){const ue=ee.query,R=k.firstChild,C=(0,A.AA)(N,R.nextSibling),K=Fe(N,k.getChild(T.o5)),z=k.lastChild,Q=te[C],O=B(R,"MetricExpr.LiteralExpr.Number"),v=B(z,"MetricExpr.LiteralExpr.Number"),L=z.getChild(T.MK);if(O||b(N,R,ee),v)ue.operations.push((0,A.rq)(Q,N,z,!!K?.isBool));else if(L){const I=(0,A.z9)(z);I?.type.id===T.wN&&ue.operations.push((0,A.rq)(Q,N,I,!!K?.isBool)),b(N,z,ee)}else{ue.binaryQueries=ue.binaryQueries||[];const I={operator:C,query:{labels:[],operations:[]}};K?.isMatcher&&(I.vectorMatchesType=K.matchType,I.vectorMatches=K.matches),ue.binaryQueries.push(I),b(N,z,{query:I.query,errors:ee.errors})}}function Fe(N,k){if(!k)return;const ee=k.getChild(T.wT),ue=k.getChild(T.x);if(!ee&&ue)return{isBool:!0,isMatcher:!1};{if(!ee)return;const R=(0,A.AA)(N,ee.getChild(T.x$)?.getChild(T.qJ));return{isMatcher:!0,isBool:!!ue,matches:R,matchType:ee.getChild(T.On)?"on":"ignoring"}}}function me(N){return N?.parent?.type.id===T.Q6}function Ae(N){return N[0]==='"'&&N[N.length-1]==='"'?N.substring(1,N.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):N.replace(/`/g,"")}function B(N,k){let ee=N;const ue=k.split(".");for(const R of ue)if(ee=ee.getChild(R),!ee)return null;return ee}function Te(N,k,ee){const ue=(0,A.xz)(N,k);return ue.text=`${ee}: ${ue.text}`,ue}function Qe(N){return N.labels.length===0&&N.operations.length===0}function Je(N,k,ee){const ue=[];let R=k.getChild(T.LQ);for(;R;){const C=(0,A.AA)(N,R.getChild(T.yj));C&&ue.push(C),R=R?.getChild(T.LQ)}return ue.reverse(),{id:r.EF.Drop,params:ue}}function He(N,k,ee){const ue=[];let R=k.getChild(T.J3);for(;R;){const C=(0,A.AA)(N,R.getChild(T.UM));C&&ue.push(C),R=R?.getChild(T.J3)}return ue.reverse(),{id:r.EF.Keep,params:ue}}},56245:(ot,Ue,l)=>{"use strict";l.d(Ue,{AA:()=>Oe,If:()=>b,Ql:()=>T,R1:()=>fe,SY:()=>A,qk:()=>r,rq:()=>W,xz:()=>D,z9:()=>Re});const T=0;function Re(q){return q.firstChild?Re(q.firstChild):q}function D(q,Le){return{text:Oe(q,Le),from:Le.from,to:Le.to,parentType:Le.parent?.name}}const A=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function r(q){return q.replace(A,(Le,S,ke,$e,ye,We,$)=>{const te=$e||$;let be=S,Fe="0";return ke&&(be=ke,Fe="1"),ye&&(be=ye,Fe="2"),`__V_${Fe}__`+be+"__V__"+(te?"__F__"+te+"__F__":"")})}const de=[(q,Le)=>`$${q}`,(q,Le)=>`[[${q}${Le?`:${Le}`:""}]]`,(q,Le)=>`\${${q}${Le?`:${Le}`:""}}`];function b(q){return q.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(Le,S,ke,$e)=>de[parseInt(S,10)](ke,$e))}function Oe(q,Le){return Le?b(q.substring(Le.from,Le.to)):""}function W(q,Le,S,ke){const $e=[parseFloat(Oe(Le,S))];return q.comparison&&$e.push(ke),{id:q.id,params:$e}}function fe(q,Le,S){if(Le.type.id===S||Le.name===S)return[Oe(q,Le)];const ke=[];let $e=0,ye=Le.childAfter($e);for(;ye;)ke.push(...fe(q,ye,S)),$e=ye.to,ye=Le.childAfter($e);return ke}const w=q=>q.split(" ").map(S=>`${S}.*`).join("")},54623:(ot,Ue,l)=>{"use strict";l.d(Ue,{EF:()=>A,IQ:()=>Re,Ln:()=>D,NS:()=>de,h5:()=>r});var T=l(42952),Re=(b=>(b.Log="log",b.Metric="metric",b))(Re||{}),D=(b=>(b.Aggregations="Aggregations",b.RangeFunctions="Range functions",b.Functions="Functions",b.Formats="Formats",b.LineFilters="Line filters",b.LabelFilters="Label filters",b[b.BinaryOps=T.T]="BinaryOps",b))(D||{}),A=(b=>(b.Json="json",b.Logfmt="logfmt",b.Regexp="regexp",b.Pattern="pattern",b.Unpack="unpack",b.LineFormat="line_format",b.LabelFormat="label_format",b.Decolorize="decolorize",b.Drop="drop",b.Keep="keep",b.Rate="rate",b.RateCounter="rate_counter",b.CountOverTime="count_over_time",b.SumOverTime="sum_over_time",b.AvgOverTime="avg_over_time",b.MaxOverTime="max_over_time",b.MinOverTime="min_over_time",b.FirstOverTime="first_over_time",b.LastOverTime="last_over_time",b.StdvarOverTime="stdvar_over_time",b.StddevOverTime="stddev_over_time",b.QuantileOverTime="quantile_over_time",b.BytesRate="bytes_rate",b.BytesOverTime="bytes_over_time",b.AbsentOverTime="absent_over_time",b.Sum="sum",b.Avg="avg",b.Min="min",b.Max="max",b.Stddev="stddev",b.Stdvar="stdvar",b.Count="count",b.TopK="topk",b.BottomK="bottomk",b.LineContains="__line_contains",b.LineContainsNot="__line_contains_not",b.LineContainsCaseInsensitive="__line_contains_case_insensitive",b.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",b.LineMatchesRegex="__line_matches_regex",b.LineMatchesRegexNot="__line_matches_regex_not",b.LineFilterIpMatches="__line_filter_ip_matches",b.LabelFilter="__label_filter",b.LabelFilterNoErrors="__label_filter_no_errors",b.LabelFilterIpMatches="__label_filter_ip_marches",b.Unwrap="unwrap",b.SumBy="__sum_by",b.SumWithout="__sum_without",b.Addition="__addition",b.Subtraction="__subtraction",b.MultiplyBy="__multiply_by",b.DivideBy="__divide_by",b.Modulo="__modulo",b.Exponent="__exponent",b.NestedQuery="__nested_query",b.EqualTo="__equal_to",b.NotEqualTo="__not_equal_to",b.GreaterThan="__greater_than",b.LessThan="__less_than",b.GreaterOrEqual="__greater_or_equal",b.LessOrEqual="__less_or_equal",b))(A||{}),r=(b=>(b[b.LineFilters=1]="LineFilters",b[b.Parsers=2]="Parsers",b[b.PipeOperations=3]="PipeOperations",b[b.Unwrap=4]="Unwrap",b[b.NoErrors=5]="NoErrors",b[b.RangeVectorFunction=5]="RangeVectorFunction",b[b.Last=6]="Last",b))(r||{});const de={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},75723:(ot,Ue,l)=>{"use strict";l.d(Ue,{Ac:()=>fe,nE:()=>W,db:()=>S,fV:()=>q,sz:()=>ke,YB:()=>w,aN:()=>Le});var T=l(11261),Re=l(70416),D=l(97535);function A($e){let ye;try{ye=JSON.parse($e)}catch{}return typeof ye=="object"}const r=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function de($e){return r.test($e)}function b($e){let ye;try{return ye=JSON.parse($e),ye.hasOwnProperty("_entry")}catch{return!1}}var Oe=l(65650);function W($e){return($e.fields.find(We=>We.name==="labels")?.values??[]).some(We=>We.__error__!==void 0)}function fe($e){return($e.fields.find(We=>We.name==="labels")?.values??[]).some(We=>We.level!==void 0)}function w($e){const ye=$e.fields.find(Fe=>Fe.type===T.PU.string);if(ye==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const We=ye.values;let $=!1,te=!1,be=!1;return We.forEach(Fe=>{A(Fe)&&($=!0,be=b(Fe)),de(Fe)&&(te=!0)}),{hasLogfmt:te,hasJSON:$,hasPack:be}}function q($e,ye=Oe.HD.Indexed){const We=$e?.fields?.find(be=>be.name==="labels")?.values??[],$=$e?.fields?.find(be=>be.name==="labelTypes")?.values??[];if(!We?.length)return[];if(!$?.length){if(ye===Oe.HD.Indexed){const{keys:be}=(0,D.P7)(We);return be}return[]}let te=new Set;for(let be=0;be<We.length;be++){const Fe=We[be],me=$[be],Ae=Object.keys(Fe).filter(B=>me[B]===ye);te=new Set([...te,...Ae])}return Array.from(te)}function Le($e){const ye=$e?.fields?.find($=>$.name==="labels")?.values??[];return ye?.length?Object.keys(ye[0]).filter($=>{const te=ye[0][$];return te?!isNaN(Number(te))||(0,Re.pp)(te)||(0,D.tY)(te):!1}).filter($=>ye.every(te=>te[$])):[]}function S($e){const ye=$e.fields.find($=>$.name==="labels"&&$.type===T.PU.other);return ye==null?!1:ye.values.some($=>$.__error__)}function ke($e){const ye=$e.fields.find(te=>te.name==="labels"&&te.type===T.PU.other);if(ye==null)return null;const We=ye.values.slice(0,2);let $=null;for(let te of We){const be=Object.keys(te).find(Fe=>Fe==="lvl"||Fe.includes("level"));if(be){$=be;break}}return $}},79007:(ot,Ue,l)=>{"use strict";l.d(Ue,{Ex:()=>ye,jg:()=>fe,uJ:()=>We});var T=l(41987),Re=l(42952),D=l(14110),A=l(32264),r=l(27724),de=l(51814),b=l(56587),Oe=l(56245),W=l(65650);const fe=({payload:{dashboardId:$,orgId:te,grafanaVersion:be,queries:Fe}})=>{try{const me=Fe[de.id]?.filter(C=>!C.hide)?.map(C=>(0,b.vV)(C));if(!me?.length)return;const Ae=me.filter(C=>(0,b.sI)(C.expr)),B=me.filter(C=>!(0,b.sI)(C.expr)),Te=me.filter(C=>C.queryType===W.U3.Instant),Qe=me.filter(C=>C.queryType===W.U3.Range),Je=me.filter(C=>C.editorMode===Re.f.Builder),He=me.filter(C=>C.editorMode===Re.f.Code),N=me.filter(w),k=me.filter(q),ee=me.filter(Le),ue=me.filter(S),R={grafana_version:be,dashboard_id:$,org_id:te,queries_count:me.length,logs_queries_count:Ae.length,metric_queries_count:B.length,instant_queries_count:Te.length,range_queries_count:Qe.length,builder_mode_queries_count:Je.length,code_mode_queries_count:He.length,queries_with_template_variables_count:N.length,queries_with_changed_resolution_count:k.length,queries_with_changed_line_limit_count:ee.length,queries_with_changed_legend_count:ue.length};(0,D.rR)("grafana_loki_dashboard_loaded",R)}catch(me){console.error("error in loki tracking handler",me)}},w=$=>Oe.SY.test($.expr),q=$=>$.resolution?$.resolution!==1:!1,Le=$=>$.maxLines!==null&&$.maxLines!==void 0,S=$=>$.legendFormat?$.legendFormat!=="":!1,ke=$=>!![r.Gf,r.M1,r.mL,r.ow,r.lb].some(be=>$.startsWith(be)),$e=$=>{let te=0;for(const be of $.data){const Fe=be.meta?.custom?.lokiQueryStatKey;Fe&&(te+=be.meta?.stats?.find(me=>me.displayName===Fe)?.value??0)}return te};function ye($,te,be,Fe={},me={}){const{app:Ae,targets:B}=te;if(Ae!==T.Jk.Explore)return;let Te=$e($);for(const Qe of B){if(ke(Qe.refId))return;(0,D.rR)("grafana_explore_loki_query_executed",{grafana_version:A.$.buildInfo.version,editor_mode:Qe.editorMode,has_data:$.data.some(Je=>Je.length>0),has_error:$.error!==void 0,legend:Qe.legendFormat,line_limit:Qe.maxLines,obfuscated_query:(0,b.$F)(Qe.expr),query_type:(0,b.sI)(Qe.expr)?"logs":"metric",query_vector_type:Qe.queryType,resolution:Qe.resolution,simultaneously_executed_query_count:B.filter(Je=>!Je.hide).length,simultaneously_hidden_query_count:B.filter(Je=>Je.hide).length,time_range_from:te?.range?.from?.toISOString(),time_range_to:te?.range?.to?.toISOString(),time_taken:Date.now()-be.getTime(),bytes_processed:Te,is_split:!1,predefined_operations_applied:Fe.predefinedOperations?Qe.expr.includes(Fe.predefinedOperations):"n/a",...me})}}function We($,te,be,Fe,me={}){const Ae={split_query_group_count:te.length,split_query_largest_partition_size:Math.max(...te.map(({partition:B})=>B.length)),split_query_total_request_count:te.reduce((B,{partition:Te})=>B+Te.length,0),is_split:!0,simultaneously_executed_query_count:be.targets.filter(B=>!B.hide).length,simultaneously_hidden_query_count:be.targets.filter(B=>B.hide).length};for(const B of te){const Te=B.partition.length;ye($,B.request,Fe,me,{...Ae,split_query_partition_size:Te})}}},30115:ot=>{var Ue=typeof Element<"u",l=typeof Map=="function",T=typeof Set=="function",Re=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function D(A,r){if(A===r)return!0;if(A&&r&&typeof A=="object"&&typeof r=="object"){if(A.constructor!==r.constructor)return!1;var de,b,Oe;if(Array.isArray(A)){if(de=A.length,de!=r.length)return!1;for(b=de;b--!==0;)if(!D(A[b],r[b]))return!1;return!0}var W;if(l&&A instanceof Map&&r instanceof Map){if(A.size!==r.size)return!1;for(W=A.entries();!(b=W.next()).done;)if(!r.has(b.value[0]))return!1;for(W=A.entries();!(b=W.next()).done;)if(!D(b.value[1],r.get(b.value[0])))return!1;return!0}if(T&&A instanceof Set&&r instanceof Set){if(A.size!==r.size)return!1;for(W=A.entries();!(b=W.next()).done;)if(!r.has(b.value[0]))return!1;return!0}if(Re&&ArrayBuffer.isView(A)&&ArrayBuffer.isView(r)){if(de=A.length,de!=r.length)return!1;for(b=de;b--!==0;)if(A[b]!==r[b])return!1;return!0}if(A.constructor===RegExp)return A.source===r.source&&A.flags===r.flags;if(A.valueOf!==Object.prototype.valueOf)return A.valueOf()===r.valueOf();if(A.toString!==Object.prototype.toString)return A.toString()===r.toString();if(Oe=Object.keys(A),de=Oe.length,de!==Object.keys(r).length)return!1;for(b=de;b--!==0;)if(!Object.prototype.hasOwnProperty.call(r,Oe[b]))return!1;if(Ue&&A instanceof Element)return!1;for(b=de;b--!==0;)if(!((Oe[b]==="_owner"||Oe[b]==="__v"||Oe[b]==="__o")&&A.$$typeof)&&!D(A[Oe[b]],r[Oe[b]]))return!1;return!0}return A!==A&&r!==r}ot.exports=function(r,de){try{return D(r,de)}catch(b){if((b.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw b}}},8227:(ot,Ue,l)=>{"use strict";l.d(Ue,{A:()=>D});const T=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Re(A){return typeof A=="string"&&T.test(A)}const D=Re},36195:(ot,Ue,l)=>{"use strict";l.d(Ue,{AL:()=>rr,By:()=>_r,CX:()=>Qr,GA:()=>It,GN:()=>Ee,Gn:()=>Rt,HV:()=>yr,I4:()=>pt,Ip:()=>kr,J3:()=>xt,J_:()=>Xt,Jq:()=>nr,K0:()=>bt,K3:()=>U,KD:()=>va,LM:()=>pe,LQ:()=>Qa,MD:()=>tr,MK:()=>Kr,Nl:()=>Pt,On:()=>Br,Or:()=>Oa,PN:()=>_t,Q6:()=>Or,Qf:()=>ft,Rh:()=>zr,Sg:()=>xa,Tz:()=>Et,UK:()=>$r,UM:()=>vt,UP:()=>ht,Yw:()=>nt,ZQ:()=>or,Zg:()=>ha,Zj:()=>Ge,aU:()=>Ht,bY:()=>Nt,c$:()=>Pe,dJ:()=>jt,dw:()=>pr,eF:()=>ar,e_:()=>sr,g$:()=>Tt,gw:()=>gt,h1:()=>hr,i8:()=>sa,iT:()=>Qt,ih:()=>aa,lo:()=>Kt,o5:()=>Ma,ov:()=>La,pH:()=>zt,q5:()=>fr,qJ:()=>Er,sK:()=>dt,sq:()=>Ea,t3:()=>ta,uk:()=>ba,w7:()=>ra,wN:()=>Ct,wT:()=>Lt,x:()=>Ur,x$:()=>br,xB:()=>Wr,xo:()=>Ar,yW:()=>Mr,yj:()=>gr});var T=l(48820);const Re=1,D=2,A=3,r=4,de=5,b=6,Oe=7,W=8,fe=9,w=10,q=11,Le=12,S=13,ke=14,$e=15,ye=16,We=17,$=18,te=19,be=20,Fe=21,me=22,Ae=23,B=24,Te=25,Qe=26,Je=27,He=28,N=29,k=30,ee=31,ue=32,R=33,C=34,K=35,z=96,Q={json:Re,logfmt:D,unpack:A,pattern:r,regexp:de,label_format:Oe,line_format:W,label_replace:fe,vector:w,offset:q,bool:Le,on:S,ignoring:ke,group_left:$e,group_right:ye,unwrap:b,decolorize:We,drop:$,keep:te},O=V=>Q[V.toLowerCase()]||-1,v={by:be,without:Fe,and:me,or:Ae,unless:B,sum:Te,avg:Qe,count:Je,max:He,min:N,stddev:k,stdvar:ee,bottomk:ue,topk:R,sort:C,sort_desc:K},L=V=>v[V.toLowerCase()]||-1,I={__proto__:null,ip:291,count_over_time:297,rate:299,rate_counter:301,bytes_over_time:303,bytes_rate:305,avg_over_time:307,sum_over_time:309,min_over_time:311,max_over_time:313,stddev_over_time:315,stdvar_over_time:317,quantile_over_time:319,first_over_time:321,last_over_time:323,absent_over_time:325,bytes:331,duration:333,duration_seconds:335},U=T.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#EP'#EPO#hQPO'#EPO$wQPO'#DTOYQPO'#DTOOQO'#Eb'#EbO%UQPO'#EaOOQO'#E}'#E}O%ZQPO'#E|Q%fQPOOO&gQPO'#FZO&lQPO'#F[OOQO'#E`'#E`OOQO'#DS'#DSOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqO&qQPO'#DWOOQO'#DV'#DVO'PQPO,59pOOQO,5:k,5:kOOQO'#Dc'#DcO'XQPO'#DbO'aQPO'#DaO(zQPO'#D`O*eQPO'#D`OOQO'#D_'#D_O,gQPO,59oO-uQPO,59oO-|QPO,5:zO.TQPO,5:{O.`QPO'#EzO0kQPO,5;hO0rQPO,5;hO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jOYQPO,5;uO3ZQPO,5;vO3`QPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Df'#DfO3eQPO,59|O5OQPO,59|OOQO'#Dg'#DgO5TQPO,59{OOQO,59{,59{O5]QPO'#DWO5zQPO'#DjO7kQPO'#DmO9XQPO'#DmOOQO'#Dm'#DmOOQO'#Dt'#DtOOQO'#Dr'#DrO+TQPO'#DrO9^QPO,59zO:wQPO'#ETO:|QPO'#EUOOQO'#EX'#EXO;RQPO'#EYO;WQPO'#E]OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0f1G0fO;]QPO'#ErO.WQPO'#ErO;qQPO1G0gO;vQPO1G0gO;{QPO,5;fO=XQPO1G1SO=`QPO1G1SO=gQPO1G1SO=nQPO'#FQO?|QPO'#FPO@WQPO'#FPOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UO@bQPO1G1aO@iQPO1G1bOOQO1G/^1G/^OOQO1G/]1G/]O5TQPO1G/hO@nQPO1G/hO@sQPO'#DhOB^QPO'#DhOOQO1G/g1G/gOBtQPO,59rOBcQPO,5:aOOQO'#Dk'#DkOCOQPO,5:UODoQPO'#DpOOQO'#Do'#DoOF]QPO,5:]OGvQPO,5:YOOQO,5:X,5:XOIaQPO,5:^O+TQPO,5:^O+TQPO,5:^OOQO,5:o,5:oOIoQPO'#EWOOQO'#EV'#EVOItQPO,5:pOK_QPO'#E[OOQO'#E['#E[OOQO'#EZ'#EZOMOQPO,5:tONiQPO'#E_OOQO'#E_'#E_OOQO'#E^'#E^O!!YQPO,5:wO!#sQPO'#D`O;]QPO,5;^O!#zQPO'#EsO!$PQPO,5;^O!$jQPO,5;^O!$tQPO,5;^O!${QPO,5;^O!%QQPO7+&RO.WQPO7+&ROOQO'#E{'#E{O!&bQPO1G1QOOQO1G1Q1G1QOYQPO7+&nO!&jQPO7+&nO!'zQPO7+&nO!(RQPO7+&nO!(YQQO'#FROOQO,5;l,5;lO!*hQPO,5;kO!*oQPO,5;kO!,QQPO7+&pO!,XQPO7+&pOOQO7+&p7+&pO!,fQPO7+&pO!,mQPO7+&pO!-rQPO7+&pO!.SQPO7+&{OOQO7+&|7+&|OOQO7+%S7+%SO!.XQPO7+%SO5TQPO,5:SO!.^QPO,5:SO!.cQPO1G/yOOQO1G/{1G/{OOQO1G0S1G0SOOQO1G0U1G0UOOQO,5:V,5:VO!.hQPO1G/wO!0RQPO,5:[O!0WQPO,5:ZOOQO1G/x1G/xO!0]QPO1G/xO!1vQPO,5:rO:|QPO,5:qO;RQPO,5:uO;WQPO,5:xO!2OQPO,5;aO!$PQPO1G0xO!2^QPO1G0xO!2fQPO,5;_O+TQPO,5;aO!2kQPO1G0xO!2rQPO'#EtO!2wQPO1G0xO!2kQPO1G0xO!3PQPO1G0xO!3WQPO1G0xO;lQPO1G0xOOQO1G0x1G0xOOQO<<Im<<ImO!3cQPO<<ImO!3hQPO,5;gOOQO7+&l7+&lO!3mQPO<<JYOOQO<<JY<<JYOYQPO<<JYOOQO'#FT'#FTO!3tQPO,5;mOOQO'#FS'#FSOOQO,5;m,5;mOOQO1G1V1G1VO!3|QPO1G1VO!6VQPO<<JgOOQO<<Hn<<HnOOQO1G/n1G/nO!6[QPO1G/nO!6aQPO7+%eOOQO1G/v1G/vOOQO1G/u1G/uOOQO1G0^1G0^OOQO1G0]1G0]OOQO1G0a1G0aOOQO1G0d1G0dOOQO'#Ev'#EvOOQO1G0{1G0{O!6fQPO1G0{OOQO'#Ew'#EwOOQO'#Ex'#ExOOQO'#Ey'#EyOOQO7+&d7+&dOOQO1G0y1G0yO!6kQPO1G0{O!7PQPO7+&dOOQO,5;`,5;`O!7XQPO7+&dO;lQPO7+&dO!7`QPO7+&dO!7kQPOAN?XOOQO1G1R1G1RO!8{QPOAN?tO!:]QPOAN?tO!:dQQO1G1XOOQO1G1X1G1XOOQO7+&q7+&qO!:lQPOAN@ROOQO7+%Y7+%YO!:qQPO<<IPO!:vQPO7+&gO!:{QPO<<JOO!;TQPO<<JOO!;]QPO'#EuO!;bQPO<<JOOOQOG24sG24sOOQOG25`G25`OOQO1G1Y1G1YOOQO7+&s7+&sO!;jQPOG25mOOQOAN>kAN>kO!;oQPO<<JROOQOAN?jAN?jO!;tQPOAN?jO!;|QPOLD+XOOQOAN?mAN?mOOQO,5:p,5:pO!<RQPO!$'NsO!<WQPO!)9D_O!<]QPO!.K9yOOQO!4//e!4//eO:|QPO'#EUO!<bQPO'#D`O!=YQPO,59oO!=dQPO'#DTOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UOYQPO1G1UO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO0wQPO,5;jO!>oQPO7+&pO!>vQPO7+&pO!?TQPO7+&pO!@]QPO7+&pO!@dQPO7+&pO!?[QPO'#FO",stateData:"!@q~O$ROStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!tQO!uRO!vRO$SPO$WTO$Y_O$Z`O$[aO$]bO$^cO$_dO$`eO$afO$bgO$chO$diO$ejO$fkO$glO$hmO~O{nO~O!tqO~O!OrO!QrO!WrO!XrOfwXgwXhwX!jwX!lwX!mwX!nwX!owX!uwX!vwX#ywX#zwX#{wX#|wX~O!]vO$PwX$XwX~P#mO$W{O~Od|Oe|O$W}O~Of!QOg!POh!QO!O!UO!j!UO!l!UO!m!UO!n!UO!o!UO!u!RO!v!RO#y!SO#z!SO#{!SO#|!TO~O$W!VO~O$W!WO~O|!XO!O!XO!P!XO!Q!XO~O$T!YO$U!ZO~O}!]O$V!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!]!TX!j!TX!l!TX!m!TX!n!TX!o!TX!u!TX!v!TX#y!TX#z!TX#{!TX#|!TX$P!TX$X!TX$i!TX$T!TX~O!OrO!QrO!WrO!XrOf!SXg!SXh!SX!]!SX!j!SX!l!SX!m!SX!n!SX!o!SX!u!SX!v!SX#y!SX#z!SX#{!SX#|!SX$P!SX$X!SX$i!SX$T!SX~OP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$W!iO~O!OrO!QrO!WrO!XrOfwagwahwa!jwa!lwa!mwa!nwa!owa!uwa!vwa#ywa#zwa#{wa#|wa~O!]vO$Pwa$Xwa~P+]OfvXgvXhvX!OvX!jvX!lvX!mvX!nvX!ovX!uvX!vvX#yvX#zvX#{vX#|vX~O$X!rO~P,tO$X!sO~P,tO!t!wO$SPO$W!uO~O$W!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!uRO!vRO$SPO$WTO$Y_O$Z`O$[aO$]bO$^cO$_dO$`eO$afO$bgO$chO$diO$ejO$fkO$glO$hmO~O!t!yO~P.eO$W!{O~O[#OO]!|O^!|OX#sPY#sPi#sPj#sPk#sPl#sPm#sPn#sPo#sPp#sPq#sPr#sPs#sP!t#sP!u#sP!v#sP$S#sP$W#sP$Y#sP$Z#sP$[#sP$]#sP$^#sP$_#sP$`#sP$a#sP$b#sP$c#sP$d#sP$e#sP$f#sP$g#sP$h#sP~O!t#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!]!Ua!j!Ua!l!Ua!m!Ua!n!Ua!o!Ua!u!Ua!v!Ua#y!Ua#z!Ua#{!Ua#|!Ua$P!Ua$X!Ua$i!Ua$T!Ua~O$W#[O~O}#]O$V!_O~O|#`O!O#`O!P!XO!Q!XO!j#aO!l#aO!m#aO!n#aO!o#aO~O{#dO!`#bOf!^Xg!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!]!^X!j!^X!l!^X!m!^X!n!^X!o!^X!u!^X!v!^X#y!^X#z!^X#{!^X#|!^X$P!^X$X!^X$i!^X$T!^X~O{#dOf!aXg!aXh!aX!O!aX!Q!aX!W!aX!X!aX!]!aX!j!aX!l!aX!m!aX!n!aX!o!aX!u!aX!v!aX#y!aX#z!aX#{!aX#|!aX$P!aX$X!aX$i!aX$T!aX~O}#hO~Of#jOg#kO$T#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!]!Sa!j!Sa!l!Sa!m!Sa!n!Sa!o!Sa!u!Sa!v!Sa#y!Sa#z!Sa#{!Sa#|!Sa$P!Sa$X!Sa$i!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!OrO!QrO!WrO!XrO!]#xO$i#zO~O$X$PO~O$T$QO~O{$RO$X$TO~Of!sXg!sXh!sX!O!sX!j!sX!l!sX!m!sX!n!sX!o!sX!u!sX!v!sX#y!sX#z!sX#{!sX#|!sX$X!sX~O$T$UO~P<TO$X$VO~P,tO!t$WO~P.eO$W$YO~OX#sXY#sXi#sXj#sXk#sXl#sXm#sXn#sXo#sXp#sXq#sXr#sXs#sX!t#sX!u#sX!v#sX$S#sX$W#sX$Y#sX$Z#sX$[#sX$]#sX$^#sX$_#sX$`#sX$a#sX$b#sX$c#sX$d#sX$e#sX$f#sX$g#sX$h#sX~O_$[O`$[O~P=sO]!|O^!|O~P=sO$T$dO~P,tO$X$eO~O}$gO~Og$hOf![Xh![X!O![X!Q![X!W![X!X![X!]![X!j![X!l![X!m![X!n![X!o![X!u![X!v![X#y![X#z![X#{![X#|![X$P![X$X![X$i![X$T![X~O$W$iO~O!k$kO!q$lO!tQO!uRO!vRO~O}#XO$V!_O~PBcO{#dO!`$nOf!^ag!^ah!^a!O!^a!Q!^a!W!^a!X!^a!]!^a!j!^a!l!^a!m!^a!n!^a!o!^a!u!^a!v!^a#y!^a#z!^a#{!^a#|!^a$P!^a$X!^a$i!^a$T!^a~O|$pOf!dXg!dXh!dX!O!dX!Q!dX!W!dX!X!dX!]!dX!j!dX!l!dX!m!dX!n!dX!o!dX!u!dX!v!dX#y!dX#z!dX#{!dX#|!dX$P!dX$T!dX$X!dX$i!dX~O$T$qOf!eag!eah!ea!O!ea!Q!ea!W!ea!X!ea!]!ea!j!ea!l!ea!m!ea!n!ea!o!ea!u!ea!v!ea#y!ea#z!ea#{!ea#|!ea$P!ea$X!ea$i!ea~O$T$qOf!bag!bah!ba!O!ba!Q!ba!W!ba!X!ba!]!ba!j!ba!l!ba!m!ba!n!ba!o!ba!u!ba!v!ba#y!ba#z!ba#{!ba#|!ba$P!ba$X!ba$i!ba~Of#jOg#kO$T#jO$X$rO~O|$tO~O$T$uOf!xag!xah!xa!O!xa!Q!xa!W!xa!X!xa!]!xa!j!xa!l!xa!m!xa!n!xa!o!xa!u!xa!v!xa#y!xa#z!xa#{!xa#|!xa$P!xa$X!xa$i!xa~O|!XO!O!XO!P!XO!Q!XOf#OXg#OXh#OX!W#OX!X#OX!]#OX!j#OX!l#OX!m#OX!n#OX!o#OX!u#OX!v#OX#y#OX#z#OX#{#OX#|#OX$P#OX$T#OX$X#OX$i#OX~O$T$vOf!|ag!|ah!|a!O!|a!Q!|a!W!|a!X!|a!]!|a!j!|a!l!|a!m!|a!n!|a!o!|a!u!|a!v!|a#y!|a#z!|a#{!|a#|!|a$P!|a$X!|a$i!|a~O|!XO!O!XO!P!XO!Q!XOf#RXg#RXh#RX!W#RX!X#RX!]#RX!j#RX!l#RX!m#RX!n#RX!o#RX!u#RX!v#RX#y#RX#z#RX#{#RX#|#RX$P#RX$T#RX$X#RX$i#RX~O$T$wOf#Pag#Pah#Pa!O#Pa!Q#Pa!W#Pa!X#Pa!]#Pa!j#Pa!l#Pa!m#Pa!n#Pa!o#Pa!u#Pa!v#Pa#y#Pa#z#Pa#{#Pa#|#Pa$P#Pa$X#Pa$i#Pa~OU$xO~P*eO!k${O~O!]$|O$i#zO~O!OrO!QrO!WrO!XrO!]#xO~OZ%OO$X#fa~P!$XO$X%TO~P;]O$X%UO~Od|Oe|Of#Tqg#Tqh#Tq!O#Tq!j#Tq!l#Tq!m#Tq!n#Tq!o#Tq!u#Tq!v#Tq#y#Tq#z#Tq#{#Tq#|#Tq$P#Tq$X#Tq$T#Tq~O$T%XO$X%YO~Od|Oe|Of#pqg#pqh#pq!O#pq!j#pq!l#pq!m#pq!n#pq!o#pq!u#pq!v#pq#y#pq#z#pq#{#pq#|#pq$P#pq$X#pq$T#pq~O$T%]O~P<TO$X%[O~P,tO#x%^O$X%aO~OX#saY#sai#saj#sak#sal#sam#san#sao#sap#saq#sar#sas#sa!t#sa!u#sa!v#sa$S#sa$Y#sa$Z#sa$[#sa$]#sa$^#sa$_#sa$`#sa$a#sa$b#sa$c#sa$d#sa$e#sa$f#sa$g#sa$h#sa~O$W$YO~P!(bO_%cO`%cO$W#sa~P!(bOf!QOh!QO!O!UO!j!UO!l!UO!m!UO!n!UO!o!UO!u!RO!v!RO#y#rq#z#rq#{#rq#|#rq$P#rq$X#rq~Og#rq~P!*|Of#rqg#rqh#rq~P!+SOg!PO~P!*|O$P#rq$X#rq~P%fOf#rqg#rqh#rq!O#rq!j#rq!l#rq!m#rq!n#rq!o#rq#y#rq#z#rq#{#rq#|#rq~O!u!RO!v!RO$P#rq$X#rq~P!,wO}%dO~O$X%eO~O}%gO~O$W%hO~O$T$qOf!eig!eih!ei!O!ei!Q!ei!W!ei!X!ei!]!ei!j!ei!l!ei!m!ei!n!ei!o!ei!u!ei!v!ei#y!ei#z!ei#{!ei#|!ei$P!ei$X!ei$i!ei~O}%iO~O{#dO~Of#jO$T#jOg!fih!fi!O!fi!Q!fi!W!fi!X!fi!]!fi!j!fi!l!fi!m!fi!n!fi!o!fi!u!fi!v!fi#y!fi#z!fi#{!fi#|!fi$P!fi$X!fi$i!fi~O{%kO}%kO~O{%pO$k%rO$l%sO$m%tO~OZ%OO$X#fi~O$j%vO~O$X#fi~P!$XO!k%yO~O!]$|O$X#fi~O$X%{O~P;]O!]$|O$X%{O$i#zO~O$X%}O~O{&OO~O$X&PO~P,tO$T&RO$X&SO~O$W$YOX#siY#sii#sij#sik#sil#sim#sin#sio#sip#siq#sir#sis#si!t#si!u#si!v#si$S#si$Y#si$Z#si$[#si$]#si$^#si$_#si$`#si$a#si$b#si$c#si$d#si$e#si$f#si$g#si$h#si~O$T&UO~O$X&VO~O}&WO~O$W&XO~Of#jOg#kO$T#jO!]#ii$i#ii$X#ii~O!]$|O$X#fq~O$X#fq~P!$XOZ%OO!]&[O$X#fq~Od|Oe|Of#T!Rg#T!Rh#T!R!O#T!R!j#T!R!l#T!R!m#T!R!n#T!R!o#T!R!u#T!R!v#T!R#y#T!R#z#T!R#{#T!R#|#T!R$P#T!R$X#T!R$T#T!R~Od|Oe|Of#p!Rg#p!Rh#p!R!O#p!R!j#p!R!l#p!R!m#p!R!n#p!R!o#p!R!u#p!R!v#p!R#y#p!R#z#p!R#{#p!R#|#p!R$P#p!R$X#p!R$T#p!R~O$X&_O~P,tO#x%^O$X&aO~O}&bO~O$X&cO~O{&dO~O!]$|O$X#fy~OZ%OO$X#fy~OU$xO~O!]&[O$X#fy~O$T&gO~O$X&hO~O!]$|O$X#f!R~O}&jO~O$T&kO~O}&lO~O$X&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$W!iO~O!]&oO$Twa~P+]O!]&oO$TwX~P#mOf&yOh&yO!O&}O!j&}O!l&}O!m&}O!n&}O!o&}O!u&zO!v&zO#y#rq#z#rq#{#rq#|#rq$T#rq~Og#rq~P!=nOf#rqg#rqh#rq~P!=tOg&xO~P!=nOf&yOg&xOh&yO!O&}O!j&}O!l&}O!m&}O!n&}O!o&}O!u&zO!v&zO#y&{O#z&{O#{&{O#|&|O~O$T#rq~P!?[O!u&zO!v&zO$T#rq~P!,wO",goto:"1j$PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$Q%P%h&W&ZPPPPPP&r'U'f't(VPP(f(n(wP)Q)VP)Q)Q)Y)c)Q)k)|)|*VPPPPPP*VP)|*`PPP)Q)Q*y+P)Q)Q+W+Z)Q+a+d+j,],r-X-X-X-X-X-X-X-X-X-X-X-X-X-X-X-n-w.[.h/Q/T/T/T/W/g,]/j,]0P0u1W1a1dPPPPP,],][YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:167,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"5b~RvX^#ipq#iqr$^rs$qst%cuv%nxy%syz%xz{%}{|&S|}&X}!O&^!O!P(l!P!Q)l!Q!R)q!R![+X![!]2X!^!_2m!_!`2z!`!a3a!c!}3n!}#O4U#P#Q4Z#Q#R4`#R#S3n#S#T4e#T#o3n#o#p4q#p#q4v#q#r5]#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$R~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aQ!_!`$g#r#s$l~$lO!O~~$qO!Q~~$tUOY$qZr$qrs%Ws#O$q#O#P%]#P~$q~%]O}~~%`PO~$q~%hQt~OY%cZ~%c~%sO#{~~%xO$W~~%}O$X~~&SO#y~~&XO!u~~&^O$T~~&cP!v~}!O&f~&iQ#_#`&o#g#h'|~&rP#X#Y&u~&xP#X#Y&{~'OP#d#e'R~'UP}!O'X~'[P#X#Y'_~'bP#a#b'e~'hP#d#e'k~'nP#h#i'q~'tP#m#n'w~'|O!`~~(PP#h#i(S~(VP#f#g(Y~(]P#]#^(`~(cP#V#W(f~(iP#h#i'w~(oP!Q![(r~(wR!t~!Q![(r!g!h)Q#X#Y)Q~)TR{|)^}!O)^!Q![)d~)aP!Q![)d~)iP!t~!Q![)d~)qO#z~~)ve!t~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#l#m1m#m#n1O~+^d!t~!O!P(r!Q![+X!g!h,l!i!j-Z!m!n-Z!o!p-Z!r!s-Z!v!w-Z#U#V-O#W#X-d#X#Y/f#Z#[/x#[#]-{#_#`/x#a#b0R#d#e/x#g#h/T#h#i/x#k#l0d#m#n1O~,oT{|)^}!O)^!Q![)d!d!e-O#]#^-T~-TO!q~~-WP#U#V-O~-^Q!d!e-O#]#^-T~-iP!k~!Q![-l~-oS!Q![-l#[#]-{#a#b.a#g#h/T~.QP!k~!Q![.T~.WR!Q![.T#a#b.a#g#h/T~.fQ!k~!Q![.l#g#h/O~.oR!Q![.l#a#b.x#g#h/T~.{P#g#h/O~/TO!k~~/YP!k~!Q![/]~/`Q!Q![/]#a#b.x~/iT{|)^}!O)^!Q![)d#U#V-O#]#^-T~/{Q#U#V-O#]#^-T~0WS!k~!Q![.l#U#V-O#]#^-T#g#h/O~0iP!k~!Q![0l~0oT!Q![0l#W#X-d#[#]-{#a#b.a#g#h/T~1TP!k~!Q![1W~1ZU!Q![1W#W#X-d#[#]-{#a#b.a#g#h/T#k#l0d~1pR!Q![1y!c!i1y#T#Z1y~2OR!t~!Q![1y!c!i1y#T#Z1yP2^T{P!Q![2X![!]2X!c!}2X#R#S2X#T#o2X~2rP!m~!_!`2u~2zO!n~~3PQ|~!_!`3V#r#s3[~3[O!o~~3aO!P~~3fP!j~!_!`3i~3nO!l~R3uT{P#xQ!Q![3n![!]2X!c!}3n#R#S3n#T#o3n~4ZO$i~~4`O$j~~4eO#|~~4hRO#S4e#S#T%W#T~4e~4vO$S~~4{Q!]~!_!`5R#r#s5W~5WO!W~~5]O!X~~5bO$U~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(V,H)=>O(V)<<1},{term:43,get:(V,H)=>L(V)<<1|1},{term:43,get:V=>I[V]||-1}],tokenPrec:0}),pe=1,Pe=2,Ie=3,je=4,it=5,dt=6,Mt=7,$t=8,Vt=9,Jt=10,ur=11,Ur=12,Br=13,Ba=14,Zr=15,lt=16,ha=17,_a=18,Wa=19,_r=20,Wr=21,va=22,Oa=23,Ot=24,Zt=25,qr=26,ea=27,dr=28,ka=29,Va=30,ya=31,qt=32,er=33,Bt=34,yt=35,ba=36,bt=37,Ee=38,$r=39,tr=40,Ea=41,Tt=42,gt=43,Tr=44,ft=45,ja=46,za=47,Pa=48,rr=49,ta=50,Qr=51,_t=52,jt=53,xa=54,fr=55,ra=56,kr=57,aa=58,Ka=59,Ge=60,Vr=61,La=62,Qt=63,ar=64,pt=65,Rt=66,Et=67,Nt=68,It=69,nr=70,Ft=71,jr=72,pr=73,mr=74,na=75,Ha=76,Ga=77,wt=78,Wt=79,Rr=80,Pt=81,Ct=82,Sa=83,$a=84,zt=85,Xt=86,Ta=87,sr=88,wr=89,sa=90,Qa=91,gr=92,ht=93,xt=94,vt=95,nt=96,hr=97,Kt=98,vr=99,ir=100,Ya=101,ia=102,Fr=103,Ja=104,Cr=105,Ra=106,Za=107,qa=108,wa=109,Fa=110,en=111,tn=112,Ca=113,Ar=114,Or=115,Dr=116,yr=117,Mr=118,Aa=119,rn=120,Da=121,Ht=122,an=123,zr=124,or=125,Kr=126,Ma=127,Lt=128,br=129,Er=130,oa=131,la=132,Na=133,Ia=134,nn=135,ca=136,Pr=137,ua=138;function Gt(V,H){const ne=[];return U.parse(V).iterate({enter:_=>{(H===void 0||H===_.type.id)&&ne.push(_.node)}}),ne[0]}function da(V){return!Gt(V,z)}function m(V){return"  ".repeat(V)}function n(V,H){return V.split(`
`).map(re=>m(H)+re).join(`
`)}function a(V){return V.split(`
`).map(ne=>ne.trimEnd()).join(`
`)}function i(V,H){const ne=V.firstChild?.type.id===H;let re=!1;return V.firstChild&&ne&&(re=!0,V=V.firstChild),{addBrackets:re,newNode:V}}function o(V,H){const ne=[];let re=V.firstChild;for(;re;)H.includes(re.type.id)&&ne.push(re),ne.push(...o(re,H)),re=re.nextSibling;return ne}function u(V,H,ne){return H===V?` ${ne}`:`
${m(1)}${ne}`}function p(V,H){let ne=V.length-1;for(;ne>=0&&H.includes(V[ne]);)ne--;return V.substring(0,ne+1)}const y=(V,H)=>{const{addBrackets:ne,newNode:re}=i(V,$r);V=re;const _=U.parse(H.substring(V.from,V.to));let Se="";return _.iterate({enter:Me=>{const Be=Me.node;switch(Be.type.id){case tr:Se+=P(Be,H);break;case rr:Be.parent?.type.id!==rr&&(Se+=X(Be,H));break}}}),ne?"("+Se+")":Se};function P(V,H){const ne=H.substring(V.from,V.to),re=U.parse(ne),_=[];let Se="";return re.iterate({enter:Me=>{const Be=Me.node;Be.type.id===Tt&&_.push(Be)}}),_.sort((Me,Be)=>{const tt=Me.getChild(gt),qe=Be.getChild(gt),ut=tt&&H.substring(tt.from,tt.to),lr=qe&&H.substring(qe.from,qe.to);return!ut||!lr?0:ut<lr?-1:ut>lr?1:0}),_.forEach(Me=>{const Be=Me.getChild(gt),tt=Be?Be.nextSibling:null,qe=Me.getChild(ft),ut=Be?H.substring(Be.from,Be.to):null,lr=tt?H.substring(tt.from,tt.to):null,Lr=qe?H.substring(qe.from,qe.to):null;Se+=`${ut}${lr}${Lr}, `}),"{"+p(Se,", ")+"}"}function X(V,H){const ne=[_t,Qt,Ge,Nt,ar,zt,Xt,wr];let re,_="";return o(V,ne).forEach(Se=>{switch(Se.type.id){case _t:_+=u(_t,re,Y(Se,H)),re=_t;break;case Qt:_+=u(Qt,re,Z(Se,H)),re=Qt;break;case Ge:_+=u(Ge,re,Z(Se,H)),re=Ge;break;case ar:_+=u(ar,re,ae(Se,H)),re=ar;break;case Nt:_+=u(Nt,re,se(Se,H)),re=Nt;break;case zt:_+=u(zt,re,Xe(Se,H)),re=zt;break;case Xt:_+=u(Xt,re,Ce(Se,H)),re=Xt;break;case wr:_+=u(wr,re,ze()),re=wr;break}}),_}function Y(V,H){const ne=V.getChild(jt),re=V.getChild(ra),_=V.getChild(ft),Se=ne&&H.substring(ne.from,ne.to),Me=_&&H.substring(_.from,_.to);return re?`${Se} ip(${Me})`:`${Se} ${Me}`}function Z(V,H){if(V.getChild(ft)){const _=V.getChild(it)||V.getChild(je),Se=V.getChild(ft),Me=_&&H.substring(_.from,_.to),Be=Se&&H.substring(Se.from,Se.to);return`| ${Me}${Be}`}return`| ${H.substring(V.from,V.to)}`}function ae(V,H){const ne=o(V,[Rt]);let re="";return ne.forEach(_=>{const Se=_.getChild(gt),Me=_.getChild(ft),Be=Se&&H.substring(Se.from,Se.to),tt=Me&&H.substring(Me.from,Me.to);re+=`${Be}=${tt}, `}),`| json ${p(re,", ")}`}function se(V,H){const ne=V.getChild(Tt)||V.getChild(It)||V.getChild(Rr)||V.getChild(nr)?.getChild(Ft)||V.getChild(nr)?.getChild(wt);if(!ne)return"";const re=ne.type.id,_=ne.getChild(gt),Se=_&&_.nextSibling;let Me;re===Ft?Me=ne.getChild(pr):re===wt?Me=ne.getChild(Wt):re===Rr?Me=ne.getChild(Pt):Me=ne.getChild(ft);const Be=_&&H.substring(_.from,_.to),tt=Se&&H.substring(Se.from,Se.to),qe=Me&&H.substring(Me.from,Me.to);return re===It?`| ${Be}${tt}ip(${qe})`:`| ${Be}${tt}${qe}`}function Xe(V,H){const ne=V.getChild(ft);return`| line_format ${ne&&H.substring(ne.from,ne.to)}`}function Ce(V,H){const ne=o(V,[sr]);let re="| label_format ";return ne.forEach(_=>{let Se,Me;_.getChildren(gt).length===2?[Se,Me]=_.getChildren(gt):(Se=_.getChild(gt),Me=_.getChild(ft));const Be=Se&&H.substring(Se.from,Se.to),tt=Me&&H.substring(Me.from,Me.to);re+=`${Be}=${tt}, `}),p(re,", ")}function ze(){return"| decolorize"}const we=(V,H)=>{const{addBrackets:ne,newNode:re}=i(V,nt);V=re;let _="";const Se=V.firstChild;switch(Se&&Se.type.id){case hr:_=Ze(V,H);break;case zr:_=ct(V,H);break;case Kr:_=At(V,H);break;case Pt:_=Dt(V,H);break;case Pr:_=Nr(V,H);break;case ua:_=kt(V,H);break}return ne?"("+_+")":_};function Ze(V,H){let ne="";return o(V,[Kt,Ct,Ar,Ht]).forEach(re=>{if(re.parent?.type.id===hr)switch(re.type.id){case Kt:ne+=`${H.substring(re.from,re.to)}(
`;break;case Ct:ne+=`${m(1)+H.substring(re.from,re.to)},
`;break;case Ar:ne+=et(re,H);break;case Ht:ne+=Ye(re,H);break}}),ne}function et(V,H){const ne=[];let re="",_="",Se="",Me="",Be="";o(V,[tr,Or,Dr,yr,rr]).forEach(qe=>{if(qe.parent?.type.id===Ar)switch(ne.push(qe),qe.type.id){case tr:{let ut=H.substring(qe.from,qe.to);re+=P({...qe,from:0,to:ut.length},ut);break}case rr:_+=X(qe,H);break;case Or:Se+=H.substring(qe.from,qe.to);break;case Dr:{const ut=qe.getChild(pr);Me+=` offset ${ut?H.substring(ut.from,ut.to):""}`;break}case yr:o(qe,[gt,Mr,Nt]).forEach((ut,lr,Lr)=>{switch(ut.type.id){case gt:{if(ut.parent?.type.id!==yr||Lr.find(sn=>sn.type.id===Mr))return;Be+=`| unwrap ${H.substring(ut.from,ut.to)} `;return}case Mr:{const fa=Lr.find(hn=>hn.type.id===gt),sn=fa?H.substring(fa.from,fa.to):"";Be+=`| unwrap ${H.substring(ut.from,ut.to)}(${sn}) `;return}case Nt:Be+=se(ut,H);return}});break}});let tt="";return ne.forEach((qe,ut,lr)=>{const Lr=lr[ut-1];qe.type.id===tr&&(tt+=m(1)+re),qe.type.id===rr&&(tt+=n(_,1)),qe.type.id===Or&&(tt+=`
`+m(1)+Se),qe.type.id===Dr&&(tt+=Me),qe.type.id===yr&&(Lr?.type.id!==Dr&&Lr?.type.id!==Or?tt+=`
`+m(1)+Be:tt+=" "+Be)}),tt+=`
)`}function Ye(V,H){let ne="";const re=o(V,[gt]).map(_=>H.substring(_.from,_.to));return o(V,[_r,Wr]).forEach(_=>{if(_.parent?.type.id===Ht)switch(_.type.id){case _r:ne=` by (${re.join(", ")}) `;break;case Wr:ne=` without (${re.join(", ")}) `;break}}),ne}function ct(V,H){let ne="";return o(V,[or,Ct,nt,Ht]).forEach((re,_,Se)=>{if(re.parent?.type.id===zr)switch(re.type.id){case or:ne+=`${H.substring(re.from,re.to)}`;break;case Ct:ne+=`(
`,ne+=`${m(1)+H.substring(re.from,re.to)},
`;break;case nt:{const Me=Se.find(qe=>qe.type.id===Ct&&qe.parent?.type.id===zr);ne+=Me?"":`(
`;const Be=H.substring(re.from,re.to),tt=Gt(Be,nt);ne+=n(we(tt,Be),1),ne+=`
)`;break}case Ht:ne+=Ye(re,H);break}}),ne}function At(V,H){let ne;const[re,_]=o(V,[Ee]).map((Se,Me)=>{Me===0&&(ne=H.substring(Se.nextSibling?.from??0,Se.nextSibling?.to));const Be=H.substring(Se.from,Se.to);let tt;return da(Be)?(tt=Gt(Be,$r),y(tt,Be)):(tt=Gt(Be,nt),we(tt,Be))});return re+`
`+ne+`
`+_}function Dt(V,H){V=V.getChild(Pt)??V;const ne=V.getChild(Sa),re=V.getChild($a),_=V.getChild(Ct);return _?ne?`+${H.substring(_.from,_.to)}`:re?`-${H.substring(_.from,_.to)}`:H.substring(_.from,_.to):""}function Nr(V,H){let ne=`label_replace(
`;return o(V,[nt,ft]).forEach(re=>{if(re.parent?.type.id===Pr)if(re.type.id===nt){const _=H.substring(re.from,re.to),Se=Gt(_,nt);ne+=n(we(Se,_),1)+`,
`}else ne+=m(1)+H.substring(re.from,re.to)+`,
`}),p(ne,`,
`)+`
)`}function kt(V,H){V=V.getChild(ua)??V;const ne=V.getChild(Ct);return ne?`vector(${H.substring(ne.from,ne.to)})`:""}const xr=V=>{const H=U.parse(V);let ne="";return H.iterate({enter:re=>{const _=re.node;if(!(_.parent?.type.id!==Ee||_.parent?.parent?.type.id===Kr))switch(_.type.id){case nt:return ne=we(_,V),!1;case $r:return ne=y(_,V),!1}}}),a(ne)}}}]);

//# sourceMappingURL=4684.a72d5ca4883f8644f4e5.js.map