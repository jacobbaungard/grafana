"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6719],{40715:(ue,N,t)=>{t.d(N,{o:()=>h});var o=t(96540),e=t(31678),B=t(97007);function h($){const v=(0,e.useDispatch)(),W=(0,o.useRef)($);W.current=$,(0,o.useEffect)(()=>()=>{v((0,B.N)({cleanupAction:W.current}))},[v])}},34708:(ue,N,t)=>{t.r(N),t.d(N,{default:()=>qn,findRoutesMatchingFilters:()=>Qt});var o=t(32196),e=t(96540),B=t(41053),h=t(40845),$=t(63021),v=t(40675),W=t(40980),K=t(39558),Q=t(42418),f=t(67061),L=t(66602),c=t(83277),p=t(31678),b=t(40715),T=t(82843),S=t(55740),D=t(49962),V=t(68788);const Y=D.H.injectEndpoints({endpoints:n=>({contactPointsState:n.query({queryFn:async({amSourceName:a})=>{try{return{data:await(0,V.pB)(a)}}catch(r){return{error:r}}}})})}),J=n=>{const a={receivers:{},errorCount:0},{currentData:r}=Y.useContactPointsStateQuery({amSourceName:n??""},{skip:!n,pollingInterval:S.cB});return r??a};var re=t(37959),fe=t(57895),Ee=t(42941),z=t(55852),We=t(96374),u=t(38138),G=t(39938),ee=t(50720),te=t(29158),me=t(64756),g=t(64853),M=t(19073),j=t(51488),de=t(23770),Z=t(57220),A=t(56361),le=t(54486),it=t(75591),xt=t(23088);const Ye=({buttonIcon:n,buttonLabel:a,buttonSize:r="lg",buttonVariant:l="primary",onButtonClick:s,text:d,href:m,showButton:i=!0})=>{const E=(0,h.of)(Wt),C={className:E.button,icon:n,size:r,variant:l};return e.createElement(xt.Z,null,e.createElement(e.Fragment,null,e.createElement("p",{className:E.text},d),i&&(m?e.createElement(z.z9,{href:m,type:"button",...C},a):e.createElement(z.$n,{onClick:s,type:"button",...C},a))))},Wt=n=>({container:(0,o.css)({backgroundColor:n.colors.background.secondary,color:n.colors.text.secondary,padding:n.spacing(4),textAlign:"center"}),text:(0,o.css)({marginBottom:n.spacing(2)}),button:(0,o.css)({margin:n.spacing(2,0,1)})});var Je=t(48205),ct=t(26058),we=t(79938),Ge=t(16293),Xe=t(76648),ye=t(84029);const pe=({exportFormat:n,onClose:a})=>{const{currentData:r="",isFetching:l}=we.hK.useExportMuteTimingsQuery({format:n}),s=`mute-timings-${new Date().getTime()}`;return l?e.createElement(K._,{text:"Loading...."}):e.createElement(Ge.J,{format:n,textDefinition:r,downloadFileName:s,onClose:a})},Ne=({exportFormat:n,onClose:a,muteTimingName:r})=>{const{currentData:l="",isFetching:s}=we.hK.useExportMuteTimingQuery({format:n,muteTiming:r}),d=`mute-timing-${r}-${new Date().getTime()}`;return s?e.createElement(K._,{text:"Loading...."}):e.createElement(Ge.J,{format:n,textDefinition:l,downloadFileName:d,onClose:a})},Oe=({onClose:n,muteTimingName:a})=>{const[r,l]=(0,e.useState)("yaml");return e.createElement(Xe.m,{activeTab:r,onTabChange:l,onClose:n,formatProviders:Object.values(ye.sl)},a?e.createElement(Ne,{exportFormat:r,onClose:n,muteTimingName:a}):e.createElement(pe,{exportFormat:r,onClose:n}))};var Ze=t(4724);const wt=Symbol("all mute timings"),Jt=()=>{const[n,a]=(0,e.useState)(null),[r,l]=(0,Ee.A)(!1),s=(0,e.useCallback)(()=>{a(null),l(!1)},[l]),d=i=>{a(i),l(!0)};return[(0,e.useMemo)(()=>!n||!r?null:n===wt?e.createElement(Oe,{onClose:s}):e.createElement(Oe,{muteTimingName:n,onClose:s}),[r,s,n]),d]},Xt=({alertManagerSourceName:n,muteTimingNames:a,hideActions:r})=>{const l=(0,h.of)(ut),s=(0,me.wA)(),{currentData:d}=(0,j.f)(n,{refetchOnFocus:!0,refetchOnReconnect:!0}),m=d?.alertmanager_config,[i,E]=(0,e.useState)(""),C=(0,e.useMemo)(()=>{const w=m?(0,Ze.IT)(m):[],ne=m?.muteTimeProvenances??{};return w.filter(({name:F})=>a?a.includes(F):!0).map(F=>({id:F.name,data:{...F,provenance:ne[F.name]}}))},[a,m]),[P,x]=(0,M.L7)(M.QI.CreateMuteTiming),[R,I]=Jt(),[y,H]=(0,M.L7)(M.QI.ExportMuteTimings),O=Zt(n,r,E,I);return e.createElement("div",{className:l.container},e.createElement(f.B,{direction:"row",alignItems:"center"},e.createElement("span",null,"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."),e.createElement(ct.h,null),!r&&C.length>0&&e.createElement(g._,{actions:[M.QI.CreateMuteTiming]},e.createElement(z.z9,{className:l.muteTimingsButtons,icon:"plus",variant:"primary",href:(0,A.nL)("alerting/routes/mute-timing/new",n)},"Add mute timing")),y&&e.createElement(z.$n,{icon:"download-alt",className:l.muteTimingsButtons,variant:"secondary","aria-label":"export all",disabled:!H,onClick:()=>I(wt)},"Export all")),C.length>0?e.createElement(it.E,{items:C,cols:O,pagination:{itemsPerPage:25}}):r?e.createElement(Ye,{text:"No mute timings configured",buttonLabel:"",showButton:!1}):e.createElement(Ye,{text:"You haven't created any mute timings yet",buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,A.nL)("alerting/routes/mute-timing/new",n),showButton:x}),!r&&e.createElement(We.u,{isOpen:!!i,title:"Delete mute timing",body:`Are you sure you would like to delete "${i}"`,confirmText:"Delete",onConfirm:()=>{s((0,de.$8)(n,i)),E("")},onDismiss:()=>E("")}),R)};function Zt(n,a=!1,r,l){const[[s,d],[m,i]]=(0,M.Hl)([M.QI.UpdateMuteTiming,M.QI.DeleteMuteTiming]),E=!a&&(d||i),[C,P]=(0,M.L7)(M.QI.ExportMuteTimings),x=(0,h.of)(ut);return(0,e.useMemo)(()=>{const R=[{id:"name",label:"Name",renderCell:function({data:y}){return e.createElement(e.Fragment,null,y.name," ",y.provenance&&e.createElement(Je.rS,null))},size:"250px"},{id:"timeRange",label:"Time range",renderCell:({data:I})=>(0,Ze.av)(I)}];return E&&R.push({id:"actions",label:"",renderCell:function({data:y}){return e.createElement(kt,{muteTiming:y,alertManagerSourceName:n,setMuteTimingName:r})},size:"150px",className:x.actionsColumn}),C&&R.push({id:"actions",label:"",renderCell:function({data:y}){return e.createElement("div",null,e.createElement(u.W.Item,{icon:"download-alt",label:"Export",ariaLabel:"export",disabled:!P,"data-testid":"export",onClick:()=>l(y.name)}))},size:"100px"}),R},[n,r,E,C,P,l,x.actionsColumn])}function kt({muteTiming:n,alertManagerSourceName:a,setMuteTimingName:r}){const l=(0,h.of)(ut),s=a===Z.hY;return n.provenance?e.createElement(f.B,{direction:"row",alignItems:"center",justifyContent:"flex-end"},(0,le.d6)(n)&&!s&&e.createElement(G.E,{text:"Disabled",color:"orange",className:l.disabledBadge}),e.createElement(ee.N,{href:(0,A.nL)("/alerting/routes/mute-timing/edit",a,{muteName:n.name})},e.createElement(te.K,{name:"file-alt",tooltip:"View mute timing"}))):e.createElement(f.B,{direction:"row",alignItems:"center",justifyContent:"flex-end"},(0,le.d6)(n)&&!s&&e.createElement(G.E,{text:"Disabled",color:"orange",className:l.disabledBadge}),e.createElement(g._,{actions:[M.QI.UpdateMuteTiming]},e.createElement(ee.N,{href:(0,A.nL)("/alerting/routes/mute-timing/edit",a,{muteName:n.name})},e.createElement(te.K,{name:"edit",tooltip:"Edit mute timing",className:l.editButton}))),e.createElement(g._,{actions:[M.QI.DeleteMuteTiming]},e.createElement(te.K,{name:"trash-alt",tooltip:"Delete mute timing",onClick:()=>r(n.name)})))}const ut=n=>({container:(0,o.css)({display:"flex",flexFlow:"column nowrap"}),muteTimingsButtons:(0,o.css)({marginBottom:n.spacing(2),alignSelf:"flex-end"}),disabledBadge:(0,o.css)({height:"fit-content"}),editButton:(0,o.css)({display:"flex"}),actionsColumn:(0,o.css)({justifyContent:"flex-end"})});var se=t(2543),_=t(88575),qt=t(60029),Be=t(56034),Le=t(14578),mt=t(10354),Se=t(21594),ve=t(94753),_t=t(39964),Re=t(98164),Gt=t(32642);const en=({receivers:n,onChangeReceiver:a,onChangeMatchers:r,matchingCount:l})=>{const[s,d]=(0,_t.l)(),m=(0,e.useRef)(null),{queryString:i,contactPoint:E}=an(s),C=(0,h.of)(rn),P=(0,e.useCallback)(()=>(0,se.debounce)(r,500),[r]);(0,e.useEffect)(()=>{a(E)},[E,a]),(0,e.useEffect)(()=>{const O=(0,Re.J$)(i??"").map(Re.NL);P()(O)},[P,i]);const x=(0,e.useCallback)(()=>{m.current&&(m.current.value=""),d({contactPoint:void 0,queryString:void 0})},[d]),R=n.map(nn),I=R.find(O=>O.value===E)??null,y=i||E,H=i&&i.length>3?(0,Re.J$)(i).length===0:!1;return e.createElement(f.B,{direction:"row",alignItems:"flex-end",gap:1},e.createElement(_.D,{className:C.noBottom,label:e.createElement(qt.J,null,e.createElement(f.B,{gap:.5},e.createElement("span",null,"Search by matchers"),e.createElement(Be.m,{content:e.createElement("div",null,"Filter notification policies by using a comma separated list of matchers, e.g.:",e.createElement("pre",null,"severity=critical, region=EMEA"))},e.createElement(Le.I,{name:"info-circle",size:"sm"})))),invalid:H,error:H?"Query must use valid matcher syntax":null},e.createElement(mt.p,{ref:m,"data-testid":"search-query-input",placeholder:"Search",width:46,prefix:e.createElement(Le.I,{name:"search"}),onChange:O=>{d({queryString:O.currentTarget.value})},defaultValue:i})),e.createElement(_.D,{label:"Search by contact point",style:{marginBottom:0}},e.createElement(Se.l6,{id:"receiver","aria-label":"Search by contact point",value:I,options:R,onChange:O=>{d({contactPoint:O?.value})},width:28,isClearable:!0})),y&&e.createElement(f.B,{alignItems:"center"},e.createElement(z.$n,{variant:"secondary",icon:"times",onClick:x},"Clear filters"),e.createElement(ve.E,{variant:"bodySmall",color:"secondary"},l===0&&"No policies matching filters.",l===1&&`${l} policy matches the filters.`,l>1&&`${l} policies match the filters.`)))};function Nt(n,a){const r=new Map;function l(s,d){const m=[...d,s];if(a(s)){const i=r.get(s)??[];r.set(s,[...i,...m])}s.routes?.forEach(i=>l(i,m))}return l(n,[]),r}function tn(n,a){const r=(0,Gt.J$)(n);return a.every(l=>r.some(s=>(0,se.isEqual)(l,s)))}const nn=n=>({label:n.name,value:n.name}),an=n=>({queryString:n.get("queryString")??void 0,contactPoint:n.get("contactPoint")??void 0}),rn=()=>({noBottom:(0,o.css)({marginBottom:0})});var be=t(37390),on=t(62930),Fe=t(60021),ln=t(35016),sn=t(26423),cn=t(12210),dt=t(99494),un=t(37534);const mn=()=>{const{installed:n}=(0,cn._)(dt.W.OnCall),{data:a}=sn.WG.useGrafanaOnCallIntegrationsQuery(void 0,{skip:!n});return l=>{const s=a??[];if(n&&(0,un.p8)(l,s))return dt.W.OnCall}},Lt=n=>{const a=mn(),r=l=>({label:l.name,value:l.name,grafanaAppReceiverType:a(l)});return n.map(r)};var dn=t(55127),$e=t.n(dn);const pn=({active:n=0,suppressed:a=0,unprocessed:r=0})=>{const l=[],s=n+a+r;return n&&l.push(e.createElement(G.E,{color:"red",key:"firing",text:`${n} firing`})),a&&l.push(e.createElement(G.E,{color:"blue",key:"suppressed",text:`${a} suppressed`})),r&&l.push(e.createElement(G.E,{color:"orange",key:"unprocessed",text:`${r} unprocessed`})),l.length>1&&l.unshift(e.createElement(e.Fragment,{key:"total"},s," ",$e()("instance",s))),!!l.length?e.createElement(f.B,{gap:.5},l):null};var Te=t(49785),gn=t(82762),X=t(79657),xe=t(33915),Ft=t(99903),ke=t(27835);const fn=({actionButtons:n,alertManagerSourceName:a,onSubmit:r,receivers:l,route:s})=>{const d=(0,h.of)(Ft.t),[m,i]=(0,e.useState)(!1),[E,C]=(0,e.useState)((0,X.gY)(s.group_by)),P=(0,X.YE)(s),{handleSubmit:x,register:R,control:I,formState:{errors:y},setValue:H,getValues:O}=(0,Te.mN)({defaultValues:{...P,overrideTimings:!0,overrideGrouping:!0}});return e.createElement("form",{onSubmit:x(r)},e.createElement(_.D,{label:"Default contact point",invalid:!!y.receiver,error:y.receiver?.message},e.createElement(e.Fragment,null,e.createElement("div",{className:d.container,"data-testid":"am-receiver-select"},e.createElement(Te.xI,{render:({field:{onChange:w,ref:ne,...F}})=>e.createElement(Se.l6,{"aria-label":"Default contact point",...F,className:d.input,onChange:oe=>w((0,X.eb)(oe)),options:l}),control:I,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),e.createElement("span",null,"or"),e.createElement(ee.N,{className:d.linkText,href:(0,A.nL)("/alerting/notifications/receivers/new",a)},"Create a contact point")))),e.createElement(_.D,{label:"Group by",description:"Group alerts when you receive a notification based on labels.","data-testid":"am-group-select"},e.createElement(Te.xI,{render:({field:{onChange:w,ref:ne,...F}})=>e.createElement(Se.KF,{"aria-label":"Group by",...F,allowCustomValue:!0,className:d.input,onCreateOption:oe=>{C(ie=>[...ie,(0,X.Mk)(oe)]),H("groupBy",[...F.value||[],oe])},onChange:oe=>w((0,X.ie)(oe)),options:[...X.Yl,...E]}),control:I,name:"groupBy"})),e.createElement(gn.S,{collapsible:!0,className:d.collapse,isOpen:m,label:"Timing options",onToggle:i},e.createElement("div",{className:d.timingFormContainer},e.createElement(_.D,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. Default 30 seconds.",invalid:!!y.groupWaitValue,error:y.groupWaitValue?.message,"data-testid":"am-group-wait"},e.createElement(xe.V,{...R("groupWaitValue",{validate:X.hH}),placeholder:ke.H.group_wait,className:d.promDurationInput,"aria-label":"Group wait"})),e.createElement(_.D,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. Default 5 minutes.",invalid:!!y.groupIntervalValue,error:y.groupIntervalValue?.message,"data-testid":"am-group-interval"},e.createElement(xe.V,{...R("groupIntervalValue",{validate:X.hH}),placeholder:ke.H.group_interval,className:d.promDurationInput,"aria-label":"Group interval"})),e.createElement(_.D,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent. Default 4 hours. Should be a multiple of Group interval.",invalid:!!y.repeatIntervalValue,error:y.repeatIntervalValue?.message,"data-testid":"am-repeat-interval"},e.createElement(xe.V,{...R("repeatIntervalValue",{validate:w=>{const ne=O("groupIntervalValue");return(0,X.DY)(w,ne)}}),placeholder:ke.H.repeat_interval,className:d.promDurationInput,"aria-label":"Repeat interval"})))),e.createElement("div",{className:d.container},n))};var pt=t(15292),En=t(72093),$t=t(70383);function vn(){const{selectedAlertmanager:n}=(0,$t.VI)(),{currentData:a}=(0,j.f)(n),r=a?.alertmanager_config;return(0,e.useMemo)(()=>(r?(0,Ze.IT)(r):[])?.map(d=>({value:d.name,label:d.name,description:d.time_intervals.map(m=>(0,Re.LF)(m)).join(", AND ")}))??[],[r])}var Ce=t(97174);const Ut=({actionButtons:n,receivers:a,route:r,onSubmit:l,defaults:s})=>{const d=(0,h.of)(yn),m=(0,h.of)(Ft.t),[i,E]=(0,e.useState)((0,X.gY)(r?.group_by)),C=vn(),P=[{name:"",operator:Fe.ho.equal,value:""}],x=a.sort(hn),R={...(0,X.YE)(r),...s},I={...R,object_matchers:r?R.object_matchers:P},{handleSubmit:y,control:H,register:O,formState:{errors:w},setValue:ne,watch:F,getValues:oe}=(0,Te.mN)({defaultValues:I}),{fields:ie,append:Ie,remove:he}=(0,Te.jz)({control:H,name:"object_matchers"});return e.createElement("form",{onSubmit:y(l)},e.createElement("input",{type:"hidden",...O("id")}),e.createElement(f.B,{direction:"column",alignItems:"flex-start"},e.createElement("div",null,"Matching labels"),ie.length===0&&e.createElement(G.E,{color:"orange",className:d.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),ie.length>0&&e.createElement("div",{className:d.matchersContainer},ie.map((k,q)=>e.createElement(f.B,{direction:"row",key:k.id,alignItems:"center"},e.createElement(_.D,{label:"Label",invalid:!!w.object_matchers?.[q]?.name,error:w.object_matchers?.[q]?.name?.message},e.createElement(mt.p,{...O(`object_matchers.${q}.name`,{required:"Field is required"}),defaultValue:k.name,placeholder:"label",autoFocus:!0})),e.createElement(_.D,{label:"Operator"},e.createElement(Te.xI,{render:({field:{onChange:U,ref:ce,...Me}})=>e.createElement(Se.l6,{...Me,className:d.matchersOperator,onChange:Pe=>U(Pe?.value),options:Re.xH,"aria-label":"Operator"}),defaultValue:k.operator,control:H,name:`object_matchers.${q}.operator`,rules:{required:{value:!0,message:"Required."}}})),e.createElement(_.D,{label:"Value",invalid:!!w.object_matchers?.[q]?.value,error:w.object_matchers?.[q]?.value?.message},e.createElement(mt.p,{...O(`object_matchers.${q}.value`),defaultValue:k.value,placeholder:"value"})),e.createElement(te.K,{tooltip:"Remove matcher",name:"trash-alt",onClick:()=>he(q)},"Remove")))),e.createElement(z.$n,{className:d.addMatcherBtn,icon:"plus",onClick:()=>Ie(X.Rg),variant:"secondary",type:"button"},"Add matcher")),e.createElement(_.D,{label:"Contact point"},e.createElement(Te.xI,{render:({field:{onChange:k,ref:q,...U}})=>e.createElement(Se.l6,{"aria-label":"Contact point",...U,className:m.input,onChange:ce=>k((0,X.eb)(ce)),options:x,isClearable:!0}),control:H,name:"receiver"})),e.createElement(_.D,{label:"Continue matching subsequent sibling nodes"},e.createElement(pt.d,{id:"continue-toggle",...O("continue")})),e.createElement(_.D,{label:"Override grouping"},e.createElement(pt.d,{id:"override-grouping-toggle",...O("overrideGrouping")})),F().overrideGrouping&&e.createElement(_.D,{label:"Group by",description:"Group alerts when you receive a notification based on labels. If empty it will be inherited from the parent policy."},e.createElement(Te.xI,{rules:{validate:k=>!k||k.length===0?"At least one group by option is required.":!0},render:({field:{onChange:k,ref:q,...U},fieldState:{error:ce}})=>e.createElement(e.Fragment,null,e.createElement(Se.KF,{"aria-label":"Group by",...U,invalid:!!ce,allowCustomValue:!0,className:m.input,onCreateOption:Me=>{E(Pe=>[...Pe,(0,X.Mk)(Me)]),ne("groupBy",[...U.value||[],Me])},onChange:Me=>k((0,X.ie)(Me)),options:[...X.Yl,...i]}),ce&&e.createElement(En.P,null,ce.message)),control:H,name:"groupBy"})),e.createElement(_.D,{label:"Override general timings"},e.createElement(pt.d,{id:"override-timings-toggle",...O("overrideTimings")})),F().overrideTimings&&e.createElement(e.Fragment,null,e.createElement(_.D,{label:Ce.G.groupWait.label,description:Ce.G.groupWait.description,invalid:!!w.groupWaitValue,error:w.groupWaitValue?.message},e.createElement(xe.V,{...O("groupWaitValue",{validate:X.hH}),"aria-label":Ce.G.groupWait.ariaLabel,className:m.promDurationInput})),e.createElement(_.D,{label:Ce.G.groupInterval.label,description:Ce.G.groupInterval.description,invalid:!!w.groupIntervalValue,error:w.groupIntervalValue?.message},e.createElement(xe.V,{...O("groupIntervalValue",{validate:X.hH}),"aria-label":Ce.G.groupInterval.ariaLabel,className:m.promDurationInput})),e.createElement(_.D,{label:Ce.G.repeatInterval.label,description:Ce.G.repeatInterval.description,invalid:!!w.repeatIntervalValue,error:w.repeatIntervalValue?.message},e.createElement(xe.V,{...O("repeatIntervalValue",{validate:(k="")=>{const q=oe("groupIntervalValue");return(0,X.DY)(k,q)}}),"aria-label":Ce.G.repeatInterval.ariaLabel,className:m.promDurationInput}))),e.createElement(_.D,{label:"Mute timings","data-testid":"am-mute-timing-select",description:"Add mute timing to policy",invalid:!!w.muteTimeIntervals},e.createElement(Te.xI,{render:({field:{onChange:k,ref:q,...U}})=>e.createElement(Se.KF,{"aria-label":"Mute timings",...U,className:m.input,onChange:ce=>k((0,X.ie)(ce)),options:C}),control:H,name:"muteTimeIntervals"})),n)};function hn(n){return n.grafanaAppReceiverType===dt.W.OnCall?-1:0}const yn=n=>{const a=n.spacing(3.5);return{addMatcherBtn:(0,o.css)({marginBottom:a}),matchersContainer:(0,o.css)({backgroundColor:n.colors.background.secondary,padding:`${n.spacing(1.5)} ${n.spacing(2)}`,paddingBottom:0,width:"fit-content"}),matchersOperator:(0,o.css)({minWidth:"120px"}),noMatchersWarning:(0,o.css)({padding:`${n.spacing(1)} ${n.spacing(2)}`,marginBottom:n.spacing(1)})}};var Vt=t(26928);const bn=(n=[],a,r)=>{const[l,s]=(0,e.useState)(!1),[d,m]=(0,e.useState)(void 0),[i,E]=(0,e.useState)(),C=Lt(n),P=(0,e.useCallback)(()=>{E(void 0),m(void 0),s(!1)},[]),x=(0,e.useCallback)((I,y)=>{E(I),m(y),s(!0)},[]);return[(0,e.useMemo)(()=>r?e.createElement(gt,{isOpen:l}):e.createElement(be.a,{isOpen:l,onDismiss:P,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Add notification policy"},e.createElement(Ut,{receivers:C,defaults:{groupBy:i?.group_by},onSubmit:I=>{i&&d&&a(I,i,d)},actionButtons:e.createElement(be.a.ButtonRow,null,e.createElement(z.$n,{type:"button",variant:"secondary",onClick:P,fill:"outline"},"Cancel"),e.createElement(z.$n,{type:"submit"},"Save policy"))})),[C,a,P,d,r,i,l]),x,P]},In=(n,a,r,l)=>{const[s,d]=(0,e.useState)(!1),[m,i]=(0,e.useState)(!1),[E,C]=(0,e.useState)(),P=Lt(a),x=(0,e.useCallback)(()=>{C(void 0),d(!1)},[]),R=(0,e.useCallback)((y,H)=>{i(H??!1),C(y),d(!0)},[]);return[(0,e.useMemo)(()=>l?e.createElement(gt,{isOpen:s}):e.createElement(be.a,{isOpen:s,onDismiss:x,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Edit notification policy"},m&&E&&e.createElement(fn,{alertManagerSourceName:n,onSubmit:r,receivers:P,route:E,actionButtons:e.createElement(be.a.ButtonRow,null,e.createElement(z.$n,{type:"button",variant:"secondary",onClick:x,fill:"outline"},"Cancel"),e.createElement(z.$n,{type:"submit"},"Update default policy"))}),!m&&e.createElement(Ut,{receivers:P,route:E,onSubmit:r,actionButtons:e.createElement(be.a.ButtonRow,null,e.createElement(z.$n,{type:"button",variant:"secondary",onClick:x,fill:"outline"},"Cancel"),e.createElement(z.$n,{type:"submit"},"Update policy"))})),[P,n,x,r,m,l,E,s]),R,x]},Mn=(n,a)=>{const[r,l]=(0,e.useState)(!1),[s,d]=(0,e.useState)(),m=(0,e.useCallback)(()=>{d(void 0),l(!1)},[d]),i=(0,e.useCallback)(P=>{d(P),l(!0)},[]),E=(0,e.useCallback)(()=>{s&&n(s)},[n,s]);return[(0,e.useMemo)(()=>a?e.createElement(gt,{isOpen:r}):e.createElement(be.a,{isOpen:r,onDismiss:m,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Delete notification policy"},e.createElement("p",null,"Deleting this notification policy will permanently remove it."),e.createElement("p",null,"Are you sure you want to delete this policy?"),e.createElement(be.a.ButtonRow,null,e.createElement(z.$n,{type:"button",variant:"destructive",onClick:E},"Yes, delete policy"),e.createElement(z.$n,{type:"button",variant:"secondary",onClick:m},"Cancel"))),[m,E,a,r]),i,m]},Pn=()=>{const[n,a]=(0,e.useState)(!1),[r,l]=(0,e.useState)([]),[s,d]=(0,e.useState)([]),[m,i]=(0,e.useState)("default"),E=(0,e.useCallback)(()=>{a(!1),l([]),d([])},[]),C=(0,e.useCallback)((R,I,y)=>{l(R),I&&d(I),y&&i(y),a(!0)},[]),P=(0,e.useMemo)(()=>{const R=r.flatMap(I=>I.alerts);return(0,se.groupBy)(R,I=>I.status.state)},[r]);return[(0,e.useMemo)(()=>e.createElement(be.a,{isOpen:n,onDismiss:E,closeOnBackdropClick:!0,closeOnEscape:!0,title:e.createElement(f.B,{direction:"row",alignItems:"center",gap:1,wrap:"wrap"},e.createElement(f.B,{direction:"row",alignItems:"center",gap:.5},e.createElement(Le.I,{name:"x"})," Matchers"),e.createElement(Vt.s,{matchers:s,formatter:m}))},e.createElement(f.B,{direction:"column"},e.createElement(pn,{active:P[Fe.Or.Active]?.length,suppressed:P[Fe.Or.Suppressed]?.length,unprocessed:P[Fe.Or.Unprocessed]?.length}),e.createElement("div",null,r.map((R,I)=>e.createElement(ln._,{key:I,alertManagerSourceName:"",group:R})))),e.createElement(be.a.ButtonRow,null,e.createElement(z.$n,{type:"button",variant:"secondary",onClick:E},"Cancel"))),[r,E,P,s,m,n]),C,E]},gt=({isOpen:n})=>e.createElement(be.a,{isOpen:n,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:e.createElement(f.B,{direction:"row",alignItems:"center",gap:.5},"Updating... ",e.createElement(on.y,{inline:!0}))},"Please wait while we update your notification policies.");var Tn=t(32264),jt=t(83122),qe=t(72109),Cn=t(69613),ft=t(23896),An=t(19645),Kt=t(79581),Et=t(35108),vt=t(8406),Ae=t(55196);const Dn=({exportFormat:n,onClose:a})=>{const{currentData:r="",isFetching:l}=we.hK.useExportPoliciesQuery({format:n}),s=`policies-${new Date().getTime()}`;return l?e.createElement(K._,{text:"Loading...."}):e.createElement(Ge.J,{format:n,textDefinition:r,downloadFileName:s,onClose:a})},Sn=({onClose:n})=>{const[a,r]=(0,e.useState)("yaml");return e.createElement(Xe.m,{activeTab:a,onTabChange:r,onClose:n,formatProviders:Object.values(ye.sl)},e.createElement(Dn,{exportFormat:a,onClose:n}))},zt=n=>{const{receivers:a=[],contactPointsState:r,readOnly:l=!1,provisioned:s=!1,alertGroups:d=[],alertManagerSourceName:m,currentRoute:i,routeTree:E,inheritedProperties:C,routesMatchingFilters:P={filtersApplied:!1,matchedRoutesWithPath:new Map},matchingInstancesPreview:x={enabled:!1},onEditPolicy:R,onAddPolicy:I,onDeletePolicy:y,onShowAlertInstances:H,isAutoGenerated:O=!1}=n,w=(0,h.of)(Ue),ne=i===E,F=i.receiver,oe=i.continue??!1,ie=(0,Gt.J$)(i),Ie=!!(ie&&ie.length),{filtersApplied:he,matchedRoutesWithPath:k}=P,q=Array.from(k.keys()),U=he&&q.some(ae=>ae.id===i.id),ce=Array.from(k.values()).flat(),Me=ce.some(ae=>ae.id===i.id),Pe=[],et=!Ie&&!ne&&!oe,yt=F??C?.receiver??"",bt=r?Vn(yt,r):[],tt=i.routes??[],Ve=he?tt.filter(ae=>ce.some(Qe=>Qe.id===ae.id)):tt,je=Ve.length>0,[It,nt]=(0,Ee.A)(!1),Ke=x?.groupsMap?.get(i.id),Mt=Ke?(0,se.sumBy)(Ke,ae=>ae.alerts.length):void 0,[Pt,Tt]=(0,M.L7)(M.QI.ViewAutogeneratedPolicyTree),ze=Ht(i),[He,Ct]=(0,Ee.A)(!ze),At=i.group_by,Dt=i.mute_time_intervals??[],Yt={group_wait:i.group_wait,group_interval:i.group_interval,repeat_interval:i.repeat_interval};bt.forEach(ae=>{Pe.push(ae)});const at=20,[rt,St]=(0,e.useState)(at),ot=On(O,ne,s,R,i,nt,y);if(O&&(!Tt||!Pt)||he&&!Me)return null;const ge=ne||ze,De=Ve.filter(ae=>ce.some(Qe=>Qe.id===ae.id)),lt=he?De:Ve,st=lt.slice(0,rt),Bt=lt.length-st.length,_n=Bt>0;return e.createElement(e.Fragment,null,e.createElement(f.B,{direction:"column",gap:1.5},e.createElement("div",{className:w.policyWrapper(U),"data-testid":ne?"am-root-route-container":"am-route-container"},oe&&e.createElement(Wn,null),et&&e.createElement(wn,null),e.createElement("div",{className:w.policyItemWrapper},e.createElement(f.B,{direction:"column",gap:1},e.createElement("div",null,e.createElement(f.B,{direction:"row",alignItems:"center",gap:1},je?e.createElement(te.K,{name:He?"angle-down":"angle-right",onClick:Ct,"aria-label":He?"Collapse":"Expand"}):null,ge?ze?e.createElement(Nn,null):e.createElement(Gn,null):Ie?e.createElement(Vt.s,{matchers:ie??[],formatter:(0,Re.VE)(m)}):e.createElement("span",{className:w.metadata},"No matchers"),e.createElement(ct.h,null),Pe.length>0&&e.createElement(xn,{errors:Pe}),s&&e.createElement(Je.rS,null),e.createElement(f.B,{direction:"row",gap:.5},!O&&!l&&e.createElement(g._,{actions:[M.QI.CreateNotificationPolicy]},e.createElement(ft.A,{shouldWrap:s,wrap:ht},ne?e.createElement(z.$n,{variant:"secondary",icon:"plus",size:"sm",disabled:s,type:"button",onClick:()=>I(i,"child")},"New child policy"):e.createElement(jt.m,{overlay:e.createElement(u.W,null,e.createElement(u.W.Item,{label:"New sibling above",icon:"arrow-up",onClick:()=>I(i,"above")}),e.createElement(u.W.Item,{label:"New sibling below",icon:"arrow-down",onClick:()=>I(i,"below")}),e.createElement(u.W.Divider,null),e.createElement(u.W.Item,{label:"New child policy",icon:"plus",onClick:()=>I(i,"child")}))},e.createElement(z.$n,{size:"sm",variant:"secondary",disabled:s,icon:"angle-down",type:"button"},"Add new policy")))),ot.length>0&&e.createElement(jt.m,{overlay:e.createElement(u.W,null,ot)},e.createElement(z.$n,{icon:"ellipsis-h",variant:"secondary",size:"sm",type:"button","aria-label":"more-actions","data-testid":"more-actions"}))))),e.createElement(Rn,{matchingInstancesPreview:x,numberOfAlertInstances:Mt,contactPoint:F??void 0,groupBy:At,muteTimings:Dt,timingOptions:Yt,inheritedProperties:C,alertManagerSourceName:m,receivers:a,matchingAlertGroups:Ke,matchers:ie,isDefaultPolicy:ne,onShowAlertInstances:H})))),e.createElement("div",{className:w.childPolicies},He&&e.createElement(e.Fragment,null,st.map(ae=>{const Qe=(0,Kt.W$)(i,ae,C),ea=Ht(ae)||O,ta=l||s||O;return e.createElement(zt,{key:ae.id,routeTree:E,currentRoute:ae,receivers:a,contactPointsState:r,readOnly:ta,inheritedProperties:Qe,onAddPolicy:I,onEditPolicy:R,onDeletePolicy:y,onShowAlertInstances:H,alertManagerSourceName:m,alertGroups:d,routesMatchingFilters:P,matchingInstancesPreview:x,isAutoGenerated:ea,provisioned:s})}),_n&&e.createElement(z.$n,{size:"sm",icon:"angle-down",variant:"secondary",className:w.moreButtons,onClick:()=>St(rt+at)},Bt," additional ",$e()("policy",Bt)))),It&&e.createElement(Sn,{onClose:nt})))};function Rn({numberOfAlertInstances:n,isDefaultPolicy:a,timingOptions:r,groupBy:l,muteTimings:s=[],matchingInstancesPreview:d,inheritedProperties:m,matchingAlertGroups:i,onShowAlertInstances:E,matchers:C,contactPoint:P,alertManagerSourceName:x,receivers:R}){const I=(0,h.of)(Ue),y=m&&m.group_by,H=m&&Object.keys(m).length>0,O=(0,se.isArray)(l)&&l[0]==="...",w=!O&&(0,se.isArray)(l)&&l.length>0,ne=a&&(0,se.isArray)(l)&&l.length===0,F=!!s.length;return e.createElement("div",{className:I.metadataRow},e.createElement(f.B,{direction:"row",alignItems:"center",gap:1},d.enabled&&e.createElement(Ae.P,{icon:"layers-alt",onClick:()=>{i&&E(i,C,(0,Re.VE)(x))},"data-testid":"matching-instances"},e.createElement(ve.E,{color:"primary"},n??"-"),e.createElement("span",null,$e()("instance",n))),P&&e.createElement(Ae.P,{icon:"at","data-testid":"contact-point"},e.createElement("span",null,"Delivered to"),e.createElement(Un,{alertManagerSourceName:x,receivers:R,contactPoint:P})),!y&&e.createElement(e.Fragment,null,w&&e.createElement(Ae.P,{icon:"layer-group","data-testid":"grouping"},e.createElement("span",null,"Grouped by"),e.createElement(ve.E,{color:"primary"},l.join(", "))),ne&&e.createElement(Ae.P,{icon:"layer-group"},e.createElement("span",null,"Single group")),O&&e.createElement(Ae.P,{icon:"layer-group"},e.createElement("span",null,"Not grouping"))),F&&e.createElement(Ae.P,{icon:"calendar-slash","data-testid":"mute-timings"},e.createElement("span",null,"Muted when"),e.createElement(Fn,{timings:s,alertManagerSourceName:x})),r&&e.createElement($n,{timingOptions:a?(0,se.defaults)(r,ke.H):r}),H&&e.createElement(e.Fragment,null,e.createElement(Ae.P,{icon:"corner-down-right-alt","data-testid":"inherited-properties"},e.createElement("span",null,"Inherited"),e.createElement(Ln,{properties:m})))))}const On=(n,a,r,l,s,d,m)=>{const[[i,E],[C,P],[x,R]]=(0,M.Hl)([M.QI.UpdateNotificationPolicyTree,M.QI.DeleteNotificationPolicy,M.QI.ExportNotificationPolicies]),I=[],y=R&&x&&a&&!n,H=i&&E,O=C&&P&&!a&&!n;return H&&I.push(e.createElement(e.Fragment,{key:"edit-policy"},e.createElement(ft.A,{shouldWrap:r,wrap:ht},e.createElement(u.W.Item,{icon:"edit",disabled:r||n,label:"Edit",onClick:()=>l(s,a)})))),y&&I.push(e.createElement(u.W.Item,{key:"export-policy",icon:"download-alt",label:"Export",onClick:d})),O&&I.push(e.createElement(e.Fragment,{key:"delete-policy"},e.createElement(u.W.Divider,null),e.createElement(ft.A,{shouldWrap:r,wrap:ht},e.createElement(u.W.Item,{destructive:!0,icon:"trash-alt",disabled:r||n,label:"Delete",onClick:()=>m(s)})))),I},Bn="__grafana_autogenerated__";function Ht(n){return!(Tn.$.featureToggles.alertingSimplifiedRouting??!1)||!n.object_matchers?!1:n.object_matchers.some(r=>r[0]===Bn&&r[1]===Fe.ho.equal&&r[2]==="true")??!1}const ht=n=>e.createElement(Be.m,{content:"Provisioned items cannot be edited in the UI",placement:"top"},e.createElement("span",null,n)),xn=({errors:n})=>e.createElement(Et.j,{arrow:!0,placement:"top",content:e.createElement(f.B,{direction:"column",gap:.5},n.map(a=>e.createElement(e.Fragment,{key:(0,se.uniqueId)()},a)))},e.createElement("span",null,e.createElement(G.E,{icon:"exclamation-circle",color:"red",text:$e()("error",n.length,!0)}))),Wn=()=>{const n=(0,h.of)(Ue);return e.createElement(Be.m,{placement:"top",content:"This route will continue matching other policies"},e.createElement("div",{className:n.gutterIcon,"data-testid":"continue-matching"},e.createElement(Le.I,{name:"arrow-down"})))},wn=()=>{const n=(0,h.of)(Ue);return e.createElement(Be.m,{placement:"top",content:"This policy matches all labels"},e.createElement("div",{className:n.gutterIcon,"data-testid":"matches-all"},e.createElement(Le.I,{name:"exclamation-triangle"})))};function Gn(){const n=(0,h.of)(Ue);return e.createElement(e.Fragment,null,e.createElement(ve.E,{element:"h2",variant:"body",weight:"medium"},"Default policy"),e.createElement("span",{className:n.metadata},"All alert instances will be handled by the default policy if no other matching policies are found."))}function Nn(){return e.createElement(ve.E,{element:"h3",variant:"body",weight:"medium"},"Auto-generated policies")}const Ln=({properties:n})=>e.createElement(Et.j,{arrow:!0,placement:"top",content:e.createElement(f.B,{direction:"row",gap:.5},Object.entries(n).map(([a,r])=>r?e.createElement(vt.J,{key:a,label:jn(a),value:Kn(a,r)}):null))},e.createElement("div",null,e.createElement(ve.E,{color:"primary"},$e()("property",Object.keys(n).length,!0)))),Fn=({timings:n,alertManagerSourceName:a})=>e.createElement("div",null,n.map(r=>e.createElement(qe.Y,{key:r,href:(0,A.i7)(r,a),color:"primary",variant:"bodySmall",inline:!1},r))),$n=({timingOptions:n})=>{const a=n.group_wait,r=n.group_interval;return!a&&!r?null:e.createElement(Ae.P,{icon:"hourglass","data-testid":"timing-options"},e.createElement("span",null,"Wait"),a&&e.createElement(Be.m,{placement:"top",content:"How long to initially wait to send a notification for a group of alert instances."},e.createElement("span",null,e.createElement(ve.E,{color:"primary"},a)," to group instances",a&&r&&",")),r&&e.createElement(Be.m,{placement:"top",content:"How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent."},e.createElement("span",null,e.createElement(ve.E,{color:"primary"},r)," before sending updates")))},Un=({alertManagerSourceName:n,contactPoint:a,receivers:r})=>{const l=r.find(m=>m.name===a);if(!l)return e.createElement(qe.Y,{href:(0,A.bg)(a,n),color:"primary",variant:"bodySmall",inline:!1},a);if(!l.grafana_managed_receiver_configs)return e.createElement(qe.Y,{href:(0,A.bg)(a,n),color:"primary",variant:"bodySmall",inline:!1},a);const d=(0,se.groupBy)(l.grafana_managed_receiver_configs,m=>m.type);return e.createElement(Et.j,{arrow:!0,placement:"top",header:e.createElement(Ae.P,{icon:"at"},e.createElement("div",null,"Contact Point"),e.createElement(ve.E,{color:"primary"},a)),key:(0,se.uniqueId)(),content:e.createElement(f.B,{direction:"row",gap:.5},Object.entries(d).map(([m,i])=>e.createElement(vt.J,{key:(0,se.uniqueId)(),label:i.length>1?i.length:void 0,icon:An.M[m],value:(0,se.upperFirst)(m)})))},e.createElement(qe.Y,{href:(0,A.bg)(a,n),color:"primary",variant:"bodySmall",inline:!1},a))};function Vn(n,a){return Object.entries(a[n]?.notifiers??[]).reduce((s=[],[d,m])=>{const i=m.filter(E=>E.lastNotifyAttemptError).map(E=>e.createElement(vt.J,{icon:"at",key:(0,se.uniqueId)(),label:`Contact Point \u203A ${E.name}`,value:E.lastNotifyAttemptError}));return s.concat(i)},[])}const jn=n=>{switch(n){case"receiver":return"Contact Point";case"group_by":return"Group by";case"group_interval":return"Group interval";case"group_wait":return"Group wait";case"repeat_interval":return"Repeat interval";default:return n}},Kn=(n,a)=>{const r=n==="group_by"&&Array.isArray(a)&&a[0]==="...",l=n==="group_by"&&Array.isArray(a)&&a.length===0;return r?e.createElement(ve.E,{variant:"bodySmall",color:"secondary"},"Not grouping"):l?e.createElement(ve.E,{variant:"bodySmall",color:"secondary"},"Single group"):Array.isArray(a)?a.join(", "):a},Ue=n=>({matcher:a=>{const{color:r,borderColor:l}=(0,Cn.MC)(a);return{wrapper:(0,o.css)({color:"#fff",background:r,padding:`${n.spacing(.33)} ${n.spacing(.66)}`,fontSize:n.typography.bodySmall.fontSize,border:`solid 1px ${l}`,borderRadius:n.shape.radius.default})}},childPolicies:(0,o.css)({marginLeft:n.spacing(4),position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",borderLeft:`solid 1px ${n.colors.border.weak}`,marginTop:0,marginLeft:"-20px"}}),policyItemWrapper:(0,o.css)({padding:n.spacing(1.5)}),metadataRow:(0,o.css)({borderBottomLeftRadius:n.shape.borderRadius(2),borderBottomRightRadius:n.shape.borderRadius(2)}),policyWrapper:(a=!1)=>(0,o.css)({flex:1,position:"relative",background:n.colors.background.secondary,borderRadius:n.shape.radius.default,border:`solid 1px ${n.colors.border.weak}`,...a&&{borderColor:n.colors.primary.border,background:n.colors.primary.transparent}}),metadata:(0,o.css)({color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize,fontWeight:n.typography.bodySmall.fontWeight}),break:(0,o.css)({width:"100%",height:0,marginBottom:n.spacing(2)}),gutterIcon:(0,o.css)({position:"absolute",top:0,transform:"translateY(50%)",left:`-${n.spacing(4)}`,color:n.colors.text.secondary,background:n.colors.background.primary,width:"25px",height:"25px",textAlign:"center",border:`solid 1px ${n.colors.border.weak}`,borderRadius:n.shape.radius.default,padding:0}),moreButtons:(0,o.css)({marginTop:n.spacing(.5),marginBottom:n.spacing(1.5)})});var zn=t(19143),Hn=t(88467),_e=t(67332),Qn=(n=>(n.NotificationPolicies="notification_policies",n.MuteTimings="mute_timings",n))(Qn||{});const Yn=()=>{const n=(0,p.useDispatch)(),a=(0,h.of)(Xn),{useGetAlertmanagerAlertGroupsQuery:r}=T.m,[l,s]=(0,c.s)(),{tab:d}=Zn(l),[m,i]=(0,e.useState)(d),[E,C]=(0,e.useState)(!1),[P,x]=(0,e.useState)(),[R,I]=(0,e.useState)([]),{selectedAlertmanager:y,hasConfigurationAPI:H,isGrafanaAlertmanager:O}=(0,$t.VI)(),{getRouteGroupsMap:w}=(0,zn.L)(),ne=J(y??""),{currentData:F,isLoading:oe,error:ie}=(0,j.f)(y,{refetchOnFocus:!0,refetchOnReconnect:!0}),Ie=F?.alertmanager_config,{currentData:he,refetch:k}=r({amSourceName:y??""},{skip:!y}),q=Ie?.receivers??[],U=(0,e.useMemo)(()=>{if(Ie?.route)return(0,X.QM)(Ie.route)},[Ie?.route]),[{value:ce,error:Me},Pe]=(0,B.A)(w,[w]);(0,e.useEffect)(()=>{U&&he&&Pe(U,he,{unquoteMatchers:!O})},[U,he,Pe,O]);const et=(0,e.useMemo)(()=>U?Qt(U,{contactPointFilter:P,labelMatchersFilter:R}):{filtersApplied:!1,matchedRoutesWithPath:new Map},[P,R,U]),yt=!!Ie?.route?.provenance;function bt(ge){if(!U)return;const De=(0,_e.AB)(y??"",ge,U);je(De)}function tt(ge){if(!U)return;const De=(0,_e.AS)(ge,U);je(De)}function Ve(ge,De,lt){if(!U)return;const st=(0,_e.I8)(y??"",ge,De,U,lt);je(st)}function je(ge){if(!F)return;const De=(0,_e.dn)(ge);C(!0),n((0,de.RW)({newConfig:{...F,alertmanager_config:{...F.alertmanager_config,route:De}},oldConfig:F,alertManagerSourceName:y,successMessage:"Updated notification policies"})).unwrap().then(()=>{y&&k(),Tt(),Ke(),Ct()}).finally(()=>{C(!1)})}const[It,nt,Ke]=bn(q,Ve,E),[Mt,Pt,Tt]=In(y??"",q,bt,E),[ze,He,Ct]=Mn(tt,E),[At,Dt]=Pn();if((0,b.o)(ge=>ge.unifiedAlerting.saveAMConfig=Hn.jA),!y)return null;const at=(F?.alertmanager_config?(0,Ze.IT)(F?.alertmanager_config):[]).length,rt=F&&!ie&&!oe,St=!F&&oe,ot=ie&&!oe,Rt=m==="mute_timings",Ot=m==="notification_policies";return e.createElement(e.Fragment,null,e.createElement($.U,null,e.createElement(v.o,{label:"Notification Policies",active:Ot,onChangeTab:()=>{i("notification_policies"),s({tab:"notification_policies"})}}),e.createElement(v.o,{label:"Mute Timings",active:Rt,counter:at,onChangeTab:()=>{i("mute_timings"),s({tab:"mute_timings"})}})),e.createElement(W.J,{className:a.tabContent},St&&e.createElement(K._,{text:"Loading Alertmanager config..."}),ot&&e.createElement(Q.F,{severity:"error",title:"Error loading Alertmanager config"},ie.message||"Unknown error."),rt&&e.createElement(e.Fragment,null,Ot&&e.createElement(e.Fragment,null,e.createElement(fe.M,{currentAlertmanager:y}),e.createElement(f.B,{direction:"column",gap:1},U&&e.createElement(en,{receivers:q,onChangeMatchers:I,onChangeReceiver:x,matchingCount:et.matchedRoutesWithPath.size}),U&&e.createElement(zt,{receivers:q,routeTree:U,currentRoute:U,alertGroups:he??[],contactPointsState:ne.receivers,readOnly:!H,provisioned:yt,alertManagerSourceName:y,onAddPolicy:nt,onEditPolicy:Pt,onDeletePolicy:He,onShowAlertInstances:Dt,routesMatchingFilters:et,matchingInstancesPreview:{groupsMap:ce,enabled:!Me},isAutoGenerated:!1})),It,Mt,ze,At),Rt&&e.createElement(Xt,{alertManagerSourceName:y,hideActions:!H}))))},Qt=(n,a)=>{const{contactPointFilter:r,labelMatchersFilter:l=[]}=a,s=r||l.length>0,d=!!r&&l.length>0;if(!s)return{filtersApplied:!1,matchedRoutesWithPath:new Map};let m=[];const i=(0,Kt._I)(n),E=r?Nt(i,I=>I.receiver===r):new Map,C=Array.from(E.keys());C&&m.push(C);const P=l.length?Nt(i,I=>tn(I,l)):new Map,x=Array.from(P.keys());return P.size>0&&m.push(x),{filtersApplied:!0,matchedRoutesWithPath:d?Jn(P,E):new Map([...P,...E])}};function Jn(...n){const a=new Map;for(const r of n[0].keys())n.every(l=>l.has(r))&&a.set(r,n[0].get(r));return a}const Xn=n=>({tabContent:(0,o.css)({marginTop:n.spacing(2)})});function Zn(n){let a="notification_policies";return n.tab==="notification_policies"&&(a="notification_policies"),n.tab==="mute_timings"&&(a="mute_timings"),{tab:a}}const kn=()=>e.createElement(re.y,{navId:"am-routes",accessType:"notification"},e.createElement(Yn,null)),qn=(0,L.Xc)(kn,{style:"page"})},23088:(ue,N,t)=>{t.d(N,{Z:()=>h});var o=t(32196),e=t(96540),B=t(40845);const h=({children:v})=>{const W=(0,B.of)($);return e.createElement("div",{className:W.container},v)},$=v=>({container:(0,o.css)({backgroundColor:v.colors.background.secondary,color:v.colors.text.secondary,padding:v.spacing(4),textAlign:"center"})})},35016:(ue,N,t)=>{t.d(N,{_:()=>te});var o=t(32196),e=t(96540),B=t(40845),h=t(67061),$=t(72109),v=t(60021),W=t(56361),K=t(69087),Q=t(64047),f=t(55196),L=t(70416),c=t(10562),p=t(97754),b=t(55852),T=t(16233),S=t(31678),D=t(19073),V=t(57220),Y=t(71223),J=t(64853);const re=({alert:g,alertManagerSourceName:M})=>{const j=(0,B.of)(fe),Z=(0,V.z2)(M)?T.TP.hasPermission(S.AccessControlAction.AlertingRuleRead):!0;return e.createElement(e.Fragment,null,e.createElement("div",{className:j.actionsRow},g.status.state===v.Or.Suppressed&&e.createElement(J._,{actions:[D.QI.CreateSilence,D.QI.UpdateSilence]},e.createElement(b.z9,{href:`${(0,W.nL)("/alerting/silences",M)}&silenceIds=${g.status.silencedBy.join(",")}`,className:j.button,icon:"bell",size:"sm"},"Manage silences")),g.status.state===v.Or.Active&&e.createElement(J._,{actions:[D.QI.CreateSilence]},e.createElement(b.z9,{href:(0,W.BK)(M,g.labels),className:j.button,icon:"bell-slash",size:"sm"},"Silence")),Z&&g.generatorURL&&e.createElement(b.z9,{className:j.button,href:g.generatorURL,icon:"chart-line",size:"sm"},"See source")),Object.entries(g.annotations).map(([A,le])=>e.createElement(Y.s,{key:A,annotationKey:A,value:le})),e.createElement("div",{className:j.receivers},"Receivers:"," ",g.receivers.map(({name:A})=>A).filter(A=>!!A).join(", ")))},fe=g=>({button:(0,o.css)({"& + &":{marginLeft:g.spacing(1)}}),actionsRow:(0,o.css)({padding:`${g.spacing(2,0)} !important`,borderBottom:`1px solid ${g.colors.border.medium}`}),receivers:(0,o.css)({padding:g.spacing(1,0)})}),Ee=({alerts:g,alertManagerSourceName:M})=>{const j=(0,B.of)(z),de=(0,e.useMemo)(()=>[{id:"state",label:"State",renderCell:({data:A})=>e.createElement(e.Fragment,null,e.createElement(p.y,{state:A.status.state}),e.createElement("span",{className:j.duration},"for"," ",(0,L.dU)({start:new Date(A.startsAt),end:new Date(A.endsAt)}))),size:"220px"},{id:"labels",label:"Labels",renderCell:({data:{labels:A}})=>e.createElement(K.m,{labels:A,size:"sm"}),size:1}],[j]),Z=(0,e.useMemo)(()=>g.map(A=>({id:A.fingerprint,data:A})),[g]);return e.createElement("div",{className:j.tableWrapper,"data-testid":"alert-group-table"},e.createElement(c.B,{cols:de,items:Z,isExpandable:!0,renderExpandedContent:({data:A})=>e.createElement(re,{alert:A,alertManagerSourceName:M})}))},z=g=>({tableWrapper:(0,o.css)({marginTop:g.spacing(3),[g.breakpoints.up("md")]:{marginLeft:g.spacing(4.5)}}),duration:(0,o.css)({marginLeft:g.spacing(1),fontSize:g.typography.bodySmall.fontSize})});var We=t(55127),u=t.n(We);const G=g=>({[v.Or.Active]:(0,o.css)({color:g.colors.error.text}),[v.Or.Suppressed]:(0,o.css)({color:g.colors.primary.text}),[v.Or.Unprocessed]:(0,o.css)({color:g.colors.secondary.text})}),ee=({group:g})=>{const M=(0,B.of)(G),j=g.alerts.length,de=g.alerts.reduce((Z,A)=>(Z[A.status.state]?Z[A.status.state]+=1:Z[A.status.state]=1,Z),{});return e.createElement("div",null,`${j} ${u()("alert",j)}: `,Object.entries(de).map(([Z,A],le)=>e.createElement("span",{key:`${JSON.stringify(g.labels)}-notifications-${le}`,className:M[Z]},le>0&&", ",`${A} ${Z}`)))},te=({alertManagerSourceName:g,group:M})=>{const[j,de]=(0,e.useState)(!0),Z=(0,B.of)(me),A=M.receiver.name!=="NONE",le=M.receiver.name;return e.createElement("div",{className:Z.wrapper},e.createElement("div",{className:Z.header},e.createElement("div",{className:Z.group,"data-testid":"alert-group"},e.createElement(Q.e,{size:"sm",isCollapsed:j,onToggle:()=>de(!j),"data-testid":"alert-group-collapse-toggle"}),Object.keys(M.labels).length?e.createElement(h.B,{direction:"row",alignItems:"center"},e.createElement(K.m,{labels:M.labels,size:"sm"}),A&&e.createElement(f.P,{icon:"at"},"Delivered to"," ",e.createElement($.Y,{href:(0,W.bg)(le,g),variant:"bodySmall",color:"primary",inline:!1},M.receiver.name))):e.createElement("span",null,"No grouping")),e.createElement(ee,{group:M})),!j&&e.createElement(Ee,{alertManagerSourceName:g,alerts:M.alerts}))},me=g=>({wrapper:(0,o.css)({"& + &":{marginTop:g.spacing(2)}}),header:(0,o.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${g.spacing(1)} ${g.spacing(1)} ${g.spacing(1)} 0`,backgroundColor:g.colors.background.secondary,width:"100%"}),group:(0,o.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,o.css)({}),[v.Or.Active]:(0,o.css)({color:g.colors.error.main}),[v.Or.Suppressed]:(0,o.css)({color:g.colors.primary.main}),[v.Or.Unprocessed]:(0,o.css)({color:g.colors.secondary.main})})},4724:(ue,N,t)=>{t.d(N,{Hy:()=>v,IT:()=>W,av:()=>Q,oB:()=>K});var o=t(95093),e=t.n(o),B=t(96540),h=t(98164);const $=/^((([01][0-9])|(2[0-3])):[0-5][0-9])$|(^24:00$)/,v=f=>f?$.test(f):!0,W=f=>[...f.mute_time_intervals??[],...f.time_intervals??[]],K=(f,L)=>{if(!f&&!L)return!0;if(!f&&L||f&&!L)return!1;const c="HH:mm",p=e()().startOf("day").add(f,c),b=e()().startOf("day").add(L,c);return!!(f&&L&&p.isBefore(b)||f&&L&&b.isAfter(p))};function Q(f){return f.time_intervals.map((c,p)=>{const{times:b,weekdays:T,days_of_month:S,months:D,years:V,location:Y}=c,J=(0,h.Dm)(b,Y),re=(0,h.uH)(T),fe=(0,h.UL)(S),Ee=(0,h.$P)(D),z=(0,h.mP)(V);return B.createElement(B.Fragment,{key:JSON.stringify(c)+p},`${J} ${re}`,B.createElement("br",null),[fe,Ee,z].join(" | "),B.createElement("br",null))})}},26928:(ue,N,t)=>{t.d(N,{s:()=>f});var o=t(32196),e=t(2543),B=t.n(e),h=t(96540),$=t(40845),v=t(67061),W=t(69613),K=t(32642),Q=t(35108);const f=({matchers:p,formatter:b="default"})=>{const T=(0,$.of)(c),S=5,D=(0,e.take)(p,S),V=(0,e.takeRight)(p,p.length-S),Y=V.length>0;return h.createElement("span",{"data-testid":"label-matchers"},h.createElement(v.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap"},D.map(J=>h.createElement(L,{key:(0,e.uniqueId)(),matcher:J,formatter:b})),Y&&h.createElement(Q.j,{arrow:!0,placement:"top",content:h.createElement(h.Fragment,null,V.map(J=>h.createElement(L,{key:(0,e.uniqueId)(),matcher:J})))},h.createElement("span",null,h.createElement("div",{className:T.metadata},`and ${V.length} more`)))))},L=({matcher:p,formatter:b="default"})=>{const T=(0,$.of)(c);return h.createElement("div",{className:T.matcher(p[0]).wrapper},h.createElement(v.B,{direction:"row",gap:0,alignItems:"baseline"},K.t8[b](p)))},c=p=>({matcher:b=>{const{color:T,borderColor:S}=(0,W.MC)(b);return{wrapper:(0,o.css)({color:"#fff",background:T,padding:`${p.spacing(.33)} ${p.spacing(.66)}`,fontSize:p.typography.bodySmall.fontSize,border:`solid 1px ${S}`,borderRadius:p.shape.borderRadius(2)})}},metadata:(0,o.css)({color:p.colors.text.secondary,fontSize:p.typography.bodySmall.fontSize,fontWeight:p.typography.bodySmall.fontWeight})})},33915:(ue,N,t)=>{t.d(N,{V:()=>L});var o=t(96540),e=t(10354),B=t(14578),h=t(35108),$=t(32196),v=t(40845),W=t(41068);function K(){const c=(0,v.of)(f);return o.createElement("div",null,"Prometheus duration format consist of a number followed by a time unit.",o.createElement("br",null),"Different units can be combined for more granularity.",o.createElement("hr",null),o.createElement("div",{className:c.list},o.createElement("div",{className:c.header},o.createElement("div",null,"Symbol"),o.createElement("div",null,"Time unit"),o.createElement("div",null,"Example")),o.createElement(Q,{unit:W.y.seconds,name:"seconds",example:"20s"}),o.createElement(Q,{unit:W.y.minutes,name:"minutes",example:"10m"}),o.createElement(Q,{unit:W.y.hours,name:"hours",example:"4h"}),o.createElement(Q,{unit:W.y.days,name:"days",example:"3d"}),o.createElement(Q,{unit:W.y.weeks,name:"weeks",example:"2w"}),o.createElement("div",{className:c.examples},o.createElement("div",null,"Multiple units combined"),o.createElement("code",null,"1m30s, 2h30m20s, 1w2d"))))}function Q({unit:c,name:p,example:b}){const T=(0,v.of)(f);return o.createElement(o.Fragment,null,o.createElement("div",{className:T.unit},c),o.createElement("div",null,p),o.createElement("code",null,b))}const f=c=>({unit:(0,$.css)({fontWeight:c.typography.fontWeightBold}),list:(0,$.css)({display:"grid",gridTemplateColumns:"max-content 1fr 2fr",gap:c.spacing(1,3)}),header:(0,$.css)({display:"contents",fontWeight:c.typography.fontWeightBold}),examples:(0,$.css)({display:"contents","& > div":{gridColumn:"1 / span 2"}})}),L=o.forwardRef((c,p)=>o.createElement(e.p,{suffix:o.createElement(h.j,{content:o.createElement(K,null),disabled:!1},o.createElement(B.I,{name:"info-circle",size:"lg"})),...c,ref:p}));L.displayName="PromDurationInput"},99903:(ue,N,t)=>{t.d(N,{t:()=>e});var o=t(32196);const e=B=>({container:(0,o.css)({alignItems:"center",display:"flex",flexFlow:"row nowrap","& > * + *":{marginLeft:B.spacing(1)}}),input:(0,o.css)({flex:1}),promDurationInput:(0,o.css)({maxWidth:B.spacing(32)}),timingFormContainer:(0,o.css)({padding:B.spacing(1)}),linkText:(0,o.css)({textDecoration:"underline"}),collapse:(0,o.css)({border:"none",background:"none",color:B.colors.text.primary})})},97174:(ue,N,t)=>{t.d(N,{G:()=>o});const o={groupWait:{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. If empty it will be inherited from the parent policy.",ariaLabel:"Group wait value"},groupInterval:{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. If empty it will be inherited from the parent policy.",ariaLabel:"Group interval value"},repeatInterval:{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent.",ariaLabel:"Repeat interval value"}}},27835:(ue,N,t)=>{t.d(N,{H:()=>o});const o={group_wait:"30s",group_interval:"5m",repeat_interval:"4h"}},19143:(ue,N,t)=>{t.d(N,{L:()=>Q});var o=t(14590),e=t(96540),B=t(25027),h=t(67278);const $=()=>new h.c(new URL(t.p+t.u(5398),t.b));let v;function W(){let f;if(v===void 0)try{f=$(),v=o.LV(f)}catch(c){c instanceof Error&&(0,B.vV)(c)}return{disposeWorker:()=>{f&&v&&(v[o.A2](),f.terminate(),v=void 0,f=void 0)}}}function K(f){if(!v)throw new Error("Route Matcher has not been initialized")}function Q(){(0,e.useEffect)(()=>{const{disposeWorker:c}=W();return c},[]);const f=(0,e.useCallback)(async(c,p,b)=>{K(v);const T=performance.now(),S=await v.getRouteGroupsMap(c,p,b),D=performance.now()-T;return(0,B.fH)(`Route Groups Matched in  ${D} ms`,{matchingTime:D.toString(),alertGroupsCount:p.length.toString(),topLevelRoutesCount:c.routes?.length.toString()??"0"}),S},[]),L=(0,e.useCallback)(async(c,p,b)=>{K(v);const T=performance.now(),S=await v.matchInstancesToRoute(c,p,b),D=performance.now()-T;return(0,B.fH)(`Instances Matched in  ${D} ms`,{matchingTime:D.toString(),instancesToMatchCount:p.length.toString(),topLevelRoutesCount:c.routes?.length.toString()??"0"}),S},[]);return{getRouteGroupsMap:f,matchInstancesToRoute:L}}},79657:(ue,N,t)=>{t.d(N,{DY:()=>We,Mk:()=>Y,QM:()=>S,Rg:()=>c,SJ:()=>V,YE:()=>D,Yl:()=>b,eb:()=>re,gY:()=>J,hH:()=>Ee,ie:()=>fe});var o=t(2543),e=t.n(o),B=t(60021),h=t(98164),$=t(57220),v=t(32642),W=t(67332),K=t(25968);const Q=(u,G)=>Object.entries(u??{}).reduce((ee,[te,me])=>[...ee,{name:te,value:me,operator:G?B.ho.regex:B.ho.equal}],[]),f=u=>u.value,L=u=>(u??[]).map(f),c={name:"",value:"",operator:B.ho.equal},p=["grafana_folder","alertname"],b=[{label:"grafana_folder",value:"grafana_folder",isFixed:!0},{label:"alertname",value:"alertname",isFixed:!0},{label:"Disable (...)",value:"..."}],T={id:"",overrideGrouping:!1,groupBy:p,object_matchers:[],routes:[],continue:!1,receiver:"",overrideTimings:!1,groupWaitValue:"",groupIntervalValue:"",repeatIntervalValue:"",muteTimeIntervals:[]};function S(u){return{id:(0,o.uniqueId)("route-"),...u,routes:(u.routes??[]).map(S)}}const D=u=>{if(!u)return T;const G="id"in u?u.id:(0,o.uniqueId)("route-");if(Object.keys(u).length===0)return{...T,id:G};const ee=[];u.routes?.forEach(g=>{const M=D(g);ee.push(M)});const te=u.object_matchers?.map(g=>({name:g[0],operator:g[1],value:g[2]}))??[],me=u.matchers?.flatMap(g=>(0,v.So)(g).flatMap(h.MU)).map(({name:g,operator:M,value:j})=>({name:(0,v.Ig)(g),operator:M,value:(0,v.Ig)(j)}))??[];return{id:G,object_matchers:[...me,...te,...Q(u.match,!1),...Q(u.match_re,!0)],continue:u.continue??!1,receiver:u.receiver??"",overrideGrouping:Array.isArray(u.group_by)&&u.group_by.length>0,groupBy:u.group_by??void 0,overrideTimings:[u.group_wait,u.group_interval,u.repeat_interval].some(Boolean),groupWaitValue:u.group_wait??"",groupIntervalValue:u.group_interval??"",repeatIntervalValue:u.repeat_interval??"",routes:ee,muteTimeIntervals:u.mute_time_intervals??[]}},V=(u,G,ee)=>{const te=(0,W.eM)(G.id??"",ee),{overrideGrouping:me,groupBy:g,overrideTimings:M,groupWaitValue:j,groupIntervalValue:de,repeatIntervalValue:Z,receiver:A}=G,le=void 0,it=me?g:le,Ye=M&&j?j:le,Je=M&&de?de:le,we=M&&Z?Z:le,Ge=G.object_matchers?.filter(pe=>pe.name&&pe.operator&&pe.value!==null&&pe.value!==void 0).map(({name:pe,operator:Ne,value:Oe})=>[pe,Ne,Oe]),Xe=G.routes?.map(pe=>V(u,pe,ee)),ye={...te??{},continue:G.continue,group_by:it,object_matchers:Ge,match:void 0,match_re:void 0,group_wait:Ye,group_interval:Je,repeat_interval:we,routes:Xe,mute_time_intervals:G.muteTimeIntervals,receiver:A};return u!==$.hY?(ye.matchers=G.object_matchers?.map(({name:pe,operator:Ne,value:Oe})=>`${(0,v.ot)(pe)}${Ne}${(0,v.ot)(Oe)}`),ye.object_matchers=void 0):(ye.object_matchers=(0,v.J$)(ye),ye.matchers=void 0),G.receiver&&(ye.receiver=G.receiver),ye},Y=u=>({label:u,value:u}),J=u=>(u??[]).map(Y),re=u=>u===null?null:u?f(u)??"":"",fe=u=>u?L(u):[];function Ee(u){return!u||u.length===0?!0:(0,K.TN)(u)||"Invalid duration format. Must be {number}{time_unit}"}const z=u=>u.map(G=>{const[ee,te,me]=G;return`${ee}${te}${me}`}),We=(u,G="")=>{if(u.length===0)return!0;const ee=Ee(u),te=Ee(G);if(ee!==!0)return ee;if(te!==!0)return te;const me=(0,K.P8)(u),g=(0,K.P8)(G);return g!==0&&me<g?"Repeat interval should be higher or equal to Group interval":!0}},54486:(ue,N,t)=>{t.d(N,{KR:()=>h,Ww:()=>v,d6:()=>L,iF:()=>K,jU:()=>B,jb:()=>f,oU:()=>$});var o=t(2543),e=t.n(o);const B=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],h=["january","february","march","april","may","june","july","august","september","october","november","december"],$={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:"",location:"",disable:!1},v=(c,p,b)=>c?c.split(",").map(T=>T.trim()).every(T=>T.split(":").every(p))||b:!0,W=c=>c?c.split(",").map(p=>p.trim()):void 0,K=c=>{const p=c.time_intervals.map(({times:b,weekdays:T,days_of_month:S,months:D,years:V,location:Y,disable:J})=>{const re={times:Q(b,J),weekdays:W(T)?.map(fe=>fe.toLowerCase()),days_of_month:W(S),months:W(D),years:W(V),location:Y||void 0};return(0,o.omitBy)(re,o.isUndefined)});return{name:c.name,time_intervals:p}};function Q(c,p){if(p)return[];const b=c?.filter(({start_time:T,end_time:S})=>!!T&&!!S);return b?.length?b:void 0}function f(c){return c.times?.length===0||c.weekdays?.length===0||c.days_of_month?.length===0||c.months?.length===0||c.years?.length===0}function L(c){return c.time_intervals.every(p=>f(p))}},67332:(ue,N,t)=>{t.d(N,{AB:()=>v,AS:()=>W,I8:()=>K,dn:()=>f,eM:()=>L});var o=t(1932),e=t(2543),B=t.n(e),h=t(14588),$=t(79657);const v=(c,p,b)=>{if(!L(p.id??"",b))throw new Error(`No such route with ID '${p.id}'`);function S(D){let V=D;if(D.id===p.id){const Y=(0,$.SJ)(c,p,b);V={...D,...Y}}return{...V,routes:D.routes?.map(S)}}return S(b)},W=(c,p)=>{if(c.id===p.id)throw new Error("You cant remove the root policy");function b(T){return{...T,routes:T.routes?.reduce((S=[],D)=>(D.id===c.id||S.push(b(D)),S),[])}}return b(p)},K=(c,p,b,T,S)=>{const D=(0,$.SJ)(c,p,T);return(0,o.jM)(T,V=>{const[Y,J,re]=Q(V,b);if(Y===void 0||J===void 0||re===void 0)throw new Error(`could not find reference route "${b.id}" in tree`);S==="child"&&(Y.routes?Y.routes.push(D):Y.routes=[D]),S==="above"&&(J.routes=(0,h.insertBeforeImmutably)(J.routes??[],D,re)),S==="below"&&(J.routes=(0,h.insertAfterImmutably)(J.routes??[],D,re))})};function Q(c,p){let b,T,S;function D(V,Y,J){b||(V.id===p.id&&(b=V,T=J,S=Y),V.routes&&V.routes.forEach((re,fe)=>D(re,fe,V)))}return D(c,0,c),[b,T,S]}function f(c){return(0,e.omit)({...c,routes:c.routes?.map(p=>f(p))},"id")}function L(c,p){return p.id===c?p:p.routes?.find(b=>L(c,b))}}}]);

//# sourceMappingURL=AlertAmRoutes.6057c6d1aa370edf58ca.js.map