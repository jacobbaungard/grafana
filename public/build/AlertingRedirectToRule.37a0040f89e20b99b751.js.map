{"version":3,"file":"AlertingRedirectToRule.37a0040f89e20b99b751.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/RedirectToRuleViewer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-viewer/RuleViewerLayout.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { useMemo } from 'react';\nimport { Redirect } from 'react-router-dom';\nimport { useLocation } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { config, isFetchError } from '@grafana/runtime';\nimport { Alert, Card, Icon, LoadingPlaceholder, useStyles2, withErrorBoundary } from '@grafana/ui';\n\nimport { AlertLabels } from './components/AlertLabels';\nimport { RuleViewerLayout } from './components/rule-viewer/RuleViewerLayout';\nimport { useCloudCombinedRulesMatching } from './hooks/useCombinedRule';\nimport { getRulesSourceByName } from './utils/datasource';\nimport { createViewLink } from './utils/misc';\nimport { unescapePathSeparators } from './utils/rule-id';\n\nconst pageTitle = 'Find rule';\nconst subUrl = config.appSubUrl;\n\nfunction useRuleFindParams() {\n  // DO NOT USE REACT-ROUTER HOOKS FOR THIS CODE\n  // React-router's useLocation/useParams/props.match are broken and don't preserve original param values when parsing location\n  // so, they cannot be used to parse name and sourceName path params\n  // React-router messes the pathname up resulting in a string that is neither encoded nor decoded\n  // Relevant issue: https://github.com/remix-run/history/issues/505#issuecomment-453175833\n  // It was probably fixed in React-Router v6\n  const location = useLocation();\n\n  return useMemo(() => {\n    const segments = location.pathname?.replace(subUrl, '').split('/') ?? []; // [\"\", \"alerting\", \"{sourceName}\", \"{name}]\n    const name = unescapePathSeparators(decodeURIComponent(unescapePathSeparators(segments[3])));\n    const sourceName = decodeURIComponent(segments[2]);\n\n    const searchParams = new URLSearchParams(location.search);\n\n    return {\n      name,\n      sourceName,\n      namespace: searchParams.get('namespace') ?? undefined,\n      group: searchParams.get('group') ?? undefined,\n    };\n  }, [location]);\n}\n\nexport function RedirectToRuleViewer(): JSX.Element | null {\n  const styles = useStyles2(getStyles);\n\n  const { name, sourceName, namespace, group } = useRuleFindParams();\n  const {\n    error,\n    loading,\n    rules = [],\n  } = useCloudCombinedRulesMatching(name, sourceName, { namespace, groupName: group });\n\n  if (!name || !sourceName) {\n    return <Redirect to=\"/notfound\" />;\n  }\n\n  if (error) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <Alert title={`Failed to load rules from ${sourceName}`}>\n          {isFetchError(error) && (\n            <details className={styles.errorMessage}>\n              {error.message}\n              <br />\n              {/* {!!error?.stack && error.stack} */}\n            </details>\n          )}\n        </Alert>\n      </RuleViewerLayout>\n    );\n  }\n\n  if (loading) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <LoadingPlaceholder text=\"Loading rule...\" />\n      </RuleViewerLayout>\n    );\n  }\n\n  const rulesSource = getRulesSourceByName(sourceName);\n\n  if (!rulesSource) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <Alert title=\"Could not view rule\">\n          <details className={styles.errorMessage}>{`Could not find data source with name: ${sourceName}.`}</details>\n        </Alert>\n      </RuleViewerLayout>\n    );\n  }\n\n  if (rules.length === 1) {\n    const [rule] = rules;\n    const to = createViewLink(rulesSource, rule, '/alerting/list').replace(subUrl, '');\n    return <Redirect to={to} />;\n  }\n\n  if (rules.length === 0) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <div data-testid=\"no-rules\">\n          No rules in <span className={styles.param}>{sourceName}</span> matched the name{' '}\n          <span className={styles.param}>{name}</span>\n        </div>\n      </RuleViewerLayout>\n    );\n  }\n\n  return (\n    <RuleViewerLayout title={pageTitle}>\n      <div>\n        Several rules in <span className={styles.param}>{sourceName}</span> matched the name{' '}\n        <span className={styles.param}>{name}</span>, please select the rule you want to view.\n      </div>\n      <div className={styles.rules}>\n        {rules.map((rule, index) => {\n          return (\n            <Card key={`${rule.name}-${index}`} href={createViewLink(rulesSource, rule, '/alerting/list')}>\n              <Card.Heading>{rule.name}</Card.Heading>\n              <Card.Meta separator={''}>\n                <Icon name=\"folder\" />\n                <span className={styles.namespace}>{`${rule.namespace.name} / ${rule.group.name}`}</span>\n              </Card.Meta>\n              <Card.Tags>\n                <AlertLabels labels={rule.labels} />\n              </Card.Tags>\n            </Card>\n          );\n        })}\n      </div>\n    </RuleViewerLayout>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    param: css`\n      font-style: italic;\n      color: ${theme.colors.text.secondary};\n    `,\n    rules: css`\n      margin-top: ${theme.spacing(2)};\n    `,\n    namespace: css`\n      margin-left: ${theme.spacing(1)};\n    `,\n    errorMessage: css`\n      white-space: pre-wrap;\n    `,\n  };\n}\n\nexport default withErrorBoundary(RedirectToRuleViewer, { style: 'page' });\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2, NavModelItem } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { PageProps } from 'app/core/components/Page/types';\n\ntype Props = {\n  children: React.ReactNode | React.ReactNode[];\n  title: string;\n  renderTitle?: PageProps['renderTitle'];\n  wrapInContent?: boolean;\n};\n\nconst defaultPageNav: Partial<NavModelItem> = {\n  icon: 'bell',\n  id: 'alert-rule-view',\n};\n\nexport function RuleViewerLayout(props: Props): JSX.Element | null {\n  const { wrapInContent = true, children, title, renderTitle } = props;\n  const styles = useStyles2(getPageStyles);\n\n  return (\n    <Page pageNav={{ ...defaultPageNav, text: title }} renderTitle={renderTitle} navId=\"alert-list\">\n      <Page.Contents>\n        <div className={styles.content}>{wrapInContent ? <RuleViewerLayoutContent {...props} /> : children}</div>\n      </Page.Contents>\n    </Page>\n  );\n}\n\ntype ContentProps = {\n  children: React.ReactNode | React.ReactNode[];\n  padding?: number;\n};\n\nexport function RuleViewerLayoutContent({ children, padding = 2 }: ContentProps): JSX.Element | null {\n  const styles = useStyles2(getContentStyles(padding));\n  return <div className={styles.wrapper}>{children}</div>;\n}\n\nconst getPageStyles = (theme: GrafanaTheme2) => {\n  return {\n    content: css`\n      max-width: ${theme.breakpoints.values.xxl}px;\n    `,\n  };\n};\n\nconst getContentStyles = (padding: number) => (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      background: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.weak};\n      border-radius: ${theme.shape.radius.default};\n      padding: ${theme.spacing(padding)};\n    `,\n  };\n};\n"],"names":["pageTitle","subUrl","useRuleFindParams","location","segments","name","sourceName","searchParams","RedirectToRuleViewer","styles","getStyles","namespace","group","error","loading","rules","rulesSource","rule","to","index","theme","defaultPageNav","RuleViewerLayout","props","wrapInContent","children","title","renderTitle","getPageStyles","RuleViewerLayoutContent","padding","getContentStyles"],"sourceRoot":""}