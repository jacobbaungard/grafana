"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6552],{99226:(Me,_,a)=>{a.d(_,{gv:()=>ee});var s=a(2543),e=a.n(s),n=a(96540),S=a(32264),v=a(67061),ne=a(55852),c=a(25968);const F=S.$.unifiedAlerting.minInterval??"10s",B=((M=F)=>{const f=[(0,c.M9)("10s"),(0,c.M9)("30s"),(0,c.M9)("1m"),(0,c.M9)("5m"),(0,c.M9)("10m"),(0,c.M9)("15m"),(0,c.M9)("30m"),(0,c.M9)("1h")],G=(0,c.P8)(M),J=f.filter(W=>G<=W),re=(0,s.times)(8-J.length,W=>{const K=(0,s.last)(J)??G,oe=J.length===0?1:2;return K*oe*(W+1)});return[...J,...re].map(c.an)})(F),ee=({currentInterval:M,onSelect:te})=>n.createElement(v.B,{direction:"row",gap:.5,role:"listbox"},B.map(f=>{const G=M===f;return n.createElement(ne.$n,{role:"option","aria-selected":G,key:f,variant:G?"primary":"secondary",size:"sm",onClick:()=>te(f)},f)}))},1723:(Me,_,a)=>{a.d(_,{R:()=>Be,I:()=>We});var s=a(32196),e=a(96540),n=a(49785),S=a(40845),v=a(67061),ne=a(29158),c=a(88575),F=a(60029),V=a(10354),B=a(94753),ee=a(15292),M=a(56034),te=a(14578),f=a(8484),G=a(25027),J=a(9518),re=a(61410),W=a(57220),K=a(25968),oe=a(64047),ue=a(46479),ae=a(2543),$=a(26272),U=a(13544),Q=a(55852),Ne=a(21594),Ge=a(90613),Y=a(37390),Ce=a(28138),X=a(16233),xe=a(11230),ce=a(31678),de=a(79938),Re=a(730),me=a(63066),Se=a(23662),De=a(48205),Fe=a(99226),g=a(85242);const E=()=>{const t=(0,S.of)(R),r=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return e.createElement(v.B,{gap:.5},e.createElement("div",{className:t.slashNotAllowed},"Folders with '/' character are not allowed."),e.createElement(M.m,{placement:"top",content:"Link to the Github issue",theme:"info"},e.createElement(te.I,{name:"info-circle",size:"xs",className:t.infoIcon,onClick:r})))},I=t=>t.indexOf("/")!==-1;function x(t){const{value:r}=t,o={warningCondition:i=>I(i),warningComponent:E},u={disallowValues:!0,isAllowedValue:i=>!I(i)};return e.createElement(g.sR,{showRoot:!1,rootName:"",allowEmpty:!0,initialFolderUid:r?.uid,searchQueryType:ce.SearchQueryType.AlertFolder,...t,permissionLevel:ce.PermissionLevelString.Edit,customAdd:u,folderWarning:o})}const R=t=>({slashNotAllowed:(0,s.css)({color:t.colors.warning.main,fontSize:"12px",marginBottom:"2px"}),infoIcon:(0,s.css)({color:t.colors.warning.main,fontSize:"12px",marginBottom:"2px",cursor:"pointer"})});var Z=a(7921);const D=1e3,N=(t,r)=>{const{isLoading:l,currentData:o}=de.hK.endpoints.rulerNamespace.useQuery({namespace:t,rulerConfig:Re.$q},{skip:!t,refetchOnMountOrArgChange:!0});return{groupOptions:(0,e.useMemo)(()=>o?(Object.values(o).flat()??[]).map(d=>{const m=O(d);return{label:d.name,value:d.name,description:d.interval??me.T6,isDisabled:r?!1:m,isProvisioned:m}}).sort(Pe):[],[o,r]),loading:l}},O=t=>t.rules.some(r=>(0,Se.lT)(r)&&!!r.grafana_alert.provenance),Pe=(t,r)=>t.label?.localeCompare(r.label??"")||0,Te=(t,r)=>t.label?.toLowerCase().includes(r.toLowerCase());function be({groupfoldersForGrafana:t,enableProvisionedGroups:r}){const{formState:{errors:l},watch:o,setValue:u,control:i}=(0,n.xW)(),d=(0,S.of)(A),m=o("folder"),C=o("group"),{groupOptions:y,loading:h}=N(m?.uid??"",r),[P,T]=(0,e.useState)(!1),[b,L]=(0,e.useState)(!1),le=()=>T(!0),w=()=>L(!0),H=p=>{se(),u("folder",p),T(!1)},Ie=(p,j)=>{u("group",p),u("evaluateEvery",j),L(!1)},se=(0,e.useCallback)(()=>{u("group","")},[u]),q=(0,e.useCallback)(async p=>{const j=p?y.filter(ye=>Te(ye,p)):y;return(0,ae.take)(j,D)},[y]),ze=(0,e.useMemo)(()=>(0,ae.debounce)(q,300,{leading:!0}),[q]),we=C?{value:C,label:C}:void 0;return e.createElement("div",{className:d.container},e.createElement(v.B,{alignItems:"center"},e.createElement(c.D,{label:e.createElement(F.J,{htmlFor:"folder",description:"Select a folder to store your rule."},"Folder"),className:d.formInput,error:l.folder?.message,"data-testid":"folder-picker"},e.createElement(v.B,{direction:"row",alignItems:"center"},!P&&e.createElement(e.Fragment,null,e.createElement(n.xI,{render:({field:{ref:p,...j}})=>e.createElement("div",{style:{width:420}},e.createElement(x,{inputId:"folder",invalid:!!l.folder?.message,...j,enableReset:!0,onChange:({title:ye,uid:ie})=>{j.onChange({title:ye,uid:ie}),se()}})),name:"folder",rules:{required:{value:!0,message:"Select a folder"},validate:{pathSeparator:p=>(0,Z.G0)(p.uid)}}}),e.createElement(B.E,{color:"secondary"},"or"),e.createElement(Q.$n,{onClick:le,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!X.TP.hasPermission(ce.AccessControlAction.FoldersCreate),"data-testid":U.Tp.components.AlertRules.newFolderButton},"New folder"))||e.createElement("div",null,"Creating new folder..."))),P&&e.createElement(ve,{onCreate:H,onClose:()=>T(!1)})),P&&e.createElement(ve,{onCreate:H,onClose:()=>T(!1)}),e.createElement(v.B,{alignItems:"center"},e.createElement("div",{style:{width:420}},e.createElement(c.D,{label:"Evaluation group and interval","data-testid":"group-picker",description:"Define how often the alert rule is evaluated.",className:d.formInput,error:l.group?.message,invalid:!!l.group?.message},e.createElement(n.xI,{render:({field:{ref:p,...j},fieldState:ye})=>e.createElement(Ne.DW,{disabled:!m||h,inputId:"group",key:(0,ae.uniqueId)(),...j,onChange:ie=>{j.onChange(ie.label??"")},isLoading:h,invalid:!!m&&!C&&!!ye.error,loadOptions:ze,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:we,defaultOptions:y,getOptionLabel:ie=>e.createElement("div",null,e.createElement("span",null,ie.label),ie.isProvisioned&&e.createElement(e.Fragment,null," ",e.createElement(De.rS,null))),placeholder:"Select an evaluation group..."}),name:"group",control:i,rules:{required:{value:!0,message:"Must enter a group name"},validate:{pathSeparator:p=>(0,Z.G0)(p)}}}))),e.createElement(Ge.a,{marginTop:4,gap:1,display:"flex",alignItems:"center"},e.createElement(B.E,{color:"secondary"},"or"),e.createElement(Q.$n,{onClick:w,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!m,"data-testid":U.Tp.components.AlertRules.newEvaluationGroupButton},"New evaluation group")),b&&e.createElement(Oe,{onCreate:Ie,onClose:()=>L(!1),groupfoldersForGrafana:t})))}function ve({onClose:t,onCreate:r}){const l=(0,S.of)(A),[o,u]=(0,e.useState)(""),i=async()=>{const m=await(0,xe.vV)({title:o});if(!m.uid){Ce.A.emit($.r1.alertError,["Folder could not be created"]);return}const C={title:m.title,uid:m.uid};r(C),Ce.A.emit($.r1.alertSuccess,["Folder Created","OK"])},d=I(o);return e.createElement(Y.a,{className:l.modal,isOpen:!0,title:"New folder",onDismiss:t,onClickBackdrop:t},e.createElement("div",{className:l.modalTitle},"Create a new folder to store your rule"),e.createElement("form",{onSubmit:i},e.createElement(c.D,{label:e.createElement(F.J,{htmlFor:"folder"},"Folder name"),error:"The folder name can't contain slashes",invalid:d},e.createElement(V.p,{"data-testid":U.Tp.components.AlertRules.newFolderNameField,autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:o,onChange:m=>u(m.currentTarget.value),className:l.formInput})),e.createElement(Y.a.ButtonRow,null,e.createElement(Q.$n,{variant:"secondary",type:"button",onClick:t},"Cancel"),e.createElement(Q.$n,{type:"submit",disabled:!o||d,"data-testid":U.Tp.components.AlertRules.newFolderNameCreateButton},"Create"))))}function Oe({onClose:t,onCreate:r,groupfoldersForGrafana:l}){const o=(0,S.of)(A),u=()=>{r(w("group"),w("evaluateEvery"))},{watch:i}=(0,n.xW)(),d="eval-every-input",[m,C]=i(["group","folder.title"]),y=(l&&l[C]?.find(q=>q.name===m)?.rules)??[],h=()=>{t()},P=(0,n.mN)({defaultValues:{group:"",evaluateEvery:me.T6},mode:"onChange",shouldFocusError:!0}),{register:T,handleSubmit:b,formState:L,setValue:le,getValues:w,watch:H}=P,Ie=H("evaluateEvery"),se=q=>{le("evaluateEvery",q,{shouldValidate:!0})};return e.createElement(Y.a,{className:o.modal,isOpen:!0,title:"New evaluation group",onDismiss:h,onClickBackdrop:h},e.createElement("div",{className:o.modalTitle},"Create a new evaluation group to use for this alert rule."),e.createElement(n.Op,{...P},e.createElement("form",{onSubmit:b(()=>u())},e.createElement(c.D,{label:e.createElement(F.J,{htmlFor:"group",description:"A group evaluates all its rules over the same evaluation interval."},"Evaluation group"),error:L.errors.group?.message,invalid:!!L.errors.group},e.createElement(V.p,{"data-testid":U.Tp.components.AlertRules.newEvaluationGroupName,className:o.formInput,autoFocus:!0,id:"group",placeholder:"Enter a name",...T("group",{required:{value:!0,message:"Required."}})})),e.createElement(c.D,{error:L.errors.evaluateEvery?.message,invalid:L.errors.evaluateEvery?!0:void 0,label:e.createElement(F.J,{htmlFor:d,description:"How often all rules in the group are evaluated."},"Evaluation interval")},e.createElement(v.B,{direction:"column"},e.createElement(V.p,{"data-testid":U.Tp.components.AlertRules.newEvaluationGroupInterval,className:o.formInput,id:d,placeholder:me.T6,...T("evaluateEvery",(0,ue.iS)(y))}),e.createElement(v.B,{direction:"row",alignItems:"flex-end"},e.createElement(Fe.gv,{currentInterval:Ie,onSelect:se})))),e.createElement(Y.a.ButtonRow,null,e.createElement(Q.$n,{variant:"secondary",type:"button",onClick:h},"Cancel"),e.createElement(Q.$n,{type:"submit",disabled:!L.isValid,"data-testid":U.Tp.components.AlertRules.newEvaluationGroupCreate},"Create")))))}const A=t=>({container:(0,s.css)({display:"flex",flexDirection:"column",alignItems:"baseline",maxWidth:`${t.breakpoints.values.lg}px`,justifyContent:"space-between"}),formInput:(0,s.css)({flexGrow:1}),modal:(0,s.css)({width:`${t.breakpoints.values.sm}px`}),modalTitle:(0,s.css)({color:t.colors.text.secondary,marginBottom:t.spacing(2)})});var z=a(94822);const ge=[{value:z.Q8.Alerting,label:"Alerting"},{value:z.Q8.NoData,label:"No Data"},{value:z.Q8.OK,label:"Normal"},{value:z.Q8.Error,label:"Error"},{value:z.Q8.KeepLast,label:"Keep Last State"}],Ae=({includeNoData:t,includeError:r,...l})=>{const o=(0,e.useMemo)(()=>t?r?ge:ge.filter(u=>u.value!==z.Q8.Error):ge.filter(u=>u.value!==z.Q8.NoData),[t,r]);return e.createElement(Ne.l6,{options:o,...l})};var pe=a(64100);function Le(t){const r=(0,K.P8)(t);return[0,r*1,r*2,r*3,r*4,r*5].map(K.an)}function fe({selectedPendingPeriod:t,groupEvaluationInterval:r,onSelect:l}){const o=i=>t===i,u=Le(r);return e.createElement(v.B,{direction:"row",gap:.5,role:"listbox"},u.map(i=>e.createElement(Q.$n,{role:"option","aria-selected":o(i),key:i,variant:o(i)?"primary":"secondary",size:"sm",onClick:()=>{l(i)}},i==="0s"?"None":i)))}var Ve=a(271);const We=10,k=t=>({required:{value:!0,message:"Required."},validate:r=>{if(r==="0")return!0;try{const l=(0,K.M9)(r);if(l===0)return!0;try{const o=(0,K.M9)(t);return l>=o?!0:(0,f.t)("alert-rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(l){return l instanceof Error?l.message:(0,f.t)("alert-rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}}),Ke=(t,r)=>{const{groupOptions:l}=N(t,!1);return!(0,e.useCallback)(u=>l.some(i=>i.label===u),[l])(r)};function $e({evaluateEvery:t,setEvaluateEvery:r,enableProvisionedGroups:l}){const o=(0,S.of)(he),{watch:u,setValue:i,getValues:d}=(0,n.xW)(),[m,C]=(0,e.useState)(!1),[y,h,P]=u(["group","folder.uid","folder.title"]),b=(0,re.$)(p=>p.rulerRules)[W.hY],le=(0,J.dy)(W.hY).find(p=>p.uid===h),w=le?.groups.find(p=>p.name===y),H=Ke(h??"",y);(0,e.useEffect)(()=>{!H&&w?.interval&&r(w.interval)},[r,H,i,w]);const Ie=(p=!1)=>{p||(0,G.fH)(G.le.leavingRuleGroupEdit),C(!1)},se=()=>C(!0),q=b?.loading||H||!h||!y,ze={name:P,rulesSource:W.hY,groups:[]},we={name:y,interval:t,rules:[],totals:{}};return e.createElement("div",null,e.createElement(be,{groupfoldersForGrafana:b?.result,enableProvisionedGroups:l}),P&&m&&e.createElement(ue.u5,{namespace:le??ze,group:w??we,folderUid:h,onClose:()=>Ie(),intervalEditOnly:!0,hideFolder:!0}),P&&y&&e.createElement("div",{className:o.evaluationContainer},e.createElement(v.B,{direction:"column",gap:0},e.createElement("div",{className:o.marginTop},e.createElement(v.B,{direction:"column",gap:1},d("group")&&d("evaluateEvery")&&e.createElement("span",null,e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-group.text",evaluateEvery:t},"All rules in the selected group are evaluated every ",{evaluateEvery:t},"."),!H&&e.createElement(ne.K,{name:"pen","aria-label":"Edit",disabled:q,onClick:se})))))))}function Ue({evaluateEvery:t}){const r=(0,S.of)(he),{register:l,formState:{errors:o},setValue:u,watch:i}=(0,n.xW)(),d="eval-for-input",m=i("evaluateFor"),C=y=>{u("evaluateFor",y)};return e.createElement(v.B,{direction:"row","justify-content":"flex-start","align-items":"flex-start"},e.createElement(c.D,{label:e.createElement(F.J,{htmlFor:"evaluateFor",description:'Period the threshold condition must be met to trigger the alert. Selecting "None" triggers the alert immediately once the condition is met.'},e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.pending-period"},"Pending period")),className:r.inlineField,error:o.evaluateFor?.message,invalid:o.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0},e.createElement(v.B,{direction:"row",alignItems:"center"},e.createElement(V.p,{id:d,width:8,...l("evaluateFor",k(t))}),e.createElement(fe,{selectedPendingPeriod:m,groupEvaluationInterval:t,onSelect:C}))))}function Qe(){return e.createElement(v.B,{direction:"row",gap:.5,alignItems:"center"},e.createElement(B.E,{variant:"bodySmall",color:"secondary"},e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.info-help.text"},"Define the alert behavior when the evaluation fails or the query returns no data.")),e.createElement(pe.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"}))}function Ee(){return e.createElement(v.B,{direction:"row",gap:.5,alignItems:"center"},e.createElement(B.E,{variant:"bodySmall",color:"secondary"},e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.description.text"},"Define how the alert rule is evaluated.")),e.createElement(pe.G,{contentText:e.createElement(e.Fragment,null,e.createElement("p",null,e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description1"},"Evaluation groups are containers for evaluating alert and recording rules.")),e.createElement("p",null,e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description2"},"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval.")),e.createElement("p",null,e.createElement(f.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description3"},"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."))),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"}))}function Be({evaluateEvery:t,setEvaluateEvery:r,existing:l,enableProvisionedGroups:o}){const u=(0,S.of)(he),[i,d]=(0,e.useState)(!1),{watch:m,setValue:C}=(0,n.xW)(),y=m("isPaused");return e.createElement(Ve.P,{stepNo:3,title:"Set evaluation behavior",description:Ee()},e.createElement(v.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start"},e.createElement($e,{setEvaluateEvery:r,evaluateEvery:t,enableProvisionedGroups:o}),e.createElement(Ue,{evaluateEvery:t}),l&&e.createElement(c.D,{htmlFor:"pause-alert-switch"},e.createElement(n.xI,{render:()=>e.createElement(v.B,{gap:1,direction:"row",alignItems:"center"},e.createElement(ee.d,{id:"pause-alert",onChange:h=>{C("isPaused",h.currentTarget.checked)},value:!!y}),e.createElement("label",{htmlFor:"pause-alert",className:u.switchLabel},e.createElement(f.x6,{i18nKey:"alert-rule-form.pause"},"Pause evaluation"),e.createElement(M.m,{placement:"top",content:"Turn on to pause evaluation for this alert rule.",theme:"info"},e.createElement(te.I,{tabIndex:0,name:"info-circle",size:"sm",className:u.infoIcon})))),name:"isPaused"}))),e.createElement(oe.e,{isCollapsed:!i,onToggle:h=>d(!h),text:"Configure no data and error handling"}),i&&e.createElement(e.Fragment,null,e.createElement(Qe,null),e.createElement(c.D,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null"},e.createElement(n.xI,{render:({field:{onChange:h,ref:P,...T}})=>e.createElement(Ae,{...T,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:b=>h(b?.value)}),name:"noDataState"})),e.createElement(c.D,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout"},e.createElement(n.xI,{render:({field:{onChange:h,ref:P,...T}})=>e.createElement(Ae,{...T,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:b=>h(b?.value)}),name:"execErrState"}))))}const he=t=>({inlineField:(0,s.css)({marginBottom:0}),evaluateLabel:(0,s.css)({marginRight:t.spacing(1)}),evaluationContainer:(0,s.css)({color:t.colors.text.secondary,maxWidth:`${t.breakpoints.values.sm}px`,fontSize:t.typography.size.sm}),intervalChangedLabel:(0,s.css)({marginBottom:t.spacing(1)}),warningIcon:(0,s.css)({justifySelf:"center",marginRight:t.spacing(1),color:t.colors.warning.text}),infoIcon:(0,s.css)({marginLeft:"10px"}),warningMessage:(0,s.css)({color:t.colors.warning.text}),bold:(0,s.css)({fontWeight:"bold"}),alignInterval:(0,s.css)({marginTop:t.spacing(1),marginLeft:`-${t.spacing(1)}`}),marginTop:(0,s.css)({marginTop:t.spacing(1)}),switchLabel:(0,s.css)({color:t.colors.text.primary,cursor:"pointer",fontSize:t.typography.bodySmall.fontSize})})},46479:(Me,_,a)=>{a.d(_,{u5:()=>De,iS:()=>Se});var s=a(32196),e=a(2543),n=a(96540),S=a(49785),v=a(39938),ne=a(40845),c=a(37390),F=a(67061),V=a(88575),B=a(60029),ee=a(10354),M=a(55852),te=a(3169),f=a(40715),G=a(31678),J=a(61410),re=a(23770),W=a(82775),K=a(57220),oe=a(88467),ue=a(63066),ae=a(23662),$=a(25968),U=a(75591),Q=a(32264),Ne=a(42418);const Ge=()=>n.createElement(Ne.F,{severity:"warning",title:"Global evaluation interval limit exceeded"},"A minimum evaluation interval of ",n.createElement("strong",null,Q.$.unifiedAlerting.minInterval)," has been configured in Grafana.",n.createElement("br",null),"Please contact the administrator to configure a lower interval.");var Y=a(99106),Ce=a(99226),X=a(1723),xe=a(7921);const ce=10;function de({message:g,error:E}){return E?n.createElement(v.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:g}):n.createElement(v.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:g})}const Re=g=>{try{const E=(0,$.M9)(g);return!(E<X.I*1e3||E%(X.I*1e3)!==0)}catch{return!1}},me=({rulesWithoutRecordingRules:g})=>{const E=(0,ne.of)(Fe),{watch:I}=(0,S.xW)(),x=I("groupInterval"),R=!x,Z=g.slice().map((N,O)=>({id:O,data:(0,ae.jg)(N,x)})).sort((N,O)=>(0,$.P8)(N.data.forDuration)-(0,$.P8)(O.data.forDuration)),D=(0,n.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:N}})=>n.createElement(n.Fragment,null,N),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:N}})=>n.createElement(n.Fragment,null,N),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:N}})=>R?n.createElement(de,{message:"#Evaluations not available."}):Re(x)?N===0?n.createElement(de,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):n.createElement(n.Fragment,null,N):n.createElement(de,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[x,R]);return n.createElement("div",{className:E.tableWrapper},n.createElement(U.E,{items:Z,cols:D,pagination:{itemsPerPage:ce}}))},Se=g=>({required:{value:!0,message:"Required."},validate:E=>{try{const I=(0,$.M9)(E);if(I<X.I*1e3)return`Cannot be less than ${X.I} seconds.`;if(I%(X.I*1e3)!==0)return`Must be a multiple of ${X.I} seconds.`;if((0,re.uQ)(g,E).length===0)return!0;{const x=g.map(Z=>{const{forDuration:D}=(0,ae.jg)(Z,E);return(0,$.P8)(D)}),R=Math.min(...x);return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,$.an)(R)}".`}}catch(I){return I instanceof Error?I.message:"Failed to parse duration"}}});function De(g){const{namespace:E,group:I,onClose:x,intervalEditOnly:R,folderUid:Z}=g,D=(0,ne.of)(Fe),N=(0,G.useDispatch)(),{loading:O,error:Pe,dispatched:Te}=(0,J.$)(t=>t.updateLotexNamespaceAndGroup)??oe.jA,be=(0,te._2)(),ve=(0,n.useMemo)(()=>({namespaceName:(0,Y.EL)(E).name,groupName:I.name,groupInterval:I.interval??ue.T6}),[E,I.name,I.interval]),Oe=(0,K.EV)(E.rulesSource),A=Oe===K.hY,z=(0,Y.EL)(E).parents,ge=A?"Folder":"Namespace";(0,n.useEffect)(()=>{Te&&!O&&!Pe&&x(!0)},[Te,O,x,Pe]),(0,f.o)(t=>t.unifiedAlerting.updateLotexNamespaceAndGroup=oe.jA);const Ae=t=>{const r=A?(0,Y.wf)(t.namespaceName,z):t.namespaceName;N((0,re.LU)({rulesSourceName:Oe,groupName:I.name,newGroupName:t.groupName,namespaceName:E.name,newNamespaceName:r,groupInterval:t.groupInterval||void 0,folderUid:Z}))},pe=(0,S.mN)({mode:"onBlur",defaultValues:ve,shouldFocusError:!0}),{handleSubmit:Le,register:fe,watch:Ve,formState:{isDirty:We,errors:k,isValid:Ke},setValue:$e,getValues:Ue}=pe,Qe=()=>{be.error("There are errors in the form. Correct the errors and retry.")},Ee=(0,e.compact)(I.rules.map(t=>t.rulerRule).filter(t=>!(0,ae.i7)(t))),Be=Ee.length>0,he=R||A?"Edit evaluation group":"Edit namespace or evaluation group";return n.createElement(c.a,{className:D.modal,isOpen:!0,title:he,onDismiss:x,onClickBackdrop:x},n.createElement(S.Op,{...pe},n.createElement("form",{onSubmit:t=>t.preventDefault(),key:JSON.stringify(ve)},n.createElement(n.Fragment,null,!g.hideFolder&&n.createElement(F.B,{gap:1,alignItems:"center"},n.createElement(V.D,{className:D.formInput,label:n.createElement(B.J,{htmlFor:"namespaceName",description:!A&&"Change the current namespace name. Moving groups between namespaces is not supported"},ge),invalid:k.namespaceName?!0:void 0,error:k.namespaceName?.message},n.createElement(ee.p,{id:"namespaceName",readOnly:R||A,...fe("namespaceName",{required:"Namespace name is required.",validate:{pathSeparator:t=>A?!0:(0,xe.G0)(t)}})})),A&&g.folderUrl&&n.createElement(M.z9,{href:g.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})),n.createElement(V.D,{label:n.createElement(B.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval."},"Evaluation group"),invalid:!!k.groupName,error:k.groupName?.message},n.createElement(ee.p,{autoFocus:!0,id:"groupName",readOnly:R,...fe("groupName",{required:"Evaluation group name is required.",validate:{pathSeparator:t=>(0,xe.G0)(t)}})})),n.createElement(V.D,{label:n.createElement(B.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group."},n.createElement(F.B,{gap:.5},"Evaluation interval")),invalid:k.groupInterval?!0:void 0,error:k.groupInterval?.message},n.createElement(F.B,{direction:"column"},n.createElement(ee.p,{id:"groupInterval",placeholder:ue.T6,...fe("groupInterval",Se(Ee))}),n.createElement(Ce.gv,{currentInterval:Ue("groupInterval"),onSelect:t=>$e("groupInterval",t,{shouldValidate:!0,shouldDirty:!0})}))),(0,W.q)(Ve("groupInterval")).exceedsLimit&&n.createElement(Ge,null),!Be&&n.createElement("div",null,"This group does not contain alert rules."),Be&&n.createElement(n.Fragment,null,n.createElement("div",null,"List of rules that belong to this group"),n.createElement("div",{className:D.evalRequiredLabel},"#Eval column represents the number of evaluations needed before alert starts firing."),n.createElement(me,{rulesWithoutRecordingRules:Ee})),n.createElement("div",{className:D.modalButtons},n.createElement(c.a.ButtonRow,null,n.createElement(M.$n,{variant:"secondary",type:"button",disabled:O,onClick:()=>x(!1),fill:"outline"},"Cancel"),n.createElement(M.$n,{type:"button",disabled:!We||!Ke||O,onClick:Le(t=>Ae(t),Qe)},O?"Saving...":"Save")))))))}const Fe=g=>({modal:(0,s.css)({maxWidth:"560px"}),modalButtons:(0,s.css)({top:"-24px",position:"relative"}),formInput:(0,s.css)({flex:1}),tableWrapper:(0,s.css)({marginTop:g.spacing(2),marginBottom:g.spacing(2),height:"100%"}),evalRequiredLabel:(0,s.css)({fontSize:g.typography.bodySmall.fontSize})})},41520:(Me,_,a)=>{a.d(_,{V:()=>n});var s=a(96540),e=a(75471);function n(){return(0,s.useMemo)(()=>(0,e.Q9)(),[])}}}]);

//# sourceMappingURL=6552.da44b892df82ebe2e5da.js.map