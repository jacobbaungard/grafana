"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{73725:(q,x,t)=>{t.d(x,{r:()=>R});var n=t(96540),e=t(16817),D=t(88323),g=t(14578),P=t(53477),E=t(24439);const v=()=>(0,E.getGrafanaSearcher)().getSortOptions();function R({onChange:I,value:w,placeholder:W,filter:F,getSortOptions:b,isClearable:S}){const L=(0,e.A)(async()=>{const m=await(b??v)();return F?m.filter($=>F.includes($.value)):m},[b,F]);if(L.loading)return null;const B=!!(w?.includes("desc")||w?.startsWith("-"));return n.createElement(D.l6,{key:w,width:28,onChange:I,value:L.value?.find(m=>m.value===w)??null,options:L.value,"aria-label":"Sort",placeholder:W??`Sort (Default ${P.r4.label})`,prefix:n.createElement(g.I,{name:B?"sort-amount-down":"sort-amount-up"}),isClearable:S})}},32538:(q,x,t)=>{t.r(x),t.d(x,{default:()=>Nt});var n=t(32196),e=t(96540),D=t(70713),g=t(14110),P=t(40845),E=t(67647),v=t(36830),R=t(80348),I=t(71101),w=t(2543),W=t(12131),F=t(2619),b=t(33390),S=t(53477),L=t(6204),B=t(24439),m=t(64161),$=t(16757);const V={query:"",tag:[],starred:!1,layout:m.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},K={sort:null,starred:null,query:null,tag:null,layout:null},se=()=>localStorage.getItem(S.YU)===m.P.List?m.P.List:m.P.Folders;class ne extends F.Q{constructor(){super(...arguments),this.updateLocation=(0,w.debounce)(a=>W.Ny.partial(a,!0),300),this.doSearchWithDebounce=(0,w.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...K})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(o=>o!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const o=a.currentTarget.checked;this.setStateAndDoSearch({starred:o})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(S.w7,a):localStorage.removeItem(S.w7),this.state.layout===m.P.Folders?this.setStateAndDoSearch({sort:a,layout:m.P.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(S.YU,a),this.state.sort&&a===m.P.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),b.A.set(S.d7,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,B.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,L.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,L.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,o=!0){const r=(0,$.N1)(W.Ny.getSearchObject());(r.query||r.datasource||r.panel_type)&&(r.layout=m.P.List);const i=se(),l=localStorage.getItem(S.w7)??void 0,c=i===m.P.List?r.sort||l:null;ee.setState({...V,...r,layout:i,sort:c??V.sort,prevSort:l,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),o&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const o=a.sort||this.state.sort||localStorage.getItem(S.w7)||void 0;this.setState({sort:o,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.layout===m.P.List}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,L.J$)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const o=(0,B.getGrafanaSearcher)(),r=Date.now();(this.state.starred?o.starred(this.lastQuery):o.search(this.lastQuery)).then(l=>{r>this.lastSearchTimestamp&&(this.setState({result:l,loading:!1}),this.lastSearchTimestamp=r)}).catch(l=>{(0,L.KZ)(this.state.eventTrackingNamespace,{...a,error:l?.message}),this.setState({loading:!1})})}}let ee;function ce(){if(!ee){const a=localStorage.getItem(S.YU)??V.layout;let o=b.A.getBool(S.d7,!0);o&&(o=!1),ee=new ne({...V,layout:a,includePanels:o})}return ee}function te(){const s=ce();return[s.useState(),s]}var Y=t(82076),J=t(55314),_=t(32264),G=t(55852),me=t(56034),oe=t(28138),p=t(44836),de=t(28444),M=t(37690),ge=t(18241),fe=t(51887);function Ee(){const s=(0,P.of)(ve),a=(0,R.useDispatch)(),o=(0,M.xK)(),[r]=(0,J.uz)(),[i]=(0,J.wt)(),[,l]=te(),c=(0,e.useMemo)(()=>!_.$.featureToggles.nestedFolders&&Object.values(o.folder).some(d=>d),[o]),u=l.hasSearchFilters(),f=()=>{a((0,M.cT)({isSelected:!1,folderUID:void 0})),u&&l.doSearchWithDebounce()},T=async()=>{await r({selectedItems:o}),j("delete",o),f()},h=async d=>{await i({selectedItems:o,destinationUID:d}),j("move",o),f()},y=()=>{oe.A.publish(new de.S8({component:fe.J,props:{selectedItems:o,onConfirm:h}}))},A=()=>{oe.A.publish(new de.S8({component:ge.T,props:{selectedItems:o,onConfirm:T}}))},O=e.createElement(G.$n,{onClick:y,variant:"secondary",disabled:c},e.createElement(p.x6,{i18nKey:"browse-dashboards.action.move-button"},"Move"));return e.createElement("div",{className:s.row,"data-testid":"manage-actions"},c?e.createElement(me.m,{content:(0,p.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved")},O):O,e.createElement(G.$n,{onClick:A,variant:"destructive"},e.createElement(p.x6,{i18nKey:"browse-dashboards.action.delete-button"},"Delete")))}const ve=s=>({row:(0,n.css)({display:"flex",flexDirection:"row",gap:s.spacing(1),marginBottom:s.spacing(2)})}),pe={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function j(s,a){const o=Object.keys(a.dashboard).filter(i=>a.dashboard[i]),r=Object.keys(a.folder).filter(i=>a.folder[i]);(0,g.rR)(pe[s],{item_counts:{folder:r.length,dashboard:o.length},source:"tree_actions"})}var re=t(66864),le=t(10880),$e=t(94354),Ve=t(73725),ze=t(99818);function He(){return[{value:m.P.Folders,icon:"folder",description:(0,p.t)("search.actions.view-as-folders","View by folders")},{value:m.P.List,icon:"list-ul",description:(0,p.t)("search.actions.view-as-list","View as list")}]}function Ge(s){const a=s.layout??m.P.Folders;return a===m.P.Folders&&(s.query||s.sort||s.starred||s.tag.length>0)?m.P.List:a}const Ae=({onLayoutChange:s,onSortChange:a,onStarredFilterChange:o=()=>{},onTagFilterChange:r,getTagOptions:i,getSortOptions:l,sortPlaceholder:c,onDatasourceChange:u,onPanelTypeChange:f,onSetIncludePanels:T,state:h,showStarredFilter:y,hideLayout:A})=>{const O=(0,P.of)(Qe),d=Ge(h),C=h.tag.length||h.starred||h.query||h.datasource||h.panel_type?[m.P.Folders]:[];return e.createElement("div",{className:O.actionRow},e.createElement(re.Gy,{spacing:"md",width:"auto"},e.createElement(ze.$,{isClearable:!1,tags:h.tag,tagOptions:i,onChange:r}),_.$.featureToggles.panelTitleSearch&&e.createElement(le.S,{"data-testid":"include-panels",disabled:d===m.P.Folders,value:h.includePanels,onChange:()=>T(!h.includePanels),label:(0,p.t)("search.actions.include-panels","Include panels")}),y&&e.createElement("div",{className:O.checkboxWrapper},e.createElement(le.S,{label:(0,p.t)("search.actions.starred","Starred"),onChange:o,value:h.starred})),h.datasource&&e.createElement(G.$n,{icon:"times",variant:"secondary",onClick:()=>u(void 0)},e.createElement(p.x6,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:h.datasource})),h.panel_type&&e.createElement(G.$n,{icon:"times",variant:"secondary",onClick:()=>f(void 0)},"Panel: ",h.panel_type)),e.createElement(re.Gy,{spacing:"md",width:"auto"},!A&&e.createElement($e.z,{options:He(),disabledOptions:C,onChange:s,value:d}),e.createElement(Ve.r,{onChange:z=>a(z?.value),value:h.sort,getSortOptions:l,placeholder:c||(0,p.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};Ae.displayName="ActionRow";const Qe=s=>({actionRow:(0,n.css)`
      display: none;

      ${s.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${s.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:(0,n.css)`
      label {
        line-height: 1.2;
      }
    `});function je(){const[s,a]=te();return e.createElement("div",null,e.createElement(Ae,{showStarredFilter:!0,state:s,getTagOptions:a.getTagOptions,getSortOptions:(0,B.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,B.getGrafanaSearcher)().sortPlaceholder,includePanels:s.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var Ze=t(76442),Ye=t(7521),Je=t(92955),N=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(N||{}),Xe=t(32885),ke=t(91793),_e=t(10022),qe=t(39070),ie=t(13544),ye=t(49952);function et({row:{original:s},isSelected:a,onItemSelectionChange:o}){const r=s.item;if(!a)return e.createElement(Ce,null);if(r.kind==="ui")return r.uiKind==="pagination-placeholder"?e.createElement(le.S,{disabled:!0,value:!1}):e.createElement(Ce,null);if((0,ye.I)(r.uid))return e.createElement(Ce,null);const i=a(r);return e.createElement(le.S,{"data-testid":ie.Tp.pages.BrowseDashboards.table.checkbox(r.uid),"aria-label":(0,p.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:i===N.Selected,indeterminate:i===N.Mixed,onChange:l=>o?.(r,l.currentTarget.checked)})}function Ce(){const s=(0,P.of)(tt);return e.createElement("span",{className:s.checkboxSpacer})}const tt=s=>({checkboxSpacer:(0,n.css)({paddingLeft:s.spacing(2)})});function at({isSelected:s,onAllSelectionChange:a}){const o=s?.("$all")??N.Unselected;return e.createElement(le.S,{value:o===N.Selected,indeterminate:o===N.Mixed,"aria-label":(0,p.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:r=>{o===N.Mixed?a?.(!1):a?.(r.currentTarget.checked)}})}var st=t(70255),Oe=t(94753),nt=t(29158),ot=t(62930),Le=t(14578),rt=t(50720),Re=t(78318),lt=t(40957),we=t(18759);const De="md",Fe="sm";function it({row:{original:s},onFolderClick:a,treeID:o}){const r=(0,P.of)(ct),{item:i,level:l,isOpen:c}=s,u=(0,M.V6)(),f=c&&!u[i.uid],T=(0,lt.cu)(s.item,c);return i.kind==="ui"?e.createElement(e.Fragment,null,e.createElement(we.T,{level:l,spacing:{xs:1,md:3}}),e.createElement("span",{className:r.folderButtonSpacer}),i.uiKind==="empty-folder"?e.createElement("em",{className:r.emptyText},e.createElement(Oe.E,{variant:"body",color:"secondary",truncate:!0},"No items")):e.createElement(st.A,{width:200})):e.createElement(e.Fragment,null,e.createElement(we.T,{level:l,spacing:{xs:1,md:3}}),i.kind==="folder"?e.createElement(nt.K,{size:De,className:r.chevron,onClick:()=>{a(i.uid,!c)},name:c?"angle-down":"angle-right","aria-label":c?(0,p.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:i.title}):(0,p.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:i.title})}):e.createElement("span",{className:r.folderButtonSpacer}),e.createElement("div",{className:r.iconNameContainer},f?e.createElement(ot.y,{size:Fe}):e.createElement(Le.I,{size:Fe,name:T}),e.createElement(Oe.E,{variant:"body",truncate:!0,id:o&&(0,ye.e)(o,i)},i.url?e.createElement(rt.N,{onClick:()=>{(0,g.rR)("manage_dashboards_result_clicked")},href:i.url,className:r.link},i.title):i.title)))}const ct=s=>({chevron:(0,n.css)({marginRight:s.spacing(1),width:(0,Re.cs)(De)}),emptyText:(0,n.css)({overflow:"hidden"}),folderButtonSpacer:(0,n.css)({paddingLeft:`calc(${(0,Re.cs)(De)}px + ${s.spacing(1)})`}),iconNameContainer:(0,n.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});var Be=t(64149);function dt({row:{original:s}}){const a=(0,P.of)(ht),o=s.item;return o.kind==="ui"?o.uiKind==="pagination-placeholder"?e.createElement(Be.L.Skeleton,null):null:o.tags?e.createElement(Be.L,{className:a.tagList,tags:o.tags}):null}function ht(s){return{tagList:(0,n.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var ut=t(37811);const xe=36,Pe=36,mt=0;function gt({items:s,width:a,height:o,isSelected:r,onFolderClick:i,onAllSelectionChange:l,onItemSelectionChange:c,isItemLoaded:u,requestLoadMore:f,canSelect:T=!1}){const h=(0,e.useId)(),y=(0,e.useRef)(null),A=(0,e.useRef)(null),O=(0,P.of)(Ke);(0,e.useEffect)(()=>{y.current&&y.current.resetloadMoreItemsCache(!0),A.current&&A.current.resetAfterIndex(0)},[s]);const d=(0,e.useMemo)(()=>{const H={id:"checkbox",width:0,Header:at,Cell:et},Z={id:"name",width:3,Header:e.createElement("span",{style:{paddingLeft:24}},e.createElement(p.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column"},"Name")),Cell:Ie=>e.createElement(it,{...Ie,onFolderClick:i})},k={id:"tags",width:2,Header:(0,p.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:dt};return[T&&H,Z,k].filter(qe.zz)},[i,T]),C=(0,Xe.useTable)({columns:d,data:s},ut.A),{getTableProps:z,getTableBodyProps:X,headerGroups:U}=C,Q=(0,e.useMemo)(()=>({table:C,isSelected:r,onAllSelectionChange:l,onItemSelectionChange:c,treeID:h}),[C,r,l,c,s,h]),ue=(0,e.useCallback)(H=>u(H),[u]),Me=(0,e.useCallback)((H,Z)=>{const{parentUID:k}=s[H];f(k)},[f,s]),Ut=(0,e.useCallback)(H=>{const Z=s[H];return Z.item.kind==="ui"&&Z.item.uiKind==="divider"?mt:Pe},[s]);return e.createElement("div",{...z(),role:"table"},U.map(H=>{const{key:Z,...k}=H.getHeaderGroupProps({style:{width:a}});return e.createElement("div",{key:Z,...k,className:(0,n.cx)(O.row,O.headerRow)},H.headers.map(Te=>{const{key:Ie,...Wt}=Te.getHeaderProps();return e.createElement("div",{key:Ie,...Wt,role:"columnheader",className:O.cell},Te.render("Header",{isSelected:r,onAllSelectionChange:l}))}))}),e.createElement("div",{...X(),"data-testid":ie.Tp.pages.BrowseDashboards.table.body},e.createElement(_e.A,{ref:y,itemCount:s.length,isItemLoaded:ue,loadMoreItems:Me},({onItemsRendered:H,ref:Z})=>e.createElement(ke._m,{ref:k=>{Z(k),A.current=k},height:o-xe,width:a,itemCount:s.length,itemData:Q,estimatedItemSize:Pe,itemSize:Ut,onItemsRendered:H},ft))))}function ft({index:s,style:a,data:o}){const r=(0,P.of)(Ke),{table:i,isSelected:l,onItemSelectionChange:c,treeID:u}=o,{rows:f,prepareRow:T}=i,h=f[s];T(h);const y=h.original.item;return y.kind==="ui"&&y.uiKind==="divider"?e.createElement("div",{...h.getRowProps({style:a})},e.createElement("hr",{className:r.divider})):e.createElement("div",{...h.getRowProps({style:a}),className:(0,n.cx)(r.row,r.bodyRow),"aria-labelledby":(0,ye.e)(u,y),"data-testid":ie.Tp.pages.BrowseDashboards.table.row("title"in y?y.title:y.uid)},h.cells.map(A=>{const{key:O,...d}=A.getCellProps();return e.createElement("div",{key:O,...d,className:r.cell},A.render("Cell",{isSelected:l,onItemSelectionChange:c,treeID:u}))}))}const Ke=s=>({row:(0,n.css)({gap:s.spacing(1)}),divider:(0,n.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,n.css)({backgroundColor:s.colors.background.secondary,height:xe}),bodyRow:(0,n.css)({height:Pe,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,n.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});function Et({folderUID:s,width:a,height:o,canSelect:r}){const i=(0,M.eC)(s),l=(0,R.useDispatch)(),c=(0,M.q0)(s),u=(0,M.Ms)(),f=(0,M.V6)(),T=(0,e.useCallback)((d,C)=>{l((0,M.wn)({folderUID:d,isOpen:C})),C&&l((0,M.Ii)({parentUID:d,pageSize:Je.md}))},[l]),h=(0,e.useCallback)((d,C)=>{l((0,M.t$)({item:d,isSelected:C}))},[l]),y=(0,e.useCallback)(d=>{if(d==="$all"){if(u.$all)return N.Selected;for(const X of Object.values(u))if(typeof X!="boolean"){for(const U in X)if(X[U])return N.Mixed}return N.Unselected}return u[d.kind][d.uid]?N.Selected:Ne(d,f,u)?N.Mixed:N.Unselected},[u,f]),A=(0,e.useCallback)(d=>{const C=c[d];if(!C)return!1;const z=C.item;return!(z.kind==="ui"&&z.uiKind==="pagination-placeholder")},[c]),O=(0,M.Zg)();return i==="fulfilled"&&c.length===0?e.createElement("div",{style:{width:a}},r?e.createElement(Ye.A,{title:s?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:s?`dashboard/new?folderUid=${s}`:"dashboard/new",proTip:s&&"Add/move dashboards to your folder at ->",proTipLink:s&&"dashboards",proTipLinkTitle:s&&"Browse dashboards",proTipTarget:""}):e.createElement(Ze.c,{callToActionElement:e.createElement("span",null,"This folder is empty")})):e.createElement(gt,{canSelect:r,items:c,width:a,height:o,isSelected:y,onFolderClick:T,onAllSelectionChange:d=>l((0,M.cT)({isSelected:d,folderUID:s})),onItemSelectionChange:h,isItemLoaded:A,requestLoadMore:O})}function Ne(s,a,o){const r=a[s.uid];return r?r.items.some(i=>{const l=o[i.kind][i.uid];return l||Ne(i,a,o)}):!1}var vt=t(24180),pt=t(38138),be=t(64539),yt=t(83122),Ct=t(87978),Dt=t(51253),Pt=t(88575),bt=t(10354),St=t(71500);const Mt={folderName:""};function Tt({onCancel:s,onConfirm:a}){const o=(0,p.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),r=async l=>{try{return await St.P.validateNewFolderName(l),!0}catch(c){if(c instanceof Error)return c.message;throw c}},i=(0,p.t)("browse-dashboards.new-folder-form.name-label","Folder name");return e.createElement(Dt.l,{defaultValues:Mt,onSubmit:l=>a(l.folderName),"data-testid":ie.Tp.pages.BrowseDashboards.NewFolderForm.form},({register:l,errors:c})=>e.createElement(e.Fragment,null,e.createElement(Pt.D,{label:i,invalid:!!c.folderName,error:c.folderName&&c.folderName.message},e.createElement(bt.p,{"data-testid":ie.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",...l("folderName",{required:o,validate:async u=>await r(u)})})),e.createElement(re.Gy,null,e.createElement(G.$n,{variant:"secondary",fill:"outline",onClick:s},e.createElement(p.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label"},"Cancel")),e.createElement(G.$n,{type:"submit"},e.createElement(p.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label"},"Create")))))}function It({parentFolder:s,canCreateDashboard:a,canCreateFolder:o}){const[r,i]=(0,e.useState)(!1),l=(0,vt.zy)(),[c]=(0,J.Vc)(),[u,f]=(0,e.useState)(!1),T=async y=>{try{await c({title:y,parentUid:s?.uid});const A=s?.parents?s.parents.length+1:0;(0,g.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:A})}finally{f(!1)}},h=e.createElement(pt.W,null,a&&e.createElement(be.D,{label:(0,Y.m0)(),onClick:()=>(0,g.rR)("grafana_menu_item_clicked",{url:he("/dashboard/new",s?.uid),from:l.pathname}),url:he("/dashboard/new",s?.uid)}),o&&e.createElement(be.D,{onClick:()=>f(!0),label:(0,Y.CD)()}),a&&e.createElement(be.D,{label:(0,Y.ZX)(),onClick:()=>(0,g.rR)("grafana_menu_item_clicked",{url:he("/dashboard/import",s?.uid),from:l.pathname}),url:he("/dashboard/import",s?.uid)}));return e.createElement(e.Fragment,null,e.createElement(yt.m,{overlay:h,onVisibleChange:i},e.createElement(G.$n,null,(0,Y.Oj)(),e.createElement(Le.I,{name:r?"angle-up":"angle-down"}))),u&&e.createElement(Ct._,{title:(0,Y.CD)(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>f(!1),size:"sm"},e.createElement(Tt,{onConfirm:T,onCancel:()=>f(!1)})))}function he(s,a){const o=a?s+"?folderUid="+a:s;return _.$.appSubUrl?_.$.appSubUrl+o:o}var At=t(9134),Ot=t(78368),Lt=t(14236),Se=t(10860),Rt=t(97427),wt=t(66359);const ae=50,Ft={view:new Ot.R((0,Lt.Vc)({fields:[{name:"uid",display:!0,values:Array(ae).fill(null)},{name:"kind",display:!0,values:Array(ae).fill("dashboard")},{name:"name",display:!0,values:Array(ae).fill("")},{name:"location",display:!0,values:Array(ae).fill("")},{name:"tags",display:!0,values:Array(ae).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:ae};function Bt({width:s,height:a,canSelect:o}){const r=(0,R.useDispatch)(),i=(0,R.useSelector)(d=>d.browseDashboards.selectedItems),l=(0,M.QE)(),{keyboardEvents:c}=(0,Rt.d)(),[u,f]=te(),T=u.result??Ft,h=(0,e.useCallback)((d,C)=>d?d==="*"&&C==="*"?l:d==="*"?!1:i[Ue(d)][C]??!1:!1,[i,l]),y=(0,e.useCallback)(()=>{r((0,M.cT)({isSelected:!1,folderUID:void 0}))},[r]),A=(0,e.useCallback)((d,C)=>{const z=!h(d,C);r((0,M.t$)({item:{kind:Ue(d),uid:C},isSelected:z}))},[h,r]);if(T.totalRows===0)return e.createElement("div",{style:{width:s}},e.createElement(Se.Z,null,e.createElement(Se.Z.Heading,null,e.createElement(p.x6,{i18nKey:"browse-dashboards.no-results.text"},"No results found for your query.")),e.createElement(Se.Z.Actions,null,e.createElement(G.$n,{variant:"secondary",onClick:f.onClearSearchAndFilters},e.createElement(p.x6,{i18nKey:"browse-dashboards.no-results.clear"},"Clear search and filters")))));const O={response:T,selection:o?h:void 0,selectionToggle:o?A:void 0,clearSelection:y,width:s,height:a,onTagSelected:f.onAddTag,keyboardEvents:c,onDatasourceChange:u.datasource?f.onDatasourceChange:void 0,onClickItem:f.onSearchItemClicked};return e.createElement(wt.P,{...O})}function Ue(s){switch(s){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+s)}var xt=t(49904);const We=(0,e.memo)(({match:s})=>{const{uid:a}=s.params,o=(0,R.useDispatch)(),r=(0,P.of)(Kt),[i,l]=te(),c=l.hasSearchFilters();(0,e.useEffect)(()=>{l.initStateFromUrl(a),o((0,M.cT)({isSelected:!1,folderUID:void 0}))},[o,a,l]),(0,e.useEffect)(()=>{!c&&i.result&&l.setState({result:void 0,includePanels:void 0})},[c,i.result,l]);const{data:u}=(0,J.kH)(a??J.hT),[f]=(0,J.iB)(),T=(0,e.useMemo)(()=>{if(!u)return;const U=(0,I.R4)(u),Q=(0,I.Cg)(u.uid),ue=U.children?.find(Me=>Me.id===Q);return ue&&(ue.active=!0),U},[u]),h=(0,M.QE)(),{canEditFolders:y,canEditDashboards:A,canCreateDashboards:O,canCreateFolders:d}=(0,xt.N)(u),C=y&&a,z=y||A,X=async U=>{if(u){const Q=await f({...u,title:U});if("error"in Q)throw(0,g.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:Q.error}),Q.error;(0,g.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,g.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return e.createElement(v.Y,{navId:"dashboards/browse",pageNav:T,onEditTitle:C?X:void 0,actions:e.createElement(e.Fragment,null,u&&e.createElement(At.m,{folder:u}),(O||d)&&e.createElement(It,{parentFolder:u,canCreateDashboard:O,canCreateFolder:d}))},e.createElement(v.Y.Contents,{className:r.pageContents},e.createElement(E.Z,{placeholder:(0,Y.wT)(i.includePanels),value:i.query,escapeRegex:!1,onChange:U=>l.onQueryChange(U)}),h?e.createElement(Ee,null):e.createElement(je,null),e.createElement("div",{className:r.subView},e.createElement(D.Ay,null,({width:U,height:Q})=>c?e.createElement(Bt,{canSelect:z,width:U,height:Q}):e.createElement(Et,{canSelect:z,width:U,height:Q,folderUID:a})))))}),Kt=s=>({pageContents:(0,n.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:s.spacing(1)}),subView:(0,n.css)({height:"100%"})});We.displayName="BrowseDashboardsPage";const Nt=We},18241:(q,x,t)=>{t.d(x,{T:()=>w});var n=t(96540),e=t(32264),D=t(96374),g=t(94753),P=t(68402),E=t(42418),v=t(44836),R=t(55314),I=t(43907);const w=({onConfirm:W,onDismiss:F,selectedItems:b,...S})=>{const{data:L}=(0,R.G2)(b),B=!e.$.featureToggles.nestedFolders&&L&&(L.alertRule||L.libraryPanel),[m,$]=(0,n.useState)(!1),V=async()=>{$(!0);try{await W(),$(!1),F()}catch{$(!1)}};return n.createElement(D.u,{body:n.createElement(n.Fragment,null,n.createElement(g.E,{element:"p"},n.createElement(v.x6,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),n.createElement(I.x,{selectedItems:b}),n.createElement(P.$,{v:2})),description:n.createElement(n.Fragment,null,B?n.createElement(E.F,{severity:"warning",title:(0,v.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder")},n.createElement(v.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text"},"One or more folders contain library panels or alert rules. Delete these first in order to proceed.")):null),confirmationText:"Delete",confirmText:m?(0,v.t)("browse-dashboards.action.deleting","Deleting..."):(0,v.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:F,onConfirm:V,title:(0,v.t)("browse-dashboards.action.delete-modal-title","Delete"),...S})}},51887:(q,x,t)=>{t.d(x,{J:()=>W});var n=t(96540),e=t(37390),D=t(42418),g=t(94753),P=t(68402),E=t(88575),v=t(55852),R=t(70096),I=t(44836),w=t(43907);const W=({onConfirm:F,onDismiss:b,selectedItems:S,...L})=>{const[B,m]=(0,n.useState)(),[$,V]=(0,n.useState)(!1),K=Object.keys(S.folder).filter(ne=>S.folder[ne]),se=async()=>{if(B!==void 0){V(!0);try{await F(B),V(!1),b()}catch{V(!1)}}};return n.createElement(e.a,{title:(0,I.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:b,...L},K.length>0&&n.createElement(D.F,{severity:"info",title:(0,I.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),n.createElement(g.E,{element:"p"},n.createElement(I.x6,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),n.createElement(w.x,{selectedItems:S}),n.createElement(P.$,{v:3}),n.createElement(E.D,{label:(0,I.t)("browse-dashboards.action.move-modal-field-label","Folder name")},n.createElement(R.d,{value:B,excludeUIDs:K,onChange:m})),n.createElement(e.a.ButtonRow,null,n.createElement(v.$n,{onClick:b,variant:"secondary",fill:"outline"},n.createElement(I.x6,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),n.createElement(v.$n,{disabled:B===void 0||$,onClick:se,variant:"primary"},$?(0,I.t)("browse-dashboards.action.moving","Moving..."):(0,I.t)("browse-dashboards.action.move-button","Move"))))}},9134:(q,x,t)=>{t.d(x,{m:()=>V});var n=t(96540),e=t(32264),D=t(14110),g=t(12131),P=t(38138),E=t(64539),v=t(83122),R=t(55852),I=t(14578),w=t(87978),W=t(5108),F=t(10096),b=t(44836),S=t(28444),L=t(55314),B=t(49904),m=t(18241),$=t(51887);function V({folder:K}){const[se,ne]=(0,n.useState)(!1),[ee,ce]=(0,n.useState)(!1),[te]=(0,L.aF)(),[Y]=(0,L.Ko)(),{canEditFolders:J,canDeleteFolders:_,canViewPermissions:G,canSetPermissions:me}=(0,B.N)(K),oe=e.$.featureToggles.nestedFolders&&J,p=async j=>{await te({folder:K,destinationUID:j}),(0,D.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},de=async()=>{await Y(K),(0,D.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:j}=K,re=j&&j.length?j[j.length-1].url:"/dashboards";g.Ny.push(re)},M=()=>{F.lE.publish(new S.S8({component:$.J,props:{selectedItems:{folder:{[K.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:p}}))},ge=()=>{F.lE.publish(new S.S8({component:m.T,props:{selectedItems:{folder:{[K.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:de}}))},fe=(0,b.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),Ee=(0,b.t)("browse-dashboards.folder-actions-button.move","Move"),ve=(0,b.t)("browse-dashboards.folder-actions-button.delete","Delete"),pe=n.createElement(P.W,null,G&&n.createElement(E.D,{onClick:()=>ce(!0),label:fe}),oe&&n.createElement(E.D,{onClick:M,label:Ee}),_&&n.createElement(E.D,{destructive:!0,onClick:ge,label:ve}));return!G&&!oe&&!_?null:n.createElement(n.Fragment,null,n.createElement(v.m,{overlay:pe,onVisibleChange:ne},n.createElement(R.$n,{variant:"secondary"},n.createElement(b.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),n.createElement(I.I,{name:se?"angle-up":"angle-down"}))),ee&&n.createElement(w._,{title:(0,b.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:K.title,onClose:()=>ce(!1),size:"md"},n.createElement(W.x,{resource:"folders",resourceId:K.uid,canSetPermissions:me})))}},49904:(q,x,t)=>{t.d(x,{N:()=>P});var n=t(32264),e=t(10096),D=t(80348);function g(E,v){return v?e.TP.hasPermissionInMetadata(E,v):e.TP.hasPermission(E)}function P(E){const v=g(D.AccessControlAction.DashboardsCreate,E),R=!!((!E||n.$.featureToggles.nestedFolders)&&g(D.AccessControlAction.FoldersCreate)),I=g(D.AccessControlAction.FoldersDelete,E),w=g(D.AccessControlAction.DashboardsWrite,E),W=g(D.AccessControlAction.FoldersWrite,E),F=g(D.AccessControlAction.FoldersPermissionsWrite,E),b=g(D.AccessControlAction.FoldersPermissionsRead,E);return{canCreateDashboards:v,canCreateFolders:R,canDeleteFolders:I,canEditDashboards:w,canEditFolders:W,canSetPermissions:F,canViewPermissions:b}}},82076:(q,x,t)=>{t.d(x,{CD:()=>g,Oj:()=>E,ZX:()=>P,m0:()=>D,wT:()=>e});var n=t(44836);function e(v=!1){return v?(0,n.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,n.t)("search.search-input.placeholder","Search for dashboards and folders")}function D(){return(0,n.t)("search.dashboard-actions.new-dashboard","New dashboard")}function g(){return(0,n.t)("search.dashboard-actions.new-folder","New folder")}function P(){return(0,n.t)("search.dashboard-actions.import","Import")}function E(){return(0,n.t)("search.dashboard-actions.new","New")}}}]);

//# sourceMappingURL=DashboardListPage.dac1fe75fbaa4f9b1c23.js.map