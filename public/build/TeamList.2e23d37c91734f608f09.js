"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:(G,p,e)=>{e.d(p,{Y:()=>u});var O=e(96540),t=e(41053),r=e(10096),g=e(80348),M=e(37425),A=e(85927);const u=({teamId:f,roleOptions:m,disabled:s,roles:c,onApplyRoles:d,pendingRoles:_,apply:I=!1,maxWidth:y,width:W,isLoading:h})=>{const[{loading:x,value:T=c||[]},E]=(0,t.A)(async()=>{try{if(c)return c;if(I&&_?.length)return _;if(r.TP.hasPermission(g.AccessControlAction.ActionTeamsRolesList))return await(0,A.xN)(f)}catch(v){console.error("Error loading options",v)}return[]},[f,_,c]);(0,O.useEffect)(()=>{E()},[E]);const L=async v=>{I?d&&d(v):(await(0,A.G3)(v,f),await E())},C=r.TP.hasPermission(g.AccessControlAction.ActionTeamsRolesAdd)&&r.TP.hasPermission(g.AccessControlAction.ActionTeamsRolesRemove);return O.createElement(M.n,{apply:I,onRolesChange:L,roleOptions:m,appliedRoles:T,isLoading:x||h,disabled:s,basicRoleDisabled:!0,canUpdateRoles:C,maxWidth:y,width:W})}},52576:(G,p,e)=>{e.r(p),e.d(p,{TeamList:()=>j,default:()=>U});var O=e(32196),t=e(96540),r=e(70255),g=e(69733),M=e(40845),A=e(12942),u=e(67061),f=e(56034),m=e(14578),s=e(91605),c=e(55852),d=e(14186),_=e(67647),I=e(28389),y=e(19384),W=e(7521),h=e(36830),x=e(85927),T=e(16233),E=e(80348),L=e(31084),C=e(33667);const v=new Array(3).fill(null).map((P,R)=>({id:R,memberCount:0,name:"",orgId:0,permission:0})),j=({teams:P,query:R,noTeams:N,hasFetched:D,loadTeams:K,deleteTeam:B,changeQuery:H,totalPages:X,page:Z,rolesLoading:Q,changePage:w,changeSort:F})=>{const[Y,k]=(0,t.useState)([]),$=(0,M.of)(b);(0,t.useEffect)(()=>{K(!0)},[K]),(0,t.useEffect)(()=>{T.TP.licensedAccessControlEnabled()&&T.TP.hasPermission(E.AccessControlAction.ActionRolesList)&&(0,x.RL)().then(i=>k(i))},[]);const z=T.TP.hasPermission(E.AccessControlAction.ActionTeamsCreate),V=a(),q=(0,t.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>D?i&&t.createElement(A.e,{src:i,alt:"User avatar"}):t.createElement(r.A,{containerClassName:$.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i}})=>D?i:t.createElement(r.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>D?i:t.createElement(r.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>D?i:t.createElement(r.A,{width:40}),sortType:"number"},...V?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:S}})=>D?T.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRolesList,S)&&t.createElement(L.Y,{teamId:S.id,roles:S.roles||[],isLoading:Q,roleOptions:Y,width:40}):t.createElement(r.A,{width:320,height:32,containerClassName:$.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!D)return t.createElement(u.B,{direction:"row",justifyContent:"flex-end",alignItems:"center"},t.createElement(r.A,{containerClassName:$.blockSkeleton,width:16,height:16}),t.createElement(r.A,{containerClassName:$.blockSkeleton,width:22,height:24}));const S=T.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRead,i),J=T.TP.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsDelete,i);return t.createElement(u.B,{direction:"row",justifyContent:"flex-end"},S&&t.createElement(f.m,{content:"Edit team"},t.createElement("a",{href:`org/teams/edit/${i.id}`,"aria-label":`Edit team ${i.name}`},t.createElement(m.I,{name:"pen"}))),t.createElement(s.e,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!J,onConfirm:()=>B(i.id)}))}}],[V,D,Q,Y,B,$]);return t.createElement(h.Y,{navId:"teams",actions:t.createElement(c.z9,{href:z?"org/teams/new":"#",disabled:!z},"New Team")},t.createElement(h.Y.Contents,null,N?t.createElement(W.A,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!T.TP.hasPermission(E.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement(d.I,{grow:!0},t.createElement(_.Z,{placeholder:"Search teams",value:R,onChange:H}))),t.createElement(u.B,{direction:"column",gap:2},t.createElement(I.j,{columns:q,data:D?P:v,getRowId:i=>String(i.id),fetchData:F}),t.createElement(u.B,{justifyContent:"flex-end"},t.createElement(y.d,{hideWhenSinglePage:!0,currentPage:Z,numberOfPages:X,onNavigate:w}))))))};function a(){return T.TP.licensedAccessControlEnabled()&&T.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&T.TP.hasPermission(E.AccessControlAction.ActionRolesList)}function n(P){return{teams:P.teams.teams,query:P.teams.query,perPage:P.teams.perPage,page:P.teams.page,noTeams:P.teams.noTeams,totalPages:P.teams.totalPages,hasFetched:P.teams.hasFetched,rolesLoading:P.teams.rolesLoading}}const o={loadTeams:C.Bu,deleteTeam:C.To,changePage:C.yd,changeQuery:C.nM,changeSort:C.Vk},U=(0,g.connect)(n,o)(j),b=P=>({blockSkeleton:(0,O.css)({lineHeight:1,display:"flex"})})},33667:(G,p,e)=>{e.d(p,{Bu:()=>s,It:()=>C,To:()=>_,Vk:()=>W,aK:()=>L,eo:()=>d,n7:()=>E,nC:()=>v,nM:()=>I,yd:()=>y});var O=e(2543),t=e.n(O),r=e(17172),g=e(82467),M=e(10096),A=e(80714),u=e(80348),f=e(700),m=e(34655);function s(a=!1){return async(n,o)=>{const{query:l,page:U,perPage:b,sort:P}=o().teams;if(!M.TP.hasPermission(u.AccessControlAction.ActionTeamsRead)){n((0,m.Q9)({teams:[],totalCount:0,page:1,perPage:b,noTeams:!0}));return}const R=await(0,r.AI)().get("/api/teams/search",(0,A.F)({query:l,page:U,perpage:b,sort:P}));let N=!1;if(a&&(N=R.teams.length===0),M.TP.licensedAccessControlEnabled()&&M.TP.hasPermission(u.AccessControlAction.ActionTeamsRolesList)){n((0,m.dJ)());const D=R?.teams.map(B=>B.id),K=await(0,r.AI)().post("/api/access-control/teams/roles/search",{teamIds:D});R.teams.forEach(B=>{B.roles=K?K[B.id]||[]:[]}),n((0,m.jE)())}n((0,m.Q9)({noTeams:N,...R}))}}const c=(0,O.debounce)(a=>a(s()),500);function d(a){return async n=>{const o=await(0,r.AI)().get(`/api/teams/${a}`,(0,A.F)());n((0,m.$T)(o)),n((0,g.Vz)((0,f.R)(o)))}}function _(a){return async n=>{await(0,r.AI)().delete(`/api/teams/${a}`),await M.TP.fetchUserPermissions(),n(s())}}function I(a){return async n=>{n((0,m.L5)(a)),c(n)}}function y(a){return async n=>{n((0,m.EC)(a)),n(s())}}function W({sortBy:a}){const n=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,m.$u)(n)),o(s())}}function h(){return async(a,n)=>{const o=n().team.team,l=await getBackendSrv().get(`/api/teams/${o.id}/members`);a(teamMembersLoaded(l))}}function x(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().post(`/api/teams/${l.id}/members`,{userId:a}),n(h())}}function T(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().delete(`/api/teams/${l.id}/members/${a}`),n(h())}}function E(a,n){return async(o,l)=>{const U=l().team.team;await(0,r.AI)().put(`/api/teams/${U.id}`,{name:a,email:n}),o(d(U.id))}}function L(){return async(a,n)=>{const o=n().team.team,l=await(0,r.AI)().get(`/api/teams/${o.id}/groups`);a((0,m.tC)(l))}}function C(a){return async(n,o)=>{const l=o().team.team;await(0,r.AI)().post(`/api/teams/${l.id}/groups`,{groupId:a}),n(L())}}function v(a){return async(n,o)=>{const l=o().team.team;await(0,r.AI)().delete(`/api/teams/${l.id}/groups?groupId=${encodeURIComponent(a)}`),n(L())}}function j(a){return async n=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),n(h())}}},700:(G,p,e)=>{e.d(p,{R:()=>f,X:()=>m});var O=e(33378),t=e(76323),r=e(2913),g=e(16233),M=e(35538),A=e(80348);const u={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:A.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function f(s){const c={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===u||g.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsPermissionsRead,s))&&c.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const d={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},_=s===u;return(0,M.z5)()&&(d.tabSuffix=()=>(0,t.J)({experimentId:_?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,O.a)("teamsync")?(_||g.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsPermissionsRead,s))&&c.children.push(d):r.Ay.featureToggles.featureHighlights&&c.children.push({...d,tabSuffix:()=>(0,t.J)({experimentId:_?"":"feature-highlights-team-sync-badge"})}),c}function m(s){const c=f(u);let d;for(const _ of c.children)if(_.id.indexOf(s)>0){_.active=!0,d=_;break}return{main:c,node:d}}}}]);

//# sourceMappingURL=TeamList.2e23d37c91734f608f09.js.map