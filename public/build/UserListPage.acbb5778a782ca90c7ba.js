"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743,9856],{20972:(fe,N,a)=>{a.r(N),a.d(N,{default:()=>ze});var s=a(32196),e=a(96540),A=a(13544),C=a(32264),U=a(33378),y=a(40675),L=a(40845),F=a(63021),d=a(44836),w=a(16233),V=a(72254),Q=a(36830),X=a(80348),q=a(31083),_=a(69733),ee=a(67647),x=a(94354),M=a(55852),ce=a(10096),te=a(12942),D=a(67061),R=a(56034),$=a(14578),K=a(94753),P=a(78369),W=a(28389),ae=a(19384),G=a(46334),se=a(90613);const f=({units:t,icon:r})=>t?.length?t.length>1?e.createElement(R.m,{placement:"top",content:e.createElement(D.B,{direction:"column"},t?.map(l=>e.createElement("span",{key:l.name},l.name)))},e.createElement(b,{icon:r},t.length)):e.createElement(b,{icon:r},t[0].name):null,b=(0,e.forwardRef)(({children:t,icon:r},l)=>e.createElement(se.a,{ref:l,display:"flex",alignItems:"center",marginRight:1},e.createElement($.I,{name:r})," ",e.createElement(se.a,{marginLeft:1},t)));b.displayName="TooltipContent";const ne=({users:t,showPaging:r,totalPages:l,onChangePage:E,currentPage:h,fetchData:g})=>{const T=(0,e.useMemo)(()=>t.some(o=>o.licensedRole),[t]),u=(0,e.useMemo)(()=>t.some(o=>o.orgs),[t]),k=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:o}})=>o&&e.createElement(te.e,{src:o,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:o}})=>o,sortType:"string"},...u?[{id:"orgs",header:"Belongs to",cell:({cell:{value:o,row:I}})=>e.createElement(D.B,{alignItems:"center"},e.createElement(f,{units:o,icon:"building"}),I.original.isAdmin&&e.createElement(R.m,{placement:"top",content:"Grafana Admin"},e.createElement($.I,{name:"shield"}))),sortType:(o,I)=>(o.original.orgs?.length||0)-(I.original.orgs?.length||0)}]:[],...T?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:o}})=>o==="None"?e.createElement(K.E,{color:"disabled"},"Not assigned"," ",e.createElement(R.m,{placement:"top",content:"A licensed role will be assigned when this user signs in"},e.createElement($.I,{name:"question-circle"}))):o,sortType:"string"}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:o}})=>e.createElement(e.Fragment,null,o&&e.createElement(e.Fragment,null,o==="10 years"?e.createElement(K.E,{color:"disabled"},"Never"):o)),sortType:(o,I)=>new Date(o.original.lastSeenAt).getTime()-new Date(I.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:o}})=>e.createElement(e.Fragment,null,Array.isArray(o)&&o.length>0&&e.createElement(G.E,{label:o[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:o}})=>e.createElement(e.Fragment,null,o&&e.createElement(P.v,{colorIndex:9,name:"Disabled"}))},{id:"edit",header:"",cell:({row:{original:o}})=>e.createElement("a",{href:`admin/users/edit/${o.id}`,"aria-label":`Edit team ${o.name}`},e.createElement(R.m,{content:"Edit user"},e.createElement($.I,{name:"pen"})))}],[T,u]);return e.createElement(D.B,{direction:"column",gap:2},e.createElement(W.j,{columns:k,data:t,getRowId:o=>String(o.id),fetchData:g}),r&&e.createElement(D.B,{justifyContent:"flex-end"},e.createElement(ae.d,{numberOfPages:l,currentPage:h,onNavigate:E})))};var v=a(57334);const j=[],ie=t=>{j.push(t)},de=A.Tp.pages.UserListPage.UserListAdminPage,me={fetchUsers:v.hU,changeQuery:v.nM,changePage:v.yd,changeFilter:v.$u,changeSort:v.Vk},c=t=>({users:t.userListAdmin.users,query:t.userListAdmin.query,showPaging:t.userListAdmin.showPaging,totalPages:t.userListAdmin.totalPages,page:t.userListAdmin.page,filters:t.userListAdmin.filters}),Y=(0,_.connect)(c,me)(({fetchUsers:t,query:r,changeQuery:l,users:E,showPaging:h,changeFilter:g,filters:T,totalPages:u,page:k,changePage:o,changeSort:I})=>{const oe=(0,L.of)(Oe);return(0,e.useEffect)(()=>{t()},[t]),e.createElement(Q.Y.Contents,null,e.createElement("div",{className:oe.actionBar,"data-testid":de.container},e.createElement("div",{className:oe.row},e.createElement(ee.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:r,onChange:l}),e.createElement(x.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:pe=>g({name:"activeLast30Days",value:pe}),value:T.find(pe=>pe.name==="activeLast30Days")?.value,className:oe.filter}),j.map((pe,Qe)=>e.createElement(pe,{key:Qe,filters:T,onChange:g,className:oe.filter})),ce.TP.hasPermission(X.AccessControlAction.UsersCreate)&&e.createElement(M.z9,{href:"admin/users/create",variant:"primary"},"New user"))),e.createElement(ne,{users:E,showPaging:h,totalPages:u,onChangePage:o,currentPage:k,fetchData:I}))});function Ne(){return React.createElement(Page,{navId:"global-users"},React.createElement(Y,null))}const Oe=t=>({filter:(0,s.css)({margin:t.spacing(0,1),[t.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,s.css)({marginBottom:t.spacing(2),display:"flex",alignItems:"flex-start",gap:t.spacing(2),[t.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,s.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:t.spacing(.5),flexGrow:1,[t.breakpoints.down("sm")]:{flexWrap:"wrap",gap:t.spacing(2),width:"100%"}})}),Be=null;var be=a(39938),Ae=a(23088);const Ue=t=>{if(!t.includes(" "))return{browser:t,computer:""};const r=t.split(" ");return{browser:r[0],computer:r[1]}},ue=(t,r)=>t.length>r?t.substring(0,r)+"...":t,ye=({value:t})=>{const r=Ue(t);return e.createElement(R.m,{theme:"info-alt",content:t,placement:"top-end",interactive:!0},e.createElement("span",null,ue(r.browser,10),ue(r.computer,10)))},Le=({devices:t,showPaging:r,totalPages:l,onChangePage:E,currentPage:h,fetchData:g})=>{const T=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:u}})=>u&&e.createElement(te.e,{src:u,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:u}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:u}})=>e.createElement(ye,{value:u}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:u}})=>u,sortType:(u,k)=>new Date(u.original.updatedAt).getTime()-new Date(k.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:u}})=>u&&e.createElement(be.E,{text:u,color:"orange"})}],[]);return e.createElement(D.B,{direction:"column",gap:2},e.createElement(W.j,{columns:T,data:t,getRowId:u=>u.deviceId,fetchData:g}),r&&e.createElement(D.B,{justifyContent:"flex-end"},e.createElement(ae.d,{numberOfPages:l,currentPage:h,onNavigate:E})),t.length===0&&e.createElement(Ae.Z,null,e.createElement("span",null,"No anonymous users found.")))},n={fetchUsersAnonymousDevices:v.xq,changeAnonUserSort:v.A5,changeAnonPage:v.is,changeAnonQuery:v.Bc},i=t=>({devices:t.userListAnonymousDevices.devices,query:t.userListAnonymousDevices.query,showPaging:t.userListAnonymousDevices.showPaging,totalPages:t.userListAnonymousDevices.totalPages,page:t.userListAnonymousDevices.page,filters:t.userListAnonymousDevices.filters}),m=A.Tp.pages.UserListPage.UserListAdminPage,z=(0,_.connect)(i,n)(({devices:t,fetchUsersAnonymousDevices:r,query:l,changeAnonQuery:E,filters:h,showPaging:g,totalPages:T,page:u,changeAnonPage:k,changeAnonUserSort:o})=>{const I=(0,L.of)(H);return(0,e.useEffect)(()=>{r()},[r]),e.createElement(Q.Y.Contents,null,e.createElement("div",{className:I.actionBar,"data-testid":m.container},e.createElement("div",{className:I.row},e.createElement(ee.Z,{placeholder:"Search devices by ip adress.",autoFocus:!0,value:l,onChange:E}),e.createElement(x.z,{options:[{label:"Active last 30 days",value:!0}],value:h.find(oe=>oe.name==="activeLast30Days")?.value,className:I.filter}))),e.createElement(Le,{devices:t,showPaging:g,totalPages:T,onChangePage:k,currentPage:u,fetchData:o}))});function Z(){return React.createElement(Page,{navId:"anonymous-users"},React.createElement(z,null))}const H=t=>({filter:(0,s.css)({margin:t.spacing(0,1),[t.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,s.css)({marginBottom:t.spacing(2),display:"flex",alignItems:"flex-start",gap:t.spacing(2),[t.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,s.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:t.spacing(.5),flexGrow:1,[t.breakpoints.down("sm")]:{flexWrap:"wrap",gap:t.spacing(2),width:"100%"}})}),re=null;var J=a(66864),S=a(72686),Ee=a(37390),De=a(39558),le=a(71678);const Te=A.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,Pe=({email:t,onDismiss:r})=>{const l=(0,L.of)(Ce),{data:E,isLoading:h}=(0,S.kd)(t);return e.createElement(Ee.a,{className:l.modal,isOpen:!0,title:(0,d.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:r},h?e.createElement("div",{className:l.loading},e.createElement(De._,{text:(0,d.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})):E?.map(g=>e.createElement("div",{key:g.dashboardUid,className:l.listItem,"data-testid":Te.listItem(g.dashboardUid)},e.createElement("p",{className:l.dashboardTitle},g.dashboardTitle),e.createElement("div",{className:l.urlsContainer},e.createElement("a",{rel:"noreferrer",target:"_blank",className:(0,s.cx)("external-link",l.url),href:(0,V.mL)(g.publicDashboardAccessToken),onClick:r},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link"},"Public dashboard URL")),e.createElement("span",{className:l.urlsDivider},"\u2022"),e.createElement("a",{className:(0,s.cx)("external-link",l.url),href:(0,V.gN)(g.dashboardUid,g.slug),onClick:r},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting"},"Public dashboard settings"))),e.createElement("hr",{className:l.divider}))))},Ie=({email:t})=>{const r=(0,d.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return e.createElement(le.$s,null,({showModal:l,hideModal:E})=>e.createElement(M.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:r,"aria-label":r,onClick:()=>l(Pe,{email:t,onDismiss:E})}))},Ce=t=>({modal:(0,s.css)`
    width: 590px;
  `,loading:(0,s.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,s.css)`
    display: flex;
    flex-direction: column;
    gap: ${t.spacing(.5)};
  `,divider:(0,s.css)`
    margin: ${t.spacing(1.5,0)};
    color: ${t.colors.text.secondary};
  `,urlsContainer:(0,s.css)`
    display: flex;
    gap: ${t.spacing(.5)};

    ${t.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,s.css)`
    color: ${t.colors.text.secondary};
    ${t.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
    font-weight: ${t.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
  `}),xe=({user:t,hideModal:r})=>{const[l]=(0,S.g9)(),E=(0,L.of)(he),h=()=>{l({email:t.email}),r()};return e.createElement(Ee.a,{className:E.modal,isOpen:!0,title:(0,d.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:r},e.createElement("p",{className:E.description},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1"},"Are you sure you want to revoke access for ",{email:t.email},"?")),e.createElement("p",{className:E.description},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0},"This action will immediately revoke ",{email:t.email},"'s access to all public dashboards.")),e.createElement(Ee.a.ButtonRow,null,e.createElement(M.$n,{type:"button",variant:"secondary",onClick:r,fill:"outline"},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button"},"Cancel")),e.createElement(M.$n,{type:"button",variant:"destructive",onClick:h},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button"},"Revoke access"))))},Me=({user:t})=>{const r=(0,d.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return e.createElement(le.$s,null,({showModal:l,hideModal:E})=>e.createElement(M.$n,{size:"sm",variant:"destructive",onClick:()=>l(xe,{user:t,hideModal:E}),icon:"times","aria-label":r,title:r}))},he=t=>({modal:(0,s.css)`
    width: 500px;
  `,description:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
    margin: 0;
  `}),Re=A.Tp.pages.UserListPage.publicDashboards,$e=()=>{const{data:t,isLoading:r}=(0,S.AK)();return e.createElement(Q.Y.Contents,{isLoading:r},e.createElement("table",{className:"filter-table form-inline","data-testid":Re.container},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label"},"Email")),e.createElement("th",null,e.createElement("span",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label"},"Activated")),e.createElement(R.m,{placement:"top",content:(0,d.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard")},e.createElement($.I,{name:"question-circle"}))),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label"},"Last active")),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label"},"Origin")),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,t?.map(l=>e.createElement("tr",{key:l.email},e.createElement("td",{className:"max-width-10"},e.createElement("span",{className:"ellipsis",title:l.email},l.email)),e.createElement("td",{className:"max-width-10"},l.firstSeenAtAge),e.createElement("td",{className:"max-width-10"},l.lastSeenAtAge),e.createElement("td",{className:"max-width-10"},e.createElement(J.Gy,{spacing:"sm"},e.createElement("span",null,l.totalDashboards," dashboard(s)"),e.createElement(Ie,{email:l.email}))),e.createElement("td",{className:"max-width-10"},e.createElement(P.v,{name:"Viewer",colorIndex:19})),e.createElement("td",{className:"text-right"},e.createElement(Me,{user:l})))))))};var Ke=(t=>(t.ADMIN="admin",t.ORG="org",t.PUBLIC_DASHBOARDS="public-dashboards",t.ANON="anon",t))(Ke||{});const ve=A.Tp.pages.UserListPage,Se=({view:t,setView:r})=>e.createElement(y.o,{label:(0,d.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:t==="public-dashboards",onChangeTab:()=>r("public-dashboards"),"data-testid":ve.tabs.publicDashboardsUsers}),We={admin:e.createElement(Y,null),org:e.createElement(q.UsersListPageContent,null),["public-dashboards"]:e.createElement($e,null),anon:e.createElement(z,null)};function ze(){const t=(0,L.of)(Fe),r=w.TP.hasPermission(X.AccessControlAction.UsersRead),l=w.TP.hasPermission(X.AccessControlAction.OrgUsersRead),E=(0,V.iR)()&&!!C.$.featureToggles.publicDashboardsEmailSharing&&(0,U.a)("publicDashboardsEmailSharing"),[h,g]=(0,e.useState)(()=>r?"admin":l?"org":null),T=l&&r;return e.createElement(Q.Y,{navId:"global-users"},T?e.createElement(F.U,{className:t.tabsMargin},e.createElement(y.o,{label:"All users",active:h==="admin",onChangeTab:()=>g("admin"),"data-testid":ve.tabs.allUsers}),e.createElement(y.o,{label:"Organization users",active:h==="org",onChangeTab:()=>g("org"),"data-testid":ve.tabs.orgUsers}),C.$.anonymousEnabled&&C.$.featureToggles.displayAnonymousStats&&e.createElement(y.o,{label:"Anonymous devices",active:h==="anon",onChangeTab:()=>g("anon"),"data-testid":ve.tabs.anonUserDevices}),E&&e.createElement(Se,{view:h,setView:g})):E&&e.createElement(F.U,{className:t.tabsMargin},e.createElement(y.o,{label:"Users",active:h==="org",onChangeTab:()=>g("org"),"data-testid":ve.tabs.users}),e.createElement(Se,{view:h,setView:g})),h?We[h]:e.createElement(q.UsersListPageContent,null))}const Fe=t=>({tabsMargin:(0,s.css)({marginBottom:t.spacing(3)})})},69546:(fe,N,a)=>{a.d(N,{b:()=>$});var s=a(96540),e=a(13544),A=a(12942),C=a(94753),U=a(90613),y=a(56034),L=a(14578),F=a(78369),d=a(55852),w=a(67061),V=a(28389),Q=a(19384),X=a(96374),q=a(89062),_=a(85927),ee=a(46334),x=a(10096),M=a(80348),ce=a(5133);const te=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,D=K=>{const P=K?.isExternallySynced;return!x.TP.hasPermissionInMetadata(M.AccessControlAction.OrgUsersWrite,K)||P},R=e.Tp.pages.UserListPage.UsersListPage,$=({users:K,orgId:P,onRoleChange:W,onRemoveUser:ae,fetchData:G,changePage:se,page:f,totalPages:b,rolesLoading:ne})=>{const[v,j]=(0,s.useState)(null),[ie,de]=(0,s.useState)([]);(0,s.useEffect)(()=>{async function c(){try{if(x.TP.hasPermission(M.AccessControlAction.ActionRolesList)){let p=await(0,_.RL)(P);de(p)}}catch{console.error("Error loading options")}}x.TP.licensedAccessControlEnabled()&&c()},[P]);const me=(0,s.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:c}})=>c&&s.createElement(A.e,{src:c,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:c}})=>s.createElement("div",null,c),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,c&&s.createElement(s.Fragment,null,c==="10 years"?s.createElement(C.E,{color:"disabled"},"Never"):c)),sortType:(c,p)=>new Date(c.original.lastSeenAt).getTime()-new Date(p.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:c},row:{original:p}})=>{const ge=D(p);return x.TP.licensedAccessControlEnabled()?s.createElement(q.y,{userId:p.userId,roles:p.roles||[],isLoading:ne,orgId:P,roleOptions:ie,basicRole:c,onBasicRoleChange:Y=>W(Y,p),basicRoleDisabled:ge,basicRoleDisabledMessage:te,width:40}):s.createElement(ce.r,{"aria-label":"Role",value:c,disabled:ge,onChange:Y=>W(Y,p)})}},{id:"info",header:"",cell:({row:{original:c}})=>D(c)&&s.createElement(U.a,{display:"flex",alignItems:"center",marginLeft:1},s.createElement(y.m,{interactive:!0,content:s.createElement("div",null,"This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",s.createElement("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank"},"Grafana authentication docs"),"\xA0for details.")},s.createElement(L.I,{name:"question-circle"})))},{id:"authLabels",header:"Origin",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,Array.isArray(c)&&c.length>0&&s.createElement(ee.E,{label:c[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,c&&s.createElement(F.v,{colorIndex:9,name:"Disabled"}))},{id:"delete",header:"",cell:({row:{original:c}})=>x.TP.hasPermissionInMetadata(M.AccessControlAction.OrgUsersRemove,c)&&s.createElement(d.$n,{size:"sm",variant:"destructive",onClick:()=>{j(c)},icon:"times","aria-label":`Delete user ${c.name}`})}],[ne,P,ie,W]);return s.createElement(w.B,{direction:"column",gap:2,"data-testid":R.container},s.createElement(V.j,{columns:me,data:K,getRowId:c=>String(c.userId),fetchData:G}),s.createElement(w.B,{justifyContent:"flex-end"},s.createElement(Q.d,{onNavigate:se,currentPage:f,numberOfPages:b,hideWhenSinglePage:!0})),!!v&&s.createElement(X.u,{body:`Are you sure you want to delete user ${v?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{j(null)},isOpen:!0,onConfirm:()=>{v&&(ae(v),j(null))}}))}},23088:(fe,N,a)=>{a.d(N,{Z:()=>C});var s=a(32196),e=a(96540),A=a(40845);const C=({children:y})=>{const L=(0,A.of)(U);return e.createElement("div",{className:L.container},y)},U=y=>({container:(0,s.css)`
      background-color: ${y.colors.background.secondary};
      color: ${y.colors.text.secondary};
      padding: ${y.spacing(4)};
      text-align: center;
    `})},31083:(fe,N,a)=>{a.r(N),a.d(N,{UsersListPageContent:()=>ye,UsersListPageUnconnected:()=>ue,default:()=>Le});var s=a(96540),e=a(69733),A=a(36663),C=a(36830),U=a(10096),y=a(69546),L=a(10534),F=a(55852),d=a(47259);const w={revokeInvite:d.eb},V=(0,e.connect)(null,w);class Q extends s.PureComponent{render(){const{invitee:i,revokeInvite:m}=this.props;return s.createElement("tr",null,s.createElement("td",null,i.email),s.createElement("td",null,i.name),s.createElement("td",{className:"text-right"},s.createElement(L.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>i.url},"Copy Invite"),"\xA0"),s.createElement("td",null,s.createElement(F.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>m(i.code),"aria-label":"Revoke Invite"})))}}const X=V(Q);class q extends s.PureComponent{render(){const{invitees:i}=this.props;return s.createElement("table",{className:"filter-table form-inline"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,"Email"),s.createElement("th",null,"Name"),s.createElement("th",null),s.createElement("th",{style:{width:"34px"}}))),s.createElement("tbody",{"data-testid":"InviteesTable-body"},i.map((m,O)=>s.createElement(X,{key:`${m.id}-${O}`,invitee:m}))))}}var _=a(1081),ee=a(40823);const{selectAll:x,selectById:M,selectTotal:ce}=ee.Tp,te=(n,i)=>i,D=(0,_.Mz)([x,te],(n,i)=>{const m=new RegExp(i,"i");return n.filter(B=>m.test(B.name)||m.test(B.email))});var R=a(14186),$=a(67647),K=a(94354),P=a(2913),W=a(80348),ae=a(2543),G=a(17172),se=a(80714),f=a(87617);function b(){return async(n,i)=>{try{n((0,f.Cj)());const{perPage:m,page:O,searchQuery:B,sort:z}=i().users,Z=await(0,G.AI)().get("/api/org/users/search",(0,se.F)({perpage:m,page:O,query:B,sort:z}));if(U.TP.licensedAccessControlEnabled()&&U.TP.hasPermission(W.AccessControlAction.ActionUserRolesList)){n((0,f.dJ)());const H=U.TP.user.orgId,re=Z?.orgUsers.map(S=>S.userId),J=await(0,G.AI)().post("/api/access-control/users/roles/search",{userIds:re,orgId:H});Z.orgUsers.forEach(S=>{S.roles=J?J[S.userId]||[]:[]}),n((0,f.jE)())}n((0,f.Y_)(Z))}catch{(0,f.g4)()}}}const ne=(0,ae.debounce)(n=>n(b()),300);function v(n){return async i=>{await(0,G.AI)().patch(`/api/org/users/${n.userId}`,{role:n.role}),i(b())}}function j(n){return async i=>{await(0,G.AI)().delete(`/api/org/users/${n}`),i(b())}}function ie(n){return async i=>{i((0,f.EC)(n)),i(b())}}function de({sortBy:n}){const i=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async m=>{m((0,f.$u)(i)),m(b())}}function me(n){return async i=>{i((0,f.t_)(n)),ne(i)}}const c=n=>{const i=new RegExp(n.searchQuery,"i");return n.users.filter(m=>i.test(m.login)||i.test(m.email)||i.test(m.name))},p=n=>n.searchQuery;function ge(n){return{searchQuery:p(n.users),pendingInvitesCount:ce(n.invites),externalUserMngLinkName:n.users.externalUserMngLinkName,externalUserMngLinkUrl:n.users.externalUserMngLinkUrl}}const Y={changeSearchQuery:me},Be=(0,e.connect)(ge,Y)(({externalUserMngLinkName:n,externalUserMngLinkUrl:i,searchQuery:m,pendingInvitesCount:O,changeSearchQuery:B,onShowInvites:z,showInvites:Z})=>{const H=[{label:"Users",value:"users"},{label:`Pending Invites (${O})`,value:"invites"}],J=U.TP.hasPermission(W.AccessControlAction.OrgUsersAdd)&&!(P.Ay.disableLoginForm&&P.Ay.externalUserMngInfo);return s.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},s.createElement(R.I,{grow:!0},s.createElement($.Z,{value:m,onChange:B,placeholder:"Search user by login, email or name"})),O>0&&s.createElement("div",{style:{marginLeft:"1rem"}},s.createElement(K.z,{value:Z?"invites":"users",options:H,onChange:z})),J&&s.createElement(F.z9,{href:"org/users/invite"},"Invite"),i&&s.createElement(F.z9,{href:i,target:"_blank",rel:"noopener"},n))});function be(n){const i=p(n.users);return{users:c(n.users),searchQuery:p(n.users),page:n.users.page,totalPages:n.users.totalPages,perPage:n.users.perPage,invitees:D(n.invites,i),externalUserMngInfo:n.users.externalUserMngInfo,isLoading:n.users.isLoading,rolesLoading:n.users.rolesLoading}}const Ae={loadUsers:b,fetchInvitees:d.G7,changePage:ie,changeSort:de,updateUser:v,removeUser:j},Ue=(0,e.connect)(be,Ae),ue=({users:n,page:i,totalPages:m,invitees:O,externalUserMngInfo:B,isLoading:z,rolesLoading:Z,loadUsers:H,fetchInvitees:re,changePage:J,updateUser:S,removeUser:Ee,changeSort:De})=>{const[le,Te]=(0,s.useState)(!1),Pe=B?(0,A.G)(B):"";(0,s.useEffect)(()=>{H(),re()},[re,H]);const Ie=(he,Re)=>{S({...Re,role:he})},Ce=he=>Ee(he.userId),xe=()=>{Te(!le)},Me=()=>le?s.createElement(q,{invitees:O}):s.createElement(y.b,{users:n,orgId:U.TP.user.orgId,rolesLoading:Z,onRoleChange:Ie,onRemoveUser:Ce,fetchData:De,changePage:J,page:i,totalPages:m});return s.createElement(C.Y.Contents,{isLoading:!z},s.createElement(Be,{onShowInvites:xe,showInvites:le}),Pe&&s.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:Pe}}),z&&Me())},ye=Ue(ue);function Le(){return s.createElement(C.Y,{navId:"users"},s.createElement(ye,null))}}}]);

//# sourceMappingURL=UserListPage.acbb5778a782ca90c7ba.js.map